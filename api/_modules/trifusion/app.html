

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>trifusion.app &mdash; TriFusion 0.5.5 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="TriFusion 0.5.5 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> TriFusion
          

          
          </a>

          
            
            
              <div class="version">
                0.5.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../trifusion.html">TriFusion modules and API reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TriFusion</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>trifusion.app</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for trifusion.app</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python2</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">#</span>
<span class="c1">#  Copyright 2012 Unknown &lt;diogo@arch&gt;</span>
<span class="c1">#</span>
<span class="c1">#  This program is free software; you can redistribute it and/or modify</span>
<span class="c1">#  it under the terms of the GNU General Public License as published by</span>
<span class="c1">#  the Free Software Foundation; either version 2 of the License, or</span>
<span class="c1">#  (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1">#  This program is distributed in the hope that it will be useful,</span>
<span class="c1">#  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1">#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1">#  GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1">#  You should have received a copy of the GNU General Public License</span>
<span class="c1">#  along with this program; if not, write to the Free Software</span>
<span class="c1">#  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,</span>
<span class="c1">#  MA 02110-1301, USA.</span>

<span class="c1"># Standard libraries imports</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">exists</span><span class="p">,</span> <span class="n">splitext</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">misc</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">ctypes</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">signal</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">Queue</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">stat</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">threading</span>

<span class="c1"># Move to Application&#39;s directory. This is a way of avoiding encoding</span>
<span class="c1"># issues when the full path to the application&#39;s directory contains</span>
<span class="c1"># non-ASCII characters. This way, the cur_dir attribute will be always</span>
<span class="c1"># set to &quot;.&quot;</span>
<span class="n">called_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s2">&quot;frozen&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">))</span>
<span class="k">elif</span> <span class="vm">__file__</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>

<span class="c1"># freeze_support must be called here so that multiprocessing work</span>
<span class="c1"># correctly on windows</span>
<span class="n">multiprocessing</span><span class="o">.</span><span class="n">freeze_support</span><span class="p">()</span>

<span class="c1"># Bypass default argument handling from kivy</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;KIVY_NO_ARGS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>

<span class="c1"># Comment this section until the EventLoop for sphinx building.</span>
<span class="c1"># Kivy imports</span>
<span class="c1"># from kivy.config import Config</span>
<span class="c1">#</span>
<span class="c1"># # Sets some kivy configurations before creating main window</span>
<span class="c1"># Config.set(&quot;kivy&quot;, &quot;desktop&quot;, 1)</span>
<span class="c1"># Config.set(&quot;kivy&quot;, &quot;exit_on_escape&quot;, 0)</span>
<span class="c1"># Config.set(&quot;graphics&quot;, &quot;resizable&quot;, 1)</span>
<span class="c1"># Config.set(&quot;graphics&quot;, &quot;fullscreen&quot;, 0)</span>
<span class="c1"># Config.set(&quot;graphics&quot;, &quot;minimum_height&quot;, 700)</span>
<span class="c1"># Config.set(&quot;graphics&quot;, &quot;minimum_width&quot;, 1000)</span>
<span class="c1"># Config.set(&quot;graphics&quot;, &quot;height&quot;, 700)</span>
<span class="c1"># Config.set(&quot;graphics&quot;, &quot;width&quot;, 1000)</span>
<span class="c1"># Config.set(&quot;graphics&quot;, &quot;multisamples&quot;, 4)</span>
<span class="c1"># Config.set(&quot;input&quot;, &quot;mouse&quot;, &quot;mouse, disable_multitouch&quot;)</span>
<span class="c1">#</span>
<span class="c1"># # Force creation of main window</span>
<span class="c1"># from kivy.base import EventLoop</span>
<span class="c1"># EventLoop.ensure_window()</span>

<span class="kn">from</span> <span class="nn">kivy.app</span> <span class="k">import</span> <span class="n">App</span>
<span class="kn">from</span> <span class="nn">kivy.animation</span> <span class="k">import</span> <span class="n">Animation</span>
<span class="kn">from</span> <span class="nn">kivy.uix.checkbox</span> <span class="k">import</span> <span class="n">CheckBox</span>
<span class="kn">from</span> <span class="nn">kivy.uix.scrollview</span> <span class="k">import</span> <span class="n">ScrollView</span>
<span class="kn">from</span> <span class="nn">kivy.lang</span> <span class="k">import</span> <span class="n">Builder</span>
<span class="kn">from</span> <span class="nn">kivy.properties</span> <span class="k">import</span> <span class="n">ListProperty</span><span class="p">,</span> <span class="n">DictProperty</span>
<span class="kn">from</span> <span class="nn">kivy.clock</span> <span class="k">import</span> <span class="n">Clock</span>
<span class="kn">from</span> <span class="nn">kivy.uix.treeview</span> <span class="k">import</span> <span class="n">TreeViewLabel</span>

<span class="c1"># Local TriFusion imports</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">__init__</span> <span class="k">import</span> <span class="n">__version__</span><span class="p">,</span> <span class="n">__build__</span>
    <span class="kn">import</span> <span class="nn">data.resources.theme.default</span> <span class="k">as</span> <span class="nn">tm</span>
    <span class="kn">from</span> <span class="nn">ortho</span> <span class="k">import</span> <span class="n">protein2dna</span>
    <span class="kn">from</span> <span class="nn">process.base</span> <span class="k">import</span> <span class="n">Base</span>
    <span class="kn">from</span> <span class="nn">process.data</span> <span class="k">import</span> <span class="n">Partitions</span><span class="p">,</span> <span class="n">InvalidPartitionFile</span>
    <span class="kn">from</span> <span class="nn">process.error_handling</span> <span class="k">import</span> <span class="n">EmptyAlignment</span><span class="p">,</span> <span class="n">EmptyData</span><span class="p">,</span> <span class="n">KillByUser</span><span class="p">,</span> \
        <span class="n">SingleAlignment</span>
    <span class="kn">from</span> <span class="nn">process.sequence</span> <span class="k">import</span> <span class="n">AlignmentList</span>
    <span class="kn">from</span> <span class="nn">data.resources.info_data</span> <span class="k">import</span> <span class="n">orthology_plots</span><span class="p">,</span> \
        <span class="n">informative_storage</span>
    <span class="kn">from</span> <span class="nn">data.resources.background_tasks</span> <span class="k">import</span> <span class="n">remove_tmp</span><span class="p">,</span> \
        <span class="n">load_proc</span><span class="p">,</span> <span class="n">get_stats_summary</span><span class="p">,</span> <span class="n">background_process</span><span class="p">,</span> \
        <span class="n">background_export_groups</span><span class="p">,</span> <span class="n">orto_execution</span><span class="p">,</span> <span class="n">process_execution</span><span class="p">,</span> \
        <span class="n">orto_update_filters</span><span class="p">,</span> <span class="n">get_active_group</span><span class="p">,</span> <span class="n">get_orto_data</span><span class="p">,</span> <span class="n">get_stats_data</span>
    <span class="kn">from</span> <span class="nn">data.resources.custom_widgets</span> <span class="k">import</span> <span class="o">*</span>
    <span class="kn">from</span> <span class="nn">data.resources.stats</span> <span class="k">import</span> <span class="o">*</span>
    <span class="kn">from</span> <span class="nn">base.plotter</span> <span class="k">import</span> <span class="n">scatter_plot</span><span class="p">,</span> <span class="n">bar_plot</span><span class="p">,</span> \
        <span class="n">interpolation_plot</span><span class="p">,</span> <span class="n">stacked_bar_plot</span><span class="p">,</span> <span class="n">box_plot</span><span class="p">,</span> <span class="n">histogram_smooth</span><span class="p">,</span> \
        <span class="n">histogram_plot</span><span class="p">,</span> <span class="n">triangular_heat</span><span class="p">,</span> <span class="n">outlier_densisty_dist</span><span class="p">,</span> \
        <span class="n">sliding_window</span>
    <span class="kn">from</span> <span class="nn">base.html_creator</span> <span class="k">import</span> <span class="n">HtmlTemplate</span>
    <span class="kn">from</span> <span class="nn">ortho.OrthomclToolbox</span> <span class="k">import</span> <span class="n">MultiGroupsLight</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">trifusion</span> <span class="k">import</span> <span class="n">__version__</span><span class="p">,</span> <span class="n">__build__</span>
    <span class="kn">import</span> <span class="nn">trifusion.data.resources.theme.default</span> <span class="k">as</span> <span class="nn">tm</span>
    <span class="kn">from</span> <span class="nn">trifusion.ortho</span> <span class="k">import</span> <span class="n">protein2dna</span>
    <span class="kn">from</span> <span class="nn">trifusion.process.base</span> <span class="k">import</span> <span class="n">Base</span>
    <span class="kn">from</span> <span class="nn">trifusion.process.data</span> <span class="k">import</span> <span class="n">Partitions</span><span class="p">,</span> <span class="n">InvalidPartitionFile</span>
    <span class="kn">from</span> <span class="nn">trifusion.process.error_handling</span> <span class="k">import</span> <span class="n">EmptyAlignment</span><span class="p">,</span> <span class="n">EmptyData</span><span class="p">,</span> \
        <span class="n">KillByUser</span><span class="p">,</span> <span class="n">SingleAlignment</span>
    <span class="kn">from</span> <span class="nn">trifusion.process.sequence</span> <span class="k">import</span> <span class="n">AlignmentList</span>
    <span class="kn">from</span> <span class="nn">trifusion.data.resources.info_data</span> <span class="k">import</span> <span class="n">orthology_plots</span><span class="p">,</span> \
        <span class="n">informative_storage</span>
    <span class="kn">from</span> <span class="nn">trifusion.data.resources.background_tasks</span> <span class="k">import</span> <span class="n">remove_tmp</span><span class="p">,</span> \
        <span class="n">load_proc</span><span class="p">,</span> <span class="n">get_stats_summary</span><span class="p">,</span> <span class="n">background_process</span><span class="p">,</span> \
        <span class="n">background_export_groups</span><span class="p">,</span> <span class="n">orto_execution</span><span class="p">,</span> <span class="n">process_execution</span><span class="p">,</span> \
        <span class="n">orto_update_filters</span><span class="p">,</span> <span class="n">get_active_group</span><span class="p">,</span> <span class="n">get_orto_data</span><span class="p">,</span> <span class="n">get_stats_data</span>
    <span class="kn">from</span> <span class="nn">trifusion.data.resources.custom_widgets</span> <span class="k">import</span> <span class="o">*</span>
    <span class="kn">from</span> <span class="nn">trifusion.data.resources.stats</span> <span class="k">import</span> <span class="o">*</span>
    <span class="kn">from</span> <span class="nn">trifusion.base.plotter</span> <span class="k">import</span> <span class="n">scatter_plot</span><span class="p">,</span> <span class="n">bar_plot</span><span class="p">,</span> \
        <span class="n">interpolation_plot</span><span class="p">,</span> <span class="n">stacked_bar_plot</span><span class="p">,</span> <span class="n">box_plot</span><span class="p">,</span> <span class="n">histogram_smooth</span><span class="p">,</span> \
        <span class="n">histogram_plot</span><span class="p">,</span> <span class="n">triangular_heat</span><span class="p">,</span> <span class="n">outlier_densisty_dist</span><span class="p">,</span> \
        <span class="n">sliding_window</span>
    <span class="kn">from</span> <span class="nn">trifusion.base.html_creator</span> <span class="k">import</span> <span class="n">HtmlTemplate</span>
    <span class="kn">from</span> <span class="nn">trifusion.ortho.OrthomclToolbox</span> <span class="k">import</span> <span class="n">MultiGroupsLight</span>

<span class="c1">###################################</span>
<span class="c1"># Modifications to kivy source code</span>
<span class="c1">###################################</span>

<span class="c1"># MEMO 1</span>
<span class="c1"># scatter.py on_touch_up function was modified to prevent a bug from</span>
<span class="c1"># crashing  the app. Before the fix, when right-clicking in a</span>
<span class="c1"># ScatterLayout and then  left-clicking in the generate ball would crash</span>
<span class="c1"># the app with a KeyError  exception. The fix on lines 595-598 handles</span>
<span class="c1"># this exception by not deleting a touch from _last_touch_pos</span>
<span class="c1"># dictionary, since the key is not there anymore.</span>
<span class="c1"># MEMO 2</span>
<span class="c1"># scrollview.py _change_touch_mode function was modified to prevent a bug</span>
<span class="c1"># from # crashing the app. Before the fix, sometimes the app would crash</span>
<span class="c1"># due to a KeyError exception on line 920. I did not detect any</span>
<span class="c1"># specific pattern for this  error and I could never replicate the bug,</span>
<span class="c1"># but every now and then the app  would crash. The fix on lines 920-923</span>
<span class="c1"># handles the KeyError exception by  returning the function.</span>
<span class="c1"># MEMO 3</span>
<span class="c1"># To avoid issues with non-ascii characters on the path of the binary</span>
<span class="c1"># file, some changes were performed on matplotlib and kivy files.</span>
<span class="c1"># .:Matplotlib:.</span>
<span class="c1">#   .: matplotlib/__init__.py :.</span>
<span class="c1">#      [l324](wrap()) Wrap the self.report() method around a try</span>
<span class="c1">#      statement and handle all exceptions attributing False to spoke</span>
<span class="c1">#      [l822](matplotlib_fname) hardcode the join() method with &quot;mpl-data&quot;</span>
<span class="c1">#   .: matplotlib/font_manager.py:.</span>
<span class="c1">#      [l1026](__init__()) Replace the &quot;datapath&quot; value of the rcParams</span>
<span class="c1">#      dictionary wit a relative path -&gt;</span>
<span class="c1">#      rcParams[&quot;datapath&quot;] = os.path.relpath(rcParams[&quot;datapath&quot;])</span>
<span class="c1">#   .: matplotlib/mathtext.py:.</span>
<span class="c1">#      [l1013](StandardPsFonts()) Wrap the get_data_path() function call</span>
<span class="c1">#      with a relative path -&gt;</span>
<span class="c1">#      basepath = os.path.join( os.path.relpath(get_data_path()),</span>
<span class="c1">#                              &#39;fonts&#39;, &#39;afm&#39; )</span>
<span class="c1">#   .: matplotlib/style/core.py:.</span>
<span class="c1">#      [l30] Same as previous -&gt;</span>
<span class="c1">#      BASE_LIBRARY_PATH = os.path.join(</span>
<span class="c1">#          os.path.relpath(mpl.get_data_path()), &#39;stylelib&#39;)</span>
<span class="c1"># .:Kivy:.</span>
<span class="c1">#   .: kivy/atlas.py :.</span>
<span class="c1">#      [l206] Wrap the dirname(filename) in a relative path -&gt;</span>
<span class="c1">#      d = os.path.relpath(dirname(filename))</span>
<span class="c1">#    .: kivy/core/text/text_sdl2.py :.</span>
<span class="c1">#      [l21](_get_font_id()) Replace the &quot;font_name_r&quot; value of the</span>
<span class="c1">#      self.options dictionary with a relative path -&gt;</span>
<span class="c1">#      self.options[&#39;font_name_r&#39;] = os.path.relpath(</span>
<span class="c1">#          self.options[&#39;font_name_r&#39;])</span>
<span class="c1">#    .: kivy/core/window/window_sdl2.py :.</span>
<span class="c1">#       [l339](set_icon()) Wrap the filename variable in a relative path -&gt;</span>
<span class="c1">#       self._win.set_window_icon(str(os.path.relpath(filename)))</span>

<span class="c1"># ==============================================================================</span>
<span class="c1">#                                  EXCEPTIONS</span>
<span class="c1"># ==============================================================================</span>

<span class="n">MCL_FILE</span> <span class="o">=</span> <span class="kc">None</span>


<div class="viewcode-block" id="InputTypeError"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.InputTypeError">[docs]</a><span class="k">class</span> <span class="nc">InputTypeError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="TriFusionApp"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp">[docs]</a><span class="k">class</span> <span class="nc">TriFusionApp</span><span class="p">(</span><span class="n">App</span><span class="p">):</span>

    <span class="c1">#######################</span>
    <span class="c1">#</span>
    <span class="c1"># GUI RELATED VARIABLES</span>
    <span class="c1">#</span>
    <span class="c1">#######################</span>

    <span class="c1"># Referecence to blue and red colors</span>
    <span class="n">_blue</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">c_app_blue</span>
    <span class="n">_red</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">c_app_red</span>

    <span class="n">show_side_panel</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    bool controlling the toggling of main headers. Is set to True</span>
<span class="sd">    when the sidepanel is open and False when not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lock_side_panel</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;bool that prevents the animation of the sidepanel when True.&quot;&quot;&quot;</span>

    <span class="n">screen</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Currently open Screen object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Variable containing screen names</span>
    <span class="n">screen_names</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">()</span>
    <span class="sd">&quot;&quot;&quot;List of basename screen names.&quot;&quot;&quot;</span>
    <span class="n">available_screens</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">()</span>
    <span class="sd">&quot;&quot;&quot;List of paths to screen files.&quot;&quot;&quot;</span>
    <span class="n">loaded_screens</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dictionary that maps the screen name to a Screen object. Entries are</span>
<span class="sd">    only populated when Screens are loaded for the first time. This</span>
<span class="sd">    allows the state of each screen to be saved.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plot_screens</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">()</span>
    <span class="sd">&quot;&quot;&quot;List of screens dedicated for plots.&quot;&quot;&quot;</span>

    <span class="c1"># Attributes to know current and previous screen</span>
    <span class="n">current_screen</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">()</span>
    <span class="sd">&quot;&quot;&quot;String with the name of the current Screen object.&quot;&quot;&quot;</span>
    <span class="n">previous_screen</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">()</span>
    <span class="sd">&quot;&quot;&quot;String with the name of the last Screen object.&quot;&quot;&quot;</span>

    <span class="c1"># Attribute to load screens</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">NumericProperty</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Create temporary directory for transient files</span>
    <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">()</span>
    <span class="n">log_file</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">()</span>
    <span class="n">bm_file</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">()</span>
    <span class="n">projects_file</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">()</span>

    <span class="c1"># Getting current directory to fetch the screen kv files</span>
    <span class="n">cur_dir</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>

    <span class="c1"># Only the original input files. SHOULD NOT BE MODIFIED</span>
    <span class="n">file_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Dynamic list containing only the active files</span>
    <span class="n">active_file_list</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">()</span>
    <span class="c1"># Dictionary mapping file names to their corresponding full paths. This</span>
    <span class="c1"># attribute must exist, because some parts of the code need only the</span>
    <span class="c1"># file name instead of the full path, but a connection to the full</span>
    <span class="c1"># path must  be maintained for future reference</span>
    <span class="n">filename_map</span> <span class="o">=</span> <span class="n">DictProperty</span><span class="p">()</span>

    <span class="c1"># Setting the list of taxa names</span>
    <span class="n">active_taxa_list</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">()</span>

    <span class="c1"># Attribute to the home path</span>
    <span class="n">home_path</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">))</span>

    <span class="c1"># Attribute with bookmarks for file chooser. The bookmark attribute is a</span>
    <span class="c1"># list containing a list with the full path of the bookmarks as the</span>
    <span class="c1"># first element and a dictionary mapping the full path to the bookmark</span>
    <span class="c1"># name as the second element</span>
    <span class="n">bookmarks</span> <span class="o">=</span> <span class="p">[[],</span> <span class="p">{}]</span>
    <span class="c1"># For mouse over purposes</span>
    <span class="n">bookmarks_bt</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Attribute that controls the DragNDrop timing.</span>
    <span class="n">drag_files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">drag_c</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">_popup</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">_subpopup</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">_exit_popup</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Dictionary containing the values for the main process operations</span>
    <span class="n">main_operations</span> <span class="o">=</span> <span class="n">DictProperty</span><span class="p">({</span>
        <span class="s2">&quot;concatenation&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;conversion&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;reverse_concatenation&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>

    <span class="c1"># Dictionary containing all values of the switches and checkboxes in the</span>
    <span class="c1"># process screen</span>
    <span class="n">secondary_operations</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="s2">&quot;collapse&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                                        <span class="p">(</span><span class="s2">&quot;filter&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                                        <span class="p">(</span><span class="s2">&quot;gcoder&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                                        <span class="p">(</span><span class="s2">&quot;consensus&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)])</span>

    <span class="n">secondary_options</span> <span class="o">=</span> <span class="n">DictProperty</span><span class="p">([(</span><span class="s2">&quot;interleave&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s2">&quot;zorro&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s2">&quot;collapse_file&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s2">&quot;collapse_filter&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s2">&quot;filter_file&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s2">&quot;taxa_filter&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s2">&quot;codon_filter&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s2">&quot;gap_filter&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s2">&quot;minimum_taxa_filter&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s2">&quot;variation_filter&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s2">&quot;gcoder_file&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s2">&quot;consensus_file&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s2">&quot;consensus_single&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),])</span>

    <span class="c1"># Attribute that controls whether a file is to be overwritten or skipped</span>
    <span class="c1"># For it to be active it must be a string with &quot;overwrite&quot; or &quot;skip&quot;,</span>
    <span class="c1"># otherwise it&#39;s ignored</span>
    <span class="n">file_overwrite</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">file_apply_all</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Attributes for the Orthology screen widgets</span>
    <span class="n">ortho_search_options</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">orto_search_height</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Attribute for the gridlayout widget that will contain all main options</span>
    <span class="c1"># for the process module</span>
    <span class="n">process_grid_wgt</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">process_options</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">process_height</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Attributes for Statistics summary stats</span>
    <span class="n">stats_summary</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">stats_table</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">MAX_TABLE_N</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">gene_table_selection</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">gene_master_table</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Attribute for the widget containing the treeview showing the</span>
    <span class="c1"># operations queue</span>
    <span class="n">operation_tv</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">main_nodes</span> <span class="o">=</span> <span class="n">DictProperty</span><span class="p">()</span>

    <span class="c1"># Attributes containing plot related elements</span>
    <span class="n">plot_backups</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">current_plt_idx</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">current_plot</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">allownone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">current_lgd</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">current_table</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">allownone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Alternate version for rapid plot switch. Only available for certain</span>
    <span class="c1">#   plots</span>
    <span class="n">alternative_plot</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">allownone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">alternative_lgd</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">alternative_table</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">allownone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Patch attribute</span>
    <span class="n">plt_patch</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># Dictionary with the plotmethods and file names for orthology plots</span>
    <span class="n">orto_plt_method</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Taxa distribution&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="n">bar_plot</span><span class="p">,</span> <span class="s2">&quot;Species_distribution.png&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Gene copy distribution&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="n">bar_plot</span><span class="p">,</span> <span class="s2">&quot;Gene_copy_distribution.png&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Taxa coverage&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="n">bar_plot</span><span class="p">,</span> <span class="s2">&quot;Species_coverage.png&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Taxa gene copies&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="n">bar_plot</span><span class="p">,</span> <span class="s2">&quot;Species_copy_number.png&quot;</span><span class="p">]</span>
    <span class="p">}</span>
    <span class="c1"># Dictionary with the plot methods and file names for each stats_idx</span>
    <span class="n">stats_plt_method</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Gene occupancy&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">interpolation_plot</span><span class="p">,</span> <span class="s2">&quot;gene_occupancy.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Distribution of missing data sp&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">stacked_bar_plot</span><span class="p">,</span> <span class="s2">&quot;missing_data_distribution_sp.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Distribution of missing data&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">histogram_smooth</span><span class="p">,</span> <span class="s2">&quot;missing_data_distribution.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Distribution of missing orthologs&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">bar_plot</span><span class="p">,</span> <span class="s2">&quot;missing_gene_distribution.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Distribution of missing orthologs avg&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">histogram_plot</span><span class="p">,</span> <span class="s2">&quot;missing_gene_distribution_avg.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Cumulative distribution of missing genes&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">bar_plot</span><span class="p">,</span> <span class="s2">&quot;cumulative_distribution_missing_genes.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Distribution of sequence size&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">box_plot</span><span class="p">,</span> <span class="s2">&quot;avg_seqsize_species.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Distribution of sequence size all&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">histogram_plot</span><span class="p">,</span> <span class="s2">&quot;avg_seqsize.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Proportion of nucleotides or residues&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">bar_plot</span><span class="p">,</span> <span class="s2">&quot;char_proportions.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Proportion of nucleotides or residues sp&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">stacked_bar_plot</span><span class="p">,</span> <span class="s2">&quot;char_proportions_sp.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Pairwise sequence similarity&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">histogram_plot</span><span class="p">,</span> <span class="s2">&quot;similarity_distribution.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Pairwise sequence similarity sp&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">triangular_heat</span><span class="p">,</span> <span class="s2">&quot;similarity_distribution_sp.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Pairwise sequence similarity gn&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">sliding_window</span><span class="p">,</span> <span class="s2">&quot;similarity_distribution_gn.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Segregating sites&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">histogram_plot</span><span class="p">,</span> <span class="s2">&quot;segregating_sites.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Segregating sites prop&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">histogram_plot</span><span class="p">,</span> <span class="s2">&quot;segregating_sites_prop.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Segregating sites sp&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">triangular_heat</span><span class="p">,</span> <span class="s2">&quot;segregating_sites_sp.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Segregating sites gn&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">sliding_window</span><span class="p">,</span> <span class="s2">&quot;segregating_sites_gn.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Alignment length/Polymorphism correlation&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">scatter_plot</span><span class="p">,</span> <span class="s2">&quot;length_polymorphism_correlation.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Distribution of taxa frequency&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">histogram_plot</span><span class="p">,</span> <span class="s2">&quot;distribution_taxa_frequency.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Allele Frequency Spectrum&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">histogram_plot</span><span class="p">,</span> <span class="s2">&quot;allele_frequency_spectrum.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Allele Frequency Spectrum prop&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">histogram_plot</span><span class="p">,</span> <span class="s2">&quot;allele_frequency_spectrum_prop.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Allele Frequency Spectrum gn&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">histogram_plot</span><span class="p">,</span> <span class="s2">&quot;allele_frequency_spectrum_gn.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Missing data outliers&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">outlier_densisty_dist</span><span class="p">,</span> <span class="s2">&quot;Missing_data_outliers.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Missing data outliers sp&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">outlier_densisty_dist</span><span class="p">,</span> <span class="s2">&quot;Missing_data_outliers_sp.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Segregating sites outliers&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">outlier_densisty_dist</span><span class="p">,</span> <span class="s2">&quot;Segregating_sites_outliers.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Segregating sites outliers sp&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">outlier_densisty_dist</span><span class="p">,</span> <span class="s2">&quot;Segregating_sites_outliers_sp.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Sequence size outliers&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">outlier_densisty_dist</span><span class="p">,</span> <span class="s2">&quot;Sequence_size_outliers.png&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Sequence size outliers sp&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">outlier_densisty_dist</span><span class="p">,</span> <span class="s2">&quot;Sequence_size_outliers_sp.png&quot;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="c1"># Storage of previous data sets. This is used to evaluate whether the</span>
    <span class="c1"># plot methods should be run, or if they should be ignored. The Stats</span>
    <span class="c1"># key refers to the previous active data sets when the stats summary</span>
    <span class="c1"># statistics overview was performed. It should contain two lists,</span>
    <span class="c1"># the first with the file set and the second with the taxa set</span>
    <span class="n">previous_sets</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Files&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;Taxa&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;Stats&quot;</span><span class="p">:</span> <span class="p">[]}</span>
    <span class="c1"># This attribute will store the StatsToggleWgt when changing the screen</span>
    <span class="c1"># from Statistics. When the Statistics screen is back on active,</span>
    <span class="c1"># the widget can be restored with this var</span>
    <span class="n">previous_stats_toggle</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Attributes for storing taxa and file buttons for side panel. These</span>
    <span class="c1">#  will be used when search for files/taxa and for loading only</span>
    <span class="c1"># button subsets for very large data sets. Each list element</span>
    <span class="c1"># pertains a single file/taxon and it will be a tupple containing the</span>
    <span class="c1">#  main button, information button and remove button.</span>
    <span class="n">sp_file_bts</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">()</span>
    <span class="n">sp_taxa_bts</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">()</span>
    <span class="n">sp_partition_bts</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">()</span>

    <span class="c1"># Attributes that control the amount of taxa/file buttons showing at the</span>
    <span class="c1"># side panel. To avoid staggering the app with tons of buttons, a</span>
    <span class="c1"># maximum number of buttons showing initially is set. More buttons</span>
    <span class="c1"># can be later added.</span>
    <span class="n">MAX_FILE_BUTTON</span> <span class="o">=</span> <span class="n">NumericProperty</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">count_files</span> <span class="o">=</span> <span class="n">NumericProperty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">MAX_PARTITION_BUTTON</span> <span class="o">=</span> <span class="n">NumericProperty</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">count_partitions</span> <span class="o">=</span> <span class="n">NumericProperty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Attributes storing the toggle buttons from Taxa/File panels. Mostly</span>
    <span class="c1"># for mouse_over events</span>
    <span class="c1"># Contains the button widgets from the Files and Taxa tabs</span>
    <span class="n">mouse_over_bts</span> <span class="o">=</span> <span class="n">DictProperty</span><span class="p">({</span>
        <span class="s2">&quot;Files&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;Taxa&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;Partitions&quot;</span><span class="p">:</span> <span class="p">[]})</span>
    <span class="c1"># The button text of the previous mouse over event. This will allow the</span>
    <span class="c1"># assessment of whether the current mouse collision is for the same</span>
    <span class="c1"># button (in which case the mouse over will not be triggered) or for</span>
    <span class="c1"># a different button (in which case the mouse over is triggered)</span>
    <span class="n">previous_mouse_over</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="c1"># This is a locking mechanism of the mouse over event. When there is a</span>
    <span class="c1"># scheduled event for a mouse over this attribute is set to False, which</span>
    <span class="c1"># prevents further events from being scheduled in the meantime. When the</span>
    <span class="c1"># scheduled event is dispatched, the lock is released and it returns to</span>
    <span class="c1"># True</span>
    <span class="n">mouse_over_ready</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Stores the previous mouse over label button so that it can be removed</span>
    <span class="n">old_mouse_over</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">fancy_bt</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">touch</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># Attribute that stores paths of currently active removable media</span>
    <span class="n">removable_media</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Attribute that locks arrow keys keybindings when a text input is</span>
    <span class="c1"># focused</span>
    <span class="n">arrow_block</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Whether SidePanel&#39;s More options dialog is active or not</span>
    <span class="n">sp_moreopts</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Whether a FancyDropDown is... well... dropped</span>
    <span class="n">fancy_dropped</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Attribute that stores the last selected button in the sidepanel.</span>
    <span class="n">last_sp_bt</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Files&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Taxa&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Partitions&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

    <span class="c1"># Attribute that stores information on whether the control key is being</span>
    <span class="c1"># pressed</span>
    <span class="n">is_control_pressed</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Attribute that stores information on whether the shift key is being</span>
    <span class="c1"># pressed</span>
    <span class="n">is_shift_pressed</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Attribute that stores the previous button for general purpose multi</span>
    <span class="c1"># selection of toggle buttons using shift clicking</span>
    <span class="n">prev_tb</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">mouse_position</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">()</span>

    <span class="c1"># Attribute that determines whether statistics background processes</span>
    <span class="c1"># should be interrupted or not</span>
    <span class="n">lock_stats</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Attributes used to determine is a specific background process</span>
    <span class="c1"># should be terminated by the user. All values are set to True by</span>
    <span class="c1"># default and their values only change on the start up of the</span>
    <span class="c1"># appropriate function.</span>

    <span class="c1"># For Statistics summary stats</span>
    <span class="n">terminate_stats</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># For process execution</span>
    <span class="n">terminate_process_exec</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># For generic background process</span>
    <span class="n">terminate_background</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># For file loading</span>
    <span class="n">terminate_load_files</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># For orthology search execution</span>
    <span class="n">terminate_orto_search</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># For orthology group export</span>
    <span class="n">terminate_group_export</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>


    <span class="c1">################################</span>
    <span class="c1">#</span>
    <span class="c1"># CORE PROGRAM RELATED VARIABLES</span>
    <span class="c1">#</span>
    <span class="c1">################################</span>

    <span class="c1"># MySQL access</span>
    <span class="n">mysql_pass</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">sqldb</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># OrthoMCL output directory</span>
    <span class="n">ortho_dir</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># Export directory for orthology exports</span>
    <span class="n">orto_export_dir</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># USEARCH database</span>
    <span class="n">usearch_file</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">usearch_db</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s2">&quot;goodProteins_db&quot;</span><span class="p">)</span>
    <span class="n">usearch_output</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s2">&quot;AllVsAll.out&quot;</span><span class="p">)</span>
    <span class="n">usearch_evalue</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s2">&quot;0.00001&quot;</span><span class="p">)</span>

    <span class="c1"># MCL/Groups attributes</span>
    <span class="n">mcl_file</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">ortholog_prefix</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s2">&quot;My_group&quot;</span><span class="p">)</span>
    <span class="n">group_prefix</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s2">&quot;group&quot;</span><span class="p">)</span>
    <span class="n">mcl_inflation</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">([</span><span class="s2">&quot;3&quot;</span><span class="p">])</span>

    <span class="c1"># Protein quality filters</span>
    <span class="n">protein_min_len</span> <span class="o">=</span> <span class="n">NumericProperty</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Absolute</span>
    <span class="n">protein_max_stop</span> <span class="o">=</span> <span class="n">NumericProperty</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>  <span class="c1"># Percentage</span>

    <span class="c1"># Orthology cluster filters</span>
    <span class="n">orto_max_gene</span> <span class="o">=</span> <span class="n">NumericProperty</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">orto_min_sp</span> <span class="o">=</span> <span class="n">NumericProperty</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># Attributes for exporting groups as protein/nucleotides</span>
    <span class="n">protein_db</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">cds_db</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># Attribute containing the path to the proteome files</span>
    <span class="n">proteome_files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">active_proteome_files</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">()</span>

    <span class="c1"># Attribute containing the orthology group files</span>
    <span class="n">ortho_group_files</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">()</span>
    <span class="n">ortho_groups</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">active_group</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">active_group_name</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># List storing the original alignment object variables. SHOULD NOT BE</span>
    <span class="c1"># MODIFIED</span>
    <span class="n">alignment_list</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># List of active alignment object variables.</span>
    <span class="n">active_alignment_list</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># List of active partitions</span>
    <span class="n">active_partitions</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">()</span>

    <span class="c1"># Attribute that determines whether taxa information needs to be updated</span>
    <span class="n">trigger_taxa_update</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Attributes containing the original and active taxa information</span>
    <span class="c1"># dictionaries</span>
    <span class="n">original_tx_inf</span> <span class="o">=</span> <span class="n">DictProperty</span><span class="p">()</span>
    <span class="n">active_tx_inf</span> <span class="o">=</span> <span class="n">DictProperty</span><span class="p">()</span>
    <span class="c1"># Same as before but for file information</span>
    <span class="n">original_file_inf</span> <span class="o">=</span> <span class="n">DictProperty</span><span class="p">()</span>
    <span class="n">active_file_inf</span> <span class="o">=</span> <span class="n">DictProperty</span><span class="p">()</span>

    <span class="c1"># Export mode. Tuple with first element &quot;taxa&quot; or &quot;file&quot; and second</span>
    <span class="c1"># element as &quot;all&quot; or &quot;selected&quot;</span>
    <span class="n">export_mode</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Attribute storing the sequence types currently loaded</span>
    <span class="n">sequence_types</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">()</span>

    <span class="c1"># Attribute for taxa and file groups</span>
    <span class="n">taxa_groups</span> <span class="o">=</span> <span class="n">DictProperty</span><span class="p">()</span>
    <span class="n">file_groups</span> <span class="o">=</span> <span class="n">DictProperty</span><span class="p">()</span>
    <span class="n">dataset_file</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Attribute containing the objects for the several possible output</span>
    <span class="c1"># files.</span>
    <span class="n">output_file</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">output_dir</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">conversion_suffix</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># Attribute storing active output formats. Fasta is True by default</span>
    <span class="n">output_formats</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">([</span><span class="s2">&quot;fasta&quot;</span><span class="p">])</span>

    <span class="c1"># Attributes for extra options of output formats</span>
    <span class="c1"># Determines wheter the Fasta output format will be compliant with LDhat</span>
    <span class="n">ld_hat</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># Determines whether the part.File associated with phylip format is</span>
    <span class="c1"># created</span>
    <span class="n">create_partfile</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Determines whether the charset partitions in Nexus input files are to</span>
    <span class="c1"># be used in the output file</span>
    <span class="n">use_nexus_partitions</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Determines whether the substitution models defined for the</span>
    <span class="c1"># partitions are to be used in the output file</span>
    <span class="n">use_nexus_models</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Determines whether taxa names should be truncated to 10 characters</span>
    <span class="c1"># in a phylip file</span>
    <span class="n">phylip_truncate_name</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># Additional options for IMa2 ormat</span>
    <span class="c1"># [0] - string - population file path</span>
    <span class="c1"># [1] - string - Population tree string</span>
    <span class="c1"># [2] - list - mutation model for each partition (one element if</span>
    <span class="c1"># applies to all)</span>
    <span class="c1"># [3] - list - inheritance scalaer for each partition (one element if</span>
    <span class="c1">#  applies to all)</span>
    <span class="n">ima2_options</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>

    <span class="c1"># Attribute storing the missing data filter settings. The list should</span>
    <span class="c1"># contain gap threshold as first element, missing data threshold as</span>
    <span class="c1"># second element and minimum taxa representation proportion as the third</span>
    <span class="c1"># element</span>
    <span class="n">missing_filter_settings</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">([(</span><span class="kc">True</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>
    <span class="c1"># Attribute storing the taxa filter settings. The first element of</span>
    <span class="c1"># the list should be the filter mode (either &quot;Contain&quot; or &quot;Exclude&quot;)</span>
    <span class="c1"># and the second element should be a string with the name of the taxa</span>
    <span class="c1">#  group (from the</span>
    <span class="c1"># taxa_group attribute)</span>
    <span class="n">taxa_filter_settings</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
    <span class="c1"># Attribute storing the alignment filter settings. This will determine</span>
    <span class="c1"># which codon positions will be written to the output (only for DNA</span>
    <span class="c1"># sequences), so this will consist of a list containing 3 elements that</span>
    <span class="c1"># correspond to each position. Positions will be saved or filtered</span>
    <span class="c1"># depending on the boolean value of the list position. Ex. [True,</span>
    <span class="c1"># True, True] will save all positions, whereas [True, True, False]</span>
    <span class="c1"># will only save the first</span>
    <span class="c1"># two positions</span>
    <span class="n">codon_filter_settings</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span>
    <span class="c1"># Attribute storing the alignment variation filter settings. For each</span>
    <span class="c1"># key entry there is a list with two elements, storing the minimum</span>
    <span class="c1"># and maximum value for that particular statistic. None values are</span>
    <span class="c1"># allowed, in which case there is no boundary</span>
    <span class="n">variation_filter</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>

    <span class="c1"># Attribute determining whether reverse concatenation will use a</span>
    <span class="c1"># partition file or the partitions defined in the app</span>
    <span class="n">use_app_partitions</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># Partitions file</span>
    <span class="n">partitions_file</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="c1"># Input file for reverse concatenation</span>
    <span class="n">rev_infile</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># Attribute for ZORRO settings</span>
    <span class="n">zorro_suffix</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">zorro_dir</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="n">hap_prefix</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s2">&quot;Hap&quot;</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;Attribute storing the haplotype prefix.&quot;&quot;&quot;</span>

    <span class="c1">##################################</span>
    <span class="c1">#</span>
    <span class="c1"># GUI RELATED METHODS AND FUNCTIONS</span>
    <span class="c1">#</span>
    <span class="c1">##################################</span>

<div class="viewcode-block" id="TriFusionApp.build"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># Setting main window title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;TriFusion - Streamline phylogenomics&quot;</span>

        <span class="c1"># Set icon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">icon</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_dir</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;trifusion-icon-512.png&quot;</span><span class="p">)</span>

        <span class="c1"># Set temporary directory path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data_dir</span><span class="p">,</span> <span class="s2">&quot;tmp&quot;</span><span class="p">)</span>
        <span class="c1"># Set directory for error records</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data_dir</span><span class="p">,</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="s2">&quot;error.out&quot;</span><span class="p">)</span>
        <span class="c1"># Set path for file hosting filechooser bookmarks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bm_file</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data_dir</span><span class="p">,</span> <span class="s2">&quot;bookmarks&quot;</span><span class="p">)</span>
        <span class="c1"># Set path for file hosting the user projects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">projects_file</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data_dir</span><span class="p">,</span> <span class="s2">&quot;projects&quot;</span><span class="p">)</span>
        <span class="c1"># Set path for sequence data sqlite database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqldb</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;sequencedb&quot;</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,)</span>

        <span class="c1"># Setting available screens</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">available_screens</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="s2">&quot;Orthology&quot;</span><span class="p">,</span> <span class="s2">&quot;Process&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;Statistics&quot;</span><span class="p">,</span> <span class="s2">&quot;fc&quot;</span><span class="p">,</span> <span class="s2">&quot;group_compare&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;plot&quot;</span><span class="p">,</span> <span class="s2">&quot;orto_plot&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_screens</span>

        <span class="c1"># Transforming screen names into complete paths to be loaded by kivy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">available_screens</span> <span class="o">=</span> <span class="p">[</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_dir</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;screens&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.kv&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">screen</span><span class="p">))</span> <span class="k">for</span> <span class="n">screen</span> <span class="ow">in</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">available_screens</span><span class="p">]</span>

        <span class="c1"># Store screen names specifically designed for plot display</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_screens</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;group_compare&quot;</span><span class="p">,</span> <span class="s2">&quot;plot&quot;</span><span class="p">,</span> <span class="s2">&quot;orto_plot&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;Statistics&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loaded_screens</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">sc</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">sc</span> <span class="ow">in</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">available_screens</span><span class="p">)</span>

        <span class="c1"># First thing is go to main screen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">go_screen</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Set method for closing side panel when touching outside</span>
        <span class="n">Window</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_touch_up</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidepanel_on_touch</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

        <span class="c1"># Listen to keybindings</span>
        <span class="n">Window</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_key_down</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_keyboard_events</span><span class="p">)</span>

        <span class="n">Window</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_key_up</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_release_events</span><span class="p">)</span>

        <span class="c1"># Execute cleaning function when exiting app</span>
        <span class="n">Window</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_request_close</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">check_action</span><span class="p">(</span><span class="s2">&quot;Are you sure you want to quit?&quot;</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">_exit_clean</span><span class="p">,</span> <span class="n">popup_level</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

        <span class="n">Window</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_stop</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exit_clean</span><span class="p">())</span>

        <span class="n">Window</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_motion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mouse_zoom</span><span class="p">)</span>

        <span class="n">Window</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_dropfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">load_files_dragndrop</span><span class="p">)</span>

        <span class="n">Window</span><span class="o">.</span><span class="n">clearcolor</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">c_main_background</span>

        <span class="c1"># Orthology widgets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span> <span class="o">=</span> <span class="n">OrthologySearchGrid</span><span class="p">()</span>
        <span class="c1"># Check for orthology programs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_orto_programs</span><span class="p">()</span>

        <span class="c1"># Process widgets</span>
        <span class="c1"># Creating GridLayout instance for general options of Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span> <span class="o">=</span> <span class="n">ProcessGeneral</span><span class="p">()</span>
        <span class="c1"># Create GridLayout instance for additional options of Process.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_options</span> <span class="o">=</span> <span class="n">AdditionalProcessContents</span><span class="p">()</span>
        <span class="c1"># Create Summary stats box instance for Statistics screen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_summary</span> <span class="o">=</span> <span class="n">StatsSummary</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_table</span> <span class="o">=</span> <span class="n">GeneTable</span><span class="p">()</span>

        <span class="c1"># Initialize operation queue treeview in side panel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operation_queue_init</span><span class="p">()</span>

        <span class="c1"># Initialize projects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">projects_init</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="n">FancyButton</span><span class="p">())</span>

        <span class="c1"># Set schedule for mouse over events on side panel</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_interval</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_mouseover_tabs</span><span class="p">(),</span> <span class="o">.</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Sets schedule for removable media automatic detection</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_interval</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_removable_media</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Set path to sqlite database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqldb</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;trifusion.sql3&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_start_clean</span><span class="p">()</span>

        <span class="c1"># Now that the sqlite database path is defined, initialize the</span>
        <span class="c1"># AlignmentList object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span> <span class="o">=</span> <span class="n">AlignmentList</span><span class="p">([],</span> <span class="n">sql_db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sqldb</span><span class="p">)</span>

        <span class="c1"># If arguments were provided at the command line, load data into</span>
        <span class="c1"># the app assuming they are alignments</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_once</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">dt</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_files_startup</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]),</span> <span class="o">.</span><span class="mi">1</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ------------------------ METHOD NOMENCLATURE GUIDE -----------------</span>

<span class="sd">        Given the large number of methods needed to give functionality to</span>
<span class="sd">        the app, this nomenclature guide was created to aid in the naming</span>
<span class="sd">        of new methods so that the code can be more easily browsed and</span>
<span class="sd">        understood. Note that this guide only targets methods that</span>
<span class="sd">        perform similar tasks and, therefore, can be grouped by a common</span>
<span class="sd">        prefix name. Other methods that perform more unique operations</span>
<span class="sd">        may have different names.</span>

<span class="sd">        Method&#39;s names will be given based on their main operation and</span>
<span class="sd">        specific task. For example, a method in charge of toggle the side</span>
<span class="sd">        panel, should be named &quot;toggle_sidepanel&quot;, being &quot;toggle&quot; the</span>
<span class="sd">        common prefix and &quot;sidepanel&quot; the keyword linked ot the specific</span>
<span class="sd">        task.</span>

<span class="sd">        1. Toggles.</span>

<span class="sd">        &quot;toggle_[specific_task]&quot;, e.g. &quot;toggle_sidepanel&quot;</span>

<span class="sd">        Methods use to toggle certain widgets or values/attributes.</span>

<span class="sd">        2. Dialogues.</span>

<span class="sd">        &quot;dialog_[specific_task]&quot;, e.g. &quot;dialog_format&quot;</span>

<span class="sd">        Methods that generate dialogues throughout the app, usually in</span>
<span class="sd">        the form of popups</span>

<span class="sd">        3. Populating methods.</span>

<span class="sd">        &quot;populate_[specific_task]&quot;, e.g., &quot;populate_input_files&quot;</span>

<span class="sd">        Methods that populate certain widgets, usually gridlayouts, with</span>
<span class="sd">        other widgets</span>

<span class="sd">        4. Add/Remove</span>

<span class="sd">        &quot;add_[specific_task]&quot;, e.g., &quot;add_bookmark&quot;</span>
<span class="sd">        &quot;remove_[specific_task]&quot;, e.g., &quot;remove_taxa_group&quot;</span>

<span class="sd">        Methods that add or remove widgets, usually buttons/togglebuttons,</span>
<span class="sd">        from other widgets</span>

<span class="sd">        5. Saves.</span>

<span class="sd">        &quot;save_[specific_task]&quot;, e.g., &quot;save_file&quot;</span>

<span class="sd">        Methods that save specific settings from the several options of the</span>
<span class="sd">        sapp</span>

<span class="sd">        6. Updates.</span>

<span class="sd">        &quot;update_[specific_task]&quot;, e.g., &quot;update_tabs&quot;</span>

<span class="sd">        Wrapper methods used to update several attributes or widgets of the</span>
<span class="sd">        app</span>

<span class="sd">        7. Checks.</span>

<span class="sd">        &quot;check_[specific_task]&quot;, e.g., &quot;check_filters&quot;</span>

<span class="sd">        Methods that perform some kind of sanity checks to user input data</span>

<span class="sd">        8. Unique operations</span>

<span class="sd">        [specific_task]_[unique_operation], e.g., &quot;sidepanel_animation&quot;</span>

<span class="sd">        When the method performs a unique operations, the specific_task</span>
<span class="sd">        should prefix the name of the method.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="TriFusionApp.mouse_zoom"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.mouse_zoom">[docs]</a>    <span class="k">def</span> <span class="nf">mouse_zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">vals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param vals: touch event list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Only perform any actions in plot screens and pop is not active</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_screens</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_subpopup</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>

            <span class="c1"># Ignore if in statistics screen and sidepanel expanded</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Statistics&quot;</span> <span class="ow">and</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">stats_panel</span><span class="o">.</span><span class="n">width</span> <span class="o">==</span> <span class="mi">410</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="c1"># Add exceptions here</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">plot_content</span><span class="o">.</span><span class="n">children</span><span class="p">[</span>
                              <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">StatsSummary</span><span class="p">)</span> <span class="ow">or</span> \
                        <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">plot_content</span><span class="o">.</span><span class="n">children</span><span class="p">[</span>
                                   <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">GeneTable</span><span class="p">):</span>
                    <span class="k">return</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="k">pass</span>

            <span class="n">motion</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="c1"># Check if motion is mouse scroll</span>
            <span class="k">if</span> <span class="n">motion</span><span class="o">.</span><span class="n">is_mouse_scrolling</span><span class="p">:</span>

                <span class="c1"># Only perform an action at the begining of the motion</span>
                <span class="k">if</span> <span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;begin&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_control_pressed</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">motion</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="s2">&quot;scrollup&quot;</span><span class="p">:</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">plot_content</span><span class="o">.</span><span class="n">scale</span> <span class="o">-=</span> <span class="o">.</span><span class="mi">1</span>

                    <span class="k">elif</span> <span class="n">motion</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="s2">&quot;scrolldown&quot;</span><span class="p">:</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">plot_content</span><span class="o">.</span><span class="n">scale</span> <span class="o">+=</span> <span class="o">.</span><span class="mi">1</span></div>

    <span class="k">def</span> <span class="nf">_start_clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        In the event of unexpected exits, clean the tmp directory on app</span>
<span class="sd">        start</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">)</span>

        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_exec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">program</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks the execution of the MCL software from a given path. If the MCL</span>
<span class="sd">        is correct, returns True</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;mcl&quot;</span><span class="p">:</span> <span class="sa">b</span><span class="s2">&quot;mcl&quot;</span><span class="p">,</span>
               <span class="s2">&quot;usearch&quot;</span><span class="p">:</span> <span class="s2">&quot;usearch&quot;</span><span class="p">}</span>

        <span class="c1"># If the OS is windows and the program is usearch, first check if the</span>
        <span class="c1"># necessary DLL vcomp100.dll is present in the app&#39;s directory</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;win32&quot;</span><span class="p">,</span> <span class="s2">&quot;cygwin&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">program</span> <span class="o">==</span> <span class="s2">&quot;usearch&quot;</span><span class="p">:</span>
            <span class="n">flist</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data_dir</span><span class="p">)]</span>
            <span class="k">if</span> <span class="s2">&quot;vcomp100.dll&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">flist</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_subpopup</span><span class="p">()</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_warning</span><span class="p">(</span>
                    <span class="s2">&quot;Missing a DLL file&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;You are providing the USEARCH executable but the&quot;</span>
                    <span class="s2">&quot; vcomp100.dll file is missing. Please download it from&quot;</span>
                    <span class="s2">&quot; the link below and place the DLL in&quot;</span>
                    <span class="s2">&quot; C:\Users\&lt;USER&gt;\AppData\Roaming</span><span class="se">\\</span><span class="s2">trifusion. Then&quot;</span>
                    <span class="s2">&quot; try again.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;[ref=http://drive5.com/usearch/vcomp100.dll][b]&quot;</span>
                    <span class="s2">&quot;[color=#37abc8ff]http://drive5.com/usearch/vcomp100.dll&quot;</span>
                    <span class="s2">&quot;[/b][/color][/ref]&quot;</span><span class="p">)</span>

        <span class="c1"># First, try to execute the file directly from the path</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">res</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;--version&quot;</span><span class="p">],</span>
                                      <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="n">program</span><span class="p">])</span>

        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># This exception may occur because the file is not executable</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="mi">13</span><span class="p">:</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Make the file executable</span>
                    <span class="n">st</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">|</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IEXEC</span><span class="p">)</span>

                    <span class="n">res</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;--version&quot;</span><span class="p">],</span>
                        <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

                    <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="n">program</span><span class="p">])</span>

                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                    <span class="c1"># The provided file is not executable and TriFusion does</span>
                    <span class="c1"># not have permissions to change that.</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># The first OSError exception could not be handled. Fail the</span>
                <span class="c1"># executable check</span>
                <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_check_orto_programs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the USEARCH and MCL programs are installed and reachable.</span>
<span class="sd">        1. Check if executables are in the app_dir</span>
<span class="sd">        2. Check if executables are callable from subprocess</span>
<span class="sd">        3. If both checks fail, modify ortho_search_grid to highlight the</span>
<span class="sd">        problem.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dll_path</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># The mcl executable requires the .exe extension in windows to</span>
        <span class="c1"># work properly</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;win32&quot;</span><span class="p">,</span> <span class="s2">&quot;cygwin&quot;</span><span class="p">]:</span>
            <span class="n">mcl_string</span> <span class="o">=</span> <span class="s2">&quot;mcl.exe&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mcl_string</span> <span class="o">=</span> <span class="s2">&quot;mcl&quot;</span>

        <span class="c1"># Check if MCL_FILE has been set. This happens when running TriFusion</span>
        <span class="c1"># from the executable binary.</span>
        <span class="k">if</span> <span class="n">MCL_FILE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mcl_file</span> <span class="o">=</span> <span class="n">MCL_FILE</span>
        <span class="c1"># Check MCL in app_dir</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data_dir</span><span class="p">,</span> <span class="n">mcl_string</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mcl_file</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data_dir</span><span class="p">,</span> <span class="n">mcl_string</span><span class="p">)</span>
        <span class="c1"># Check MCL in package directory, if running from source</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;resources&quot;</span><span class="p">,</span> <span class="s2">&quot;mcl&quot;</span><span class="p">)):</span>
            <span class="n">mcl_dir</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;resources&quot;</span><span class="p">,</span> <span class="s2">&quot;mcl&quot;</span><span class="p">)</span>
            <span class="c1"># For Windows</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;win32&quot;</span><span class="p">,</span> <span class="s2">&quot;cygwin&quot;</span><span class="p">]:</span>
                <span class="c1"># For Windows 64bit</span>
                <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">architecture</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;64bit&quot;</span><span class="p">:</span>
                    <span class="n">mcl_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">mcl_dir</span><span class="p">,</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span> <span class="s2">&quot;64bit&quot;</span><span class="p">,</span> <span class="s2">&quot;mcl64.exe&quot;</span><span class="p">)</span>
                    <span class="n">dll_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">mcl_dir</span><span class="p">,</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span> <span class="s2">&quot;64bit&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;cygwin1.dll&quot;</span><span class="p">)</span>
                <span class="c1"># For Windows 32bit</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mcl_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">mcl_dir</span><span class="p">,</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span> <span class="s2">&quot;32bit&quot;</span><span class="p">,</span> <span class="s2">&quot;mcl32.exe&quot;</span><span class="p">)</span>
                    <span class="n">dll_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">mcl_dir</span><span class="p">,</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span> <span class="s2">&quot;32bit&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;cygwin1.dll&quot;</span><span class="p">)</span>

            <span class="c1"># For MacOS</span>
            <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;darwin&quot;</span><span class="p">:</span>
                <span class="n">mcl_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">mcl_dir</span><span class="p">,</span> <span class="s2">&quot;MacOS&quot;</span><span class="p">,</span> <span class="n">mcl_string</span><span class="p">)</span>

            <span class="c1"># For Linux</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mcl_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">mcl_dir</span><span class="p">,</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span> <span class="n">mcl_string</span><span class="p">)</span>

            <span class="c1"># Copy mcl executable to trifusion dir</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">mcl_path</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data_dir</span><span class="p">,</span>
                                           <span class="n">mcl_string</span><span class="p">))</span>
            <span class="n">mcl_file</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data_dir</span><span class="p">,</span> <span class="n">mcl_string</span><span class="p">)</span>
            <span class="c1"># Copy dll necessary in windows version</span>
            <span class="k">if</span> <span class="n">dll_path</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">dll_path</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data_dir</span><span class="p">,</span>
                                               <span class="s2">&quot;cygwin1.dll&quot;</span><span class="p">))</span>
            <span class="c1"># Make mcl executable</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">mcl_file</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">mcl_file</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">|</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IEXEC</span><span class="p">)</span>
            <span class="c1"># Test mcl executable</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_exec</span><span class="p">(</span><span class="n">mcl_file</span><span class="p">,</span> <span class="s2">&quot;mcl&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mcl_file</span> <span class="o">=</span> <span class="n">mcl_file</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Remove bad executable from app dir</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data_dir</span><span class="p">,</span> <span class="n">mcl_string</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">dll_path</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data_dir</span><span class="p">,</span> <span class="s2">&quot;cygwin1.dll&quot;</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If not in app_dir check is its reachable system-wide by</span>
            <span class="c1"># subprocess</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s2">&quot;mcl&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mcl_file</span> <span class="o">=</span> <span class="n">mcl_string</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c1"># If the mcl file could not be found through any of the previous</span>
        <span class="c1">#  methods, modify the attributes of the orto_search_grid.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcl_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">mcl_check</span><span class="o">.</span><span class="n">background_src</span> <span class="o">=</span> \
                <span class="s2">&quot;data/backgrounds/red_noise.png&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">mcl_check_ico</span><span class="o">.</span><span class="n">icon_src</span> <span class="o">=</span> \
                <span class="s2">&quot;data/backgrounds/warning_icon.png&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">mcl_check_ico</span><span class="o">.</span><span class="n">icon_size</span> <span class="o">=</span> \
                <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">mcl_check_lbl</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
                <span class="s2">&quot;MCL is not installed or reachable&quot;</span>
            <span class="n">fix_bt</span> <span class="o">=</span> <span class="n">FixButton</span><span class="p">()</span>
            <span class="n">fix_bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_mcl_fix</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">mcl_fix_box</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">fix_bt</span><span class="p">)</span>

        <span class="c1"># Check USEARCH DLL in app_dir for windows only</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;win32&quot;</span><span class="p">,</span> <span class="s2">&quot;cygwin&quot;</span><span class="p">]</span> <span class="ow">and</span> \
                <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data_dir</span><span class="p">,</span> <span class="s2">&quot;vcomp100.dll&quot;</span><span class="p">)):</span>
            <span class="c1"># Copy necessary DLL to app dir if it doesn&#39;t exist</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">architecture</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;64bit&quot;</span><span class="p">:</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;resources&quot;</span><span class="p">,</span>
                                         <span class="s2">&quot;usearch&quot;</span><span class="p">,</span> <span class="s2">&quot;64bit&quot;</span><span class="p">,</span> <span class="s2">&quot;vcomp100.dll&quot;</span><span class="p">),</span>
                                    <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data_dir</span><span class="p">,</span> <span class="s2">&quot;vcomp100.dll&quot;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;resources&quot;</span><span class="p">,</span>
                                         <span class="s2">&quot;usearch&quot;</span><span class="p">,</span> <span class="s2">&quot;32bit&quot;</span><span class="p">,</span> <span class="s2">&quot;vcomp100.dll&quot;</span><span class="p">),</span>
                                    <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data_dir</span><span class="p">,</span> <span class="s2">&quot;vcomp100.dll&quot;</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c1"># CHeck USEARCH in app_dir</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data_dir</span><span class="p">,</span> <span class="s2">&quot;usearch&quot;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">usearch_file</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data_dir</span><span class="p">,</span> <span class="s2">&quot;usearch&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If not in app_dir check is its reachable system-wide by</span>
            <span class="c1"># subprocess</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s2">&quot;usearch&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">usearch_file</span> <span class="o">=</span> <span class="s2">&quot;usearch&quot;</span>
            <span class="c1"># MCL software not reachable. Modify attributes and</span>
            <span class="c1"># orto_search_grid</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">usearch_check</span><span class="o">.</span><span class="n">background_src</span> <span class="o">=</span> \
                    <span class="s2">&quot;data/backgrounds/red_noise.png&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">usearch_check_ico</span><span class="o">.</span><span class="n">icon_src</span> <span class="o">=</span> \
                    <span class="s2">&quot;data/backgrounds/warning_icon.png&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">usearch_check_ico</span><span class="o">.</span><span class="n">icon_size</span> <span class="o">=</span> \
                    <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">usearch_check_lbl</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
                    <span class="s2">&quot;USEARCH is not installed or reachable&quot;</span>
                <span class="n">fix_bt</span> <span class="o">=</span> <span class="n">FixButton</span><span class="p">()</span>
                <span class="n">fix_bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_usearch_fix</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">usearch_fix</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">fix_bt</span><span class="p">)</span>

<div class="viewcode-block" id="TriFusionApp.dialog_mcl_fix"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_mcl_fix">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_mcl_fix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens a dialog with information for fixing the missing MCL executable</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">DialogMCLFix</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;MCL troubleshooting...&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">330</span><span class="p">),</span> <span class="n">close_bt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_usearch_fix"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_usearch_fix">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_usearch_fix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens a dialog with information for fixing the missing USEARCH</span>
<span class="sd">        executable</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">DialogUSEARCHFix</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;USEARCH troubleshooting...&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">330</span><span class="p">),</span> <span class="n">close_bt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.load_files_startup"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.load_files_startup">[docs]</a>    <span class="k">def</span> <span class="nf">load_files_startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gives support for loading data into the app when launching the</span>
<span class="sd">        app via command line and providing the files as arguments. Issues</span>
<span class="sd">        the same dialog as the load_files_dragndrop to let the user</span>
<span class="sd">        choose whether the input files are alignments or proteomes</span>
<span class="sd">        :param file_list: list, with file paths as strings or unicode</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">InputType</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>
        <span class="n">content</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="n">file_list</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">350</span><span class="p">,</span> <span class="mi">160</span><span class="p">),</span>
                        <span class="n">separator_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                        <span class="n">close_bt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.load_files_dragndrop"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.load_files_dragndrop">[docs]</a>    <span class="k">def</span> <span class="nf">load_files_dragndrop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function gives functionality to the drag and drop feature</span>
<span class="sd">        that automatically loads files when droped into the app window.</span>
<span class="sd">        Note that this method will issue different data loding methods</span>
<span class="sd">        depending on the active screen. Proteome alignments will be opened</span>
<span class="sd">        in the Orthology screen, while sequence alignment will be opened</span>
<span class="sd">        in the Process and Statistics screens.</span>
<span class="sd">        :param args: list, first element is the SDL2 object, second</span>
<span class="sd">        element is the file path</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">drag_check</span><span class="p">(</span><span class="n">dt</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            In order to support drag and drop of multiple files, a periodic</span>
<span class="sd">            check is made to assess if the self.drag_files object is</span>
<span class="sd">            still being populated, or if it reached a static state. Only</span>
<span class="sd">            when it reaches a static state, will the app issue the</span>
<span class="sd">            corresponding methods to load all files into the app.</span>
<span class="sd">            :param dt:</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="c1"># If the drag_files attribute continues to be populated,</span>
            <span class="c1"># its lenght will be higher than the current counter. In such</span>
            <span class="c1">#  case, update the counter</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drag_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_c</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">drag_c</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drag_files</span><span class="p">)</span>
                <span class="c1"># In case only a single file was dragged and dropped,</span>
                <span class="c1"># this additional scheduled event will allow the single</span>
                <span class="c1"># file to the loaded. Otherwise, it will do nothing.</span>
                <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_once</span><span class="p">(</span><span class="n">drag_check</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># In this case, the drag_files attribute has reached a static</span>
            <span class="c1">#  size and the loading methods can be issued</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drag_files</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_c</span><span class="p">:</span>
                <span class="c1"># Issue methods only when drag_files is populated</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_files</span><span class="p">:</span>

                    <span class="n">content</span> <span class="o">=</span> <span class="n">InputType</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>
                    <span class="n">content</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_files</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                                    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">350</span><span class="p">,</span> <span class="mi">160</span><span class="p">),</span>
                                    <span class="n">separator_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                    <span class="n">border_color</span><span class="o">=</span><span class="n">tm</span><span class="o">.</span><span class="n">c_popup_border</span><span class="p">,</span>
                                    <span class="n">close_bt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                    <span class="c1"># Load proteomes</span>
                    <span class="c1"># if self.screen.name == &quot;Orthology&quot;:</span>
                    <span class="c1">#     self.load_proteomes(self.drag_files)</span>
                    <span class="c1"># if self.screen.name in [&quot;Process&quot;, &quot;Statistics&quot;,</span>
                    <span class="c1">#                         &quot;main&quot;]:</span>
                    <span class="c1">#     self.load_files_subproc(self.drag_files)</span>

                    <span class="c1"># Reset drag counter and drag_files attributes</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">drag_c</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">drag_files</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># This functionality should only be triggered when in one of the</span>
        <span class="c1"># main screens</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_all_popups</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">drag_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unicode</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;utf8&quot;</span><span class="p">))</span>

        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_once</span><span class="p">(</span><span class="n">drag_check</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_exit_clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is issued when the application is closed and performs</span>
<span class="sd">        any necessary clean up operations</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">terminate_stats</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terminate_load_files</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terminate_background</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">run_in_background</span><span class="p">(</span><span class="n">remove_tmp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span>
                               <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">con</span><span class="p">],</span>
                               <span class="n">no_arg2</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cancel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Cleaning temporary files and &quot;</span>
                                   <span class="s2">&quot;exiting...&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method updates the filechooser path when clicking on the path</span>
<span class="sd">        label</span>

<span class="sd">        :param path: string, with destination path</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If in filechooser, do this</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">path_bx</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">path</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">icon_view_tab</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="c1"># When in popup, do thissd_filechooser</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">path_bx</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sd_filechooser</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_subpopup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">path_bx</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_subpopup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sd_filechooser</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>

    <span class="k">def</span> <span class="nf">_release_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">vals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method that releases keyboard events that are triggered in</span>
<span class="sd">        _on_keyboard_events when the key is released</span>
<span class="sd">        :param vals: input list from on_key_up</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">key_code</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">305</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_control_pressed</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">304</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_shift_pressed</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_on_keyboard_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">vals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Methods that listens to keyboard input and triggers events or</span>
<span class="sd">        changes properties when acceptable keyboard shortcuts are entered</span>
<span class="sd">        :param vals: input list from on_key_down function</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get modifier (usually ctrl or shift)</span>
        <span class="c1"># TODO: The modifier in MacOS is different. Must check on this.</span>
        <span class="n">modifier</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">key_code</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Switch between Ctrl for Windows/Linux and Cmd for MacOS as the</span>
        <span class="c1"># preferred modifier</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;darwin&quot;</span><span class="p">:</span>
            <span class="n">mod_key</span> <span class="o">=</span> <span class="s2">&quot;meta&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mod_key</span> <span class="o">=</span> <span class="s2">&quot;ctrl&quot;</span>

        <span class="k">if</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">305</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_control_pressed</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">304</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_shift_pressed</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># ==================================================================</span>
        <span class="c1"># Popup keybindings</span>
        <span class="c1"># ==================================================================</span>

        <span class="k">def</span> <span class="nf">popup_keys</span><span class="p">(</span><span class="n">backn</span><span class="p">,</span> <span class="n">backd</span><span class="p">,</span> <span class="n">bt1</span><span class="p">,</span> <span class="n">bt2</span><span class="p">,</span> <span class="n">bt3</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Wrapper function that provides functionality to arrow keys for</span>
<span class="sd">            navigating through selection buttons in popups</span>
<span class="sd">            :param backn: string for background normal</span>
<span class="sd">            :param backd: string for background down</span>
<span class="sd">            :param bt1: Button widget one (usually for Ok buttons)</span>
<span class="sd">            :param bt2: Button widget two (usually for Cancel buttons)</span>
<span class="sd">            :param bt3: Optional button widget three.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrow_block</span><span class="p">:</span>
                <span class="c1"># This will deal with cases with only two buttons to cycle</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">bt3</span><span class="p">:</span>
                    <span class="c1"># if left arrow key</span>
                    <span class="k">if</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">276</span><span class="p">:</span>
                        <span class="n">bt1</span><span class="o">.</span><span class="n">background_normal</span> <span class="o">=</span> <span class="n">backn</span>
                        <span class="n">bt2</span><span class="o">.</span><span class="n">background_normal</span> <span class="o">=</span> <span class="n">backd</span>
                    <span class="c1"># if right arrow key</span>
                    <span class="k">if</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">275</span><span class="p">:</span>
                        <span class="n">bt1</span><span class="o">.</span><span class="n">background_normal</span> <span class="o">=</span> <span class="n">backd</span>
                        <span class="n">bt2</span><span class="o">.</span><span class="n">background_normal</span> <span class="o">=</span> <span class="n">backn</span>
                    <span class="c1"># if enter key. Dispatch the events of the focused</span>
                    <span class="c1"># button</span>
                    <span class="k">if</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">13</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">bt1</span><span class="o">.</span><span class="n">background_normal</span> <span class="o">==</span> <span class="n">backn</span><span class="p">:</span>
                            <span class="n">bt1</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s2">&quot;on_release&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">bt2</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s2">&quot;on_release&quot;</span><span class="p">)</span>

                <span class="c1"># This will cycle through three buttons</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">bt_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">bt1</span><span class="p">,</span> <span class="n">bt2</span><span class="p">,</span> <span class="n">bt3</span><span class="p">]</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">background_normal</span> <span class="k">for</span> <span class="n">i</span>
                           <span class="ow">in</span> <span class="n">bt_list</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">backn</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">276</span> <span class="ow">and</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">idx</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">275</span> <span class="ow">and</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="k">for</span> <span class="n">bt</span> <span class="ow">in</span> <span class="n">bt_list</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">bt_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span> <span class="o">==</span> <span class="n">idx</span><span class="p">:</span>
                            <span class="n">bt_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">background_normal</span> <span class="o">=</span> <span class="n">backn</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">bt</span><span class="o">.</span><span class="n">background_normal</span> <span class="o">=</span> <span class="n">backd</span>

                    <span class="k">if</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">13</span><span class="p">:</span>
                        <span class="n">bt_on</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">bt_list</span> <span class="k">if</span>
                                 <span class="n">i</span><span class="o">.</span><span class="n">background_normal</span> <span class="o">==</span> <span class="n">backn</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">bt_on</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s2">&quot;on_release&quot;</span><span class="p">)</span>

        <span class="c1"># ==================================================================</span>
        <span class="c1"># Popup keybindings</span>
        <span class="c1"># ==================================================================</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exit_popup</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;check_ok&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exit_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">:</span>
                <span class="n">bn</span> <span class="o">=</span> <span class="s2">&quot;data/backgrounds/check_ok.png&quot;</span>
                <span class="n">bd</span> <span class="o">=</span> <span class="s2">&quot;data/backgrounds/check_cancel.png&quot;</span>
                <span class="n">ok_bt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exit_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="s2">&quot;check_ok&quot;</span><span class="p">]</span>
                <span class="n">cancel_bt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exit_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="s2">&quot;check_cancel&quot;</span><span class="p">]</span>
                <span class="n">popup_keys</span><span class="p">(</span><span class="n">bn</span><span class="p">,</span> <span class="n">bd</span><span class="p">,</span> <span class="n">ok_bt</span><span class="p">,</span> <span class="n">cancel_bt</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exit_popup</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;find_bx&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">modifier</span> <span class="o">==</span> <span class="n">mod_key</span> <span class="ow">and</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">102</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">find_bx</span><span class="o">.</span><span class="n">height</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>
                        <span class="n">Animation</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;out_quart&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">find_bx</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sd_filechooser</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">text_filter</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">text_filter</span><span class="o">.</span><span class="n">focus</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">Animation</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;out_quart&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">find_bx</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">text_filter</span><span class="o">.</span><span class="n">focus</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subpopup</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;find_bx&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subpopup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">modifier</span> <span class="o">==</span> <span class="n">mod_key</span> <span class="ow">and</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">102</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subpopup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">find_bx</span><span class="o">.</span><span class="n">height</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>
                        <span class="n">Animation</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span>
                                  <span class="n">t</span><span class="o">=</span><span class="s2">&quot;out_quart&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_subpopup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">find_bx</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_subpopup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sd_filechooser</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_subpopup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">text_filter</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_subpopup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">text_filter</span><span class="o">.</span><span class="n">focus</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">Animation</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span>
                                  <span class="n">t</span><span class="o">=</span><span class="s2">&quot;out_quart&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_subpopup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">find_bx</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_subpopup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">text_filter</span><span class="o">.</span><span class="n">focus</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Toggle path editor</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;path_toggle&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">modifier</span> <span class="o">==</span> <span class="n">mod_key</span> <span class="ow">and</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">108</span><span class="p">:</span>
                    <span class="n">st</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">path_toggle</span><span class="o">.</span><span class="n">state</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">path_toggle</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> \
                        <span class="s2">&quot;down&quot;</span> <span class="k">if</span> <span class="n">st</span> <span class="o">!=</span> <span class="s2">&quot;down&quot;</span> <span class="k">else</span> <span class="s2">&quot;normal&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">path_toggle</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s2">&quot;on_release&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;text_filter&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">:</span>
                <span class="c1"># Ctrl + f toggles focus on find text input field</span>
                <span class="k">if</span> <span class="n">modifier</span> <span class="o">==</span> <span class="n">mod_key</span> <span class="ow">and</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">102</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">text_filter</span><span class="o">.</span><span class="n">focus</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subpopup</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;ok_bt&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subpopup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">:</span>
                <span class="n">bn</span> <span class="o">=</span> <span class="s2">&quot;data/backgrounds/bt_process.png&quot;</span>
                <span class="n">bd</span> <span class="o">=</span> <span class="s2">&quot;data/backgrounds/bt_process_off.png&quot;</span>
                <span class="n">ok_bt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subpopup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="s2">&quot;ok_bt&quot;</span><span class="p">]</span>
                <span class="n">cancel_bt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subpopup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="s2">&quot;cancel_bt&quot;</span><span class="p">]</span>
                <span class="n">popup_keys</span><span class="p">(</span><span class="n">bn</span><span class="p">,</span> <span class="n">bd</span><span class="p">,</span> <span class="n">ok_bt</span><span class="p">,</span> <span class="n">cancel_bt</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;check_ok&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">:</span>
                <span class="n">bn</span> <span class="o">=</span> <span class="s2">&quot;data/backgrounds/check_ok.png&quot;</span>
                <span class="n">bd</span> <span class="o">=</span> <span class="s2">&quot;data/backgrounds/check_cancel.png&quot;</span>
                <span class="n">ok_bt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="s2">&quot;check_ok&quot;</span><span class="p">]</span>
                <span class="n">cancel_bt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="s2">&quot;check_cancel&quot;</span><span class="p">]</span>
                <span class="n">popup_keys</span><span class="p">(</span><span class="n">bn</span><span class="p">,</span> <span class="n">bd</span><span class="p">,</span> <span class="n">ok_bt</span><span class="p">,</span> <span class="n">cancel_bt</span><span class="p">)</span>
            <span class="c1"># In this case there are three buttons to cicle</span>
            <span class="k">elif</span> <span class="s2">&quot;apply_bt&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">:</span>
                <span class="n">bn</span> <span class="o">=</span> <span class="s2">&quot;data/backgrounds/bt_process.png&quot;</span>
                <span class="n">bd</span> <span class="o">=</span> <span class="s2">&quot;data/backgrounds/bt_process_off.png&quot;</span>
                <span class="n">ok_bt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="s2">&quot;ok_bt&quot;</span><span class="p">]</span>
                <span class="n">cancel_bt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="s2">&quot;cancel_bt&quot;</span><span class="p">]</span>
                <span class="n">apply_bt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="s2">&quot;apply_bt&quot;</span><span class="p">]</span>
                <span class="n">popup_keys</span><span class="p">(</span><span class="n">bn</span><span class="p">,</span> <span class="n">bd</span><span class="p">,</span> <span class="n">ok_bt</span><span class="p">,</span> <span class="n">apply_bt</span><span class="p">,</span> <span class="n">cancel_bt</span><span class="p">)</span>
            <span class="c1"># Only two buttons to cicle</span>
            <span class="k">elif</span> <span class="s2">&quot;ok_bt&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">:</span>
                <span class="n">bn</span> <span class="o">=</span> <span class="s2">&quot;data/backgrounds/bt_process.png&quot;</span>
                <span class="n">bd</span> <span class="o">=</span> <span class="s2">&quot;data/backgrounds/bt_process_off.png&quot;</span>
                <span class="n">ok_bt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="s2">&quot;ok_bt&quot;</span><span class="p">]</span>
                <span class="n">cancel_bt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="s2">&quot;cancel_bt&quot;</span><span class="p">]</span>
                <span class="n">popup_keys</span><span class="p">(</span><span class="n">bn</span><span class="p">,</span> <span class="n">bd</span><span class="p">,</span> <span class="n">ok_bt</span><span class="p">,</span> <span class="n">cancel_bt</span><span class="p">)</span>

            <span class="k">elif</span> <span class="s2">&quot;close_bt&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">13</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">close_bt</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s2">&quot;on_release&quot;</span><span class="p">)</span>

        <span class="c1"># ======================================================================</span>
        <span class="c1"># Filechooser keybindings</span>
        <span class="c1"># ======================================================================</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;fc&quot;</span><span class="p">:</span>
            <span class="c1"># Keybinding ctrl+f that brings focus to the &quot;Find&quot; field in the</span>
            <span class="c1"># Filechooser screen</span>
            <span class="k">if</span> <span class="n">modifier</span> <span class="o">==</span> <span class="n">mod_key</span> <span class="ow">and</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">102</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">text_filter</span><span class="o">.</span><span class="n">focus</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Keybinding ctrl+backspace to clear selection</span>
            <span class="k">if</span> <span class="n">modifier</span> <span class="o">==</span> <span class="n">mod_key</span> <span class="ow">and</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">clear_s</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s2">&quot;on_release&quot;</span><span class="p">)</span>

            <span class="c1"># Add bookmarks with ctrl+d</span>
            <span class="k">if</span> <span class="n">modifier</span> <span class="o">==</span> <span class="n">mod_key</span> <span class="ow">and</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">100</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">add_bk_bt</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s2">&quot;on_release&quot;</span><span class="p">)</span>

            <span class="c1"># Toggle manual path writing with ctrl+l</span>
            <span class="k">if</span> <span class="n">modifier</span> <span class="o">==</span> <span class="n">mod_key</span> <span class="ow">and</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">108</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">path_toggle</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">path_toggle</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">path_toggle</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">path_toggle</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s2">&quot;on_release&quot;</span><span class="p">)</span>

            <span class="c1"># Select all files with ctrl+a</span>
            <span class="k">if</span> <span class="n">modifier</span> <span class="o">==</span> <span class="n">mod_key</span> <span class="ow">and</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">97</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">icon_view_tab</span><span class="o">.</span><span class="n">selection</span> <span class="o">=</span> \
                    <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">icon_view_tab</span><span class="o">.</span><span class="n">files</span> <span class="k">if</span> <span class="ow">not</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="c1"># Use arrow keys and enter to navigate through open/cancel</span>
                <span class="c1"># buttons and selecting them</span>
                <span class="n">bn</span> <span class="o">=</span> <span class="s2">&quot;data/backgrounds/bt_process.png&quot;</span>
                <span class="n">bd</span> <span class="o">=</span> <span class="s2">&quot;data/backgrounds/bt_process_off.png&quot;</span>
                <span class="n">open_close_bt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">open_close_bt</span>
                <span class="n">open_bt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">open_bt</span>
                <span class="n">cancel_bt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">cancel_bt</span>
                <span class="n">popup_keys</span><span class="p">(</span><span class="n">bn</span><span class="p">,</span> <span class="n">bd</span><span class="p">,</span> <span class="n">open_bt</span><span class="p">,</span> <span class="n">open_close_bt</span><span class="p">,</span> <span class="n">cancel_bt</span><span class="p">)</span>

        <span class="c1"># ==================================================================</span>
        <span class="c1"># General keybindings</span>
        <span class="c1"># ==================================================================</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CustomPopup</span><span class="p">)]:</span>

            <span class="c1"># Keybinding ctrl+o that opens the Filechooser screen</span>
            <span class="k">if</span> <span class="n">modifier</span> <span class="o">==</span> <span class="n">mod_key</span> <span class="ow">and</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">111</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">go_screen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;fc&quot;</span><span class="p">))</span>

            <span class="c1"># Changing main screens between Orthology, Process and</span>
            <span class="c1"># Statistics</span>
            <span class="k">if</span> <span class="n">modifier</span> <span class="o">==</span> <span class="n">mod_key</span> <span class="ow">and</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">49</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">h_ortho</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s2">&quot;on_release&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">h_ortho</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>
            <span class="k">if</span> <span class="n">modifier</span> <span class="o">==</span> <span class="n">mod_key</span> <span class="ow">and</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">50</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">h_process</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s2">&quot;on_release&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">h_process</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>
            <span class="k">if</span> <span class="n">modifier</span> <span class="o">==</span> <span class="n">mod_key</span> <span class="ow">and</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">51</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">h_stat</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s2">&quot;on_release&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">h_stat</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>

            <span class="c1"># Toggle side panel (slash)</span>
            <span class="k">if</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">92</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">ap</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s2">&quot;on_release&quot;</span><span class="p">)</span>

        <span class="c1"># ==================================================================</span>
        <span class="c1"># Text input autocompletion</span>
        <span class="c1"># ==================================================================</span>

        <span class="c1"># Use tab for auto completion when textinput is focused</span>
        <span class="n">path_wgt</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">key_code</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;path_bx&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="p">:</span>
                <span class="n">path_wgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">path_bx</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;path_bx&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">:</span>
                    <span class="n">path_wgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">path_bx</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path_wgt</span><span class="p">,</span> <span class="n">TextInput</span><span class="p">):</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">path_wgt</span><span class="o">.</span><span class="n">text</span>
                <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_completion</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">path_wgt</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">_common_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a string with the longest common path contained in the</span>
<span class="sd">        self.file_list dir. This is used by FileChoosers to open the nearest</span>
<span class="sd">        directory to their input files</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_list</span><span class="p">:</span>
            <span class="n">fl</span> <span class="o">=</span> <span class="n">file_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span>

        <span class="c1"># Return None if there are no input files</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fl</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Get common path</span>
        <span class="n">common_path</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">fl</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">char</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">common_path</span> <span class="o">+=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">char</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="c1"># Get nearest directory from common path</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">common_path</span><span class="p">):</span>
            <span class="n">common_path</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">common_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">common_path</span>

    <span class="k">def</span> <span class="nf">_auto_completion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used for providing auto completion for text input widgets</span>
<span class="sd">        navigating the os file system</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check if current path exists. If it does, there is no path to auto</span>
        <span class="c1"># complete and no action is required.</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">or</span> <span class="n">path</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">path</span>
        <span class="c1"># If the path does not exist, get the nearest parent directory and</span>
        <span class="c1"># use the final string of the path to text for auto completion</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">original_path</span> <span class="o">=</span> <span class="n">path</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Get list of contents that may</span>
        <span class="n">dirlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span>
                   <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">x</span><span class="p">))]</span>

        <span class="c1"># If there is only one match in dirlist, return that match</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dirlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dirlist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># If there are multiple matches in dirlist, return the longest</span>
        <span class="c1"># common substring</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">dirlist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">commonprefix</span><span class="p">(</span><span class="n">dirlist</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;Path does not exist&quot;</span><span class="p">,</span>
                                   <span class="n">t</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">original_path</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_determine_collision</span><span class="p">(</span><span class="n">wgt</span><span class="p">,</span> <span class="n">mp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provided a widget, this function determines whether the mouse is</span>
<span class="sd">        colliding with its window coordinates</span>
<span class="sd">        :param wgt: ToggleButton widget inside a relative layout</span>
<span class="sd">        :return: Boolean. True is mouse position collides with wgt</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Retrieving window widget coordinates</span>
        <span class="n">window_pos</span> <span class="o">=</span> <span class="n">wgt</span><span class="o">.</span><span class="n">to_window</span><span class="p">(</span><span class="n">wgt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">wgt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># Creating dummy widget to determine collision</span>
        <span class="n">dummy_wgt</span> <span class="o">=</span> <span class="n">Widget</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">window_pos</span><span class="p">,</span> <span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                           <span class="n">size</span><span class="o">=</span><span class="n">wgt</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dummy_wgt</span><span class="o">.</span><span class="n">collide_point</span><span class="p">(</span><span class="n">mp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_check_removable_media</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks, when a Filechooser dialog is active, for the insertion or</span>
<span class="sd">        removal of external storage devices, and updates the bookmark</span>
<span class="sd">        buttons accordingly</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">detect_changes</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Detects changes between the app attribute self.removable_media</span>
<span class="sd">            and the removable media detected in the system. If</span>
<span class="sd">            differences are found, returns the operation (remove ou add)</span>
<span class="sd">            and a list of paths</span>
<span class="sd">            :return: Tuple, 1? element is the operation (add/remove); 2?</span>
<span class="sd">            element is a list of paths with which to perform the operation</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="c1"># For linux</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;linux&quot;</span><span class="p">,</span> <span class="s2">&quot;linux2&quot;</span><span class="p">]:</span>

                <span class="c1"># Get current removable media</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s2">&quot;mount | grep -e /media -e /mnt | &quot;</span>
                    <span class="s2">&quot;awk &#39;{print $3}&#39;&quot;</span><span class="p">],</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
                <span class="n">removable_media</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># For MacOS</span>
            <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;darwin&quot;</span><span class="p">:</span>

                <span class="n">removable_media</span> <span class="o">=</span> <span class="p">[</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;/Volumes&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                                   <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;/Volumes/&quot;</span><span class="p">)]</span>

            <span class="c1"># For Windows</span>
            <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;win32&quot;</span><span class="p">,</span> <span class="s2">&quot;cygwin&quot;</span><span class="p">]:</span>

                <span class="n">removable_media</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span>
                    <span class="sa">r</span><span class="s2">&quot;[A-Z]+:.*$&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s2">&quot;mountvol /&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>

                <span class="c1"># Prevent no disk on drive popup error in windows</span>
                <span class="n">SEM_FAILCRITICALERRORS</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">SEM_NOOPENFILEERRORBOX</span> <span class="o">=</span> <span class="mh">0x8000</span>
                <span class="n">SEM_FAIL</span> <span class="o">=</span> <span class="n">SEM_NOOPENFILEERRORBOX</span> <span class="o">|</span> <span class="n">SEM_FAILCRITICALERRORS</span>

                <span class="n">kernel32</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">WinDLL</span><span class="p">(</span><span class="s1">&#39;kernel32&#39;</span><span class="p">)</span>
                <span class="n">oldmode</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">()</span>
                <span class="n">kernel32</span><span class="o">.</span><span class="n">SetThreadErrorMode</span><span class="p">(</span><span class="n">SEM_FAIL</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">oldmode</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="n">cur</span><span class="p">,</span> <span class="n">act</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">removable_media</span><span class="p">),</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">removable_media</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">cur</span> <span class="o">==</span> <span class="n">act</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="k">elif</span> <span class="n">cur</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">act</span><span class="p">):</span>
                <span class="k">return</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">cur</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">act</span><span class="p">)]</span>

            <span class="k">elif</span> <span class="n">act</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">cur</span><span class="p">):</span>
                <span class="k">return</span> <span class="s2">&quot;remove&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">act</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">cur</span><span class="p">)]</span>

        <span class="k">def</span> <span class="nf">update_media</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="n">wgt</span><span class="p">,</span> <span class="n">fc_wgt</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Updates media, according to the operation and list of paths</span>
<span class="sd">            :param operation: string, Either &quot;add&quot; or &quot;remove&quot;</span>
<span class="sd">            :param paths: list, containing the paths to the added or removed</span>
<span class="sd">            :param wgt: Widget, preferentially a gridlayout where the</span>
<span class="sd">            bookmark buttons will be added/removed</span>
<span class="sd">            :param fc_wgt: FileChooser widget in which bookmark operations</span>
<span class="sd">            will be performed</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;add&quot;</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>

                    <span class="c1"># First, check if the provided path is a directory and</span>
                    <span class="c1"># is reachable. If not, we do not add it as a bookmark</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                        <span class="k">return</span>

                    <span class="c1"># For windows, get the name of the drive manually</span>
                    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;win32&quot;</span><span class="p">,</span> <span class="s2">&quot;cygwin&quot;</span><span class="p">]:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitdrive</span><span class="p">(</span><span class="n">p</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">add_bookmark_bt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">wgt</span><span class="p">,</span> <span class="n">fc_wgt</span><span class="p">,</span> <span class="n">rm_bt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                         <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">removable_media</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;remove&quot;</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">bt</span> <span class="ow">in</span> <span class="n">wgt</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">bt</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">removable_media</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                        <span class="n">wgt</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;fc&quot;</span><span class="p">:</span>

            <span class="n">res</span> <span class="o">=</span> <span class="n">detect_changes</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">res</span><span class="p">:</span>
                <span class="n">update_media</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sv_mycomp</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">icon_view_tab</span><span class="p">)</span>

        <span class="k">elif</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CustomPopup</span><span class="p">)]:</span>
            <span class="c1"># Get popup content</span>
            <span class="n">wgt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                   <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CustomPopup</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">content</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wgt</span><span class="p">,</span> <span class="n">SaveDialog</span><span class="p">)</span> <span class="ow">or</span> \
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">wgt</span><span class="p">,</span> <span class="n">LoadMultipleDialog</span><span class="p">):</span>

                <span class="n">res</span> <span class="o">=</span> <span class="n">detect_changes</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">res</span><span class="p">:</span>
                    <span class="n">update_media</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sv_mycomp</span><span class="p">,</span>
                                 <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sd_filechooser</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_mouseover_tabs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides mouse over events throughout the app. In order to reduce</span>
<span class="sd">        computations in each cycle, the mouse over events should only be</span>
<span class="sd">        tested when the appropriate screen/widget is visible</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouse_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">mouse_pos</span>
        <span class="k">except</span> <span class="ne">ReferenceError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Get mouse position coordinates</span>
        <span class="n">mp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">mouse_pos</span>
        <span class="c1"># Set collision attribute</span>
        <span class="n">collision</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Set side button list</span>
        <span class="n">sidebt_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">side_bt</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                       <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ToggleButton</span><span class="p">)]</span>

        <span class="k">def</span> <span class="nf">show_label</span><span class="p">(</span><span class="n">mouse</span><span class="p">,</span> <span class="n">wgt</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Use this function with a Clock schedule to delay the</span>
<span class="sd">            introduction of the label widget. Otherwise, it could become</span>
<span class="sd">            cumbersome to have an label appearing right after the mouse</span>
<span class="sd">            colliding with the button</span>
<span class="sd">            :param mouse: mouse position tuple</span>
<span class="sd">            :param wgt: Layout widget, containing a descriptive label</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="c1"># Checking if the current mouse position is the same as the</span>
            <span class="c1">#  mouse position when the mouse over was triggered. This</span>
            <span class="c1"># ensures that if the user changes the mouse position while</span>
            <span class="c1"># this event is scheduled, the label will not be added to the</span>
            <span class="c1">#  root_window but the lock in self.mouse_over_ready is removed</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">mouse_pos</span> <span class="o">==</span> <span class="n">mouse</span><span class="p">:</span>
                <span class="c1"># Add widget to root layout</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">wgt</span><span class="p">)</span>
                <span class="c1"># Update old label widget</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">old_mouse_over</span> <span class="o">=</span> <span class="n">wgt</span>
                <span class="c1"># Update old label text</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">previous_mouse_over</span> <span class="o">=</span> <span class="n">wgt</span><span class="o">.</span><span class="n">text</span>

            <span class="c1"># Unlocking mouse over</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_ready</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">def</span> <span class="nf">create_sidebt_wgt</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Creates the label for the sidebt mouseover</span>
<span class="sd">            :param text: string. Text for the label</span>
<span class="sd">            :param p: tuple. position of the wgt</span>
<span class="sd">            :param s: tuple. size of the wgt</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">clear_mouse_overs</span><span class="p">()</span>
            <span class="n">side_bt</span> <span class="o">=</span> <span class="n">SideLabel</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">side_bt</span>

        <span class="k">def</span> <span class="nf">create_fancy_label</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">wgt</span><span class="p">,</span> <span class="n">lbl_height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">adjust_pos</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">c</span><span class="o">=</span><span class="p">(</span><span class="mf">0.216</span><span class="p">,</span> <span class="mf">0.67</span><span class="p">,</span> <span class="mf">0.784</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">wgt_pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="n">wgt_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span>
                               <span class="n">line_c</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Creates a fancy label akin to the mouse over labels in github.</span>
<span class="sd">            This method is quite versatile as it is able to calculate the</span>
<span class="sd">            available space for the label and determine its orientation</span>
<span class="sd">            accordingly. It also starts by removing any other potential</span>
<span class="sd">            fancy labels.</span>

<span class="sd">            :param text: string, text that will be displayed in the label</span>
<span class="sd">            :param wgt: widget that triggered the mouse over</span>
<span class="sd">            :param lbl_height: int, height of the label</span>
<span class="sd">            :param adjust_pos: Boolean, If True the position of wgt will</span>
<span class="sd">            be adjusted to window coordenates; If False, use the origial</span>
<span class="sd">            position of the wgt. This is only relevant when wgt_pos=None</span>
<span class="sd">            :param c: tuple. Label color</span>
<span class="sd">            :param wgt_pos: tuple/list, If not None, this will be the</span>
<span class="sd">            position used to create the label. Superseeds wgt.pos</span>
<span class="sd">            :param wgt_size: tuple/list, If not None this will be the size</span>
<span class="sd">            of the wgt. Superseed wgt.size</span>
<span class="sd">            :param orientation: string, whether the label will be display in</span>
<span class="sd">            the same horizontal or vertical plane of the widget</span>
<span class="sd">            :param line_c: tuple/list, color of the border line and arrow</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="c1"># If the current mouse position is no longer the same when the</span>
            <span class="c1"># label was issued, then do nothing</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">mouse_pos</span> <span class="o">!=</span> <span class="n">mp</span><span class="p">:</span>
                <span class="c1"># Unlocking mouse over</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_ready</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># Cleans any possible mouse overs</span>
                <span class="n">clear_mouse_overs</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="c1"># Cleans any possible mouse overs</span>
            <span class="n">clear_mouse_overs</span><span class="p">()</span>

            <span class="c1"># Determines which coordinates to use</span>
            <span class="k">if</span> <span class="n">wgt_pos</span><span class="p">:</span>
                <span class="n">wgt_pos</span> <span class="o">=</span> <span class="n">wgt_pos</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">adjust_pos</span><span class="p">:</span>
                    <span class="n">wgt_pos</span> <span class="o">=</span> <span class="n">wgt</span><span class="o">.</span><span class="n">to_window</span><span class="p">(</span><span class="n">wgt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">wgt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">wgt_pos</span> <span class="o">=</span> <span class="n">wgt</span><span class="o">.</span><span class="n">pos</span>

            <span class="c1"># Determines size attribute</span>
            <span class="k">if</span> <span class="n">wgt_size</span><span class="p">:</span>
                <span class="n">wgt_size</span> <span class="o">=</span> <span class="n">wgt_size</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wgt_size</span> <span class="o">=</span> <span class="n">wgt</span><span class="o">.</span><span class="n">size</span>

            <span class="c1"># Create label</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span> <span class="o">=</span> <span class="n">FancyButton</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">lbl_height</span><span class="p">,</span>
                                        <span class="nb">id</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
            <span class="c1"># Update label texture size, so that we can evaluate the</span>
            <span class="c1"># available space for the label</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span><span class="o">.</span><span class="n">texture_update</span><span class="p">()</span>
            <span class="c1"># Set border line color</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span><span class="o">.</span><span class="n">line_clr</span> <span class="o">=</span> <span class="n">line_c</span>

            <span class="c1"># Determine if there is enough space for  the label to be</span>
            <span class="c1"># properly shown. If not, truncante the label width to 70% of</span>
            <span class="c1">#  window width</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">wgt_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">wgt_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">+</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span><span class="o">.</span><span class="n">texture_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">50</span> <span class="o">&gt;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">width</span> <span class="ow">and</span> <span class="n">wgt_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">wgt_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">-</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span><span class="o">.</span><span class="n">texture_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">50</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="o">.</span><span class="mi">7</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span><span class="o">.</span><span class="n">text_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span><span class="o">.</span><span class="n">size</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span><span class="o">.</span><span class="n">halign</span> <span class="o">=</span> <span class="s2">&quot;center&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span><span class="o">.</span><span class="n">valign</span> <span class="o">=</span> <span class="s2">&quot;middle&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span><span class="o">.</span><span class="n">texture_update</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span><span class="o">.</span><span class="n">texture_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">16</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Determine label size. Add horizontal margin space (10)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span><span class="o">.</span><span class="n">texture_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
                                      <span class="mi">10</span><span class="p">,</span> <span class="n">lbl_height</span><span class="p">)</span>

            <span class="c1"># Create horizontal label</span>
            <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">:</span>
                <span class="c1"># Determine if the label has space to the right. If not,</span>
                <span class="c1"># flip the orientation</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">wgt_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">wgt_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span><span class="o">.</span><span class="n">width</span> <span class="o">&lt;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">width</span><span class="p">):</span>

                    <span class="c1"># Determine position of arrow widget</span>
                    <span class="n">point_pos</span> <span class="o">=</span> <span class="n">wgt_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">wgt_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="n">wgt_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> \
                        <span class="n">wgt_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">6</span>

                    <span class="c1"># Determine label position</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">point_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">7</span><span class="p">,</span> <span class="n">wgt_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> \
                        <span class="n">wgt_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span>

                    <span class="c1"># Create arrow widget with left arrow</span>
                    <span class="n">point_wgt</span> <span class="o">=</span> <span class="n">FancyMarker</span><span class="p">(</span><span class="n">background_normal</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;box_arrow_right.png&quot;</span><span class="p">),</span>
                                            <span class="n">pos</span><span class="o">=</span><span class="n">point_pos</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
                                            <span class="n">background_color</span><span class="o">=</span><span class="n">line_c</span><span class="p">)</span>
                <span class="c1"># In case this else code is executed, it means there is no</span>
                <span class="c1">#  space for the label to be shown in the right,</span>
                <span class="c1"># so it will show to the left</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Determine position of arrow widget</span>
                    <span class="n">point_pos</span> <span class="o">=</span> <span class="n">wgt_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">wgt_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> \
                        <span class="n">wgt_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">6</span>

                    <span class="c1"># Determine label position</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">point_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>\
                        <span class="n">wgt_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">wgt_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span>

                    <span class="c1"># Create arrow widget with left arrow</span>
                    <span class="n">point_wgt</span> <span class="o">=</span> <span class="n">FancyMarker</span><span class="p">(</span><span class="n">background_normal</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;box_arrow_left.png&quot;</span><span class="p">),</span>
                                            <span class="n">pos</span><span class="o">=</span><span class="n">point_pos</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
                                            <span class="nb">id</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                                            <span class="n">background_color</span><span class="o">=</span><span class="n">line_c</span><span class="p">)</span>
            <span class="c1"># For vertical orientation</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># For now, show always on top</span>
                <span class="c1"># Determine position of arrow</span>
                <span class="n">point_pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">wgt_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">wgt_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                             <span class="n">wgt_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">wgt_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span>

                <span class="c1"># Determine position of label</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">point_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">6</span><span class="p">,</span> <span class="n">point_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">7</span><span class="p">]</span>

                <span class="c1"># Create arrow widget with down arrow</span>
                <span class="n">point_wgt</span> <span class="o">=</span> <span class="n">FancyMarker</span><span class="p">(</span><span class="n">background_normal</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;box_arrow_down.png&quot;</span><span class="p">),</span>
                                        <span class="n">pos</span><span class="o">=</span><span class="n">point_pos</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                                        <span class="nb">id</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                                        <span class="n">background_color</span><span class="o">=</span><span class="n">line_c</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fancy_bt</span><span class="p">,</span> <span class="n">point_wgt</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>

            <span class="c1"># Unlocking mouse over</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_ready</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">def</span> <span class="nf">clear_mouse_overs</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Clears fancy mouseovers, if any</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span>
                      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">FancyButton</span><span class="p">)</span> <span class="ow">or</span>
                      <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">FancyMarker</span><span class="p">)]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="c1"># Only do this routine when the filechooser screen is on</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;fc&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_ready</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">show_side_panel</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">case_bt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">case_bt</span>
            <span class="k">for</span> <span class="n">bt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks_bt</span> <span class="o">+</span> <span class="p">[</span><span class="n">case_bt</span><span class="p">]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_collision</span><span class="p">(</span><span class="n">bt</span><span class="p">,</span> <span class="n">mp</span><span class="p">):</span>
                    <span class="n">collision</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">bt</span> <span class="o">==</span> <span class="n">case_bt</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s2">&quot;Case sensitive&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_mouse_over</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">case_bt</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span>
                                <span class="n">create_fancy_label</span><span class="p">(</span><span class="s2">&quot;Case sensitive is ON&quot;</span><span class="p">,</span>
                                                   <span class="n">case_bt</span><span class="p">,</span>
                                                   <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">create_fancy_label</span><span class="p">(</span><span class="s2">&quot;Case sensitive is OFF&quot;</span><span class="p">,</span>
                                                   <span class="n">case_bt</span><span class="p">,</span>
                                                   <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Saving relevant attributes, otherwise they would</span>
                        <span class="c1"># be lost</span>
                        <span class="n">txt</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">id</span>
                        <span class="n">pos</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">to_window</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">size</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">size</span>

                        <span class="c1"># If the current collision is different from the</span>
                        <span class="c1"># existing fancy lavel, remove it</span>
                        <span class="k">if</span> <span class="p">[</span><span class="n">txt</span><span class="p">]</span> <span class="o">!=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                                     <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">FancyButton</span><span class="p">)]:</span>
                            <span class="n">clear_mouse_overs</span><span class="p">()</span>

                        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_once</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">create_fancy_label</span><span class="p">(</span>
                            <span class="n">txt</span><span class="p">,</span> <span class="n">bt</span><span class="p">,</span> <span class="n">adjust_pos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">wgt_pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span>
                            <span class="n">wgt_size</span><span class="o">=</span><span class="n">size</span><span class="p">),</span> <span class="o">.</span><span class="mi">8</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_ready</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># If no collision is detected, remove any remaining label</span>
            <span class="c1"># widget</span>
            <span class="k">if</span> <span class="n">collision</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">old_mouse_over</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">old_mouse_over</span><span class="p">)</span>

        <span class="c1"># Only do this routine if the side panel is open</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_side_panel</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_ready</span> \
                <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_moreopts</span><span class="p">:</span>
            <span class="c1"># Get active tab in side panel</span>
            <span class="n">active_tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_tp</span><span class="o">.</span><span class="n">current_tab</span><span class="o">.</span><span class="n">text</span>
            <span class="c1"># Get remove all button</span>
            <span class="n">rm_bt</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">rm_all_File</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">rm_all_Taxa</span><span class="p">]</span>
            <span class="n">part_bts</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">merge_part</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">split_part</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">add_part</span><span class="p">]</span>

            <span class="c1"># Iterate over buttons of active tab</span>
            <span class="k">for</span> <span class="n">bt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_bts</span><span class="p">[</span><span class="n">active_tab</span><span class="p">]</span> <span class="o">+</span> <span class="n">sidebt_list</span> <span class="o">+</span> \
                    <span class="n">rm_bt</span> <span class="o">+</span> <span class="n">part_bts</span><span class="p">:</span>
                <span class="c1"># Determine if there is a collision with mouse position</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_collision</span><span class="p">(</span><span class="n">bt</span><span class="p">,</span> <span class="n">mp</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span> <span class="ow">not</span> <span class="ow">in</span>\
                        <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">bt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_bts</span><span class="p">[</span><span class="n">active_tab</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_collision</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sv_file</span><span class="p">,</span>
                                                     <span class="n">mp</span><span class="p">)</span>\
                                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_collision</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sv_sp</span><span class="p">,</span> <span class="n">mp</span><span class="p">):</span>
                            <span class="n">collision</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Set collision marker to true</span>
                        <span class="n">collision</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="c1"># This will determine if a new label button will be</span>
                    <span class="c1"># added to the layout, based on the text of the</span>
                    <span class="c1"># button. If the text is already in the previous</span>
                    <span class="c1"># mouse over, then do nothing. If the text is some</span>
                    <span class="c1"># new button, then do something</span>
                    <span class="k">if</span> <span class="n">bt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_bts</span><span class="p">[</span><span class="n">active_tab</span><span class="p">]</span> <span class="o">+</span> <span class="n">sidebt_list</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">bt</span><span class="o">.</span><span class="n">text</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_mouse_over</span><span class="p">:</span>
                            <span class="c1"># Check if there is an old label button and</span>
                            <span class="c1"># remove it</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_mouse_over</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">old_mouse_over</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">bt</span> <span class="ow">in</span> <span class="n">sidebt_list</span><span class="p">:</span>
                            <span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">center_x</span> <span class="o">+</span> <span class="n">bt</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span>
                                   <span class="n">bt</span><span class="o">.</span><span class="n">center_y</span> <span class="o">-</span> <span class="n">bt</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>
                            <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
                            <span class="n">label</span> <span class="o">=</span> <span class="n">create_sidebt_wgt</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">att</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
                            <span class="n">show_label</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>

                        <span class="k">elif</span> <span class="n">bt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_bts</span><span class="p">[</span><span class="n">active_tab</span><span class="p">]:</span>

                            <span class="c1"># Saving relevant attributes, otherwise they</span>
                            <span class="c1"># would be lost</span>
                            <span class="n">txt</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">text</span>
                            <span class="n">pos</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">to_window</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="n">size</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">size</span>

                            <span class="c1"># If the current collision is different from the</span>
                            <span class="c1"># existing fancy lavel, remove it</span>
                            <span class="k">if</span> <span class="p">[</span><span class="n">txt</span><span class="p">]</span> <span class="o">!=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                                         <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">FancyButton</span><span class="p">)]:</span>
                                <span class="n">clear_mouse_overs</span><span class="p">()</span>

                            <span class="c1"># Schedule the introduction of the label widget</span>
                            <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_once</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span>
                                <span class="n">create_fancy_label</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="n">bt</span><span class="p">,</span> <span class="n">wgt_pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span>
                                                   <span class="n">wgt_size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                                                   <span class="n">c</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="o">.</span><span class="mi">95</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>

                            <span class="c1"># Locking mouse over so that no additional label</span>
                            <span class="c1"># widgets are added during the waiting time</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_ready</span> <span class="o">=</span> <span class="kc">False</span>

                    <span class="k">elif</span> <span class="n">bt</span> <span class="ow">in</span> <span class="n">rm_bt</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">active_tab</span> <span class="o">==</span> <span class="s2">&quot;Taxa&quot;</span> <span class="ow">and</span> <span class="n">bt</span> <span class="o">==</span> <span class="n">rm_bt</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="s2">&quot;Removes all files and taxa&quot;</span> \
                                    <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_mouse_over</span><span class="p">:</span>

                                <span class="k">if</span> <span class="ow">not</span> <span class="n">bt</span><span class="o">.</span><span class="n">disabled</span><span class="p">:</span>
                                    <span class="n">create_fancy_label</span><span class="p">(</span>
                                        <span class="s2">&quot;Removes all files and taxa&quot;</span><span class="p">,</span>
                                        <span class="n">rm_bt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">adjust_pos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="n">c</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">.</span><span class="mi">33</span><span class="p">,</span> <span class="o">.</span><span class="mi">33</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

                        <span class="k">elif</span> <span class="n">active_tab</span> <span class="o">==</span> <span class="s2">&quot;Files&quot;</span> <span class="ow">and</span> <span class="n">bt</span> <span class="o">==</span> <span class="n">rm_bt</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="s2">&quot;Removes all files and taxa&quot;</span> \
                                    <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_mouse_over</span><span class="p">:</span>

                                <span class="k">if</span> <span class="ow">not</span> <span class="n">bt</span><span class="o">.</span><span class="n">disabled</span><span class="p">:</span>
                                    <span class="n">create_fancy_label</span><span class="p">(</span>
                                        <span class="s2">&quot;Removes all files and  taxa&quot;</span><span class="p">,</span>
                                        <span class="n">rm_bt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">adjust_pos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="n">c</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">.</span><span class="mi">33</span><span class="p">,</span> <span class="o">.</span><span class="mi">33</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

                    <span class="k">elif</span> <span class="n">bt</span> <span class="ow">in</span> <span class="n">part_bts</span><span class="p">:</span>
                        <span class="n">bt_text</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data/backgrounds/group_bt.png&quot;</span><span class="p">:</span>
                            <span class="s2">&quot;Merge selected partitions&quot;</span><span class="p">,</span>
                                   <span class="s2">&quot;data/backgrounds/split_bt.png&quot;</span><span class="p">:</span>
                            <span class="s2">&quot;Split selected partitions&quot;</span><span class="p">,</span>
                                   <span class="s2">&quot;data/backgrounds/add_bt35.png&quot;</span><span class="p">:</span>
                            <span class="s2">&quot;Import partition scheme&quot;</span><span class="p">}</span>

                        <span class="k">if</span> <span class="n">active_tab</span> <span class="o">==</span> <span class="s2">&quot;Partitions&quot;</span><span class="p">:</span>
                            <span class="n">create_fancy_label</span><span class="p">(</span>
                                <span class="n">bt_text</span><span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">background_normal</span><span class="p">],</span>
                                <span class="n">bt</span><span class="p">,</span> <span class="n">adjust_pos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If no collision is detected, remove any remaining</span>
                <span class="c1"># label widget</span>
                <span class="k">if</span> <span class="n">collision</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">old_mouse_over</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">old_mouse_over</span><span class="p">)</span>

        <span class="c1"># Only do this when Statistics screen is on</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Statistics&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_side_panel</span> \
                <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_collision</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sum_stats_bt</span><span class="p">,</span> <span class="n">mp</span><span class="p">):</span>
                <span class="n">collision</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">create_fancy_label</span><span class="p">(</span><span class="s2">&quot;Show summary statistics&quot;</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sum_stats_bt</span><span class="p">,</span>
                                   <span class="n">adjust_pos</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Only do this when plot screen is on</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_screens</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span> <span class="ow">not</span> <span class="ow">in</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>

            <span class="c1"># Get PlotToolbar object</span>
            <span class="n">toolbar_wgt</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">toolbar_wgt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span>
                               <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">OrtoPlotToolbar</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">toolbar_wgt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span>
                                   <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">StatsPlotToolbar</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="n">toolbar_wgt</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">toolbar_wgt</span><span class="p">:</span>
                <span class="c1"># For headless plot screens a back button is added to</span>
                <span class="c1"># root_window</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;plot&quot;</span><span class="p">:</span>
                    <span class="c1"># Get back bt</span>
                    <span class="n">back_bt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span>
                               <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">BackButton</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_collision</span><span class="p">(</span><span class="n">back_bt</span><span class="p">,</span> <span class="n">mp</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">back_bt</span><span class="o">.</span><span class="n">opacity</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">Animation</span><span class="p">(</span>
                                <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;out_quart&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">back_bt</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">back_bt</span><span class="o">.</span><span class="n">opacity</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">Animation</span><span class="p">(</span>
                                <span class="n">opacity</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;out_quart&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">back_bt</span><span class="p">)</span>

                <span class="c1"># Change toolbar opacity to become visible when collision is</span>
                <span class="c1"># true</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_collision</span><span class="p">(</span><span class="n">toolbar_wgt</span><span class="p">,</span> <span class="n">mp</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">toolbar_wgt</span><span class="o">.</span><span class="n">opacity</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">Animation</span><span class="p">(</span>
                            <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;out_quart&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">toolbar_wgt</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">toolbar_wgt</span><span class="o">.</span><span class="n">opacity</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">Animation</span><span class="p">(</span>
                            <span class="n">opacity</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;out_quart&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">toolbar_wgt</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Statistics&quot;</span><span class="p">:</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">toggle_wgt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span>
                                      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">StatsToggleWgt</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_collision</span><span class="p">(</span><span class="n">toggle_wgt</span><span class="p">,</span> <span class="n">mp</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">toggle_wgt</span><span class="o">.</span><span class="n">opacity</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">Animation</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;out_quart&quot;</span><span class="p">)</span><span class="o">.</span> \
                                    <span class="n">start</span><span class="p">(</span><span class="n">toggle_wgt</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">toggle_wgt</span><span class="o">.</span><span class="n">opacity</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">Animation</span><span class="p">(</span><span class="n">opacity</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;out_quart&quot;</span><span class="p">)</span><span class="o">.</span> \
                                    <span class="n">start</span><span class="p">(</span><span class="n">toggle_wgt</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>

                <span class="c1"># Check for collision with export figure or export table buttons</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_collision</span><span class="p">(</span><span class="n">toolbar_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">export_fig</span><span class="p">,</span> <span class="n">mp</span><span class="p">):</span>
                    <span class="n">collision</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="s2">&quot;Export as graphics&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span><span class="p">]:</span>
                        <span class="c1"># Create fancy label</span>
                        <span class="n">create_fancy_label</span><span class="p">(</span><span class="s2">&quot;Export as graphics&quot;</span><span class="p">,</span>
                                           <span class="n">toolbar_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">export_fig</span><span class="p">,</span>
                                           <span class="n">line_c</span><span class="o">=</span><span class="p">(</span><span class="mf">0.216</span><span class="p">,</span> <span class="mf">0.67</span><span class="p">,</span> <span class="mf">0.784</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_collision</span><span class="p">(</span><span class="n">toolbar_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">export_table</span><span class="p">,</span>
                                               <span class="n">mp</span><span class="p">):</span>
                    <span class="n">collision</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="s2">&quot;Export as table&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span><span class="p">]:</span>
                        <span class="c1"># Create fancy label</span>
                        <span class="n">create_fancy_label</span><span class="p">(</span><span class="s2">&quot;Export as table&quot;</span><span class="p">,</span>
                                           <span class="n">toolbar_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">export_table</span><span class="p">,</span>
                                           <span class="n">line_c</span><span class="o">=</span><span class="p">(</span><span class="mf">0.216</span><span class="p">,</span> <span class="mf">0.67</span><span class="p">,</span> <span class="mf">0.784</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;Statistics&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_collision</span><span class="p">(</span><span class="n">toolbar_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">export_group</span><span class="p">,</span>
                                                 <span class="n">mp</span><span class="p">):</span>
                        <span class="n">collision</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">if</span> <span class="s2">&quot;Export group&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span><span class="p">]:</span>
                            <span class="c1"># Create fancy label</span>
                            <span class="n">create_fancy_label</span><span class="p">(</span><span class="s2">&quot;Export group&quot;</span><span class="p">,</span>
                                               <span class="n">toolbar_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">export_group</span><span class="p">,</span>
                                               <span class="n">line_c</span><span class="o">=</span><span class="p">(</span><span class="mf">0.216</span><span class="p">,</span> <span class="mf">0.67</span><span class="p">,</span> <span class="mf">0.784</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Only do this in Orthology screen</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Orthology&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_side_panel</span> <span class="ow">is</span>
                <span class="kc">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span><span class="p">):</span>

            <span class="n">id_to_txt</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;sp_vis&quot;</span><span class="p">:</span> <span class="s2">&quot;Species focused exploration&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;gn_vis&quot;</span><span class="p">:</span> <span class="s2">&quot;Ortholog focused exploration&quot;</span><span class="p">}</span>

            <span class="c1"># Determine collision with add groups button</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_collision</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">add_group</span><span class="p">,</span> <span class="n">mp</span><span class="p">):</span>
                <span class="n">collision</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="s2">&quot;Add group files&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span><span class="p">]:</span>
                    <span class="c1"># Create fancy label</span>
                    <span class="n">create_fancy_label</span><span class="p">(</span><span class="s2">&quot;Add group files&quot;</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">add_group</span><span class="p">,</span>
                                       <span class="n">adjust_pos</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Determine collision with orthology graph visualization bts</span>
            <span class="k">for</span> <span class="n">bt</span><span class="p">,</span> <span class="n">bt_id</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sp_vis</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_vis</span><span class="p">],</span>
                                 <span class="p">[</span><span class="s2">&quot;sp_vis&quot;</span><span class="p">,</span> <span class="s2">&quot;gn_vis&quot;</span><span class="p">]):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_collision</span><span class="p">(</span><span class="n">bt</span><span class="p">,</span> <span class="n">mp</span><span class="p">):</span>
                    <span class="n">collision</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">id_to_txt</span><span class="p">[</span><span class="n">bt_id</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span><span class="p">]:</span>
                        <span class="c1"># Create fancy label</span>
                        <span class="n">create_fancy_label</span><span class="p">(</span><span class="n">id_to_txt</span><span class="p">[</span><span class="n">bt_id</span><span class="p">],</span> <span class="n">bt</span><span class="p">,</span>
                                           <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span>
                                           <span class="n">adjust_pos</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">collision</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_ready</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_mouse_over</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">clear_mouse_overs</span><span class="p">()</span>

<div class="viewcode-block" id="TriFusionApp.switch_path_wgt"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.switch_path_wgt">[docs]</a>    <span class="k">def</span> <span class="nf">switch_path_wgt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wgt_id</span><span class="p">,</span> <span class="n">path_bx</span><span class="p">,</span> <span class="n">fc_wgt</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">path_updater</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">txt</span><span class="o">.</span><span class="n">text</span><span class="p">):</span>
                <span class="n">fc_wgt</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="n">txt</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                <span class="n">fc_wgt</span><span class="o">.</span><span class="n">previous_dir</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fc_wgt</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                    <span class="s2">&quot;Directory does not exist&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="n">label</span> <span class="o">=</span> <span class="n">PathLabel</span><span class="p">()</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="n">PathText</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;path_editor&quot;</span><span class="p">)</span>

        <span class="n">fc_wgt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">txt</span><span class="o">.</span><span class="n">setter</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">))</span>
        <span class="n">fc_wgt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">label</span><span class="o">.</span><span class="n">setter</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">))</span>

        <span class="n">path_bx</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">wgt_id</span> <span class="o">==</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span>
            <span class="n">label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">fc_wgt</span><span class="o">.</span><span class="n">path</span>
            <span class="n">path_bx</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">txt</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">fc_wgt</span><span class="o">.</span><span class="n">path</span>
            <span class="n">txt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_text_validate</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">path_updater</span><span class="p">())</span>
            <span class="n">path_bx</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
            <span class="n">path_bx</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">focus</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="TriFusionApp.create_folder"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.create_folder">[docs]</a>    <span class="k">def</span> <span class="nf">create_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>

        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sd_filechooser</span><span class="o">.</span><span class="n">path</span>
        <span class="n">dir_name</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dir_name</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                <span class="s2">&quot;The specified folder already exists&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sd_filechooser</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_subpopup</span><span class="p">()</span></div>

    <span class="c1"># ######################### SCREEN NAVIGATION ##########################</span>

<div class="viewcode-block" id="TriFusionApp.go_screen"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.go_screen">[docs]</a>    <span class="k">def</span> <span class="nf">go_screen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used to go to a specific screen by specifying and index and</span>
<span class="sd">        transition direction</span>
<span class="sd">        :param idx: integer. Index value of the screen from</span>
<span class="sd">        self.screen_names</span>
<span class="sd">        :param direct: string. The direction of the transition</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_screens</span> <span class="ow">or</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Statistics&quot;</span><span class="p">:</span>
                <span class="n">screen_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_dir</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;screens&quot;</span><span class="p">,</span>
                                   <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.kv&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loaded_screens</span><span class="p">[</span><span class="n">screen_path</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span>

            <span class="c1"># Automatic removal of plot toolbar when not in a plot screen</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_names</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_screens</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_plot_wgt</span><span class="p">()</span>

            <span class="c1"># Automatic removal of fancy dropdown</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_fancy_dropdown</span><span class="p">()</span>

            <span class="c1"># Removes old toolbar when switching directly from orto plot</span>
            <span class="c1">#  widget to Statistics</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_names</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Statistics&quot;</span> <span class="ow">and</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">current_screen</span> <span class="o">!=</span> <span class="s2">&quot;Statistics&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_plot_wgt</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">idx</span>

        <span class="c1"># Precludes a transition if the current screen is the same as the</span>
        <span class="c1"># target screen</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_screen</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_names</span><span class="p">[</span><span class="n">idx</span><span class="p">]:</span>
            <span class="c1"># Update previous screen</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_screen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_screen</span>
            <span class="c1"># Update current screen</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_screen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_names</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="c1"># Make the switch</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">switch_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_screen</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span>
                                       <span class="n">direction</span><span class="o">=</span><span class="n">direct</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_screen</span> <span class="o">==</span> <span class="s2">&quot;Statistics&quot;</span><span class="p">:</span>
            <span class="c1"># Generate or update statistics screen</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statistics_show_summary</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.go_previous_screen"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.go_previous_screen">[docs]</a>    <span class="k">def</span> <span class="nf">go_previous_screen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method that returns to the previous screen, set by</span>
<span class="sd">        self.previous_screen</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_screen</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">previous_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">previous_screen</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">go_screen</span><span class="p">(</span><span class="n">previous_idx</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.load_screen"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.load_screen">[docs]</a>    <span class="k">def</span> <span class="nf">load_screen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the current screen according to the corresponding kv file</span>
<span class="sd">        :param idx: The index of the screen to be loaded</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loaded_screens</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">available_screens</span><span class="p">[</span><span class="n">idx</span><span class="p">]]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loaded_screens</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">available_screens</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;fc&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">icon_view_tab</span><span class="o">.</span><span class="n">selection</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="o">=</span> <span class="n">Builder</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">available_screens</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

            <span class="c1"># If the screen to be loaded is the filechooser, set the</span>
            <span class="c1"># home path as the default</span>
            <span class="k">if</span> <span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">available_screens</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="o">==</span> <span class="s2">&quot;fc.kv&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">icon_view_tab</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">home_path</span>
                <span class="c1"># Initialize bookmarks</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bookmark_init</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sv_book</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sv_mycomp</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">icon_view_tab</span><span class="p">)</span>

        <span class="c1"># Disengage acion bar toggle buttons when entering main filechooser</span>
        <span class="k">if</span> <span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">available_screens</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="o">==</span> <span class="s2">&quot;fc.kv&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disengage_groups</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">available_screens</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="o">==</span> <span class="s2">&quot;Statistics.kv&quot;</span><span class="p">:</span>
            <span class="c1"># Add StatsToggleWidget, if present</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">plot_content</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span>
                        <span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Image</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">show_plot_toolbar</span><span class="p">(</span><span class="n">toolbar_type</span><span class="o">=</span><span class="s2">&quot;stats&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_stats_toggle</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">previous_stats_toggle</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span></div>

<div class="viewcode-block" id="TriFusionApp.go_carousel"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.go_carousel">[docs]</a>    <span class="k">def</span> <span class="nf">go_carousel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slide</span><span class="p">,</span> <span class="n">bt_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used by other buttons outside the side buttons of the side</span>
<span class="sd">        panel to go to specific slides of the side panel</span>
<span class="sd">        :param slide: int, the index of the target slide</span>
<span class="sd">        :param bt_id: string, the id of the corresponding button</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">toggle_groups</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">bt_id</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">bt_id</span><span class="p">]</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>

        <span class="n">panel_car</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">carousel</span>
        <span class="n">panel_car</span><span class="o">.</span><span class="n">load_slide</span><span class="p">(</span><span class="n">panel_car</span><span class="o">.</span><span class="n">slides</span><span class="p">[</span><span class="n">slide</span><span class="p">])</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="TriFusionApp.toggle_groups"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.toggle_groups">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_groups</span><span class="p">(</span><span class="n">wgt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method generates a desired behaviour for groups of toggle</span>
<span class="sd">        buttons By default, when a toggle button is pressed, the state</span>
<span class="sd">        will be down and a new screen/slide is presented. However,</span>
<span class="sd">        if the same toggle button is pressed again, it&#39;s state will</span>
<span class="sd">        return to the normal state while the same screen/slide is showed.</span>
<span class="sd">        To prevent this behaviour, this method will disable the active</span>
<span class="sd">        toggle button in the group and enable any other previously</span>
<span class="sd">        disabled button.</span>

<span class="sd">        To allow a seamless transition, ensure that background_disabled_dow</span>
<span class="sd">        is the same as background_down, and that disabled_color is the</span>
<span class="sd">        same as color.</span>

<span class="sd">        :param wgt: The toggle button widget. Must belong to a group.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Iterating over the children of the parent may not be optimal, but</span>
        <span class="c1"># using the get_widgets(groupname) method could result in some</span>
        <span class="c1"># issues with garbage collector of kivy. So, for now, this will</span>
        <span class="c1"># iterate over all children of the toggle button&#39;s parent</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">wgt</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">children</span>
                  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ToggleButton</span><span class="p">)]:</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">disabled</span><span class="p">:</span>
                <span class="n">i</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">i</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>

        <span class="n">wgt</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="TriFusionApp.disengage_groups"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.disengage_groups">[docs]</a>    <span class="k">def</span> <span class="nf">disengage_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Methods used to unselect all module header buttons, in case the user</span>
<span class="sd">        enters the main filechooser</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">wgt</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">h_ortho</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">h_process</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">h_stat</span><span class="p">]:</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span></div>

<div class="viewcode-block" id="TriFusionApp.check_action"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.check_action">[docs]</a>    <span class="k">def</span> <span class="nf">check_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">bt_wgt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">popup_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">check_wgt</span><span class="o">=</span><span class="n">CheckDialog</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        General purpose method that pops a dialog checking if the user</span>
<span class="sd">        wants to perform a certain action. This method should be passed</span>
<span class="sd">        as a function on the &#39;on_*&#39; with the final function and original</span>
<span class="sd">        widget triggering the event as arguments.</span>

<span class="sd">        By default, the check action dialog is a CheckDialog widget,</span>
<span class="sd">        but alternative widgets can be used by passing them to the</span>
<span class="sd">        check_wgt option. If so, properties such as size, separator</span>
<span class="sd">        color, etc must be specified for such cases.</span>

<span class="sd">        :param text: string, text to appear in the dialog</span>
<span class="sd">        :param func: final function if the users chooses to proceed</span>
<span class="sd">        :param bt_wgt: widget where the initial &#39;on_&#39; event occurred</span>
<span class="sd">        :param args: list, of arguments to be passed on to func</span>
<span class="sd">        :param popup_level: int, level of popup. 1 for _popup, 2 for</span>
<span class="sd">        _subpopup and 3 for exit popup</span>
<span class="sd">        :param check_wgt: Widget. Specified the check dialog widget</span>

<span class="sd">        Usage example:</span>
<span class="sd">        This can be applied to the removal button of the bookmarks. In this</span>
<span class="sd">        case, the event of the removal button must be like this:</span>

<span class="sd">        remove_button.bind(partial(self.check_action,</span>
<span class="sd">                           self.remove_bookmark_bt))</span>

<span class="sd">        where, self.check_action is this method, and self.remove_bookmark_bt</span>
<span class="sd">        is the function that will actually remove the bookmark button. This</span>
<span class="sd">        function is then bound to the &quot;OK&quot; button of the check dialog.</span>
<span class="sd">        By default, the last argument is the bt_wgt.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">popup_level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">check_content</span> <span class="o">=</span> <span class="n">check_wgt</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">popup_level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">check_content</span> <span class="o">=</span> <span class="n">check_wgt</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_subpopup</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Do nothing if exit popup already exists. The return True</span>
            <span class="c1"># prevents the app from closing, since in that stage it will</span>
            <span class="c1"># be listening to return False to close.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exit_popup</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="n">check_content</span> <span class="o">=</span> <span class="n">check_wgt</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_exit</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">check_content</span><span class="p">,</span> <span class="n">CheckDialog</span><span class="p">):</span>
            <span class="c1"># Set size</span>
            <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
            <span class="c1"># Sep separator color</span>
            <span class="n">sep_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_red</span>
            <span class="c1"># Set popup title</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Warning!&quot;</span>
            <span class="c1"># Set text for dialog</span>
            <span class="n">check_content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">check_text</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">check_content</span><span class="p">,</span> <span class="n">CheckProject</span><span class="p">):</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Project overview&quot;</span>
            <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">350</span><span class="p">,</span> <span class="mi">230</span><span class="p">)</span>
            <span class="n">sep_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blue</span>
            <span class="n">check_content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">proj_name</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">check_content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_num</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Set the function to be called when dispatching the on_release</span>
        <span class="c1"># event of the check_ok button.</span>
        <span class="k">if</span> <span class="n">bt_wgt</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">check_content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">check_ok</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span>
                <span class="n">on_release</span><span class="o">=</span><span class="k">lambda</span> <span class="n">val</span><span class="p">:</span> <span class="n">func</span><span class="p">(</span><span class="n">bt_wgt</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                <span class="n">check_content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">check_ok</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="k">lambda</span> <span class="n">val</span><span class="p">:</span>
                <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">check_content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">check_ok</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span>
                    <span class="n">on_release</span><span class="o">=</span><span class="k">lambda</span> <span class="n">val</span><span class="p">:</span> <span class="n">func</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">popup_level</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">check_content</span><span class="p">,</span>
                            <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">popup_level</span><span class="o">=</span><span class="n">popup_level</span><span class="p">,</span>
                            <span class="n">separator_color</span><span class="o">=</span><span class="n">sep_color</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">popup_level</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exit_popup</span> <span class="o">=</span> <span class="n">CustomPopup</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;[b]</span><span class="si">%s</span><span class="s2">[/b]&quot;</span> <span class="o">%</span> <span class="n">title</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="n">check_content</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                <span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="n">separator_color</span><span class="o">=</span><span class="n">sep_color</span><span class="p">,</span>
                <span class="n">border_color</span><span class="o">=</span><span class="n">sep_color</span><span class="p">,</span>
                <span class="n">separator_height</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
                <span class="n">title_color</span><span class="o">=</span><span class="n">sep_color</span><span class="p">,</span>
                <span class="n">background</span><span class="o">=</span><span class="s2">&quot;data/backgrounds/transparent.png&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exit_popup</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>

        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="TriFusionApp.check_file"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.check_file">[docs]</a>    <span class="k">def</span> <span class="nf">check_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">bw</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used by some filechooser dialogs. Checks whether the provided</span>
<span class="sd">        file name already exists. If so, issues a check_action popup. If</span>
<span class="sd">        not, proceeds as normal</span>
<span class="sd">        :param path: string, complete path</span>
<span class="sd">        :param file_name: string, file name</span>
<span class="sd">        :param idx: string, operation identifier</span>
<span class="sd">        :param bw: bool, argument specific for export_graphic idx.</span>
<span class="sd">        Determines whether a figure will be exported in original color or</span>
<span class="sd">        grayscale</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Stores methods. key: idx; first value element, method to apply;</span>
        <span class="c1"># second value element, list of arguments; third value element the</span>
        <span class="c1"># file_name extension</span>
        <span class="n">methods</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;main_output&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">save_file</span><span class="p">,</span> <span class="p">[</span><span class="n">path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">idx</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
            <span class="s2">&quot;export&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">export_names</span><span class="p">,</span> <span class="p">[</span><span class="n">path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">],</span> <span class="s2">&quot;.txt&quot;</span><span class="p">],</span>
            <span class="s2">&quot;export_table&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">export_table</span><span class="p">,</span> <span class="p">[</span><span class="n">path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">],</span> <span class="s2">&quot;.csv&quot;</span><span class="p">],</span>
            <span class="s2">&quot;export_outliers&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">export_table</span><span class="p">,</span> <span class="p">[</span><span class="n">path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;.txt&quot;</span><span class="p">],</span> <span class="s2">&quot;.txt&quot;</span><span class="p">],</span>
            <span class="s2">&quot;export_graphic&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">export_graphic</span><span class="p">,</span> <span class="p">[</span><span class="n">path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">bw</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
            <span class="s2">&quot;group&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">orto_export_groups</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="c1"># Check if files exists.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">unicode</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;utf8&quot;</span><span class="p">),</span> <span class="n">file_name</span> <span class="o">+</span> <span class="n">methods</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">+</span> <span class="n">methods</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="ow">and</span> <span class="n">idx</span> <span class="o">!=</span> <span class="s2">&quot;main_output&quot;</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">check_action</span><span class="p">(</span>
                <span class="s2">&quot;The file </span><span class="si">{}</span><span class="s2"> already exists. Overwrite?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_name</span><span class="p">),</span>
                <span class="n">methods</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                <span class="o">**</span><span class="p">{</span><span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="n">methods</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;popup_level&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">methods</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="n">methods</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Close popup automatically except for the group idx</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">!=</span> <span class="s2">&quot;group&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span></div>

    <span class="c1"># ########################## GENERAL USE ###############################</span>

<div class="viewcode-block" id="TriFusionApp.run_in_background"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.run_in_background">[docs]</a>    <span class="k">def</span> <span class="nf">run_in_background</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">second_func</span><span class="p">,</span> <span class="n">args1</span><span class="p">,</span> <span class="n">args2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">no_arg2</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Crunching data...&quot;</span><span class="p">,</span>
                          <span class="n">cancel</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is intended to run time/resource consuming operations in</span>
<span class="sd">        the background, without freezing the app, and return the final</span>
<span class="sd">        result to the main thread. This means that complex methods that</span>
<span class="sd">        perform multiple changes to the App&#39;s attributes are not suitable</span>
<span class="sd">        for this method  (changes in a secondary thread will not change</span>
<span class="sd">        the App in the main thread). Therefore, the simplest solution to</span>
<span class="sd">        the problem is to isolate the time consuming parts of those</span>
<span class="sd">        methods, run them in the background, and get their result. Then,</span>
<span class="sd">        their result is piped to the follow-up fuction provided as argument</span>
<span class="sd">        :param func: intensive callable bound method to run in the</span>
<span class="sd">        background</span>
<span class="sd">        :param second_func: Follow-up bound method that will use the value</span>
<span class="sd">        returned by func</span>
<span class="sd">        :param args1: list, with the arguments for func t method. No</span>
<span class="sd">        keywords allowed</span>
<span class="sd">        :param args2: list, with arguments for second_func. These will be</span>
<span class="sd">        added to the argument list returned by func</span>
<span class="sd">        :param no_arg2: Boolean. Whether func will return something to</span>
<span class="sd">        second_func</span>
<span class="sd">        :param msg: string, message to appear in waiting dialog.</span>
<span class="sd">        :param cancel: Boolean, Shows a functional cancel button that</span>
<span class="sd">        interrupts the background process, if True.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">check_process_status</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">second_function</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">man</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This scheduled function will check the status of the second</span>
<span class="sd">            process. When finished, it will dismiss the waiting popup,</span>
<span class="sd">            get the value returned by the second process and issue the</span>
<span class="sd">            following method</span>

<span class="sd">            :param p: Process object.</span>
<span class="sd">            :param second_function: function object. If not None, this</span>
<span class="sd">            function will be executed in the main process, once the first</span>
<span class="sd">            process is finished.</span>
<span class="sd">            :param args: list. Contains the argument to be passed at the</span>
<span class="sd">            second_function</span>
<span class="sd">            :param man: Manager object.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="c1"># Kill switch. Terminating thread by user</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminate_background</span><span class="p">:</span>

                <span class="c1"># Issuing the kill order to the child thread. This signal</span>
                <span class="c1"># will propagate through the worker&#39;s methods and graciously</span>
                <span class="c1"># terminate</span>
                <span class="n">shared_ns</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># This small delay seems to fix manager shutdown issues</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Shutting down manager that provides communication between</span>
                <span class="c1"># parent and child thread</span>
                <span class="n">man</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

                <span class="c1"># Close loading popup dialog</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span>

                <span class="c1"># Unschedule the current function</span>
                <span class="n">Clock</span><span class="o">.</span><span class="n">unschedule</span><span class="p">(</span><span class="n">check_func</span><span class="p">)</span>

                <span class="c1"># Join child process and exit</span>
                <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="s2">&quot;img&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">rotation</span> <span class="o">-=</span> <span class="mi">10</span>

                <span class="k">if</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">counter</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">msg2</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">shared_ns</span><span class="o">.</span><span class="n">counter</span><span class="p">,</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">files</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                            <span class="s2">&quot;An unexpected error occurred. Check the app&quot;</span>
                            <span class="s2">&quot; logs&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">val</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="n">Clock</span><span class="o">.</span><span class="n">unschedule</span><span class="p">(</span><span class="n">check_func</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span>

                <span class="c1"># Manager must be shutdown before closing the process,</span>
                <span class="c1"># otherwise the data pipe will prevent the process from</span>
                <span class="c1"># closing</span>
                <span class="n">man</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
                <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

                <span class="c1"># Checks if there is a second function to run and whether</span>
                <span class="c1"># there are additional arguments for secondary function</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">no_arg2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">second_func</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">args2</span> <span class="ow">and</span> <span class="n">val</span><span class="p">:</span>
                            <span class="n">val</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">args2</span><span class="p">:</span>
                            <span class="n">val</span> <span class="o">=</span> <span class="n">args</span>
                        <span class="n">second_function</span><span class="p">(</span><span class="o">*</span><span class="n">val</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">second_function</span><span class="p">:</span>
                    <span class="n">second_function</span><span class="p">()</span>

        <span class="c1"># Set up manager and shared name space to share information</span>
        <span class="c1"># between background and main processes</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>
        <span class="n">shared_ns</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">Namespace</span><span class="p">()</span>
        <span class="n">shared_ns</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Set kill switch flag</span>
        <span class="n">shared_ns</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Remove lock from background process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terminate_background</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Create process</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">background_process</span><span class="p">,</span>
                             <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">shared_ns</span><span class="p">,</span> <span class="n">args1</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># Remove any possible previous popups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span>
        <span class="c1"># Create waiting dialog</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">CrunchData</span><span class="p">()</span>
        <span class="c1"># Set label</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">msg</span>

        <span class="c1"># Determine whether widget should have cancel option or not</span>
        <span class="k">if</span> <span class="n">cancel</span><span class="p">:</span>
            <span class="c1"># Set functionality of cancel button</span>
            <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">230</span><span class="p">,</span> <span class="mi">230</span><span class="p">)</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">cancel_bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span>
                <span class="n">on_release</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;terminate_background&quot;</span><span class="p">,</span>
                                             <span class="kc">True</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Remove cancel button</span>
            <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">230</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">cancel_anc</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">cancel_bt</span><span class="p">)</span>
            <span class="n">content</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">cancel_anc</span><span class="p">)</span>

        <span class="c1"># Create popup with waiting dialog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                        <span class="n">separator_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                        <span class="n">border_color</span><span class="o">=</span><span class="n">tm</span><span class="o">.</span><span class="n">c_popup_border</span><span class="p">,</span>
                        <span class="n">auto_dissmiss</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Schedule function that checks the process&#39; pulse</span>
        <span class="n">check_func</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">check_process_status</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span>
                             <span class="n">second_func</span><span class="p">,</span> <span class="n">args2</span><span class="p">,</span> <span class="n">manager</span><span class="p">)</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_interval</span><span class="p">(</span><span class="n">check_func</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">)</span></div>

    <span class="c1"># ###################### BOOKMARKS OPERATIONS ##########################</span>

<div class="viewcode-block" id="TriFusionApp.bookmark_init"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.bookmark_init">[docs]</a>    <span class="k">def</span> <span class="nf">bookmark_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wgt</span><span class="p">,</span> <span class="n">dev_wgt</span><span class="p">,</span> <span class="n">fc_wgt</span><span class="p">,</span> <span class="n">popup_level</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This will create a pickle file containing a list with the bookmarks</span>
<span class="sd">        for the file chooser menu. If no file exists, it will create an</span>
<span class="sd">        empty one. If a file already exists, it will load the available</span>
<span class="sd">        bookmarks</span>

<span class="sd">        :param wgt: Widget object where the bookmark button will be</span>
<span class="sd">        :param dev_wgt: Widget object where the system bookmarks will be</span>
<span class="sd">        :param fc_wgt: Filechooser widget associated with the bookmarks</span>
<span class="sd">        :param popup_level: int, specifies the level of the check_action popup</span>
<span class="sd">         that appears when attempting to remove a bookmark</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bm_file</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bm_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
            <span class="c1"># Retrieving the bookmark path list from the self.bookmarks</span>
            <span class="n">bk_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">bk</span> <span class="ow">in</span> <span class="n">bk_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_bookmark_bt</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">wgt</span><span class="p">,</span> <span class="n">fc_wgt</span><span class="p">,</span> <span class="n">popup_level</span><span class="o">=</span><span class="n">popup_level</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bm_file</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>

            <span class="c1"># Trying to import FM bookmarks in ~/.config/gtk-3.0/bookmarks.</span>
            <span class="c1"># This will happen only the first time the app is executed, when</span>
            <span class="c1"># the bookmarks will be saved. From there on, bookmarks will be</span>
            <span class="c1"># managed in the app</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;linux&quot;</span><span class="p">,</span> <span class="s2">&quot;linux2&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home_path</span><span class="p">,</span> <span class="s2">&quot;.config&quot;</span><span class="p">,</span> <span class="s2">&quot;gtk-3.0&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;bookmarks&quot;</span><span class="p">)):</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home_path</span><span class="p">,</span> <span class="s2">&quot;.config&quot;</span><span class="p">,</span> <span class="s2">&quot;gtk-3.0&quot;</span><span class="p">,</span>
                                   <span class="s2">&quot;bookmarks&quot;</span><span class="p">))</span> <span class="k">as</span> <span class="n">bk_file</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">bk_line</span> <span class="ow">in</span> <span class="n">bk_file</span><span class="p">:</span>
                            <span class="n">bk</span> <span class="o">=</span> <span class="n">bk_line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;file://&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                            <span class="c1"># urllib will ensure special characters with</span>
                            <span class="c1"># punctuation are correctly showed</span>
                            <span class="n">bk</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">bk</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">save_bookmark</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span> <span class="n">wgt</span><span class="p">,</span> <span class="n">fc_wgt</span><span class="p">,</span>
                                               <span class="n">popup_level</span><span class="o">=</span><span class="n">popup_level</span><span class="p">)</span>

        <span class="c1"># Get main paths for linux</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;linux&quot;</span><span class="p">,</span> <span class="s2">&quot;linux2&quot;</span><span class="p">]:</span>

            <span class="c1"># System</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_bookmark_bt</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">dev_wgt</span><span class="p">,</span> <span class="n">fc_wgt</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;System&quot;</span><span class="p">,</span>
                                 <span class="n">rm_bt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># Home</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_bookmark_bt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home_path</span><span class="p">,</span> <span class="n">dev_wgt</span><span class="p">,</span> <span class="n">fc_wgt</span><span class="p">,</span>
                                 <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Home&quot;</span><span class="p">,</span> <span class="n">rm_bt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Get removable media</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s2">&quot;mount | grep -e /media -e /mnt | awk &#39;{&quot;</span>
                <span class="s2">&quot;print $3}&#39;&quot;</span><span class="p">],</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
            <span class="n">removable_media</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">removable_media</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">removable_media</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="c1"># Add path to removable_media attribute. This attribute</span>
                    <span class="c1"># is used when updating removable media real time in</span>
                    <span class="c1"># _check_removable_media</span>
                    <span class="k">if</span> <span class="n">path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">removable_media</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">removable_media</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

                    <span class="n">name</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_bookmark_bt</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dev_wgt</span><span class="p">,</span> <span class="n">fc_wgt</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
                                         <span class="n">rm_bt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Get main devices for windows</span>
        <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;win32&quot;</span><span class="p">,</span> <span class="s2">&quot;cygwin&quot;</span><span class="p">]:</span>

            <span class="n">devices</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span>
                <span class="sa">r</span><span class="s2">&quot;[A-Z]+:.*$&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s2">&quot;mountvol /&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>

            <span class="c1"># Prevent no disk on drive popup error in windows</span>
            <span class="n">SEM_FAILCRITICALERRORS</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">SEM_NOOPENFILEERRORBOX</span> <span class="o">=</span> <span class="mh">0x8000</span>
            <span class="n">SEM_FAIL</span> <span class="o">=</span> <span class="n">SEM_NOOPENFILEERRORBOX</span> <span class="o">|</span> <span class="n">SEM_FAILCRITICALERRORS</span>

            <span class="n">kernel32</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">WinDLL</span><span class="p">(</span><span class="s1">&#39;kernel32&#39;</span><span class="p">)</span>
            <span class="n">oldmode</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">()</span>
            <span class="n">kernel32</span><span class="o">.</span><span class="n">SetThreadErrorMode</span><span class="p">(</span><span class="n">SEM_FAIL</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">oldmode</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">removable_media</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_bookmark_bt</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">dev_wgt</span><span class="p">,</span> <span class="n">fc_wgt</span><span class="p">,</span> <span class="n">rm_bt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                         <span class="n">name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitdrive</span><span class="p">(</span><span class="n">d</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

            <span class="c1"># Home directory</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_bookmark_bt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home_path</span><span class="p">,</span> <span class="n">dev_wgt</span><span class="p">,</span> <span class="n">fc_wgt</span><span class="p">,</span> <span class="n">rm_bt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Get some favorites for MacOS</span>
        <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;darwin&quot;</span><span class="p">:</span>

            <span class="c1"># Get mounted volumes</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;/Volumes&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">removable_media</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;/Volumes&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_bookmark_bt</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;/Volumes&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="n">dev_wgt</span><span class="p">,</span> <span class="n">fc_wgt</span><span class="p">,</span>
                                     <span class="n">name</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">rm_bt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Home</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_bookmark_bt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home_path</span><span class="p">,</span> <span class="n">dev_wgt</span><span class="p">,</span> <span class="n">fc_wgt</span><span class="p">,</span>
                                 <span class="n">name</span><span class="o">=</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home_path</span><span class="p">),</span>
                                 <span class="n">rm_bt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Desktop</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_bookmark_bt</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home_path</span><span class="p">,</span> <span class="s2">&quot;Desktop&quot;</span><span class="p">),</span> <span class="n">wgt</span><span class="p">,</span>
                                 <span class="n">fc_wgt</span><span class="p">,</span> <span class="s2">&quot;Desktop&quot;</span><span class="p">)</span>

            <span class="c1"># Documents</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_bookmark_bt</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home_path</span><span class="p">,</span> <span class="s2">&quot;Documents&quot;</span><span class="p">),</span> <span class="n">wgt</span><span class="p">,</span>
                                 <span class="n">fc_wgt</span><span class="p">,</span> <span class="s2">&quot;Documents&quot;</span><span class="p">)</span>

            <span class="c1"># Downloads</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_bookmark_bt</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home_path</span><span class="p">,</span> <span class="s2">&quot;Downloads&quot;</span><span class="p">),</span> <span class="n">wgt</span><span class="p">,</span>
                                 <span class="n">fc_wgt</span><span class="p">,</span> <span class="s2">&quot;Downloads&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TriFusionApp.save_bookmark"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.save_bookmark">[docs]</a>    <span class="k">def</span> <span class="nf">save_bookmark</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">wgt</span><span class="p">,</span> <span class="n">fc_wgt</span><span class="p">,</span> <span class="n">popup_level</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This adds functionality to the FileChooser &quot;Add bookmark&quot; button. It</span>
<span class="sd">        will grab the selected path and add it to a storage list that</span>
<span class="sd">        will be saved as a pickle object and stored in a file defined in</span>
<span class="sd">        self.bm_file.</span>
<span class="sd">        :param path: String containing the path of the bookmark</span>
<span class="sd">        :param wgt: Widget where the bookmark will be added</span>
<span class="sd">        :param fc_wgt: FileChooser widget that the bookmark will affect</span>
<span class="sd">        :param popup_level: int, specifies the level of the check_action popup</span>
<span class="sd">         that appears when attempting to remove a bookmark</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Load bookmarks object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bm_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
        <span class="c1"># Check if bookmark already exists. Only add bookmark if it does not</span>
        <span class="c1"># exist</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>

            <span class="c1"># Add bookmarks to the full path list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="c1"># Add mapping of the full path to the bookmark name</span>
            <span class="n">new_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">):</span> <span class="n">path</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span>
                                     <span class="nb">list</span><span class="p">(</span><span class="n">new_map</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_bookmark_bt</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">wgt</span><span class="p">,</span> <span class="n">fc_wgt</span><span class="p">,</span> <span class="n">popup_level</span><span class="o">=</span><span class="n">popup_level</span><span class="p">)</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bm_file</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.add_bookmark_bt"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.add_bookmark_bt">[docs]</a>    <span class="k">def</span> <span class="nf">add_bookmark_bt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bk</span><span class="p">,</span> <span class="n">wgt</span><span class="p">,</span> <span class="n">fc_wgt</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rm_bt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">popup_level</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This will add a bookmark button, along with its removal button. Only</span>
<span class="sd">        a bookmark path will be necessary.</span>

<span class="sd">        The path of the bookmark will be associated to the respective button</span>
<span class="sd">        by it&#39;s id.</span>

<span class="sd">        :param bk: string. bookmark file path</span>
<span class="sd">        :param wgt: Widget, preferentially a gridlayout where the bookmark</span>
<span class="sd">        buttons will be added</span>
<span class="sd">        :param fc_wgt: FileChooser widget in which bookmark operations will</span>
<span class="sd">        be performed</span>
<span class="sd">        :param name: string, optional name for bookmark button instead of</span>
<span class="sd">        the basename of the path</span>
<span class="sd">        :param rm_bt: Boolean, If True, a removal button will be added with</span>
<span class="sd">        the bookmark, else the removal button will not be added. The latter</span>
<span class="sd">        case is used for System devices bookmarks.</span>
<span class="sd">        :param popup_level: int, specifies the level of the check_action popup</span>
<span class="sd">         that appears when attempting to remove a bookmark</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Ignore if path does not exist / is not a directory</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">bk</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">bookmark_name</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">bk</span><span class="p">)</span>
        <span class="c1"># Define bookmark button</span>
        <span class="n">bt</span> <span class="o">=</span> <span class="n">TFButton</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="n">bookmark_name</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">bk</span><span class="p">,</span>
                      <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                      <span class="n">background_normal</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                             <span class="s2">&quot;bt_process.png&quot;</span><span class="p">),</span>
                      <span class="n">background_down</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                           <span class="s2">&quot;bt_process_off.png&quot;</span><span class="p">))</span>
        <span class="c1"># Bind to function that loads bookmark path into filechooser</span>
        <span class="n">bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmark_load</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fc_wgt</span><span class="p">))</span>
        <span class="c1"># Add to list for mouse over purposes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks_bt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>
        <span class="n">wgt</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rm_bt</span><span class="p">:</span>
            <span class="c1"># Define bookmark removal button</span>
            <span class="n">xbt</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                         <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">X&quot;</span> <span class="o">%</span> <span class="n">bk</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                         <span class="n">background_normal</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                                <span class="s2">&quot;remove_bt.png&quot;</span><span class="p">),</span>
                         <span class="n">background_down</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                              <span class="s2">&quot;remove_bt_down.png&quot;</span><span class="p">))</span>
            <span class="c1"># Bind to function that removes bookmark button as well as the</span>
            <span class="c1"># path from self.bm_file</span>
            <span class="n">xbt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_action</span><span class="p">,</span>
                                        <span class="s2">&quot;Are you sure you want to remove&quot;</span>
                                        <span class="s2">&quot; this bookmark?&quot;</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">remove_bookmark_bt</span><span class="p">,</span>
                                        <span class="n">popup_level</span><span class="o">=</span><span class="n">popup_level</span><span class="p">))</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">xbt</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.bookmark_load"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.bookmark_load">[docs]</a>    <span class="k">def</span> <span class="nf">bookmark_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">wgt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provided a bookmark button object, it loads the bookmark file path</span>
<span class="sd">        that is stored in the button id.</span>
<span class="sd">        :param value: bookmark button object</span>
<span class="sd">        :param wgt: Filechooser widget that will show the bookmark</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">id</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">wgt</span><span class="o">.</span><span class="n">previous_dir</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wgt</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">selection</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                <span class="s2">&quot;The path to the selected bookmark no longer exists.&quot;</span><span class="p">,</span>
                <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.remove_bookmark_bt"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.remove_bookmark_bt">[docs]</a>    <span class="k">def</span> <span class="nf">remove_bookmark_bt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds functionality to the removal button associated with each</span>
<span class="sd">        bookmark button. This will not only remove the</span>
<span class="sd">        :param value: The removal button widget</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get the widget to remove the button</span>
        <span class="n">parent_obj</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">parent</span>

        <span class="c1"># Get the bookmark button, using the removal button id</span>
        <span class="n">bk_idx</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">id</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">bk_bt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parent_obj</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span> <span class="n">bk_idx</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Remove both bookmark and removal buttons</span>
        <span class="n">parent_obj</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">parent_obj</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">bk_bt</span><span class="p">)</span>

        <span class="c1"># Update gridlayout height for scrolling purposes</span>
        <span class="n">parent_obj</span><span class="o">.</span><span class="n">height</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="mf">0.07</span>

        <span class="c1"># Core changes</span>
        <span class="n">bk_name</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">bk_idx</span><span class="p">)</span>
        <span class="c1"># Remove bookmark path from list and mapping dictionary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">bk_idx</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">bk_name</span><span class="p">]</span>
        <span class="c1"># Update self.bm_file</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bm_file</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span></div>

    <span class="c1"># ####################### PLOT SCREEN OPERATIONS #######################</span>

<div class="viewcode-block" id="TriFusionApp.dialog_export_graphic"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_export_graphic">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_export_graphic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a filechooser dialog for graphics exportation. It differs</span>
<span class="sd">        from other filechooser dialogs in the presence of a spinner to</span>
<span class="sd">        select the graphical extension</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">ExportGraphics</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">,</span>
                                 <span class="n">bookmark_init</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmark_init</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Export as graphic...&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.export_graphic"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.export_graphic">[docs]</a>    <span class="k">def</span> <span class="nf">export_graphic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">bw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the current plot object into a file based on file name and</span>
<span class="sd">        extension</span>
<span class="sd">        :param path: string, path to final directory</span>
<span class="sd">        :param file_name: string, name of graphic file</span>
<span class="sd">        :param bw: bool, Determined whether the graphic will be in the</span>
<span class="sd">        original colors (False) or grayscale (True)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">temp_f</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">f_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bw</span><span class="p">:</span>
            <span class="n">temp_f</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_bw&quot;</span> <span class="o">+</span> \
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_name</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">f_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_lgd</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_plot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">temp_f</span> <span class="k">if</span> <span class="n">temp_f</span> <span class="k">else</span> <span class="n">f_path</span><span class="p">,</span>
                <span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_lgd</span><span class="p">,),</span>
                <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_plot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">temp_f</span> <span class="k">if</span> <span class="n">temp_f</span> <span class="k">else</span> <span class="n">f_path</span><span class="p">,</span>
                                      <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bw</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">misc</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">temp_f</span><span class="p">,</span> <span class="n">flatten</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">misc</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">f_path</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">temp_f</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;Graphic successfully exported!&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.export_table"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.export_table">[docs]</a>    <span class="k">def</span> <span class="nf">export_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="s2">&quot;.csv&quot;</span><span class="p">,</span> <span class="n">warning_dlg</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the current_table list attribute to a .csv file.</span>
<span class="sd">        :param path: string, path to final directory</span>
<span class="sd">        :param file_name: string, name of table file</span>
<span class="sd">        :param warning_dlg: boolean. If True, issue a float dialog when</span>
<span class="sd">        the operation is done. If false do not issue the float dialog.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Create table file object handle</span>
        <span class="n">table_handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">+</span> <span class="n">ext</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>

        <span class="c1"># Writing table. Each entry in self.current_table should represent a</span>
        <span class="c1"># line in the table</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_table</span><span class="p">:</span>
            <span class="n">table_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">l</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Close file object</span>
        <span class="n">table_handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">warning_dlg</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;Table successfully exported!&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">)</span></div>

    <span class="c1"># ####################### SIDE PANEL OPERATIONS ########################</span>

<div class="viewcode-block" id="TriFusionApp.dialog_about"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_about">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_about</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dialog with the about information on TriFusion</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">AboutDialog</span><span class="p">()</span>

        <span class="n">content</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">__version__</span>
        <span class="n">content</span><span class="o">.</span><span class="n">build</span> <span class="o">=</span> <span class="n">__build__</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;About TriFusion&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">close_bt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">480</span><span class="p">,</span> <span class="mi">410</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.sidepanel_on_touch"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.sidepanel_on_touch">[docs]</a>    <span class="k">def</span> <span class="nf">sidepanel_on_touch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">touch</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is binded to the app Window so that it can handle any</span>
<span class="sd">        touch_up events. Once the side panel is open, this allows any mouse</span>
<span class="sd">        click outside the panel to close it. It gathers information on the</span>
<span class="sd">        mouse and side panel position and evaluates a collision. It will</span>
<span class="sd">        trigger the side panel closing only when four conditions are met:</span>

<span class="sd">        - When there is a mouse input outside the side panel</span>
<span class="sd">        - When the variable controlling the side panel (show_side_panel) is</span>
<span class="sd">        True, meaning that the panel is extended</span>
<span class="sd">        - When the mouse input is outside the previous button in the action</span>
<span class="sd">        bar, which is also used to toggle the side panel. This prevents</span>
<span class="sd">        issues of toggling the side panel twice with one mouse input</span>
<span class="sd">        - When a popup is not open. There are several buttons in the side</span>
<span class="sd">        bar that open whose position is outside the side bar. The user</span>
<span class="sd">        should be</span>
<span class="sd">        able to click anywhere in the popup without the side panel closing.</span>

<span class="sd">        In addition, it will handle the status of the partition box dialog,</span>
<span class="sd">        associated with the sidepanel. While this box is active, the</span>
<span class="sd">        sidepanel must remain open. However, clicks outside the partition</span>
<span class="sd">        box will close it.</span>

<span class="sd">        :param touch: Touch event</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Set touch as a app attribute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">touch</span> <span class="o">=</span> <span class="n">touch</span>

        <span class="k">def</span> <span class="nf">animate_sidebar</span><span class="p">():</span>

            <span class="c1"># ANIMATIONS with hierarchy</span>
            <span class="c1"># Animation of main BoxLayout containing child ScrollViews</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sidepanel_animation</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">wgt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_box</span><span class="p">)</span>
            <span class="c1"># Animation of both scrollviews</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sidepanel_animation</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">wgt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sidepanel_animation</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">wgt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sp_bts</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">show_side_panel</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_side_panel</span>

        <span class="c1"># Get mouse position</span>
        <span class="n">mp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">mouse_pos</span>
        <span class="c1"># Get side panel and previous button widgets</span>
        <span class="n">side_panel_wgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_box</span>
        <span class="n">ap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">ap</span>

        <span class="c1"># If sidepanel&#39;s more options widget is active, check if touch is</span>
        <span class="c1"># outside. If so, remove widget</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_moreopts</span><span class="p">:</span>
            <span class="n">wgt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                   <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">SP_MoreOpts_Dialog</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">wgt</span><span class="o">.</span><span class="n">collide_point</span><span class="p">(</span><span class="n">mp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="ow">not</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">_determine_collision</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_opt</span><span class="p">,</span> <span class="n">mp</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sidepanel_remove_moreopts</span><span class="p">()</span>

        <span class="c1"># If fancy dropdown is dropped, check if touch is oustide. If so,</span>
        <span class="c1"># remove the widget</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fancy_dropped</span><span class="p">:</span>
            <span class="n">wgt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                   <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">FancyDropDown</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_collision</span><span class="p">(</span><span class="n">wgt</span><span class="p">,</span> <span class="n">mp</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_fancy_dropdown</span><span class="p">()</span>

        <span class="c1"># Check for existence of a partition dialog box</span>
        <span class="n">partition_box</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                         <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">PartitionsDialog</span><span class="p">)]</span>

        <span class="c1"># If the partition box exists and the collision is outside it</span>
        <span class="k">if</span> <span class="n">partition_box</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">partition_box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">collide_point</span><span class="p">(</span>
                <span class="n">mp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mp</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="c1"># Check if spinner is open</span>
            <span class="n">spin1</span> <span class="o">=</span> <span class="n">partition_box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">codon_spin</span><span class="o">.</span><span class="n">is_open</span>
            <span class="n">spin2</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">is_open</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                     <span class="n">partition_box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">model_bx</span><span class="o">.</span><span class="n">children</span><span class="p">]</span>

            <span class="c1"># If the spinners are not open, remove</span>
            <span class="k">if</span> <span class="kc">True</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spin2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">spin1</span><span class="p">:</span>
                <span class="n">rm_bt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                         <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">RemoveFloat</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">partition_box</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">rm_bt</span><span class="p">)</span>

        <span class="c1"># Check for conditions to close the side panel.</span>
        <span class="c1"># If touch is out of panel; if panel is open; is touch is out of</span>
        <span class="c1"># menu button; a popup is not open</span>
        <span class="k">if</span> <span class="n">side_panel_wgt</span><span class="o">.</span><span class="n">collide_point</span><span class="p">(</span><span class="n">mp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">is</span> <span class="kc">False</span> \
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_side_panel</span> \
                <span class="ow">and</span> <span class="n">ap</span><span class="o">.</span><span class="n">collide_point</span><span class="p">(</span><span class="n">mp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">is</span> <span class="kc">False</span> \
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span> \
                <span class="ow">and</span> <span class="ow">not</span> <span class="n">partition_box</span> \
                <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_moreopts</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Process&quot;</span> <span class="ow">or</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Orthology&quot;</span><span class="p">:</span>
                <span class="n">queue_bt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">queue_bt</span>
                <span class="k">if</span> <span class="n">queue_bt</span><span class="o">.</span><span class="n">collide_point</span><span class="p">(</span><span class="n">mp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">animate_sidebar</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">animate_sidebar</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.toggle_sidepanel"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.toggle_sidepanel">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_sidepanel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method controlling the animation toggling of the side panel</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock_side_panel</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Closes partition box, if open</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_partition_box</span><span class="p">()</span>

        <span class="c1"># Do not toggle when the following conditions are met</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;fc&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">text_filter</span><span class="o">.</span><span class="n">focus</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">path_bx</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">PathText</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">path_bx</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">focus</span><span class="p">:</span>
                    <span class="k">return</span>

        <span class="c1"># Toggling the state of the panel. This attribute is the main</span>
        <span class="c1"># controller of the side panel state. When its True, the side panel</span>
        <span class="c1">#  is extended, otherwise the side panel is hidden</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_side_panel</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_side_panel</span>

        <span class="c1"># Lock the sidepanel animation. It will only be released after the</span>
        <span class="c1"># animations are over</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock_side_panel</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_once</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;lock_side_panel&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                            <span class="o">.</span><span class="mi">4</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_side_panel</span><span class="p">:</span>

            <span class="c1"># Redraw the side panel layout. This will ensure that the widget</span>
            <span class="c1"># is always on top of all widgets.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">bx1</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">panel_float</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">bx1</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">panel_float</span><span class="p">)</span>

            <span class="c1"># Fixing the width of the side panel</span>
            <span class="c1"># Main panel width</span>
            <span class="n">sv_panel_width</span> <span class="o">=</span> <span class="mi">330</span>
            <span class="c1"># Side buttons width</span>
            <span class="n">sv_bts_width</span> <span class="o">=</span> <span class="mi">60</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sv_panel_width</span><span class="p">,</span> <span class="n">sv_bts_width</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

        <span class="c1"># ANIMATIONS with hierarchy</span>
        <span class="c1"># Animation of main BoxLayout containing child ScrollViews</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sidepanel_animation</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">sv_panel_width</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">,</span>
                                 <span class="n">wgt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_box</span><span class="p">)</span>
        <span class="c1"># Animation of both scrollviews</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sidepanel_animation</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">sv_panel_width</span><span class="p">,</span>
                                 <span class="n">wgt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sidepanel_animation</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">sv_bts_width</span><span class="p">,</span>
                                 <span class="n">wgt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sp_bts</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="TriFusionApp.sidepanel_animation"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.sidepanel_animation">[docs]</a>    <span class="k">def</span> <span class="nf">sidepanel_animation</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">wgt</span><span class="p">):</span>

        <span class="n">Animation</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;out_quart&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">wgt</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.sidepanel_search_bts"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.sidepanel_search_bts">[docs]</a>    <span class="k">def</span> <span class="nf">sidepanel_search_bts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="n">panel</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs a search for file or taxa buttons in the side panel based</span>
<span class="sd">        on the text string provided</span>
<span class="sd">        :param txt: string, the expression used for the search</span>
<span class="sd">        :param panel: string, the panel to perform the search. Can be either</span>
<span class="sd">        &#39;files&#39; or &#39;taxa&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">panel</span> <span class="o">==</span> <span class="s2">&quot;files&quot;</span><span class="p">:</span>
            <span class="c1"># Setting which original button list</span>
            <span class="n">bt_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span>
            <span class="c1"># Setting which sink grid layout</span>
            <span class="n">gl_wgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_sl</span>
            <span class="n">create_bts_mtd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidepanel_create_bts</span>
        <span class="k">elif</span> <span class="n">panel</span> <span class="o">==</span> <span class="s2">&quot;taxa&quot;</span><span class="p">:</span>
            <span class="n">bt_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">taxa_names</span><span class="p">)</span>
            <span class="n">gl_wgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_sl</span>
            <span class="n">create_bts_mtd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidepanel_create_bts</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bt_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">partitions</span><span class="o">.</span><span class="n">partitions</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">gl_wgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">partition_sl</span>
            <span class="n">create_bts_mtd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidepanel_create_part_bts</span>

        <span class="c1"># Find buttons that match the txt string</span>
        <span class="k">if</span> <span class="n">panel</span> <span class="o">==</span> <span class="s2">&quot;files&quot;</span><span class="p">:</span>
            <span class="n">found_bts</span> <span class="o">=</span> <span class="p">[</span><span class="n">basename</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">bt_list</span> <span class="k">if</span>
                         <span class="n">txt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">basename</span><span class="p">(</span><span class="n">el</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">found_bts</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">bt_list</span> <span class="k">if</span> <span class="n">txt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">el</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>

        <span class="c1"># Clear the grid and populate with the found bts</span>
        <span class="n">gl_wgt</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
        <span class="n">mouse_bts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">txt</span> <span class="ow">in</span> <span class="n">found_bts</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">panel</span> <span class="o">==</span> <span class="s2">&quot;partitions&quot;</span><span class="p">:</span>
                <span class="c1"># Get number of alignment for partition</span>
                <span class="n">fls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">partitions</span><span class="o">.</span>\
                    <span class="n">partitions_alignments</span><span class="p">[</span><span class="n">txt</span><span class="p">]</span>
                <span class="n">bt</span><span class="p">,</span> <span class="n">inf_bt</span><span class="p">,</span> <span class="n">x_bt</span> <span class="o">=</span> <span class="n">create_bts_mtd</span><span class="p">([</span><span class="n">txt</span><span class="p">,</span> <span class="n">fls</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bt</span><span class="p">,</span> <span class="n">inf_bt</span><span class="p">,</span> <span class="n">x_bt</span> <span class="o">=</span> <span class="n">create_bts_mtd</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
            <span class="n">gl_wgt</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>
            <span class="n">gl_wgt</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">inf_bt</span><span class="p">)</span>
            <span class="n">gl_wgt</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">x_bt</span><span class="p">)</span>
            <span class="n">mouse_bts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">panel</span> <span class="o">==</span> <span class="s2">&quot;files&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_bts</span><span class="p">[</span><span class="s2">&quot;Files&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mouse_bts</span>
        <span class="k">elif</span> <span class="n">panel</span> <span class="o">==</span> <span class="s2">&quot;taxa&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_bts</span><span class="p">[</span><span class="s2">&quot;Taxa&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mouse_bts</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_bts</span><span class="p">[</span><span class="s2">&quot;Partitions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mouse_bts</span></div>

<div class="viewcode-block" id="TriFusionApp.sidepanel_clear_search"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.sidepanel_clear_search">[docs]</a>    <span class="k">def</span> <span class="nf">sidepanel_clear_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">panel</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears previous search string and populates with the original</span>
<span class="sd">        buttons</span>
<span class="sd">        :param panel: string, the panel to clear the search. Can be either</span>
<span class="sd">        &#39;files&#39; or &#39;taxa&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">panel</span> <span class="o">==</span> <span class="s2">&quot;files&quot;</span><span class="p">:</span>
            <span class="c1"># Setting which original button list</span>
            <span class="n">bt_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_file_bts</span>
            <span class="c1"># Setting which sink grid layout</span>
            <span class="n">gl_wgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_sl</span>
        <span class="k">elif</span> <span class="n">panel</span> <span class="o">==</span> <span class="s2">&quot;taxa&quot;</span><span class="p">:</span>
            <span class="n">bt_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_taxa_bts</span>
            <span class="n">gl_wgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_sl</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bt_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_partition_bts</span>
            <span class="n">gl_wgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">partition_sl</span>

        <span class="c1"># Clear the grid and populate with the found bts</span>
        <span class="n">gl_wgt</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
        <span class="n">mouse_bts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">bt</span><span class="p">,</span> <span class="n">inf_bt</span><span class="p">,</span> <span class="n">rm_bt</span> <span class="ow">in</span> <span class="n">bt_list</span><span class="p">:</span>
            <span class="c1"># Update button states during search operation</span>
            <span class="c1"># Default states is down for Taxa/Files and normal for</span>
            <span class="c1"># Partitions</span>
            <span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span> <span class="k">if</span> <span class="n">gl_wgt</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">partition_sl</span> <span class="k">else</span> \
                <span class="s2">&quot;normal&quot;</span>
            <span class="c1"># For files</span>
            <span class="k">if</span> <span class="n">bt</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span><span class="p">:</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
            <span class="c1"># For taxa</span>
            <span class="k">elif</span> <span class="n">bt</span><span class="o">.</span><span class="n">text</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
            <span class="n">bt</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
            <span class="n">gl_wgt</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>
            <span class="n">gl_wgt</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">inf_bt</span><span class="p">)</span>
            <span class="n">gl_wgt</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">rm_bt</span><span class="p">)</span>
            <span class="n">mouse_bts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">panel</span> <span class="o">==</span> <span class="s2">&quot;files&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_bts</span><span class="p">[</span><span class="s2">&quot;Files&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mouse_bts</span>
        <span class="k">elif</span> <span class="n">panel</span> <span class="o">==</span> <span class="s2">&quot;taxa&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_bts</span><span class="p">[</span><span class="s2">&quot;Taxa&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mouse_bts</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_bts</span><span class="p">[</span><span class="s2">&quot;Partitions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mouse_bts</span>

        <span class="k">if</span> <span class="n">panel</span> <span class="o">!=</span> <span class="s2">&quot;taxa&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">count_files</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
                    <span class="n">gl_wgt</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">LoadMoreBt</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">return</span></div>

<div class="viewcode-block" id="TriFusionApp.sidepanel_remove_moreopts"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.sidepanel_remove_moreopts">[docs]</a>    <span class="k">def</span> <span class="nf">sidepanel_remove_moreopts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes widgets from the more options dialog</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">wgt</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">SP_MoreOpts_Dialog</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">FancyMarkerPersist</span><span class="p">)]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">wgt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sp_moreopts</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TriFusionApp.remove_fancy_dropdown"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.remove_fancy_dropdown">[docs]</a>    <span class="k">def</span> <span class="nf">remove_fancy_dropdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes FancyDropDown widgets from the root window</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">wgt</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">FancyDropDown</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">FancyMarkerPersist</span><span class="p">)]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">wgt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fancy_dropped</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TriFusionApp.toggle_fancy_dropdown"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.toggle_fancy_dropdown">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_fancy_dropdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bt</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;down&quot;</span><span class="p">,</span>
                              <span class="n">add_ds_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds functionality to the File/Taxa dropdown menus using a</span>
<span class="sd">        FancyDropDown widget</span>
<span class="sd">        :param Button bt: Button instance that was pressed</span>
<span class="sd">        :param list values: List of values that will populate the dropdown</span>
<span class="sd">        menu</span>
<span class="sd">        :param str orientation: Whether the dropdown will go &#39;down&#39; or &#39;up&#39;</span>
<span class="sd">        :param str add_ds_type: If not None, it will provide the additional</span>
<span class="sd">        data set buttons of the appropriate ds_type (&#39;files&#39; or &#39;taxa&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">set_ds</span><span class="p">(</span><span class="n">cur_bt</span><span class="p">,</span> <span class="n">ds_name</span><span class="p">,</span> <span class="n">wgt</span><span class="p">):</span>
            <span class="n">cur_bt</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">ds_name</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">remove_fancy_dropdown</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fancy_dropped</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_fancy_dropdown</span><span class="p">()</span>

        <span class="c1"># Get vertical size from the number of entries in values</span>
        <span class="n">ds_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="c1"># If the add_ds_type option is provided, add two more items that will</span>
        <span class="c1"># correspond to the &quot;active&quot; and &quot;total&quot; datasets</span>
        <span class="k">if</span> <span class="n">add_ds_type</span><span class="p">:</span>
            <span class="n">ds_len</span> <span class="o">+=</span> <span class="mi">2</span>

        <span class="c1"># Since bt may be inside a scrollview, this retrieves the real position</span>
        <span class="c1"># of the widget</span>
        <span class="n">real_pos</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">to_window</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">width</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">ds_len</span> <span class="o">*</span> <span class="mi">35</span> <span class="o">+</span> <span class="mi">19</span>

        <span class="c1"># Get position</span>
        <span class="n">wgt_x</span> <span class="o">=</span> <span class="n">real_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="n">bt</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span>
            <span class="n">wgt_y</span> <span class="o">=</span> <span class="n">real_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">-</span> <span class="n">height</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wgt_y</span> <span class="o">=</span> <span class="n">real_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bt</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="mi">17</span>

        <span class="c1"># Correct x position, if outside screen</span>
        <span class="k">if</span> <span class="n">wgt_x</span> <span class="o">+</span> <span class="n">width</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">width</span><span class="p">:</span>
            <span class="c1"># Determine the width that is over the window bound</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">wgt_x</span> <span class="o">+</span> <span class="n">width</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">width</span>
            <span class="n">wgt_x</span> <span class="o">-=</span> <span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>

        <span class="c1"># Correct x position to the left</span>
        <span class="n">wgt_x</span> <span class="o">=</span> <span class="n">wgt_x</span> <span class="k">if</span> <span class="n">wgt_x</span> <span class="o">&gt;=</span> <span class="mi">20</span> <span class="k">else</span> <span class="mi">20</span>

        <span class="c1"># Correct height and y position, if widget falls outside screen</span>
        <span class="k">if</span> <span class="n">wgt_y</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">+=</span> <span class="p">(</span><span class="n">wgt_y</span> <span class="o">-</span> <span class="mi">20</span><span class="p">)</span>
            <span class="n">wgt_y</span> <span class="o">=</span> <span class="mi">20</span>

        <span class="k">elif</span> <span class="n">wgt_y</span> <span class="o">+</span> <span class="n">height</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">height</span><span class="p">:</span>
            <span class="n">off_set</span> <span class="o">=</span> <span class="p">(</span><span class="n">wgt_y</span> <span class="o">+</span> <span class="n">height</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">height</span>
            <span class="n">height</span> <span class="o">-=</span> <span class="p">(</span><span class="n">off_set</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>

        <span class="c1"># Get final size</span>
        <span class="n">size</span> <span class="o">=</span> <span class="p">[</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">]</span>

        <span class="c1"># Generate fancy marker</span>
        <span class="n">bg</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span> <span class="s2">&quot;box_arrow_up.png&quot;</span><span class="p">)</span> <span class="k">if</span> \
            <span class="n">orientation</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span> <span class="k">else</span> \
            <span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span> <span class="s2">&quot;box_arrow_down.png&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span>
            <span class="n">arrow_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">real_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">real_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arrow_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">real_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                         <span class="n">real_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bt</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>

        <span class="n">point_wgt</span> <span class="o">=</span> <span class="n">FancyMarkerPersist</span><span class="p">(</span>
            <span class="n">background_normal</span><span class="o">=</span><span class="n">bg</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">arrow_pos</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
            <span class="n">background_color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.216</span><span class="p">,</span> <span class="mf">0.67</span><span class="p">,</span> <span class="mf">0.784</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Generate DropDown</span>
        <span class="n">dropdown</span> <span class="o">=</span> <span class="n">FancyDropDown</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="n">wgt_x</span><span class="p">,</span> <span class="n">wgt_y</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">add_ds_type</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name_tpl</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;All </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;Active </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">]:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name_tpl</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">add_ds_type</span><span class="p">)</span>
                <span class="n">bg</span> <span class="o">=</span> <span class="s2">&quot;data/backgrounds/transparent.png&quot;</span> <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="n">bt</span><span class="o">.</span><span class="n">text</span> \
                    <span class="k">else</span> <span class="s2">&quot;data/backgrounds/bt_process.png&quot;</span>
                <span class="n">ds_bt</span> <span class="o">=</span> <span class="n">TFButton</span><span class="p">(</span><span class="n">size_hint_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                                 <span class="n">text</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                                 <span class="n">background_normal</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
                <span class="n">ds_bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">set_ds</span><span class="p">,</span> <span class="n">bt</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
                <span class="n">dropdown</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">grid_wgt</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">ds_bt</span><span class="p">)</span>

        <span class="c1"># Create Buttons for each custom data set group</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="n">bg</span> <span class="o">=</span> <span class="s2">&quot;data/backgrounds/transparent.png&quot;</span> <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="n">bt</span><span class="o">.</span><span class="n">text</span> <span class="k">else</span> \
                <span class="s2">&quot;data/backgrounds/bt_process.png&quot;</span>
            <span class="n">ds_bt</span> <span class="o">=</span> <span class="n">TFButton</span><span class="p">(</span><span class="n">size_hint_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                             <span class="n">background_normal</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
            <span class="n">ds_bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">set_ds</span><span class="p">,</span> <span class="n">bt</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
            <span class="n">dropdown</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">grid_wgt</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">ds_bt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">point_wgt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">dropdown</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fancy_dropped</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="TriFusionApp.sidepanel_moreopts_dialog"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.sidepanel_moreopts_dialog">[docs]</a>    <span class="k">def</span> <span class="nf">sidepanel_moreopts_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_moreopts</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidepanel_remove_moreopts</span><span class="p">()</span>

        <span class="c1"># Get active tab</span>
        <span class="n">active_tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_tp</span><span class="o">.</span><span class="n">current_tab</span><span class="o">.</span><span class="n">text</span>

        <span class="c1"># Get position</span>
        <span class="n">wgt_x</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">135</span>
        <span class="n">wgt_y</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">bt</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="mi">12</span>

        <span class="c1"># Generate fancy marker</span>
        <span class="n">point_wgt</span> <span class="o">=</span> <span class="n">FancyMarkerPersist</span><span class="p">(</span>
            <span class="n">background_normal</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                   <span class="s2">&quot;box_arrow_down.png&quot;</span><span class="p">),</span>
            <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">bt</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)),</span>
            <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">background_color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.216</span><span class="p">,</span> <span class="mf">0.67</span><span class="p">,</span> <span class="mf">0.784</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="n">dlg_wgt</span> <span class="o">=</span> <span class="n">SP_MoreOpts_Dialog</span><span class="p">(</span><span class="n">ds_type</span><span class="o">=</span><span class="n">active_tab</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="n">wgt_x</span><span class="p">,</span> <span class="n">wgt_y</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">dlg_wgt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">point_wgt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sp_moreopts</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="TriFusionApp.load_proteomes"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.load_proteomes">[docs]</a>    <span class="k">def</span> <span class="nf">load_proteomes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Similar to load method, but specific for loading proteome files.</span>
<span class="sd">        Given the potential size of these files, they are not stored in</span>
<span class="sd">        memory, but instead are processed on the fly</span>

<span class="sd">        :param selection: list. Contains complete paths to the proteome</span>
<span class="sd">        files</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check if alignment files have already been loaded. If so, issue</span>
        <span class="c1"># warning, since the two data types cannot be loaded in simultaneous</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_warning</span><span class="p">(</span><span class="s2">&quot;Cannot mix alignment and proteome &quot;</span>
                                       <span class="s2">&quot;data&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;TriFusion currently has alignment data&quot;</span>
                                       <span class="s2">&quot; loaded. If you want to load proteome&quot;</span>
                                       <span class="s2">&quot; data, please remove the current&quot;</span>
                                       <span class="s2">&quot; data set.&quot;</span><span class="p">)</span>

        <span class="c1"># Collect input files. Search directories, if they are provided</span>
        <span class="n">original_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="n">original_list</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">join</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                                  <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">))])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">original_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="c1"># Check if files exist</span>
        <span class="n">file_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">original_list</span> <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span>

        <span class="c1"># If input is empty, raise warning and return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;The provided proteome files do&quot;</span>
                                          <span class="s2">&quot; not exist.&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="c1"># Stores invalid proteome files</span>
        <span class="n">bad_proteomes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;invalid&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;no_fasta&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;no_protein&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="n">good_proteomes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Filter non</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">Base</span><span class="p">()</span>
            <span class="n">er</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">autofinder</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">f_short</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">er</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">):</span>
                <span class="n">bad_proteomes</span><span class="p">[</span><span class="s2">&quot;invalid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f_short</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">er</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;fasta&quot;</span><span class="p">:</span>
                <span class="n">bad_proteomes</span><span class="p">[</span><span class="s2">&quot;no_fasta&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f_short</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">er</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;Protein&quot;</span><span class="p">:</span>
                <span class="n">bad_proteomes</span><span class="p">[</span><span class="s2">&quot;no_protein&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f_short</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">good_proteomes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="c1"># If there are proteome files already loaded, extend</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">good_proteomes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_proteome_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="c1"># If there are no proteome files loaded</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span> <span class="o">=</span> <span class="n">good_proteomes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_proteome_files</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span><span class="p">)</span>

        <span class="c1"># Update gene filter value to number of proteomes. This will</span>
        <span class="c1"># automatically set the minimum number of species to the number of</span>
        <span class="c1"># proteome files, each of which should represent a species.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orto_min_sp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span><span class="p">)</span>

        <span class="c1"># Issue float dialog informing that files have been loaded</span>
        <span class="k">if</span> <span class="n">good_proteomes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> file(s) successfully loaded&quot;</span> <span class="o">%</span>
                                   <span class="nb">len</span><span class="p">(</span><span class="n">good_proteomes</span><span class="p">),</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">original_list</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">file_list</span><span class="p">):</span>
                <span class="n">missing</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">original_list</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">file_list</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> file(s) could not be found&quot;</span> <span class="o">%</span>
                                       <span class="n">missing</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">)</span>

            <span class="c1"># Update the filename - path mapping attribute</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span>
                                     <span class="nb">list</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span>
                                          <span class="nb">zip</span><span class="p">([</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                                               <span class="n">good_proteomes</span><span class="p">],</span>
                                              <span class="n">good_proteomes</span><span class="p">)))</span>

            <span class="c1"># Populate file buttons in side panel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">original_file_inf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_file_information</span><span class="p">(</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;proteome&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">populate_input_files</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;proteome&quot;</span><span class="p">)</span>

        <span class="c1"># Automatically set the default orthology directory as the same</span>
        <span class="c1"># directory of the input files</span>
        <span class="c1"># Remove potential trailing dir separators that prevent</span>
        <span class="c1"># basename from finding the last dir name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ortho_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_common_path</span><span class="p">(</span><span class="n">file_list</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">bad_proteomes</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">!=</span> <span class="p">[[],</span> <span class="p">[],</span> <span class="p">[]]:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">bad_proteomes</span><span class="p">[</span><span class="s2">&quot;invalid&quot;</span><span class="p">]:</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;The following files are in invalid format:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> \
                       <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bad_proteomes</span><span class="p">[</span><span class="s2">&quot;invalid&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">bad_proteomes</span><span class="p">[</span><span class="s2">&quot;no_fasta&quot;</span><span class="p">]:</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;The following files are not in FASTA format:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> \
                       <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bad_proteomes</span><span class="p">[</span><span class="s2">&quot;no_fasta&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">bad_proteomes</span><span class="p">[</span><span class="s2">&quot;no_protein&quot;</span><span class="p">]:</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;The following files do not contain protein &quot;</span> \
                       <span class="s2">&quot;sequences:</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n\n</span><span class="s2">&quot;</span> \
                       <span class="o">%</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bad_proteomes</span><span class="p">[</span><span class="s2">&quot;no_protein&quot;</span><span class="p">])</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_warning</span><span class="p">(</span><span class="s2">&quot;Invalid proteome files detected&quot;</span><span class="p">,</span>
                                       <span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.update_tabs"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.update_tabs">[docs]</a>    <span class="k">def</span> <span class="nf">update_tabs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrapper that updates the contents of the files and taxa tabs</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">populate_input_files</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">populate_species</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">populate_partitions</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.update_taxa"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.update_taxa">[docs]</a>    <span class="k">def</span> <span class="nf">update_taxa</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This checks whether some taxa that were specific to some file(s)</span>
<span class="sd">        were removed when that file is removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If taxa were removed during the update, remove those buttons too</span>
        <span class="n">current_tx</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_taxa_bts</span><span class="p">]</span>
        <span class="n">removed_taxa</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">current_tx</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">taxa_names</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">removed_taxa</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">removed_taxa</span><span class="p">:</span>
                <span class="c1"># Get the corresponding buttons:</span>
                <span class="n">x_but_txt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">X&quot;</span> <span class="o">%</span> <span class="n">i</span>
                <span class="n">bt_obj</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_sl</span><span class="o">.</span><span class="n">children</span>
                          <span class="k">if</span> <span class="n">x_but_txt</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_bt</span><span class="p">(</span><span class="n">bt_obj</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">pass</span></div>

        <span class="c1">#self.active_taxa_list = self.alignment_list.taxa_names</span>

<div class="viewcode-block" id="TriFusionApp.update_partitions"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.update_partitions">[docs]</a>    <span class="k">def</span> <span class="nf">update_partitions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates partition buttons following any change to input data</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check for missing partitions based on id and remove them</span>
        <span class="k">for</span> <span class="n">bt</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">x_bt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_partition_bts</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bt</span><span class="o">.</span><span class="n">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">partitions</span><span class="o">.</span><span class="n">partitions</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_bt</span><span class="p">(</span><span class="n">x_bt</span><span class="p">,</span> <span class="n">parent_wgt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">partition_sl</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.update_partition_label"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.update_partition_label">[docs]</a>    <span class="k">def</span> <span class="nf">update_partition_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setsand updates a label on the Partitions tab of the side panel,</span>
<span class="sd">        informing how partitions files are selected out of the total</span>
<span class="sd">        partitions</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="p">:</span>
            <span class="c1"># Get total number of partitions</span>
            <span class="n">total_parts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">partitions</span><span class="o">.</span><span class="n">partitions</span><span class="p">)</span>
            <span class="c1"># Get selected partitions</span>
            <span class="n">active_parts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">partition_sl</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">TGToggleButton</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">partition_lab</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> of </span><span class="si">%s</span><span class="s2"> partitions &quot;</span> \
                <span class="s2">&quot;selected&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">active_parts</span><span class="p">,</span> <span class="n">total_parts</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.update_file_label"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.update_file_label">[docs]</a>    <span class="k">def</span> <span class="nf">update_file_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets and updates a label on the Files tab of the side panel,</span>
<span class="sd">        informing how many files are selected out of the total files</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Determine which list is used to populate</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span>
        <span class="n">active_lst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span> <span class="k">else</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">active_proteome_files</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_lab</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> of </span><span class="si">%s</span><span class="s2"> files selected&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">active_lst</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.update_sp_label"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.update_sp_label">[docs]</a>    <span class="k">def</span> <span class="nf">update_sp_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets and updates a label on the Taxa tab of the side panel,</span>
<span class="sd">        informing how many taxa are selected out of the total taxa. If</span>
<span class="sd">        the taxa list is empty, it disables the select/deselect buttons</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sp_lab</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> of </span><span class="si">%s</span><span class="s2"> taxa selected&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">taxa_names</span><span class="p">))</span>

        <span class="c1"># Add disabled no taxa button when empty</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> \
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">taxa_names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;species_temp&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_sl</span><span class="o">.</span><span class="n">children</span><span class="p">]:</span>
                <span class="n">no_bt</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;species_temp&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;No species loaded&quot;</span><span class="p">,</span>
                               <span class="n">size_hint_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="s2">&quot;species_temp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">no_bt</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_sl</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">no_bt</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.sidepanel_create_bts"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.sidepanel_create_bts">[docs]</a>    <span class="k">def</span> <span class="nf">sidepanel_create_bts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>

        <span class="c1"># Determine state based on active_file_list</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">:</span>
            <span class="c1"># For files</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">:</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="ow">in</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span> <span class="k">else</span> <span class="s2">&quot;normal&quot;</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span><span class="p">:</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="ow">in</span> \
                                      <span class="bp">self</span><span class="o">.</span><span class="n">active_proteome_files</span> <span class="k">else</span> <span class="s2">&quot;normal&quot;</span>
            <span class="c1"># For taxa</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span> <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span> <span class="k">else</span> <span class="s2">&quot;normal&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>

        <span class="n">bt</span> <span class="o">=</span> <span class="n">TGToggleButton</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                            <span class="n">size_hint_x</span><span class="o">=.</span><span class="mi">8</span><span class="p">,</span> <span class="n">shorten</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">shorten_from</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>

        <span class="c1"># Setting horizontal text size for shortening</span>
        <span class="n">bt</span><span class="o">.</span><span class="n">text_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="c1"># Binding functionality to toggle button</span>
        <span class="n">bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_selection</span><span class="p">)</span>

        <span class="c1"># Set Information button and add the widget</span>
        <span class="n">inf_bt</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                        <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">?&quot;</span> <span class="o">%</span> <span class="n">idx</span><span class="p">,</span>
                        <span class="n">border</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                        <span class="n">background_normal</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                               <span class="s2">&quot;info_bt_down.png&quot;</span><span class="p">),</span>
                        <span class="n">background_down</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                             <span class="s2">&quot;info_bt.png&quot;</span><span class="p">))</span>
        <span class="n">inf_bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_popup_info</span><span class="p">)</span>

        <span class="c1"># Set remove button with event binded and add the widget</span>
        <span class="n">x_bt</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                      <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">X&quot;</span> <span class="o">%</span> <span class="n">idx</span><span class="p">,</span>
                      <span class="n">border</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                      <span class="n">background_normal</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                             <span class="s2">&quot;remove_bt.png&quot;</span><span class="p">),</span>
                      <span class="n">background_down</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                           <span class="s2">&quot;remove_bt_down.png&quot;</span><span class="p">))</span>
        <span class="n">x_bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_action</span><span class="p">,</span>
                                     <span class="s2">&quot;Are you sure you want to remove&quot;</span>
                                     <span class="s2">&quot; this item?&quot;</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">remove_bt</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">bt</span><span class="p">,</span> <span class="n">inf_bt</span><span class="p">,</span> <span class="n">x_bt</span></div>

<div class="viewcode-block" id="TriFusionApp.populate_input_files"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.populate_input_files">[docs]</a>    <span class="k">def</span> <span class="nf">populate_input_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;alignment&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method grabs the input files that were selected in the</span>
<span class="sd">        FileChooser widget and populates the File tab in the main side panel</span>
<span class="sd">        with toggle and remove buttons for each file</span>

<span class="sd">        :param mode: string. Determines which list will be used to populate.</span>
<span class="sd">        If alignment, it will use file_list; If proteome, it will use</span>
<span class="sd">        proteome_list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Determine which list is used to populate</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;alignment&quot;</span><span class="p">:</span>
            <span class="n">lst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span>

        <span class="c1"># Remove the initial disabled button, if it&#39;s still there</span>
        <span class="k">if</span> <span class="s2">&quot;file_temp&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_sl</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_temp</span><span class="p">)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="s2">&quot;file_temp&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_sl</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">5</span>

        <span class="c1"># Add a label at the end of the file list informing how many files</span>
        <span class="c1"># are currently selected out of the total files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_file_label</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_partition_label</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_files</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_FILE_BUTTON</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">count_files</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sidepanel_add_bts</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;Files&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Check if morebt is already present</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_sl</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                        <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">LoadMoreBt</span><span class="p">)]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_sl</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">LoadMoreBt</span><span class="p">())</span>
                <span class="k">return</span></div>

<div class="viewcode-block" id="TriFusionApp.sidepanel_add_bts"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.sidepanel_add_bts">[docs]</a>    <span class="k">def</span> <span class="nf">sidepanel_add_bts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">tab_name</span><span class="p">,</span> <span class="n">partition_fls</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrapper that adds buttons to the corresponding File, Taxa or</span>
<span class="sd">        Partitions panel. Also prevents duplicates from being entered and</span>
<span class="sd">        adds buttons for mouse over events.</span>
<span class="sd">        :param idx: string. Identifier of the current item. It will be the</span>
<span class="sd">        name of the button</span>
<span class="sd">        :param tab_name: string. Identifies in which side panel gridlayout</span>
<span class="sd">        the button will be added</span>
<span class="sd">        :param partition_fls: string. Only for Partitions tab_name. Includes</span>
<span class="sd">        full path of the alignment for the partition.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Set attributes to be added</span>
        <span class="k">if</span> <span class="n">tab_name</span> <span class="o">==</span> <span class="s2">&quot;Files&quot;</span><span class="p">:</span>
            <span class="n">grid_wgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_sl</span>
            <span class="n">bt_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_file_bts</span>

        <span class="k">elif</span> <span class="n">tab_name</span> <span class="o">==</span> <span class="s2">&quot;Taxa&quot;</span><span class="p">:</span>
            <span class="n">grid_wgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_sl</span>
            <span class="n">bt_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_taxa_bts</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">grid_wgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">partition_sl</span>
            <span class="n">bt_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_partition_bts</span>

        <span class="c1"># This prevents duplicate entries from being added</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">grid_wgt</span><span class="o">.</span><span class="n">children</span><span class="p">]:</span>

            <span class="c1"># Create buttons</span>
            <span class="k">if</span> <span class="n">tab_name</span> <span class="o">==</span> <span class="s2">&quot;Partitions&quot;</span><span class="p">:</span>
                <span class="n">bt</span><span class="p">,</span> <span class="n">inf_bt</span><span class="p">,</span> <span class="n">x_bt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidepanel_create_part_bts</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">partition_fls</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bt</span><span class="p">,</span> <span class="n">inf_bt</span><span class="p">,</span> <span class="n">x_bt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidepanel_create_bts</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

            <span class="c1"># Add button to storage for mouse over events</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_bts</span><span class="p">[</span><span class="n">tab_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>

            <span class="c1"># Adds buttons to gridlayout</span>
            <span class="n">grid_wgt</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>
            <span class="n">grid_wgt</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">inf_bt</span><span class="p">)</span>
            <span class="n">grid_wgt</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">x_bt</span><span class="p">)</span>

            <span class="c1"># Add all three buttons to the storage attribute</span>
            <span class="n">bt_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">bt</span><span class="p">,</span> <span class="n">inf_bt</span><span class="p">,</span> <span class="n">x_bt</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.sidepanel_load_more_filebts"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.sidepanel_load_more_filebts">[docs]</a>    <span class="k">def</span> <span class="nf">sidepanel_load_more_filebts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">max_buttons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_FILE_BUTTON</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_files</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_sl</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_sl</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count_files</span><span class="p">,</span> <span class="n">max_buttons</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">count_files</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">infile</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">count_files</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sidepanel_add_bts</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="s2">&quot;Files&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_sl</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">LoadMoreBt</span><span class="p">())</span></div>

<div class="viewcode-block" id="TriFusionApp.populate_species"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.populate_species">[docs]</a>    <span class="k">def</span> <span class="nf">populate_species</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method grabs the taxa names from the input files that were</span>
<span class="sd">        selected in the FileChooser widget and populates the Taxa tab in the</span>
<span class="sd">        main side panel with toggle and remove buttons for each taxon</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Remove the initial disabled button if it&#39;s still there</span>
        <span class="k">if</span> <span class="s2">&quot;species_temp&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_sl</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">species_temp</span><span class="p">)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="s2">&quot;species_temp&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_sl</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">5</span>

        <span class="c1"># Add a label at the end of the taxa list informing how many taxa</span>
        <span class="c1"># are currently selected out of the total taxa</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sp_label</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">tx</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span><span class="p">):</span>

            <span class="c1"># Prevents duplicate taxa from being entered</span>
            <span class="k">if</span> <span class="n">tx</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_sl</span><span class="o">.</span><span class="n">children</span><span class="p">]:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">sidepanel_add_bts</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span> <span class="s2">&quot;Taxa&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.repopulate_partitions"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.repopulate_partitions">[docs]</a>    <span class="k">def</span> <span class="nf">repopulate_partitions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrapper method that re-populates partitions after changes</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Clear partitions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">partition_sl</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count_partitions</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Re-populate partitions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">populate_partitions</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.populate_partitions"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.populate_partitions">[docs]</a>    <span class="k">def</span> <span class="nf">populate_partitions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populates the partitions tab in the side bar from the partitions</span>
<span class="sd">        object associated with alignment objects.</span>

<span class="sd">        This method is used when input files are loaded into the program,</span>
<span class="sd">        which means there will be no issue with multiple files being</span>
<span class="sd">        associated with the same partitions. This kind of change is done</span>
<span class="sd">        a posteriori when importing partition files or setting the</span>
<span class="sd">        partitions manually.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Remove initial disabled button, if it&#39;s still there</span>
        <span class="k">if</span> <span class="s2">&quot;partition_temp&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">partition_sl</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">partition_temp</span><span class="p">)</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="s2">&quot;partition_temp&quot;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">ReferenceError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">for</span> <span class="n">partition</span><span class="p">,</span> <span class="n">fls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">partitions</span><span class="o">.</span><span class="n">iter_files</span><span class="p">():</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_partitions</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_PARTITION_BUTTON</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">count_partitions</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="c1"># Create partition buttons</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sidepanel_add_bts</span><span class="p">(</span><span class="n">partition</span><span class="p">,</span> <span class="s2">&quot;Partitions&quot;</span><span class="p">,</span>
                                       <span class="n">partition_fls</span><span class="o">=</span><span class="n">fls</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">partition_sl</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">LoadMoreBt</span><span class="p">())</span>
                <span class="k">return</span></div>

<div class="viewcode-block" id="TriFusionApp.partitions_merge_dialog"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.partitions_merge_dialog">[docs]</a>    <span class="k">def</span> <span class="nf">partitions_merge_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dialog that appears when clicking merge partitions asking for the</span>
<span class="sd">        name of the new partition</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">InputTextDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">,</span>
                                  <span class="n">action</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitions_merge</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Choose name for new partition&quot;</span><span class="p">,</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mf">153.5</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.partitions_merge"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.partitions_merge">[docs]</a>    <span class="k">def</span> <span class="nf">partitions_merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merge active partitions</span>

<span class="sd">        :param name: string. Name of the new partition</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">partitions</span><span class="o">.</span><span class="n">partitions</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                <span class="s2">&quot;A partition named </span><span class="si">%s</span><span class="s2"> already exists.&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span>
                <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">partitions</span><span class="o">.</span><span class="n">merge_partitions</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_partitions</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="c1"># Resets active partitions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_partitions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Close popup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repopulate_partitions</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.partitions_split"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.partitions_split">[docs]</a>    <span class="k">def</span> <span class="nf">partitions_split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">new_names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Split an active partition</span>

<span class="sd">        :param new_range: Optional. Tuple containing the new ranges for the</span>
<span class="sd">        new partitions</span>
<span class="sd">        :param new_names: Optional. Tuple containing the new names for each</span>
<span class="sd">        new partition</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check whether any of the new partition names already exist. Issue</span>
        <span class="c1"># an error if so.</span>
        <span class="k">if</span> <span class="n">new_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_names</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">partitions</span><span class="o">.</span><span class="n">partitions</span><span class="p">]:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;Duplicate partition names &quot;</span>
                                              <span class="s2">&quot;deteced: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_names</span> <span class="k">if</span> <span class="n">x</span> <span class="k">if</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">partitions</span><span class="o">.</span><span class="n">partitions</span><span class="p">])),</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="c1"># Get active partition</span>
        <span class="n">active_partition</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">partition_sl</span><span class="o">.</span><span class="n">children</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ToggleButton</span><span class="p">)</span> <span class="ow">and</span>
                            <span class="n">x</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">new_range</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">partitions</span><span class="o">.</span><span class="n">split_partition</span><span class="p">(</span>
                <span class="n">active_partition</span><span class="p">,</span> <span class="n">new_range</span><span class="p">,</span> <span class="n">new_names</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">partitions</span><span class="o">.</span><span class="n">split_partition</span><span class="p">(</span><span class="n">active_partition</span><span class="p">)</span>

        <span class="c1"># Resets ative partitions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_partitions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Close popup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repopulate_partitions</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_partitions_split"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_partitions_split">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_partitions_split</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">SplitPartitions</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>

        <span class="c1"># Get active partition</span>
        <span class="n">active_partition</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">partition_sl</span><span class="o">.</span><span class="n">children</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ToggleButton</span><span class="p">)</span> <span class="ow">and</span>
                            <span class="n">x</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Get partition range</span>
        <span class="n">part_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">partitions</span><span class="o">.</span>\
            <span class="n">partitions</span><span class="p">[</span><span class="n">active_partition</span><span class="p">]</span>

        <span class="c1"># Disable manual split if the current partition has a fragmented</span>
        <span class="c1"># range</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">part_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">wgt</span> <span class="ow">in</span> <span class="p">[</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">ok_bt</span><span class="p">,</span> <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">part1</span><span class="p">,</span>
                        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">part2</span><span class="p">]:</span>
                <span class="n">wgt</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">manual_slider</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">manual_slider</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">part_range</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">manual_slider</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">part_range</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># If partition contains only one file, disable automatic split by</span>
        <span class="c1">#  files</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">partitions</span><span class="o">.</span><span class="n">partitions_alignments</span><span class="p">[</span>
                <span class="n">active_partition</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">auto_split_bt</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Split partition&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">420</span><span class="p">,</span> <span class="mi">320</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">part_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                <span class="s2">&quot;Manual split in unavailable for partitions with &quot;</span>
                <span class="s2">&quot;fragmented ranges.&quot;</span><span class="p">,</span>
                <span class="n">t</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.partitions_change_name"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.partitions_change_name">[docs]</a>    <span class="k">def</span> <span class="nf">partitions_change_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partition_name</span><span class="p">,</span> <span class="n">new_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes name of a partition</span>
<span class="sd">        :param partition_name: string, Original partition name</span>
<span class="sd">        :param new_name: string, new partition name</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Change partition name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">partitions</span><span class="o">.</span><span class="n">change_name</span><span class="p">(</span><span class="n">partition_name</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span>

        <span class="c1"># Update button in side panel</span>
        <span class="n">bt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">partition_sl</span><span class="o">.</span><span class="n">children</span>
              <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ToggleButton</span><span class="p">)</span> <span class="ow">and</span>
              <span class="n">x</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="n">partition_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">bt</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">new_name</span></div>

<div class="viewcode-block" id="TriFusionApp.partitions_import_scheme"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.partitions_import_scheme">[docs]</a>    <span class="k">def</span> <span class="nf">partitions_import_scheme</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partition_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Imports partitions in partition_file and applies to the</span>
<span class="sd">        alignment_list partition object. It applies to the entire</span>
<span class="sd">        alignment_list for now.</span>
<span class="sd">        :param partition_file: string, path to partition file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">partitions</span><span class="o">.</span><span class="n">read_from_file</span><span class="p">(</span><span class="n">partition_file</span><span class="p">)</span>

        <span class="c1"># Clear partitions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">partition_sl</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
        <span class="c1">#C Clear partition button storage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sp_partition_bts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Re-populate partitions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">populate_partitions</span><span class="p">()</span>
        <span class="c1"># Update partitions label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_partition_label</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.sidepanel_create_part_bts"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.sidepanel_create_part_bts">[docs]</a>    <span class="k">def</span> <span class="nf">sidepanel_create_part_bts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates buttons for each partition</span>
<span class="sd">        :param idx: string. unique identifier of partition</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">part_name</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fl_num</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="c1"># Create main button</span>
        <span class="n">bt</span> <span class="o">=</span> <span class="n">TGToggleButton</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">part_name</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">part_name</span><span class="p">,</span>
                            <span class="n">size_hint_y</span><span class="o">=.</span><span class="mi">8</span><span class="p">,</span> <span class="n">shorten</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                            <span class="n">shorten_from</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>

        <span class="n">bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_selection</span><span class="p">)</span>

        <span class="c1"># Setting horizontal text size for shortening</span>
        <span class="n">bt</span><span class="o">.</span><span class="n">text_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>

        <span class="c1"># Create file counter button. This button will display the number</span>
        <span class="c1"># of alignments included in this partition as its text. The</span>
        <span class="c1"># on_release event will show a popup with a list of the alignment</span>
        <span class="c1"># files contained</span>
        <span class="n">c_bt</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">fl_num</span><span class="p">,</span>
                      <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">C&quot;</span> <span class="o">%</span> <span class="n">part_name</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">border</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">c_bt</span><span class="o">.</span><span class="n">background_normal</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                      <span class="s2">&quot;bt_process.png&quot;</span><span class="p">)</span>
        <span class="n">c_bt</span><span class="o">.</span><span class="n">background_down</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span> <span class="s2">&quot;count_bt.png&quot;</span><span class="p">)</span>
        <span class="n">c_bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_partition_files</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

        <span class="c1"># Create edition button</span>
        <span class="n">ed_bt</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                       <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">?&quot;</span> <span class="o">%</span> <span class="n">part_name</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">ed_bt</span><span class="o">.</span><span class="n">background_normal</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;edit_bt_down.png&quot;</span><span class="p">)</span>
        <span class="n">ed_bt</span><span class="o">.</span><span class="n">background_down</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span> <span class="s2">&quot;edit_bt.png&quot;</span><span class="p">)</span>
        <span class="n">ed_bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dialog_partitions</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">bt</span><span class="p">,</span> <span class="n">c_bt</span><span class="p">,</span> <span class="n">ed_bt</span></div>

<div class="viewcode-block" id="TriFusionApp.set_codon_model"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.set_codon_model">[docs]</a>    <span class="k">def</span> <span class="nf">set_codon_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">codon_partition</span><span class="p">,</span> <span class="n">wgt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes the model spinners when changing the codon partitioning</span>

<span class="sd">        :param codon_partition: string. The codon partition string that</span>
<span class="sd">        should correspond to a key in partition_model</span>
<span class="sd">        :param wgt: Widget object containing the partitions dialog</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">first_background</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span> <span class="s2">&quot;model_bt1.png&quot;</span><span class="p">)</span>
        <span class="n">second_background</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span> <span class="s2">&quot;model_bt2.png&quot;</span><span class="p">)</span>
        <span class="n">third_background</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span> <span class="s2">&quot;model_bt3.png&quot;</span><span class="p">)</span>

        <span class="n">partition_model</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;[color=ff5555ff]1[/color] + [color=37abc8ff]2[/color] + &quot;</span>
            <span class="s2">&quot;[color=71c837ff]3[/color]&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">ModelSpinner</span><span class="p">(</span><span class="n">background_normal</span><span class="o">=</span><span class="n">first_background</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">),</span>
            <span class="n">ModelSpinner</span><span class="p">(</span><span class="n">background_normal</span><span class="o">=</span><span class="n">second_background</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">),</span>
            <span class="n">ModelSpinner</span><span class="p">(</span><span class="n">background_normal</span><span class="o">=</span><span class="n">third_background</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;3&quot;</span><span class="p">)],</span>
            <span class="s2">&quot;[color=ff5555ff](1 + 2)[/color] + [color=37abc8ff]3[/color]&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">ModelSpinner</span><span class="p">(</span><span class="n">background_normal</span><span class="o">=</span><span class="n">first_background</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;12&quot;</span><span class="p">),</span>
            <span class="n">ModelSpinner</span><span class="p">(</span><span class="n">background_normal</span><span class="o">=</span><span class="n">second_background</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;3&quot;</span><span class="p">)],</span>
            <span class="s2">&quot;[color=ff5555ff]1[/color] + [color=37abc8ff](2 + 3)[/color]&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">ModelSpinner</span><span class="p">(</span><span class="n">background_normal</span><span class="o">=</span><span class="n">first_background</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">),</span>
            <span class="n">ModelSpinner</span><span class="p">(</span><span class="n">background_normal</span><span class="o">=</span><span class="n">second_background</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;23&quot;</span><span class="p">)],</span>
            <span class="s2">&quot;[color=ff5555ff](1 + 3)[/color] + [color=37abc8ff]2[/color]&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="n">ModelSpinner</span><span class="p">(</span><span class="n">background_normal</span><span class="o">=</span><span class="n">first_background</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;13&quot;</span><span class="p">),</span>
            <span class="n">ModelSpinner</span><span class="p">(</span><span class="n">background_normal</span><span class="o">=</span><span class="n">second_background</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">)],</span>
            <span class="s2">&quot;No partitions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">ModelSpinner</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">)]}</span>

        <span class="k">if</span> <span class="n">wgt</span><span class="p">:</span>
            <span class="n">partitions_wgt</span> <span class="o">=</span> <span class="n">wgt</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">partitions_wgt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                              <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">PartitionsDialog</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">partitions_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">model_bx</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">partition_model</span><span class="p">[</span><span class="n">codon_partition</span><span class="p">]:</span>
            <span class="n">partitions_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">model_bx</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">model</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.save_model"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.save_model">[docs]</a>    <span class="k">def</span> <span class="nf">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">part_name</span><span class="p">,</span> <span class="n">partition_wgt</span><span class="p">,</span> <span class="n">apply_all</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the model currently set in the partitions dialog.</span>
<span class="sd">        :param part_name: string, name of partition</span>
<span class="sd">        :param partition_wgt: Widget of the Partitions dialog</span>
<span class="sd">        :param apply_all: boolean, whether the current model will be</span>
<span class="sd">        applied to all partitions or not</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">model_spiners</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">partition_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">model_bx</span><span class="o">.</span><span class="n">children</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_spiners</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">partitions</span><span class="o">.</span><span class="n">set_model</span><span class="p">(</span>
                <span class="n">part_name</span><span class="p">,</span> <span class="p">[</span><span class="n">model_spiners</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">],</span> <span class="n">apply_all</span><span class="o">=</span><span class="n">apply_all</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">models</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">wgt</span> <span class="ow">in</span> <span class="n">model_spiners</span><span class="p">:</span>
                <span class="n">models</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">wgt</span><span class="o">.</span><span class="n">text</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">wgt</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
                <span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wgt</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

            <span class="n">links</span><span class="p">,</span> <span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">links</span><span class="p">,</span> <span class="n">models</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">pair</span><span class="p">:</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">partitions</span><span class="o">.</span><span class="n">set_model</span><span class="p">(</span>
                <span class="n">part_name</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">links</span><span class="p">,</span> <span class="n">apply_all</span><span class="o">=</span><span class="n">apply_all</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.remove_partition_box"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.remove_partition_box">[docs]</a>    <span class="k">def</span> <span class="nf">remove_partition_box</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a currently active partition box when clicking the X button</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Gathers active partition box and remove button</span>
        <span class="n">partition_box</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                         <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">PartitionsDialog</span><span class="p">)</span> <span class="ow">or</span>
                         <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">RemoveFloat</span><span class="p">)]</span>

        <span class="c1"># Removes widgets:</span>
        <span class="k">for</span> <span class="n">wgt</span> <span class="ow">in</span> <span class="n">partition_box</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">wgt</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_partition_files"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_partition_files">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_partition_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partition_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shows a popup listing the files associated with a given partition</span>
<span class="sd">        :param partition_name: string, name of partition</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">BtList</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>

        <span class="n">plist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">partitions</span><span class="o">.</span><span class="n">partitions_alignments</span><span class="p">[</span>
            <span class="n">partition_name</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">plist</span><span class="p">:</span>
            <span class="n">bt</span> <span class="o">=</span> <span class="n">TFButton</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">rev_inlist</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Alignment files in </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">partition_name</span><span class="p">,</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">6</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_select_taxa_group"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_select_taxa_group">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_select_taxa_group</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shows a subpopup listing the taxa groups that have already been</span>
<span class="sd">        created. Each taxa group will be a Button widget</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">BtList</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_subpopup</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">taxa_groups</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">nm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">taxa_groups</span><span class="p">:</span>
                <span class="n">bt</span> <span class="o">=</span> <span class="n">TFButton</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">nm</span><span class="p">,</span> <span class="n">size_hint_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
                <span class="n">bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">select_taxa_group</span><span class="p">)</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">rev_inlist</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">bt</span> <span class="o">=</span> <span class="n">TFButton</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;No groups defined&quot;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">rev_inlist</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Select taxa group&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">4</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">),</span> <span class="n">popup_level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.select_taxa_group"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.select_taxa_group">[docs]</a>    <span class="k">def</span> <span class="nf">select_taxa_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gives functionality to the buttons in the dialog_select_taxa_group.</span>
<span class="sd">        Saves the taxa group name and closes subpopup</span>

<span class="sd">        :param bt: Button object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">taxa_filter_settings</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">taxa_filter_settings</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">text</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">taxa_filter_settings</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Contain&quot;</span><span class="p">,</span> <span class="n">bt</span><span class="o">.</span><span class="n">text</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_subpopup</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_create_group_from_file"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_create_group_from_file">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_create_group_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a filechooser dialog  to select a file containing a</span>
<span class="sd">        taxa/file list that will be used to generate a data set group</span>
<span class="sd">        :param ds_type: string. Identifies the data set type. Either taxa or</span>
<span class="sd">        files</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">SaveDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">,</span>
                             <span class="n">bookmark_init</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmark_init</span><span class="p">)</span>

        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_box</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_box</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Choose text file to import&quot;</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sd_filechooser</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">ds_type</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_select_from_file"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_select_from_file">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_select_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a filechooser dialog to select a text file containing a list</span>
<span class="sd">        of files or taxa names to be selected in the side panel</span>

<span class="sd">        Calls: select_bt_from_file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">SaveDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">,</span>
                             <span class="n">bookmark_init</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmark_init</span><span class="p">)</span>

        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_box</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_box</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Choose text file to import&quot;</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sd_filechooser</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;select_from_file&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_remove_from_file"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_remove_from_file">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_remove_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a filechooser dialog to select a text file containing a list</span>
<span class="sd">        of files or taxa names to be removed in the side panel.</span>

<span class="sd">        Then calls: self.remove_bt_from_file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">SaveDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">,</span>
                             <span class="n">bookmark_init</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmark_init</span><span class="p">)</span>

        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_box</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_box</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Choose text file to import&quot;</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sd_filechooser</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;remove_from_file&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_import_partitions"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_import_partitions">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_import_partitions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a filechooser dialog to select a partition file and import</span>
<span class="sd">        its scheme to the current partition. If one or more partitions</span>
<span class="sd">        are active, ask the user if we wants to import the partition</span>
<span class="sd">        scheme to the selected partitions or to the whole dataset</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">SaveDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">,</span>
                             <span class="n">bookmark_init</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmark_init</span><span class="p">)</span>

        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_box</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_box</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Choose partition scheme file&quot;</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sd_filechooser</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;import_partitions&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_partitions"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_partitions">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_partitions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">btx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shows a small widget with partition information</span>

<span class="sd">        :param btx: Button widget that will be used to determine which</span>
<span class="sd">        partition is being viewed and the position of the partitions dialog</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">flatter</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Creates a flat iterator of tuples. If s is [[(1,2), (2,3)],</span>
<span class="sd">            (4,5)] this will yield ((1,2), (2,3), (4,5))</span>

<span class="sd">            :param s: list.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">y</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">y</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="n">j</span>

        <span class="n">partition_model</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;1,2,3&quot;</span><span class="p">:</span>
                <span class="s2">&quot;[color=ff5555ff]1[/color] + [color=37abc8ff]2[/color]&quot;</span>
                <span class="s2">&quot; + [color=71c837ff]3[/color]&quot;</span><span class="p">,</span>
            <span class="s2">&quot;12,3&quot;</span><span class="p">:</span>
                <span class="s2">&quot;[color=ff5555ff](1 + 2)[/color] + [color=37abc8ff]3&quot;</span>
                <span class="s2">&quot;[/color]&quot;</span><span class="p">,</span>
            <span class="s2">&quot;1,23&quot;</span><span class="p">:</span>
                <span class="s2">&quot;[color=ff5555ff]1[/color] + [color=37abc8ff](2 + 3)&quot;</span>
                <span class="s2">&quot;[/color]&quot;</span><span class="p">,</span>
            <span class="s2">&quot;13,2&quot;</span><span class="p">:</span>
                <span class="s2">&quot;[color=ff5555ff](1 + 3)[/color] + [color=37abc8ff]2&quot;</span>
                <span class="s2">&quot;[/color]&quot;</span><span class="p">}</span>

        <span class="c1"># Get position of partition edit button:</span>
        <span class="n">ed_pos</span> <span class="o">=</span> <span class="n">btx</span><span class="o">.</span><span class="n">to_window</span><span class="p">(</span><span class="n">btx</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">btx</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Set position for partitions dialog</span>
        <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">240</span><span class="p">,</span> <span class="mi">260</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">ed_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">btx</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
               <span class="n">ed_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">btx</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">PartitionsDialog</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                                   <span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">rm_wgt</span> <span class="o">=</span> <span class="n">RemoveFloat</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">[</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span>
                                  <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">20</span><span class="p">])</span>

        <span class="c1"># Set partition object and partition name</span>

        <span class="c1"># Since partition names can be changed and I can only get the</span>
        <span class="c1"># partition name from he edition button id (which does not</span>
        <span class="c1"># change), this iteration over all three partition buttons for</span>
        <span class="c1"># each partition will retrieve the correct partition name</span>
        <span class="n">displayed_partitions</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">partition_sl</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span> <span class="ow">not</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">LoadMoreBt</span><span class="p">))</span>
        <span class="n">part_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">ebt</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">bt</span> <span class="ow">in</span>
                     <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">iter</span><span class="p">(</span><span class="n">displayed_partitions</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
                     <span class="k">if</span> <span class="n">ebt</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">btx</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">part_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">partitions</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">partition_name</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">part_name</span>
        <span class="n">content</span><span class="o">.</span><span class="n">original_name</span> <span class="o">=</span> <span class="n">part_name</span>

        <span class="c1"># Get partition length</span>
        <span class="n">part_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">partitions</span>
                      <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">part_name</span><span class="p">)</span>
        <span class="n">part_len</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">flatter</span><span class="p">(</span><span class="n">part_range</span><span class="p">)])</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">partition_lenght</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">bp&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">part_len</span><span class="p">)</span>

        <span class="c1"># If there are codon partitions</span>
        <span class="k">if</span> <span class="n">part_obj</span><span class="o">.</span><span class="n">partitions</span><span class="p">[</span><span class="n">part_name</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">part_obj</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">part_name</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">codon_spin</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">codon_spin</span><span class="o">.</span>\
                    <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_codon_model</span><span class="p">(</span>
                    <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">codon_spin</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">content</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m_key</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">part_obj</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">part_name</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">codon_spin</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">partition_model</span><span class="p">[</span><span class="n">m_key</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_codon_model</span><span class="p">(</span><span class="n">partition_model</span><span class="p">[</span><span class="n">m_key</span><span class="p">],</span> <span class="n">content</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">part_obj</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">part_name</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">part_obj</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">part_name</span><span class="p">][</span><span class="mi">0</span><span class="p">])):</span>
                    <span class="n">params</span> <span class="o">=</span> <span class="n">part_obj</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">part_name</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">model</span> <span class="o">=</span> <span class="n">part_obj</span><span class="o">.</span><span class="n">get_model_name</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
                    <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">model_bx</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">model</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">part_obj</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">part_name</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">model_bx</span><span class="o">.</span><span class="n">children</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">m</span>
        <span class="k">elif</span> <span class="n">part_obj</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">part_name</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">part_obj</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">part_name</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">part_obj</span><span class="o">.</span><span class="n">get_model_name</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">model_bx</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">model</span>
        <span class="k">elif</span> <span class="n">part_obj</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">part_name</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">part_obj</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">part_name</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">model_bx</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">model</span>

        <span class="c1"># Give functionality to remove button</span>
        <span class="n">rm_wgt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_partition_box</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">rm_wgt</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.get_popup_info"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.get_popup_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_popup_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function determines whether the taxa information has changed</span>
<span class="sd">        since it has been update (when files are removed). If so,</span>
<span class="sd">        it updates the taxa information and issues popup_info. Else,</span>
<span class="sd">        just issues popup_info</span>
<span class="sd">        :param value: Button object that issued the function</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger_taxa_update</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trigger_taxa_update</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_in_background</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_taxa_information</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">popup_info</span><span class="p">,</span>
                                   <span class="kc">None</span><span class="p">,</span>
                                   <span class="p">[</span><span class="n">value</span><span class="p">],</span>
                                   <span class="n">cancel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                   <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Updating taxa information&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">popup_info</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.popup_info"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.popup_info">[docs]</a>    <span class="k">def</span> <span class="nf">popup_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the pop up information content for the pressed taxa or</span>
<span class="sd">        file button</span>
<span class="sd">        :param value: the button object is provided when binding</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Determining if the request comes from file or taxa tab</span>
        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">parent</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_sl</span><span class="p">:</span>

            <span class="c1"># Get taxa name</span>
            <span class="n">tx</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">id</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">tx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span><span class="p">:</span>

                <span class="c1"># Get the information from the content list. This is done</span>
                <span class="c1"># when calling the popup to avoid repeating this</span>
                <span class="c1"># operation every time taxa  or files are added/removed.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_tx_inf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_taxon_information</span><span class="p">(</span>
                    <span class="n">tx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="p">)</span>

                <span class="n">content</span> <span class="o">=</span> <span class="n">BoxLayout</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                    <span class="n">spacing</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                <span class="n">sv</span> <span class="o">=</span> <span class="n">ScrollView</span><span class="p">(</span><span class="n">scroll_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;bars&quot;</span><span class="p">],</span> <span class="n">bar_width</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                <span class="n">all_ds</span> <span class="o">=</span> <span class="n">BoxLayout</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span>
                                   <span class="n">height</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">30</span> <span class="o">*</span> <span class="mi">7</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span>
                                   <span class="n">size_hint_y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">total_ds</span> <span class="o">=</span> <span class="n">TaxaPopup</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">30</span> <span class="o">*</span> <span class="mi">7</span><span class="p">)</span>
                <span class="n">total_ds</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">dataset_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Complete data set&quot;</span>
                <span class="n">active_ds</span> <span class="o">=</span> <span class="n">TaxaPopup</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">30</span> <span class="o">*</span> <span class="mi">7</span><span class="p">)</span>
                <span class="n">active_ds</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">dataset_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Active data set&quot;</span>

                <span class="c1"># Populate complete data set contents</span>
                <span class="n">total_ds</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">seq_len</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">original_tx_inf</span><span class="p">[</span><span class="n">tx</span><span class="p">][</span><span class="s2">&quot;length&quot;</span><span class="p">]</span>
                <span class="n">total_ds</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">indels</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">original_tx_inf</span><span class="p">[</span><span class="n">tx</span><span class="p">][</span><span class="s2">&quot;indel&quot;</span><span class="p">]</span>
                <span class="n">total_ds</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">missing</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">original_tx_inf</span><span class="p">[</span><span class="n">tx</span><span class="p">][</span><span class="s2">&quot;missing&quot;</span><span class="p">]</span>
                <span class="n">total_ds</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">ef_seq_len</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s%%</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">original_tx_inf</span><span class="p">[</span><span class="n">tx</span><span class="p">][</span><span class="s2">&quot;effective_len&quot;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">original_tx_inf</span><span class="p">[</span><span class="n">tx</span><span class="p">][</span><span class="s2">&quot;effective_len_per&quot;</span><span class="p">]))</span>
                <span class="n">total_ds</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_cov</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s%%</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">original_tx_inf</span><span class="p">[</span><span class="n">tx</span><span class="p">][</span><span class="s2">&quot;fl_coverage&quot;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">original_tx_inf</span><span class="p">[</span><span class="n">tx</span><span class="p">][</span><span class="s2">&quot;fl_coverage_per&quot;</span><span class="p">]))</span>

                <span class="c1"># Populate active data set contents</span>
                <span class="n">active_ds</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">seq_len</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_tx_inf</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span>
                <span class="n">active_ds</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">indels</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_tx_inf</span><span class="p">[</span><span class="s2">&quot;indel&quot;</span><span class="p">]</span>
                <span class="n">active_ds</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">missing</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_tx_inf</span><span class="p">[</span><span class="s2">&quot;missing&quot;</span><span class="p">]</span>
                <span class="n">active_ds</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">ef_seq_len</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s%%</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_tx_inf</span><span class="p">[</span><span class="s2">&quot;effective_len&quot;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_tx_inf</span><span class="p">[</span><span class="s2">&quot;effective_len_per&quot;</span><span class="p">]))</span>
                <span class="n">active_ds</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_cov</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s%%</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_tx_inf</span><span class="p">[</span><span class="s2">&quot;fl_coverage&quot;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_tx_inf</span><span class="p">[</span><span class="s2">&quot;fl_coverage_per&quot;</span><span class="p">]))</span>

                <span class="n">close_bl</span> <span class="o">=</span> <span class="n">CloseBox</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>

                <span class="n">all_ds</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">total_ds</span><span class="p">)</span>
                <span class="n">all_ds</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">active_ds</span><span class="p">)</span>
                <span class="n">sv</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">all_ds</span><span class="p">)</span>
                <span class="n">content</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">sv</span><span class="p">)</span>
                <span class="n">content</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">close_bl</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Taxon: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="o">.</span><span class="n">id</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">value</span><span class="o">.</span><span class="n">parent</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_sl</span><span class="p">:</span>

            <span class="c1"># Get file name</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">id</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">[</span><span class="n">file_name</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span><span class="p">:</span>

                <span class="n">content</span> <span class="o">=</span> <span class="n">FilePopup</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>

                <span class="c1"># Get the information from the content list. This is done</span>
                <span class="c1"># when calling the popup to avoid repeating this</span>
                <span class="c1"># operation every time taxa  or files are added/removed.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_file_inf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_file_information</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>

                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">in_format</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_file_inf</span><span class="p">[</span><span class="s2">&quot;aln_format&quot;</span><span class="p">]</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">seq_type</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_file_inf</span><span class="p">[</span><span class="s2">&quot;seq_type&quot;</span><span class="p">]</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">seq_size</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_file_inf</span><span class="p">[</span><span class="s2">&quot;aln_len&quot;</span><span class="p">]</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">n_taxa</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_file_inf</span><span class="p">[</span><span class="s2">&quot;n_taxa&quot;</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;File: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="o">.</span><span class="n">id</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">320</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">[</span><span class="n">file_name</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span><span class="p">:</span>

                <span class="n">content</span> <span class="o">=</span> <span class="n">ProteomePopup</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>

                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">n_seq</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">original_file_inf</span><span class="p">[</span><span class="n">file_name</span><span class="p">][</span><span class="s2">&quot;n_seq&quot;</span><span class="p">]</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">n_res</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">original_file_inf</span><span class="p">[</span><span class="n">file_name</span><span class="p">][</span><span class="s2">&quot;n_res&quot;</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;File </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="o">.</span><span class="n">id</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.change_taxa_name"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.change_taxa_name">[docs]</a>    <span class="k">def</span> <span class="nf">change_taxa_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_name</span><span class="p">,</span> <span class="n">new_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes the taxa name on a double tap</span>
<span class="sd">        :param old_name: string, original taxon name</span>
<span class="sd">        :param new_name: string, new taxon name</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">change_taxon_name</span><span class="p">(</span><span class="n">old_name</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span>

        <span class="c1"># Change active taxa list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_name</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">old_name</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span>
                                 <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span><span class="p">]</span>

        <span class="c1"># Change sp_taxa_bts attribute</span>
        <span class="k">for</span> <span class="n">taxa</span><span class="p">,</span> <span class="n">inf</span><span class="p">,</span> <span class="n">rm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_taxa_bts</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">taxa</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="n">old_name</span><span class="p">:</span>
                <span class="n">taxa</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">new_name</span>
                <span class="n">taxa</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">new_name</span>
                <span class="n">inf</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_name</span><span class="p">)</span>
                <span class="n">rm</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">X&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_name</span><span class="p">)</span>

        <span class="c1"># Change tx_info attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_tx_inf</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">new_name</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">old_name</span> <span class="k">else</span>
            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_tx_inf</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

        <span class="c1"># Change mouser_over_bts attribute</span>
        <span class="k">for</span> <span class="n">taxa</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_bts</span><span class="p">[</span><span class="s2">&quot;Taxa&quot;</span><span class="p">]</span>
                     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ToggleButton</span><span class="p">)]:</span>
            <span class="k">if</span> <span class="n">taxa</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="n">old_name</span><span class="p">:</span>
                <span class="n">taxa</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">new_name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sidepanel_clear_search</span><span class="p">(</span><span class="s2">&quot;taxa&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.export_names"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.export_names">[docs]</a>    <span class="k">def</span> <span class="nf">export_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export the names of buttons in the corresponding tab in the side</span>
<span class="sd">        panel It listens to the self.export_mode attribute, which is a</span>
<span class="sd">        tuple object with the first element being either &quot;file&quot; or &quot;taxa&quot;</span>
<span class="sd">        and the second element as &quot;all&quot; or &quot;selected&quot;.</span>

<span class="sd">        :param path: string. Path to the output file.</span>
<span class="sd">        :param file_name. Name of the output file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Create file object</span>
        <span class="n">export_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_mode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;files&quot;</span><span class="p">:</span>
            <span class="c1"># Export all files</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_mode</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
                <span class="n">fl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fl</span><span class="p">:</span>
                    <span class="n">short_name</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                    <span class="n">export_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">short_name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Export selected files</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_mode</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;selected&quot;</span><span class="p">:</span>
                <span class="n">fl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span> <span class="k">else</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_proteome_files</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fl</span><span class="p">:</span>
                    <span class="n">short_name</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                    <span class="n">export_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">short_name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_mode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;taxa&quot;</span><span class="p">:</span>
            <span class="c1"># Export all taxa</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_mode</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">taxa_names</span><span class="p">:</span>
                    <span class="n">export_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Export selected taxa</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_mode</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;selected&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span><span class="p">:</span>
                    <span class="n">export_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Close file handle</span>
        <span class="n">export_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Issue success message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;Successfully exported </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">export_mode</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_mode</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                               <span class="n">t</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.toggle_multi_selection"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.toggle_multi_selection">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_multi_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds multiple selection using shift+click for general purpose lists</span>
<span class="sd">        of toggle buttons in data set creator</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">get_selection</span><span class="p">(</span><span class="n">bt</span><span class="p">,</span> <span class="n">bt_list</span><span class="p">):</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_shift_pressed</span><span class="p">:</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_tb</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[</span><span class="n">bt</span><span class="p">]</span>

                <span class="c1"># For possible exceptions where prev_tb is not in button</span>
                <span class="c1"># list, return only the selected button and reset the prev_tb</span>
                <span class="c1"># attribute</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_tb</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bt_list</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prev_tb</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">return</span> <span class="p">[</span><span class="n">bt</span><span class="p">]</span>

                <span class="n">start</span> <span class="o">=</span> <span class="n">bt_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prev_tb</span><span class="p">)</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">bt_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">bt_list</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">bt_list</span><span class="p">[</span><span class="n">stop</span><span class="p">:</span><span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">bt</span><span class="p">]</span>

        <span class="c1"># Get the parent layout object</span>
        <span class="n">parent_obj</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">parent</span>

        <span class="n">bt_list</span> <span class="o">=</span> <span class="n">parent_obj</span><span class="o">.</span><span class="n">children</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">sel</span> <span class="o">=</span> <span class="n">get_selection</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">bt_list</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">bt</span> <span class="ow">in</span> <span class="n">sel</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;normal&quot;</span><span class="p">:</span>
                <span class="n">bt</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>

            <span class="k">elif</span> <span class="n">value</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span>
                <span class="n">bt</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>

        <span class="c1"># Update labels for data set creator dialog</span>
        <span class="c1"># Get dialog</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">TaxaGroupDialog</span><span class="p">):</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subpopup</span><span class="o">.</span><span class="n">content</span>

        <span class="k">if</span> <span class="n">parent_obj</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="n">lbl</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">all_lbl</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lbl</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">select_lbl</span>

        <span class="n">lbl</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> of </span><span class="si">{}</span><span class="s2"> selected&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bt_list</span> <span class="k">if</span>
                                                   <span class="n">x</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">]),</span>
                                              <span class="nb">len</span><span class="p">(</span><span class="n">bt_list</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prev_tb</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="TriFusionApp.sidepanel_invert_selection"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.sidepanel_invert_selection">[docs]</a>    <span class="k">def</span> <span class="nf">sidepanel_invert_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">panel</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        panel</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Set gridlayout and taxa/file list of the appropraite panel</span>
        <span class="k">if</span> <span class="n">panel</span> <span class="o">==</span> <span class="s2">&quot;Files&quot;</span><span class="p">:</span>
            <span class="n">grid_wgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_sl</span>
            <span class="n">lst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span>
            <span class="n">active_lst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span> \
                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_proteome_files</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">grid_wgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_sl</span>
            <span class="n">lst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">taxa_names</span>
            <span class="n">active_lst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span>

        <span class="c1"># Storage of active itens</span>
        <span class="n">active_items</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Invert selection and get the active elements</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">active_lst</span><span class="p">:</span>
                <span class="n">active_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="c1"># Update panel with new active elements</span>
        <span class="k">for</span> <span class="n">wgt</span> <span class="ow">in</span> <span class="n">grid_wgt</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>

            <span class="c1"># Get only toggle buttons</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wgt</span><span class="p">,</span> <span class="n">ToggleButton</span><span class="p">):</span>

                <span class="c1"># Get text. File togglebuttons have the basename of the</span>
                <span class="c1"># active list</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">[</span><span class="n">wgt</span><span class="o">.</span><span class="n">text</span><span class="p">]</span> <span class="k">if</span> <span class="n">panel</span> <span class="o">==</span> <span class="s2">&quot;Files&quot;</span> \
                    <span class="k">else</span> <span class="n">wgt</span><span class="o">.</span><span class="n">text</span>

                <span class="k">if</span> <span class="n">txt</span> <span class="ow">in</span> <span class="n">active_items</span><span class="p">:</span>
                    <span class="n">wgt</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>
                
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">wgt</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>

        <span class="c1"># Core changes to taxa</span>
        <span class="k">if</span> <span class="n">panel</span> <span class="o">==</span> <span class="s2">&quot;Taxa&quot;</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span> <span class="o">=</span> <span class="n">active_items</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_sp_label</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">panel</span> <span class="o">==</span> <span class="s2">&quot;Files&quot;</span><span class="p">:</span>

            <span class="c1"># Update when alignment files are loaded</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">:</span>

                <span class="c1"># update active file list</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span> <span class="o">=</span> <span class="n">active_items</span>

                <span class="c1"># Update AlignmentList object</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">update_active_alignments</span><span class="p">(</span>
                    <span class="n">active_items</span>
                <span class="p">)</span>
                
            <span class="c1"># Update when proteome files are loaded</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">active_proteome_files</span> <span class="o">=</span> <span class="n">active_items</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">update_file_label</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.toggle_selection"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.toggle_selection">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds functionality for the file and taxa toggle buttons in the side</span>
<span class="sd">        panel. It adds or removes the selected taxa from the active lists</span>

<span class="sd">        :param value: Button widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">get_selection</span><span class="p">(</span><span class="n">bt</span><span class="p">,</span> <span class="n">tab</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            To support multiple selection using shift+click,</span>
<span class="sd">            this function will return the list of buttons to be modified,</span>
<span class="sd">            even if it is a single one (when shift is not being pressed)</span>
<span class="sd">            :param bt: ToggleButton object from sidepanel</span>
<span class="sd">            :param tab: string, identifier of current tab. Either File,</span>
<span class="sd">            Taxa or Partitions</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_shift_pressed</span><span class="p">:</span>

                <span class="c1"># If there is no previous pressed button in the current</span>
                <span class="c1"># the behaviour is as if shift is not being pressed</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_sp_bt</span><span class="p">[</span><span class="n">tab</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="p">[</span><span class="n">bt</span><span class="p">]</span>

                <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_bts</span><span class="p">[</span><span class="n">tab</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_sp_bt</span><span class="p">[</span><span class="n">tab</span><span class="p">])</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_bts</span><span class="p">[</span><span class="n">tab</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_bts</span><span class="p">[</span><span class="n">tab</span><span class="p">][</span><span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_bts</span><span class="p">[</span><span class="n">tab</span><span class="p">][</span><span class="n">stop</span><span class="p">:</span><span class="n">start</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">bt</span><span class="p">]</span>

        <span class="c1"># Get the parent layout object</span>
        <span class="n">parent_obj</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">parent</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">touch</span><span class="o">.</span><span class="n">is_double_tap</span> <span class="ow">and</span> <span class="n">parent_obj</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_sl</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dialog_text</span><span class="p">(</span>
                <span class="s2">&quot;Change taxon name&quot;</span><span class="p">,</span> <span class="s2">&quot;change_taxon&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="c1"># determine active file list</span>
        <span class="n">act_lst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span> <span class="k">else</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">active_proteome_files</span>

        <span class="c1"># Changes concerning the files tab</span>
        <span class="k">if</span> <span class="n">parent_obj</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_sl</span><span class="p">:</span>

            <span class="n">sel</span> <span class="o">=</span> <span class="n">get_selection</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;Files&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">sel</span><span class="p">:</span>

                <span class="c1"># When button is normal (unselected) remove from active list</span>
                <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;normal&quot;</span><span class="p">:</span>

                    <span class="k">try</span><span class="p">:</span>

                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span><span class="p">:</span>
                            <span class="n">aln_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">update_active_alignment</span><span class="p">(</span>
                                <span class="n">aln_path</span><span class="p">,</span> <span class="s2">&quot;shelve&quot;</span><span class="p">)</span>

                        <span class="n">act_lst</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>
                        <span class="n">b</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>

                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">pass</span>

                <span class="c1"># When button is down (selected) add to active list</span>
                <span class="k">elif</span> <span class="n">value</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">act_lst</span><span class="p">:</span>

                        <span class="n">act_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>
                        <span class="n">b</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>

                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span><span class="p">:</span>
                            <span class="n">aln_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">update_active_alignment</span><span class="p">(</span>
                                <span class="n">aln_path</span><span class="p">,</span> <span class="s2">&quot;active&quot;</span><span class="p">)</span>

            <span class="c1"># Update label</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_file_label</span><span class="p">()</span>

            <span class="c1"># Update last pressed button</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_sp_bt</span><span class="p">[</span><span class="s2">&quot;Files&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># Changes concerning the taxa tab</span>
        <span class="k">elif</span> <span class="n">parent_obj</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_sl</span><span class="p">:</span>

            <span class="n">sel</span> <span class="o">=</span> <span class="n">get_selection</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;Taxa&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">sel</span><span class="p">:</span>
                <span class="c1"># When button is normal (unselected) remove from active list</span>
                <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;normal&quot;</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                        <span class="n">b</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="c1"># When button is down (selected) add to active</span>
                <span class="k">elif</span> <span class="n">value</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">text</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                        <span class="n">b</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>

            <span class="c1"># Update label</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_sp_label</span><span class="p">()</span>

            <span class="c1"># Update last pressed button</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_sp_bt</span><span class="p">[</span><span class="s2">&quot;Taxa&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">elif</span> <span class="n">parent_obj</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">partition_sl</span><span class="p">:</span>

            <span class="n">sel</span> <span class="o">=</span> <span class="n">get_selection</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;Partitions&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">sel</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;normal&quot;</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">active_partitions</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                        <span class="n">b</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">text</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_partitions</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">active_partitions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                        <span class="n">b</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>

            <span class="c1"># Update last pressed button</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_sp_bt</span><span class="p">[</span><span class="s2">&quot;Partitions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">update_partition_label</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.remove_all"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.remove_all">[docs]</a>    <span class="k">def</span> <span class="nf">remove_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Functionality for the remove all button for taxa and file buttons</span>
<span class="sd">        in the side panel. This method will remove all files and taxa</span>
<span class="sd">        from the program</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># App changes</span>
        <span class="c1"># Clear widgets in side panel</span>
        <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_sl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_sl</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">partition_sl</span><span class="p">]:</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sp_lab</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_lab</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">partition_lab</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count_files</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count_partitions</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clear_process_input</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_orto_input</span><span class="p">()</span>

        <span class="c1"># Add disabled no changes button</span>
        <span class="k">if</span> <span class="s2">&quot;file_temp&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_sl</span><span class="o">.</span><span class="n">children</span><span class="p">]:</span>
            <span class="n">no_bt</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;file_temp&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;No files loaded&quot;</span><span class="p">,</span>
                           <span class="n">size_hint_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="s2">&quot;file_temp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">no_bt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_sl</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">no_bt</span><span class="p">)</span>

        <span class="c1"># Add disabled no changes button</span>
        <span class="k">if</span> <span class="s2">&quot;species_temp&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_sl</span><span class="o">.</span><span class="n">children</span><span class="p">]:</span>
            <span class="n">no_bt</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;species_temp&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;No files loaded&quot;</span><span class="p">,</span>
                           <span class="n">size_hint_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="s2">&quot;species_temp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">no_bt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_sl</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">no_bt</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.clear_orto_input"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.clear_orto_input">[docs]</a>    <span class="k">def</span> <span class="nf">clear_orto_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears any input for the orthology screen and related variables and</span>
<span class="sd">        attributes</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_proteome_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orto_min_sp</span> <span class="o">=</span> <span class="mi">3</span></div>

<div class="viewcode-block" id="TriFusionApp.clear_process_input"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.clear_process_input">[docs]</a>    <span class="k">def</span> <span class="nf">clear_process_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears any input for the process/statistics screen and related</span>
<span class="sd">        variables and attributes</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Stop other background processes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terminate_stats</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terminate_background</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terminate_load_files</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Give time for processes to end</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">clear_alignments</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_tx_inf</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_tx_inf</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_file_inf</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_file_inf</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sequence_types</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MAX_FILE_BUTTON</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MAX_PARTITION_BUTTON</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_bts</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_bts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Files&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;Taxa&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;Partitions&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_sets</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Files&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;Taxa&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;Stats&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sp_taxa_bts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sp_file_bts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sp_partition_bts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_mouse_over</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_plt_idx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_plot</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_table</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conversion_suffix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gene_table_selection</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gene_master_table</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Clear Statistics screen scatter, if screen is active</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_stats_toggle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_stats_toggle</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Statistics&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">plot_content</span><span class="o">.</span><span class="n">children</span><span class="p">[</span>
                                  <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">NoDataLabel</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">plot_content</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">plot_content</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">NoDataLabel</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gene_num</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
                <span class="s2">&quot;Genes: [color=37abc8ff]N/A[/color]&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_num</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
                <span class="s2">&quot;Taxa: [color=37abc8ff]N/A[/color]&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loaded_screens</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">available_screens</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="TriFusionApp.remove_all_groups"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.remove_all_groups">[docs]</a>    <span class="k">def</span> <span class="nf">remove_all_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes all loaded orthology groups</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Clear gridlayout contents</span>
        <span class="k">for</span> <span class="n">gl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">orto_group_glbx</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">gl</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>

        <span class="c1"># Clear orthology cards</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">card_gl</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>

        <span class="c1"># Resets ortho_groups object</span>
        <span class="c1"># Formal clearing of ortho_groups and temporary files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="o">.</span><span class="n">clear_groups</span><span class="p">()</span>
        <span class="c1"># Resets the ortho_groups variable so that new loadings will start anew</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ortho_group_files</span> <span class="o">=</span> <span class="p">[]</span></div>
        <span class="c1">#self.proteome_files = []</span>

<div class="viewcode-block" id="TriFusionApp.remove_groups"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.remove_groups">[docs]</a>    <span class="k">def</span> <span class="nf">remove_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes orthology group buttons</span>
<span class="sd">        :param value: Instance of remove button</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Remove group from MultiGroup object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="o">.</span><span class="n">remove_group</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="c1"># Remove from ortho group file container</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ortho_group_files</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="c1"># If all groups have been removed, reset ortho_groups attribute</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ortho_group_files</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Get box container of all gridlayouts</span>
        <span class="n">gl_bx</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span>

        <span class="k">for</span> <span class="n">gl</span> <span class="ow">in</span> <span class="n">gl_bx</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="c1"># Remove appropriate item, according to id, from its gridlayout</span>
            <span class="n">gl</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">gl</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                              <span class="n">x</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">value</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># If no group button is active, dispatch the first</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_gl</span><span class="o">.</span><span class="n">children</span>
                <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_gl</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_gl</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s2">&quot;on_release&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_gl</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_gl</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">card_gl</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.remove_bt"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.remove_bt">[docs]</a>    <span class="k">def</span> <span class="nf">remove_bt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">parent_wgt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Functionality for the &quot;X&quot; remove buttons in the side panel. It</span>
<span class="sd">        removes button pairs with similar id&#39;s and can be used in both files</span>
<span class="sd">        and taxa tabs</span>
<span class="sd">        :param value: Button widget to be removed</span>
<span class="sd">        :param parent_wgt: Button widget contained. If provided, it</span>
<span class="sd">        overrides value.parent</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># APP CHANGES</span>
        <span class="c1"># Get the parent layout object from where the widget will be removed</span>
        <span class="k">if</span> <span class="n">parent_wgt</span><span class="p">:</span>
            <span class="n">parent_obj</span> <span class="o">=</span> <span class="n">parent_wgt</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parent_obj</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">parent</span>

        <span class="c1"># If the button is the last file or taxa element, issue a remove_all</span>
        <span class="k">if</span> <span class="n">parent_obj</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_sl</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parent_obj</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_all</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">parent_obj</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_sl</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parent_obj</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> \
                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">taxa_names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_all</span><span class="p">()</span>

        <span class="c1"># Get button widgets to be removed</span>
        <span class="n">bt_idx</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">id</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">inf_idx</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">id</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;?&quot;</span>
        <span class="n">c_idx</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">id</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;C&quot;</span>

        <span class="c1"># Remove button widgets (name button, info button and remove button)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">bt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parent_obj</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span> <span class="n">bt_idx</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">parent_obj</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>

            <span class="c1"># Removes reference to this file/taxa in button and mouse over</span>
            <span class="c1">#  vars</span>
            <span class="k">if</span> <span class="n">parent_obj</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_sl</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sp_file_bts</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_file_bts</span>
                                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="o">!=</span> <span class="n">bt</span><span class="o">.</span><span class="n">text</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_bts</span><span class="p">[</span><span class="s2">&quot;Files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">parent_obj</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_sl</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sp_taxa_bts</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp_taxa_bts</span>
                                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="o">!=</span> <span class="n">bt</span><span class="o">.</span><span class="n">text</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mouse_over_bts</span><span class="p">[</span><span class="s2">&quot;Taxa&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">inf_bt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parent_obj</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span> <span class="n">inf_idx</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">parent_obj</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">inf_bt</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cbt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parent_obj</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span> <span class="n">c_idx</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">parent_obj</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">cbt</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Remove widgets</span>
        <span class="n">parent_obj</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="c1"># CORE CHANGES</span>
        <span class="c1"># Get the parent tab</span>
        <span class="k">if</span> <span class="n">parent_obj</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_sl</span><span class="p">:</span>
            <span class="c1"># Set the update_taxa attribute to True so that it updates</span>
            <span class="c1"># the next time the taxa information is queried</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trigger_taxa_update</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># Update file list</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">[</span><span class="n">bt_idx</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">[</span><span class="n">bt_idx</span><span class="p">]</span>
            <span class="c1"># If alignment remove from file list</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                <span class="c1"># Update alignment object list</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">remove_file</span><span class="p">([</span><span class="n">file_path</span><span class="p">])</span>
            <span class="c1"># If proteome remove, from proteome file</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                <span class="c1"># In proteome files, if the total number of proteomes is lower</span>
                <span class="c1"># than the set min taxa representation filter, update the</span>
                <span class="c1"># filter</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">orto_min_sp</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">orto_min_sp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span><span class="p">)</span>
            <span class="c1"># Update active file list. If the file has been removed from the</span>
            <span class="c1"># active list, this will handle the exception</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_proteome_files</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1"># Update active taxa list. This must be executed before calling</span>
            <span class="c1"># self.get_taxa_information since this method relies on an</span>
            <span class="c1"># updated active taxa list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_taxa</span><span class="p">()</span>

            <span class="c1"># Updates the partition list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_partitions</span><span class="p">()</span>

            <span class="c1"># Updates labels</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_file_label</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_sp_label</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_partition_label</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">parent_obj</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_sl</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">remove_taxa</span><span class="p">([</span><span class="n">bt_idx</span><span class="p">])</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">bt_idx</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="c1"># Updates label</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_sp_label</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_process_input</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.remove_bt_from_selection"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.remove_bt_from_selection">[docs]</a>    <span class="k">def</span> <span class="nf">remove_bt_from_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">txt_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds functionality to the dropdown button options for removing file</span>
<span class="sd">        or taxa buttons contained in a text file</span>
<span class="sd">        :param idx: string, either &#39;Files&#39; or &#39;Taxa&#39;.</span>
<span class="sd">        :param txt_file: string, path to txt file containing the files/taxa</span>
<span class="sd">        names to be selected. If this is not provided, then the selected</span>
<span class="sd">        files/taxa will be removed instead</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span>

        <span class="n">selection</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">selection_idx</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Get sidepanel widget where items will be removed</span>
        <span class="n">wgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_sl</span> <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;Taxa&quot;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_sl</span>

        <span class="c1"># Grab selection from text file</span>
        <span class="k">if</span> <span class="n">txt_file</span><span class="p">:</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">txt_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fh</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">selection</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                        <span class="n">selection_idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;X&quot;</span><span class="p">)</span>

        <span class="c1"># Grab selection from selected items in the sidepanel</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span> <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;Taxa&quot;</span> <span class="k">else</span> \
                <span class="p">[</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span><span class="p">]</span>
            <span class="n">selection_idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="s2">&quot;X&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;Taxa&quot;</span><span class="p">:</span>
            <span class="n">missing_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">selection</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">taxa_names</span><span class="p">]</span>
            <span class="c1"># All taxa were selected, so remove all</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">taxa_names</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">]:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_all</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If a file does not exist in the app, add it here</span>
            <span class="n">missing_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">selection</span>
                                <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">]</span>
            <span class="c1"># All files were selected, so remove all</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">]:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_all</span><span class="p">()</span>

        <span class="c1"># Removes buttons from side panel. In the case of Files, some may</span>
        <span class="c1"># not be loaded as a button in the side panel (due to the limit</span>
        <span class="c1"># of 20 files by default). These files have to be removed from</span>
        <span class="c1"># other structures in the code below</span>
        <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">([(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">wgt</span><span class="o">.</span><span class="n">children</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">bt</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">selection_idx</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_bt</span><span class="p">(</span><span class="n">bt</span><span class="p">,</span> <span class="n">parent_wgt</span><span class="o">=</span><span class="n">wgt</span><span class="p">)</span>
                <span class="n">selection_idx</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">selection_idx</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">idx</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">:</span>
                <span class="c1"># Set the update_taxa attribute to True so that it updates</span>
                <span class="c1"># the next time the taxa information is queried</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trigger_taxa_update</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">[</span><span class="n">idx</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">[</span><span class="n">idx</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">remove_file</span><span class="p">([</span><span class="n">file_path</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_taxa</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_partitions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_file_label</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_sp_label</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_partition_label</span><span class="p">()</span>

        <span class="c1"># If some of the files did not exist in the app, issue a warning</span>
        <span class="k">if</span> <span class="n">missing_elements</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;Warning: </span><span class="si">{}</span><span class="s2"> items could not be removed &quot;</span>
                <span class="s2">&quot;because they were not loaded into the &quot;</span>
                <span class="s2">&quot;app&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">missing_elements</span><span class="p">)),</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.select_bt_from_file"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.select_bt_from_file">[docs]</a>    <span class="k">def</span> <span class="nf">select_bt_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">txt_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds functionality to the dropdown button options for selecting</span>
<span class="sd">        file or taxa buttons contained in a text file</span>
<span class="sd">        :param idx: string, either &#39;Files&#39; or &#39;Taxa&#39;.</span>
<span class="sd">        :param txt_file: string, path to txt file containing the files/taxa</span>
<span class="sd">        names to be selected</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span>

        <span class="n">selection</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">txt_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fh</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">selection</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;Taxa&quot;</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">bt</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_sl</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                       <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ToggleButton</span><span class="p">)]:</span>
                <span class="k">if</span> <span class="n">bt</span><span class="o">.</span><span class="n">text</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">:</span>
                    <span class="n">bt</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">bt</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">selection</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">taxa_names</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">update_sp_label</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;Files&quot;</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">bt</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_sl</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                       <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ToggleButton</span><span class="p">)]:</span>
                <span class="k">if</span> <span class="n">bt</span><span class="o">.</span><span class="n">text</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">:</span>
                    <span class="n">bt</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">bt</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">:</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                        <span class="n">selection</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">update_active_alignments</span><span class="p">(</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">selection</span> <span class="k">if</span>
                         <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">])</span>

                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span><span class="p">:</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">active_proteome_files</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                        <span class="n">selection</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">update_file_label</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.select_bt"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.select_bt">[docs]</a>    <span class="k">def</span> <span class="nf">select_bt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Functionality to the Select All/Deselect All buttons of the side</span>
<span class="sd">        panel. The method was made in such a way that it could be of general</span>
<span class="sd">        use for buttons in the files and taxa tabs</span>

<span class="sd">        :param value: Button widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sv_parent</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                     <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ScrollView</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># This will iterate over the first child of the parent scrollview.</span>
        <span class="c1"># Since scroll view only supports one child, this should be fine</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sv_parent</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="c1"># Skips the X buttons</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ToggleButton</span><span class="p">):</span>

                <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;Select All&quot;</span><span class="p">:</span>
                    <span class="c1"># App related action</span>
                    <span class="n">i</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>

                <span class="k">elif</span> <span class="n">value</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;Deselect All&quot;</span><span class="p">:</span>
                    <span class="c1"># App related action</span>
                    <span class="n">i</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>

        <span class="c1"># Core changes to files</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sv_parent</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sv_file</span> <span class="ow">and</span>
                <span class="n">value</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;Select All&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">[:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">update_active_alignments</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_proteome_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span><span class="p">[:]</span>

        <span class="c1"># Core changes to taxa</span>
        <span class="k">if</span> <span class="n">sv_parent</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sv_sp</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;Select All&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">taxa_names</span><span class="p">)</span>

        <span class="c1"># Core changes to files</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sv_parent</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sv_file</span> <span class="ow">and</span>
                <span class="n">value</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;Deselect All&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">update_active_alignments</span><span class="p">([])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_proteome_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Core changes to taxa</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sv_parent</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sv_sp</span> <span class="ow">and</span>
                <span class="n">value</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;Deselect All&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Core changes to partitions</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sv_parent</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sv_partition</span> <span class="ow">and</span>
                <span class="n">value</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;Select All&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_partitions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">partitions</span><span class="o">.</span><span class="n">partitions</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_partitions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">sv_parent</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sv_sp</span> <span class="ow">or</span> <span class="n">sv_parent</span> <span class="o">==</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sv_file</span><span class="p">):</span>
            <span class="c1"># Updates labels</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_sp_label</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_file_label</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_partition_label</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_dataset_creator"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_dataset_creator">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_dataset_creator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds_type</span><span class="p">,</span> <span class="n">popup_level</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a dialog to choose between creating a data set from a file</span>
<span class="sd">        or manually</span>

<span class="sd">        :param ds_type: string. Identifier of the data type. Can be either</span>
<span class="sd">        taxa or files</span>
<span class="sd">        :param popup_level: integer, The level of the dialog popup. Can be</span>
<span class="sd">        either 1 (creates _popup instance) or 2 (creates _subpopup instance)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">DataSetTriageDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ds_type</span> <span class="o">=</span> <span class="n">ds_type</span>
        <span class="n">content</span><span class="o">.</span><span class="n">popup_level</span> <span class="o">=</span> <span class="n">popup_level</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Choose data set group creation method&quot;</span><span class="p">,</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">360</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_taxagroup"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_taxagroup">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_taxagroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds_type</span><span class="p">,</span> <span class="n">popup_level</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the layout for the taxa group creation popup.</span>
<span class="sd">        :param ds_type: string. Data set type. It may be either &quot;taxa&quot; or</span>
<span class="sd">        &quot;files&quot;</span>
<span class="sd">        :param popup_level: integer, The level of the dialog popup. Can be</span>
<span class="sd">        either 1 (creates _popup instance) or 2 (creates _subpopup instance)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Initializing instance for taxa group dialog</span>
        <span class="k">if</span> <span class="n">popup_level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">TaxaGroupDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">TaxaGroupDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_subpopup</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ds_type</span> <span class="o">==</span> <span class="s2">&quot;taxa&quot;</span><span class="p">:</span>
            <span class="n">bt_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">taxa_names</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Create taxa groups&quot;</span>
            <span class="n">group_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taxa_groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bt_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">],</span>
                             <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Create file groups&quot;</span>
            <span class="n">group_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Reset previous button for multi selection support</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_tb</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Populate the gridlayout for all entries</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">bt_list</span><span class="p">:</span>
            <span class="c1"># Create togglebutton for each entry</span>
            <span class="n">bt</span> <span class="o">=</span> <span class="n">ToggleButton</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">size_hint_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_multi_selection</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_dataset_bt</span><span class="p">(</span><span class="n">bt</span><span class="p">,</span> <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">all_grid</span><span class="p">,</span> <span class="n">ds_type</span><span class="p">)</span>

        <span class="c1"># Populate created groups, if any</span>
        <span class="k">if</span> <span class="n">group_list</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_list</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">group_list</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">taxagroups_add_group</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_list</span><span class="p">,</span> <span class="n">ds_type</span><span class="p">)</span>

        <span class="n">content</span><span class="o">.</span><span class="n">ds_type</span> <span class="o">=</span> <span class="n">ds_type</span>

        <span class="c1"># Show dialog</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">900</span><span class="p">,</span> <span class="mi">600</span><span class="p">),</span>
                        <span class="n">popup_level</span><span class="o">=</span><span class="n">popup_level</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.add_dataset_bt"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.add_dataset_bt">[docs]</a>    <span class="k">def</span> <span class="nf">add_dataset_bt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bt</span><span class="p">,</span> <span class="n">wgt</span><span class="p">,</span> <span class="n">ds_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for addition of a button to a widget. This method was created</span>
<span class="sd">        for the automatic upated of the widgets height when moving buttons</span>
<span class="sd">        in the taxa group creation dialog</span>
<span class="sd">        :param bt: The button widget</span>
<span class="sd">        :param wgt: The sink widget</span>
<span class="sd">        :param ds_type: string. Data set type. It may be either &quot;taxa&quot; or</span>
<span class="sd">        &quot;files&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">ds_type</span> <span class="o">==</span> <span class="s2">&quot;taxa&quot;</span><span class="p">:</span>
            <span class="n">bt_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">taxa_names</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bt_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">],</span>
                             <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">wgt</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">,</span> <span class="n">bt_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
        <span class="n">wgt</span><span class="o">.</span><span class="n">height</span> <span class="o">+=</span> <span class="mi">30</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="TriFusionApp.remove_taxa_bt"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.remove_taxa_bt">[docs]</a>    <span class="k">def</span> <span class="nf">remove_taxa_bt</span><span class="p">(</span><span class="n">bt</span><span class="p">,</span> <span class="n">wgt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for addition of a button to a widget. This method was created</span>
<span class="sd">        for the automatic upated of the widgets height when moving buttons</span>
<span class="sd">        in the taxa group creation dialog</span>
<span class="sd">        :param bt: The button widget</span>
<span class="sd">        :param wgt: The source widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wgt</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>
        <span class="n">wgt</span><span class="o">.</span><span class="n">height</span> <span class="o">-=</span> <span class="mi">30</span></div>

<div class="viewcode-block" id="TriFusionApp.taxagroup_move_taxa"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.taxagroup_move_taxa">[docs]</a>    <span class="k">def</span> <span class="nf">taxagroup_move_taxa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_wgt</span><span class="p">,</span> <span class="n">sink_wgt</span><span class="p">,</span> <span class="n">all_taxa</span><span class="p">,</span> <span class="n">ds_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method that adds functionality to the addition/removal buttons</span>
<span class="sd">        (&lt;&lt;, &lt;, &gt;&gt;, &gt;) in the taxa group dialog.</span>
<span class="sd">        :param source_wgt: widget, the gridlayout from where the buttons</span>
<span class="sd">        will be moved</span>
<span class="sd">        :param sink_wgt: widget, the gridlayout to where buttons will be</span>
<span class="sd">        moved</span>
<span class="sd">        :param all_taxa: Boolean, if True its as if alsa taxa were selected</span>
<span class="sd">        to be moved</span>
<span class="sd">        :param ds_type: string. Data set type. It may be either &quot;taxa&quot; or</span>
<span class="sd">        &quot;files&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">ds_type</span> <span class="o">==</span> <span class="s2">&quot;taxa&quot;</span><span class="p">:</span>
            <span class="n">bt_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">taxa_names</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bt_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">],</span>
                             <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># In case all taxa are to be moved</span>
        <span class="k">if</span> <span class="n">all_taxa</span><span class="p">:</span>
            <span class="c1"># Ensures that only toggle buttons are moved</span>
            <span class="k">for</span> <span class="n">tx</span> <span class="ow">in</span> <span class="n">bt_list</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">bt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">source_wgt</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span> <span class="n">tx</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">text</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">remove_taxa_bt</span><span class="p">(</span><span class="n">bt</span><span class="p">,</span> <span class="n">source_wgt</span><span class="p">)</span>
                    <span class="n">bt</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_dataset_bt</span><span class="p">(</span><span class="n">bt</span><span class="p">,</span> <span class="n">sink_wgt</span><span class="p">,</span> <span class="n">ds_type</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># This workaround is used to add some buttons from the source</span>
            <span class="c1">#  to the sink widgets while maintaining their original</span>
            <span class="c1"># order. The z-index of widgets is not working quite as I</span>
            <span class="c1"># expected, so for now this will produce the desired behaviour</span>
            <span class="n">sink_bts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># Remove buttons from the sink widget and store their names into</span>
            <span class="c1"># a storage list</span>
            <span class="k">for</span> <span class="n">bt</span> <span class="ow">in</span> <span class="n">sink_wgt</span><span class="o">.</span><span class="n">children</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_taxa_bt</span><span class="p">(</span><span class="n">bt</span><span class="p">,</span> <span class="n">sink_wgt</span><span class="p">)</span>
                <span class="n">sink_bts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

            <span class="c1"># Gather the buttons from the source widget to be transferred</span>
            <span class="c1"># while removing them from the sink</span>
            <span class="k">for</span> <span class="n">bt</span> <span class="ow">in</span> <span class="n">source_wgt</span><span class="o">.</span><span class="n">children</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">bt</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">remove_taxa_bt</span><span class="p">(</span><span class="n">bt</span><span class="p">,</span> <span class="n">source_wgt</span><span class="p">)</span>
                    <span class="n">sink_bts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

            <span class="c1"># Add buttons to the sink widget in the desired order</span>
            <span class="k">for</span> <span class="n">tx</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sink_bts</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="n">bt</span> <span class="o">=</span> <span class="n">ToggleButton</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">tx</span><span class="p">,</span> <span class="n">size_hint_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
                <span class="n">bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_multi_selection</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_dataset_bt</span><span class="p">(</span><span class="n">bt</span><span class="p">,</span> <span class="n">sink_wgt</span><span class="p">,</span> <span class="n">ds_type</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.taxagroups_show_taxa"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.taxagroups_show_taxa">[docs]</a>    <span class="k">def</span> <span class="nf">taxagroups_show_taxa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_wgt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a popup listing the taxa included in a taxa group given by</span>
<span class="sd">        name</span>
<span class="sd">        :param name_wgt: widget, widget containing the name of the group as</span>
<span class="sd">        text</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Create root boxlayout</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">BoxLayout</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="c1"># Create scroll view in which the gridlayout will be inserted</span>
        <span class="n">sv</span> <span class="o">=</span> <span class="n">ScrollView</span><span class="p">(</span><span class="n">bar_width</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scroll_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;bars&quot;</span><span class="p">])</span>
        <span class="c1"># Create close button for the popup</span>
        <span class="n">close_bt</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Close&quot;</span><span class="p">,</span> <span class="n">size_hint_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
            <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">background_normal</span><span class="o">=</span><span class="s2">&quot;data/backgrounds/bt_process.png&quot;</span><span class="p">,</span>
            <span class="n">bakcground_down</span><span class="o">=</span><span class="s2">&quot;data/backgrounds/bt_process_off.png&quot;</span><span class="p">)</span>
        <span class="c1"># Add functionality to the close button</span>
        <span class="n">close_bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>
        <span class="c1"># Create gridlayout that will store the buttons with taxa names</span>
        <span class="n">gl</span> <span class="o">=</span> <span class="n">GridLayout</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size_hint_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># Get ds_type</span>
        <span class="n">parent_wgt</span> <span class="o">=</span> <span class="n">name_wgt</span><span class="o">.</span><span class="n">parent</span>

        <span class="c1"># If its taxa data set</span>
        <span class="k">if</span> <span class="n">parent_wgt</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_group_grid</span><span class="p">:</span>
            <span class="n">bt_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">taxa_groups</span><span class="p">[</span><span class="n">name_wgt</span><span class="o">.</span><span class="n">text</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bt_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_groups</span><span class="p">[</span><span class="n">name_wgt</span><span class="o">.</span><span class="n">text</span><span class="p">]</span>

        <span class="c1"># Create buttons</span>
        <span class="k">for</span> <span class="n">tx</span> <span class="ow">in</span> <span class="n">bt_list</span><span class="p">:</span>
            <span class="n">bt</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">tx</span><span class="p">,</span> <span class="n">size_hint_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">gl</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>
            <span class="n">gl</span><span class="o">.</span><span class="n">height</span> <span class="o">+=</span> <span class="mi">35</span>

        <span class="c1"># Create widget tree</span>
        <span class="n">sv</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">gl</span><span class="p">)</span>
        <span class="n">content</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">sv</span><span class="p">)</span>
        <span class="n">content</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">close_bt</span><span class="p">)</span>

        <span class="c1"># Show dialog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Taxa group: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">name_wgt</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.remove_taxa_group"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.remove_taxa_group">[docs]</a>    <span class="k">def</span> <span class="nf">remove_taxa_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rm_wgt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes the data set group button from the app list and</span>
<span class="sd">        corresponding data set group attribute</span>
<span class="sd">        :param rm_wgt: widget, widget of the removal button</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Remove from app</span>
        <span class="n">parent_wgt</span> <span class="o">=</span> <span class="n">rm_wgt</span><span class="o">.</span><span class="n">parent</span>

        <span class="n">bt_idx</span> <span class="o">=</span> <span class="n">rm_wgt</span><span class="o">.</span><span class="n">id</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">bt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parent_wgt</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span> <span class="n">bt_idx</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">parent_wgt</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>
            <span class="n">parent_wgt</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">rm_wgt</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">bt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parent_wgt</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span> <span class="n">bt_idx</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">text</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># Remove from the dataset dialog</span>
            <span class="n">parent_wgt</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>
            <span class="n">parent_wgt</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">rm_wgt</span><span class="p">)</span>
            <span class="c1"># Remove from the sidepanel</span>
            <span class="k">if</span> <span class="n">parent_wgt</span><span class="o">.</span><span class="n">ds</span> <span class="o">==</span> <span class="s2">&quot;taxa&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_group_grid</span><span class="o">.</span><span class="n">children</span>
                          <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">rm_wgt</span><span class="o">.</span><span class="n">id</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">bt_idx</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_group_grid</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_group_grid</span><span class="o">.</span><span class="n">children</span>
                          <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">rm_wgt</span><span class="o">.</span><span class="n">id</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">bt_idx</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_group_grid</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="c1"># Remove from program attribute</span>
        <span class="k">if</span> <span class="n">parent_wgt</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_group_grid</span> <span class="ow">or</span> \
                <span class="n">parent_wgt</span><span class="o">.</span><span class="n">ds</span> <span class="o">==</span> <span class="s2">&quot;taxa&quot;</span><span class="p">:</span>
            <span class="c1"># Remove group from core attribute</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">taxa_groups</span><span class="p">[</span><span class="n">bt_idx</span><span class="p">]</span>
            <span class="c1"># Remove button from dropdown menu</span>
            <span class="c1"># Since the children of a dropdown widget are a gridlayout and</span>
            <span class="c1"># not the actual buttons contained in the dropdown menu,</span>
            <span class="c1"># this will search for the children of the gridlayout</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_dropdown</span><span class="o">.</span>
                      <span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="n">bt_idx</span><span class="p">]:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_dropdown</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="c1"># Remove button from sidepanel</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_group_grid</span><span class="o">.</span><span class="n">children</span>
                      <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="n">bt_idx</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_group_grid</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parent_wgt</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_group_grid</span> <span class="ow">or</span> \
                <span class="n">parent_wgt</span><span class="o">.</span><span class="n">ds</span> <span class="o">==</span> <span class="s2">&quot;files&quot;</span><span class="p">:</span>
            <span class="c1"># Remove group from core attribute</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_groups</span><span class="p">[</span><span class="n">bt_idx</span><span class="p">]</span>
            <span class="c1"># Remove button from dropdown menu</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_dropdown</span><span class="o">.</span>
                      <span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="n">bt_idx</span><span class="p">]:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_dropdown</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="c1"># Remove button from sidepanel</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_group_grid</span><span class="o">.</span><span class="n">children</span>
                      <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="n">bt_idx</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_group_grid</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">i</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.taxagroups_add_group"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.taxagroups_add_group">[docs]</a>    <span class="k">def</span> <span class="nf">taxagroups_add_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">wgt</span><span class="p">,</span> <span class="n">ds_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a dataset button, and corresponding removal button, to the</span>
<span class="sd">        group list gridlayut of the Dataset dialog.</span>
<span class="sd">        :param name: string, name of the group</span>
<span class="sd">        :param wgt: GridLayout widget where the buttons will be added</span>
<span class="sd">        :param ds_type: string, dataset type, whether &#39;taxa&#39; or &#39;files&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">bt</span> <span class="o">=</span> <span class="n">ShortenToggleButton</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">size_hint_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
            <span class="n">state</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span> <span class="n">disabled_color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="n">bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_groups</span><span class="p">)</span>
        <span class="n">bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">taxagroups_display_group</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>
                                                                   <span class="n">ds_type</span><span class="p">))</span>
        <span class="n">rm_bt</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">X&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">border</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">background_normal</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span> <span class="s2">&quot;remove_bt.png&quot;</span><span class="p">),</span>
            <span class="n">background_down</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;remove_bt_down.png&quot;</span><span class="p">))</span>

        <span class="n">rm_bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_action</span><span class="p">,</span>
            <span class="s2">&quot;Are you sure you want to remove this group?&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_taxa_group</span><span class="p">,</span>
            <span class="n">popup_level</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

        <span class="n">wgt</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>
        <span class="n">wgt</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">rm_bt</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.taxagroups_display_group"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.taxagroups_display_group">[docs]</a>    <span class="k">def</span> <span class="nf">taxagroups_display_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ds_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gives functionality to the group buttons in the dataset dialog. It</span>
<span class="sd">        displays the group constitution in the dialog</span>
<span class="sd">        :param name:</span>
<span class="sd">        :param ds_type:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get dataset dialog</span>
        <span class="n">root_wgts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span>
        <span class="k">if</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">root_wgts</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Popup</span><span class="p">)]:</span>
            <span class="n">dataset_wgt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">root_wgts</span> <span class="k">if</span>
                           <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Popup</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">content</span>
        <span class="k">elif</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">root_wgts</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CustomPopup</span><span class="p">)]:</span>
            <span class="n">dataset_wgt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">root_wgts</span> <span class="k">if</span>
                           <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CustomPopup</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">content</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dataset_wgt</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Reset dataset creator source and sink gridlayouts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">taxagroup_move_taxa</span><span class="p">(</span><span class="n">dataset_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">select_grid</span><span class="p">,</span>
                                 <span class="n">dataset_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">all_grid</span><span class="p">,</span>
                                 <span class="kc">True</span><span class="p">,</span>
                                 <span class="n">dataset_wgt</span><span class="o">.</span><span class="n">ds_type</span><span class="p">)</span>

        <span class="c1"># Get group names list</span>
        <span class="k">if</span> <span class="n">ds_type</span> <span class="o">==</span> <span class="s2">&quot;taxa&quot;</span><span class="p">:</span>
            <span class="n">group_lst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">taxa_groups</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">group_lst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_groups</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="c1"># Display group in the selected gridlayout</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">group_lst</span><span class="p">:</span>
            <span class="n">bt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dataset_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">all_grid</span><span class="o">.</span><span class="n">children</span>
                  <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">text</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_taxa_bt</span><span class="p">(</span><span class="n">bt</span><span class="p">,</span> <span class="n">dataset_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">all_grid</span><span class="p">)</span>
            <span class="n">bt</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_dataset_bt</span><span class="p">(</span><span class="n">bt</span><span class="p">,</span> <span class="n">dataset_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">select_grid</span><span class="p">,</span> <span class="n">ds_type</span><span class="p">)</span>

        <span class="c1"># Change dataset group name in the dialog</span>
        <span class="n">dataset_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_name</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">name</span></div>

<div class="viewcode-block" id="TriFusionApp.save_dataset_group"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.save_dataset_group">[docs]</a>    <span class="k">def</span> <span class="nf">save_dataset_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_wgt</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ds_type</span><span class="p">,</span>
                           <span class="n">group_file</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a taxa group declared using the taxa group creator popup to the</span>
<span class="sd">        list of taxa groups in the side panel</span>
<span class="sd">        :param source_wgt, gridlayout of the selected items</span>
<span class="sd">        :param name: string, name of the group</span>
<span class="sd">        :param ds_type: string. Data set type. It may be either &quot;taxa&quot; or</span>
<span class="sd">        &quot;files&quot;</span>
<span class="sd">        :param group_file: boolean, If True get the group items from the</span>
<span class="sd">        self.dataset_file file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Determine if the Dataset dialog is still active</span>
        <span class="n">root_wgts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span>
        <span class="k">if</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">root_wgts</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Popup</span><span class="p">)]:</span>
            <span class="n">dataset_wgt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">root_wgts</span> <span class="k">if</span>
                           <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Popup</span><span class="p">)][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">content</span>
        <span class="k">elif</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">root_wgts</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CustomPopup</span><span class="p">)]:</span>
            <span class="n">dataset_wgt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">root_wgts</span> <span class="k">if</span>
                           <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CustomPopup</span><span class="p">)][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">content</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dataset_wgt</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># This resets the dataset_wgt if its not the correct instance. This</span>
        <span class="c1"># happens, for example, when setting data set from file</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_wgt</span><span class="p">,</span> <span class="n">TaxaGroupDialog</span><span class="p">):</span>
            <span class="n">dataset_wgt</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">ds_type</span> <span class="o">==</span> <span class="s2">&quot;taxa&quot;</span><span class="p">:</span>
            <span class="c1"># Make core changes by populating self.taxa_groups dictionary</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">taxa_groups</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">group_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">taxa_groups</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="c1"># This list will be used to ensure that when groups are provided</span>
            <span class="c1"># via text file, only compliant entries are saved</span>
            <span class="n">check_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">taxa_names</span>
            <span class="c1"># Set the grid layout where the group button is to be added</span>
            <span class="n">grid_layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_group_grid</span>
            <span class="c1"># Set the current dataset group as default for taxa filter if</span>
            <span class="c1"># it has not been defined</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">taxa_filter_settings</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Make core changes by populating self.file_groups dictionary</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_groups</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">group_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_groups</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="c1"># This list will be used to ensure that when groups are provided</span>
            <span class="c1"># via text file, only compliant entries are saved</span>
            <span class="n">check_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="c1"># Set the grid layout where the group button is to be added</span>
            <span class="n">grid_layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_group_grid</span>

        <span class="k">if</span> <span class="n">group_file</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fh</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="n">check_list</span><span class="p">:</span>
                        <span class="n">group_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">bt</span> <span class="ow">in</span> <span class="n">source_wgt</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">group_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="c1"># If dataset dialog is still active, add the new group</span>
        <span class="k">if</span> <span class="n">dataset_wgt</span><span class="p">:</span>

            <span class="c1"># Remove original button when not groups have been previously</span>
            <span class="c1"># added</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_list</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">dataset_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_list</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>

            <span class="c1"># Add group button to layout</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                            <span class="n">dataset_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_list</span><span class="o">.</span><span class="n">children</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">taxagroups_add_group</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">dataset_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_list</span><span class="p">,</span>
                                          <span class="n">ds_type</span><span class="p">)</span>

            <span class="c1"># Reset dataset creator source and sink gridlayouts</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">taxagroup_move_taxa</span><span class="p">(</span><span class="n">dataset_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">select_grid</span><span class="p">,</span>
                                     <span class="n">dataset_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">all_grid</span><span class="p">,</span>
                                     <span class="kc">True</span><span class="p">,</span>
                                     <span class="n">dataset_wgt</span><span class="o">.</span><span class="n">ds_type</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">bt</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dataset_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_list</span><span class="o">.</span><span class="n">children</span>
                       <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">TGToggleButton</span><span class="p">)]:</span>
                <span class="n">bt</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
                <span class="n">bt</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># App changes by adding two buttons for the taxa group</span>
        <span class="c1"># Taxa button itself</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">grid_layout</span><span class="o">.</span><span class="n">children</span><span class="p">]:</span>
            <span class="n">bt</span> <span class="o">=</span> <span class="n">ShortenButton</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">size_hint_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                     <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
            <span class="n">bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">taxagroups_show_taxa</span><span class="p">)</span>
            <span class="c1"># Removal button</span>
            <span class="n">x_bt</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                          <span class="n">border</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">X&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span>
                          <span class="n">background_normal</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                                 <span class="s2">&quot;remove_bt.png&quot;</span><span class="p">))</span>
            <span class="n">x_bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_action</span><span class="p">,</span>
                                         <span class="s2">&quot;Are you sure you want to remove this&quot;</span>
                                         <span class="s2">&quot; group?&quot;</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">remove_taxa_group</span><span class="p">))</span>

            <span class="c1"># Add buttons to gridlayout</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">bt</span><span class="p">,</span> <span class="n">x_bt</span><span class="p">]:</span>
                <span class="n">grid_layout</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">i</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.projects_init"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.projects_init">[docs]</a>    <span class="k">def</span> <span class="nf">projects_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the projects attribute</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projects_file</span><span class="p">):</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projects_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">projects_fh</span><span class="p">:</span>
                <span class="c1"># Attempts to read the projects file. If the file is</span>
                <span class="c1"># somewhat corrupted, remove it and issue a warning</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">projects_dic</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">projects_fh</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projects_file</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">projects_init</span><span class="p">()</span>
                <span class="c1"># Get ordered dict</span>
                <span class="n">projects_dic</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">projects_dic</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
                                                  <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                                                 <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>

                <span class="c1"># Populate sidepanel</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">projects_dic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">project_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">project_grid</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_project_bt</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">project_grid</span><span class="p">)</span>

                    <span class="c1"># Populates main screen if active</span>
                    <span class="k">if</span> <span class="s2">&quot;home_projects_grid&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="p">:</span>
                        <span class="n">project_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">home_projects_grid</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">add_project_bt</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                            <span class="n">project_grid</span><span class="p">)</span>

        <span class="c1"># This handles cases where the projects file has</span>
        <span class="c1"># not been populated yet</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">projects_dic</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projects_file</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">projects_fh</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">projects_dic</span><span class="p">,</span> <span class="n">projects_fh</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.save_project"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.save_project">[docs]</a>    <span class="k">def</span> <span class="nf">save_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the current alignment_list or proteome_list for quick access</span>
<span class="sd">        to the data sets. It automatically detects whether the current</span>
<span class="sd">        data set is from the orthology or process modules.</span>

<span class="sd">        :param name: string, name of the project</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get projects var</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projects_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">projects_fh</span><span class="p">:</span>
            <span class="n">projects_dic</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">projects_fh</span><span class="p">)</span>

        <span class="c1"># Check for project name duplicates</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">projects_dic</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                <span class="s2">&quot;Project with the same name is already present&quot;</span><span class="p">,</span>
                <span class="n">t</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projects_file</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">projects_fh</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">:</span>
                <span class="n">projects_dic</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">,</span> <span class="s2">&quot;process&quot;</span><span class="p">]</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">projects_dic</span><span class="p">,</span> <span class="n">projects_fh</span><span class="p">)</span>
                <span class="n">ds_type</span> <span class="o">=</span> <span class="s2">&quot;process&quot;</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">projects_dic</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span><span class="p">,</span> <span class="s2">&quot;orthology&quot;</span><span class="p">]</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">projects_dic</span><span class="p">,</span> <span class="n">projects_fh</span><span class="p">)</span>
                <span class="n">ds_type</span> <span class="o">=</span> <span class="s2">&quot;orthology&quot;</span>

        <span class="n">project_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">project_grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_project_bt</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">),</span> <span class="n">ds_type</span><span class="p">,</span>
                            <span class="n">project_grid</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;home_projects_grid&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="p">:</span>
            <span class="n">project_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">home_projects_grid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_project_bt</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">),</span> <span class="n">ds_type</span><span class="p">,</span>
                                <span class="n">project_grid</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.add_project_bt"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.add_project_bt">[docs]</a>    <span class="k">def</span> <span class="nf">add_project_bt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">file_num</span><span class="p">,</span> <span class="n">ds_type</span><span class="p">,</span> <span class="n">grid_wgt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrapper that adds a project button to the sidepanel</span>
<span class="sd">        :param name: string, name of the project</span>
<span class="sd">        :param file_num: int, number of files associated with project</span>
<span class="sd">        :param ds_type: string, type of dataset. Can be either &#39;orthology&#39;</span>
<span class="sd">        or &#39;process&#39;</span>
<span class="sd">        :param grid_wgt: GridLayut widget where the project is to be added</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid_wgt</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">grid_wgt</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ds_type</span> <span class="o">==</span> <span class="s2">&quot;orthology&quot;</span><span class="p">:</span>
            <span class="n">ds_bt</span> <span class="o">=</span> <span class="n">ProjectOrtoBt</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ds_bt</span> <span class="o">=</span> <span class="n">ProjectProcBt</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

        <span class="n">bt</span> <span class="o">=</span> <span class="n">TFButton</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">size_hint_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="nb">id</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Set markup message for project name</span>
        <span class="n">msg1</span> <span class="o">=</span> <span class="s2">&quot;[b][color=ccccccff]Project name:[/color][/b] </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">name</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">))</span>

        <span class="c1"># Set markup message for number of files</span>
        <span class="n">msg2</span> <span class="o">=</span> <span class="s2">&quot;[b][color=ccccccff]Number of files:[/color][/b] </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">file_num</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">ds_bt</span> <span class="o">==</span> <span class="s2">&quot;orthology&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_action</span><span class="p">,</span>
                <span class="p">[</span><span class="n">msg1</span><span class="p">,</span> <span class="n">msg2</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">open_project</span><span class="p">,</span>
                <span class="o">**</span><span class="p">{</span><span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">name</span><span class="p">],</span>
                   <span class="s2">&quot;check_wgt&quot;</span><span class="p">:</span> <span class="n">CheckProject</span><span class="p">}))</span>

        <span class="n">rm_bt</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">35</span><span class="p">),</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">background_normal</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                   <span class="s2">&quot;remove_bt35.png&quot;</span><span class="p">),</span>
            <span class="n">background_down</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;remove_bt35_down.png&quot;</span><span class="p">))</span>
        <span class="n">rm_bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_action</span><span class="p">,</span>
            <span class="s2">&quot;Are you sure you want to remove this project?&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_project</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ds_bt</span><span class="p">,</span> <span class="n">bt</span><span class="p">,</span> <span class="n">rm_bt</span><span class="p">]:</span>
            <span class="n">grid_wgt</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">i</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.remove_project"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.remove_project">[docs]</a>    <span class="k">def</span> <span class="nf">remove_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wgt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gives functionality to the remove project button</span>
<span class="sd">        :param wgt: remove button</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Remove from projects file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projects_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">project_fh</span><span class="p">:</span>
            <span class="n">project_dic</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">project_fh</span><span class="p">)</span>

        <span class="k">del</span> <span class="n">project_dic</span><span class="p">[</span><span class="n">wgt</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projects_file</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">project_fh</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">project_dic</span><span class="p">,</span> <span class="n">project_fh</span><span class="p">)</span>

        <span class="c1"># Remove from sidepanel</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">bt</span> <span class="k">for</span> <span class="n">bt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">project_grid</span><span class="o">.</span><span class="n">children</span>
                  <span class="k">if</span> <span class="n">bt</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">wgt</span><span class="o">.</span><span class="n">id</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">project_grid</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">project_grid</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">project_grid</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">Button</span><span class="p">(</span>
                <span class="n">text</span><span class="o">=</span><span class="s2">&quot;No Saved Projects&quot;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">size_hint_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="mi">35</span><span class="p">))</span>

        <span class="c1"># Remove from home screen, if present</span>
        <span class="k">if</span> <span class="s2">&quot;home_projects_grid&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">bt</span> <span class="k">for</span> <span class="n">bt</span> <span class="ow">in</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">home_projects_grid</span><span class="o">.</span><span class="n">children</span>
                      <span class="k">if</span> <span class="n">bt</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">wgt</span><span class="o">.</span><span class="n">id</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">home_projects_grid</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">home_projects_grid</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">home_projects_grid</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">Button</span><span class="p">(</span>
                    <span class="n">text</span><span class="o">=</span><span class="s2">&quot;No Saved Projects&quot;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">size_hint_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">35</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.open_project"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.open_project">[docs]</a>    <span class="k">def</span> <span class="nf">open_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closes the current data set and opens the project identified by name</span>
<span class="sd">        :param name: string, name of the project</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projects_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">projects_fh</span><span class="p">:</span>
            <span class="n">project_dic</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">projects_fh</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">project_dic</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">project_dic</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;process&quot;</span><span class="p">:</span>
                <span class="c1"># Closes current data sets</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_all</span><span class="p">()</span>
                <span class="c1"># Check if files are present</span>
                <span class="k">if</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">project_dic</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">)]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;Some project &quot;</span>
                        <span class="s2">&quot;files no longer exist&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">)</span>
                <span class="c1"># Opens new dataset</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_files_subproc</span><span class="p">(</span><span class="n">project_dic</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">project_dic</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;orthology&quot;</span><span class="p">:</span>
                <span class="c1"># Closes current data sets</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_all</span><span class="p">()</span>
                <span class="c1"># Opens new data set</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_proteomes</span><span class="p">(</span><span class="n">project_dic</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="TriFusionApp.more_stats_table_bts"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.more_stats_table_bts">[docs]</a>    <span class="k">def</span> <span class="nf">more_stats_table_bts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Increases the MAX_TABLE_N attribute by 50 and adds more buttons</span>
<span class="sd">        to the summary statistics gene table view</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get results</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;table.pc&quot;</span><span class="p">),</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>

        <span class="c1"># Remove previous bt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_table</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">table_grid</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stats_table</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">table_grid</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># If the current table has a search operation performed, show more</span>
        <span class="c1"># lines from that searched table. If not, show more from the original</span>
        <span class="c1"># table</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gene_table_selection</span><span class="p">):</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gene_table_selection</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gene_table</span>

        <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_TABLE_N</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MAX_TABLE_N</span> <span class="o">+=</span> <span class="mi">25</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">search_add_gene_table_line</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.statistics_show_summary"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.statistics_show_summary">[docs]</a>    <span class="k">def</span> <span class="nf">statistics_show_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tp</span><span class="o">=</span><span class="s2">&quot;stats&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a subprocess for calculating summary statistics for the</span>
<span class="sd">        curently acitve data set. It will show either stats or table</span>
<span class="sd">        mode, depending on the option provided in the &#39;t&#39; argument.</span>
<span class="sd">        :param force: Bool, Clear all widgets from Stats scatter and show</span>
<span class="sd">        summary</span>
<span class="sd">        :param tp: string, Show overall summary statistics (&#39;stats&#39;) or</span>
<span class="sd">        summary statistics for each gene in table view (&#39;table&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">prepare_display</span><span class="p">(</span><span class="n">plt_wgt</span><span class="p">,</span> <span class="n">scatter</span><span class="p">):</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Statistics&quot;</span><span class="p">:</span>
                <span class="c1"># Clear main widget</span>
                <span class="n">plt_wgt</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>

                <span class="c1"># Remove any potential widgets associated with stats plots</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">footer_box</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_stats_toggle</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_plot_wgt</span><span class="p">()</span>

                <span class="c1"># Remove any potential widgets associated with stats plots</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">footer_box</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_stats_toggle</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_plot_wgt</span><span class="p">()</span>

                <span class="c1"># Disable scale, translation and rotation of scatter</span>
                <span class="n">scatter</span><span class="o">.</span><span class="n">do_scale</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">scatter</span><span class="o">.</span><span class="n">do_translation</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">scatter</span><span class="o">.</span><span class="n">do_rotation</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">scatter</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">scatter</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

        <span class="k">def</span> <span class="nf">display_stats</span><span class="p">(</span><span class="n">plt_wgt</span><span class="p">):</span>

            <span class="c1"># Get results</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;stats.pc&quot;</span><span class="p">),</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
                <span class="n">stats</span><span class="p">,</span> <span class="n">table</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>

            <span class="c1"># Check for exceptions</span>
            <span class="k">if</span> <span class="s2">&quot;exception&quot;</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;exception&quot;</span><span class="p">],</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

            <span class="c1"># Populate cards content</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats_summary</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">v</span>

            <span class="c1"># Add stats widget if in Screen</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Statistics&quot;</span><span class="p">:</span>
                <span class="n">plt_wgt</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats_summary</span><span class="p">)</span>

            <span class="c1"># Set table attribute</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_table</span> <span class="o">=</span> <span class="n">table</span>

        <span class="k">def</span> <span class="nf">display_table</span><span class="p">(</span><span class="n">plt_wgt</span><span class="p">):</span>

            <span class="c1"># Force statistics side panel close</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggle_stats_panel</span><span class="p">(</span><span class="n">force_close</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Clear Table grid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stats_table</span> <span class="o">=</span> <span class="n">GeneTable</span><span class="p">()</span>

            <span class="c1"># Get results</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;table.pc&quot;</span><span class="p">),</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
                <span class="n">table</span><span class="p">,</span> <span class="n">td</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>

            <span class="c1"># Check for exceptions</span>
            <span class="k">if</span> <span class="s2">&quot;exception&quot;</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;exception&quot;</span><span class="p">],</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

            <span class="c1"># Issue warning for large data sets</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;Large number of genes to &quot;</span>
                    <span class="s2">&quot;display. Showing first 50 for now. For larger data &quot;</span>
                    <span class="s2">&quot;sets it is recommended to use the &#39;export table&#39; &quot;</span>
                    <span class="s2">&quot;option&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span> <span class="n">dl</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">search_add_gene_table_line</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>

            <span class="c1"># Add Table widget if in screen</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Statistics&quot;</span><span class="p">:</span>
                <span class="n">plt_wgt</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats_table</span><span class="p">)</span>

            <span class="c1"># Set table attribute</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_table</span> <span class="o">=</span> <span class="n">td</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gene_table</span> <span class="o">=</span> <span class="n">table</span>

        <span class="k">def</span> <span class="nf">check_process</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ldg_wgt</span><span class="p">,</span> <span class="n">plt_wgt</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">ldg</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ns</span><span class="o">.</span><span class="n">counter</span><span class="p">,</span> <span class="n">ns</span><span class="o">.</span><span class="n">files</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1"># KILL SWITCH. Terminating thread by user</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminate_stats</span><span class="p">:</span>

                <span class="c1"># Unschedule the current function</span>
                <span class="n">Clock</span><span class="o">.</span><span class="n">unschedule</span><span class="p">(</span><span class="n">check_func</span><span class="p">)</span>

                <span class="c1"># Issuing the kill order to the child thread. This signal</span>
                <span class="c1"># will propagate through the worker&#39;s methods and graciously</span>
                <span class="c1"># terminate</span>
                <span class="n">ns</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># Clear the loading widgets of the Statistics screen</span>
                <span class="n">plt_wgt</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
                <span class="n">plt_wgt</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">NoDataLabel</span><span class="p">())</span>

                <span class="c1"># Remove lock from get_summary_stats method, so that this</span>
                <span class="c1"># method can be repeated</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lock_stats</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="c1"># Shutting down manager that provides communication between</span>
                <span class="c1"># parent and child thread</span>
                <span class="n">manager</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

                <span class="c1"># Join child process and exit</span>
                <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="c1"># Provides animation for loading widget</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_screen</span> <span class="o">==</span> <span class="s2">&quot;Statistics&quot;</span><span class="p">:</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">stats_panel</span><span class="o">.</span><span class="n">width</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">stats_panel</span><span class="o">.</span><span class="n">width</span> <span class="o">==</span> <span class="mi">410</span><span class="p">:</span>

                    <span class="c1"># Sets animation speed</span>
                    <span class="n">ldg_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">rotation</span> <span class="o">-=</span> <span class="mi">10</span>

            <span class="c1"># When worker has finished</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>

                <span class="c1"># Set the previous sets as the ones that just finished without</span>
                <span class="c1"># errors</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">previous_sets</span><span class="p">[</span><span class="s2">&quot;Stats&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">file_set</span><span class="p">,</span> <span class="n">taxa_set</span><span class="p">]</span>

                <span class="c1"># Display stats depending on the type</span>
                <span class="n">prepare_display</span><span class="p">(</span><span class="n">plt_wgt</span><span class="p">,</span> <span class="n">scatter_wgt</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tp</span> <span class="o">==</span> <span class="s2">&quot;stats&quot;</span><span class="p">:</span>
                    <span class="n">display_stats</span><span class="p">(</span><span class="n">plt_wgt</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">tp</span> <span class="o">==</span> <span class="s2">&quot;table&quot;</span><span class="p">:</span>
                    <span class="n">display_table</span><span class="p">(</span><span class="n">plt_wgt</span><span class="p">)</span>

                <span class="c1"># Unschedule the current function</span>
                <span class="n">Clock</span><span class="o">.</span><span class="n">unschedule</span><span class="p">(</span><span class="n">check_func</span><span class="p">)</span>

                <span class="c1"># Shutting down manager that provides communication between</span>
                <span class="c1"># parent and child thread</span>
                <span class="n">manager</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

                <span class="c1"># Joining child thread</span>
                <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

                <span class="c1"># Remove lock from get_summary_stats()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lock_stats</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="c1"># Exit</span>
                <span class="k">return</span>

        <span class="c1"># Get Scatter widgets</span>
        <span class="n">scatter_wgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">plot_content</span>
        <span class="n">plot_wgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">plot_content</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># If no files have been loaded, ignore</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># If a process is already running, ignore</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock_stats</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Check if plot has been previously loaded. If yes, ignore.</span>
        <span class="c1"># If there are no children, proceed as usual</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plot_wgt</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Image</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Check if any input alignments are active. If not, depends on</span>
        <span class="c1"># whether there is a summary statistics widget already in</span>
        <span class="c1"># display. If there is, ignore. If not, use the latest sum stats</span>
        <span class="c1"># pickle object to quickly display the stats</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;No active files have been &quot;</span>
                                          <span class="s2">&quot;selected&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="c1"># Get currently active data sets</span>
        <span class="n">file_set_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">active_file_set</span><span class="o">.</span><span class="n">text</span>
        <span class="n">taxa_set_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">active_taxa_set</span><span class="o">.</span><span class="n">text</span>

        <span class="n">file_set</span><span class="p">,</span> <span class="n">taxa_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_sets</span><span class="p">(</span><span class="n">file_set_name</span><span class="p">,</span>
                                                  <span class="n">taxa_set_name</span><span class="p">)</span>

        <span class="c1"># Check if currently active data sets have changed since the last</span>
        <span class="c1">#  calculation of summary statistics</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_sets</span><span class="p">[</span><span class="s2">&quot;Stats&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="n">file_set</span><span class="p">,</span> <span class="n">taxa_set</span><span class="p">]:</span>
            <span class="c1"># Active data sets are the same. If summary stats are already</span>
            <span class="c1"># displayed, ignore</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plot_wgt</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">StatsSummary</span><span class="p">)</span> <span class="ow">and</span> \
                    <span class="n">tp</span> <span class="o">==</span> <span class="s2">&quot;stats&quot;</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plot_wgt</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">GeneTable</span><span class="p">)</span> <span class="ow">and</span> \
                    <span class="n">tp</span> <span class="o">==</span> <span class="s2">&quot;table&quot;</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="c1"># If summary stats are not displayed, then retrieve</span>
            <span class="c1"># information from the pickle objects and draw the widgets</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tp</span> <span class="o">==</span> <span class="s2">&quot;stats&quot;</span><span class="p">:</span>
                    <span class="n">prepare_display</span><span class="p">(</span><span class="n">plot_wgt</span><span class="p">,</span> <span class="n">scatter_wgt</span><span class="p">)</span>
                    <span class="n">display_stats</span><span class="p">(</span><span class="n">plot_wgt</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">tp</span> <span class="o">==</span> <span class="s2">&quot;table&quot;</span><span class="p">:</span>
                    <span class="n">prepare_display</span><span class="p">(</span><span class="n">plot_wgt</span><span class="p">,</span> <span class="n">scatter_wgt</span><span class="p">)</span>
                    <span class="n">display_table</span><span class="p">(</span><span class="n">plot_wgt</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="c1"># Prepare screen by removing any potential plot widgets and</span>
        <span class="c1"># changing some properties of the scatter layout</span>
        <span class="n">prepare_display</span><span class="p">(</span><span class="n">plot_wgt</span><span class="p">,</span> <span class="n">scatter_wgt</span><span class="p">)</span>

        <span class="c1"># Disable stats subprocess interruption. Being True by default</span>
        <span class="c1"># and explicitly setting is to False when calculating summary</span>
        <span class="c1"># stats makes it much more easier to interrupt by other</span>
        <span class="c1"># actions/widgets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terminate_stats</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock_stats</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">manager</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>
        <span class="n">shared_ns</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">Namespace</span><span class="p">()</span>
        <span class="n">shared_ns</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">shared_ns</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">get_stats_summary</span><span class="p">,</span>
                             <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;aln_list&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="p">,</span>
                                     <span class="s2">&quot;dest&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span>
                                     <span class="s2">&quot;active_file_set&quot;</span><span class="p">:</span> <span class="n">file_set</span><span class="p">,</span>
                                     <span class="s2">&quot;active_taxa_set&quot;</span><span class="p">:</span> <span class="n">taxa_set</span><span class="p">,</span>
                                     <span class="s2">&quot;ns&quot;</span><span class="p">:</span> <span class="n">shared_ns</span><span class="p">})</span>

        <span class="n">p</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># Add loading widget</span>
        <span class="n">ldg</span> <span class="o">=</span> <span class="n">StatsLoading</span><span class="p">()</span>
        <span class="n">scatter_wgt</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">ldg</span><span class="p">)</span>

        <span class="n">check_func</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">check_process</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ldg</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">plot_content</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                             <span class="n">shared_ns</span><span class="p">)</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_interval</span><span class="p">(</span><span class="n">check_func</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.search_add_gene_table_line"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.search_add_gene_table_line">[docs]</a>    <span class="k">def</span> <span class="nf">search_add_gene_table_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gene_table</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wraps the creation of gene table lines into the table_grid widget.</span>
<span class="sd">        :param gene_table</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nsites&quot;</span><span class="p">,</span> <span class="s2">&quot;taxa&quot;</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;inf&quot;</span><span class="p">,</span> <span class="s2">&quot;gap&quot;</span><span class="p">,</span> <span class="s2">&quot;missing&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gene_table</span><span class="o">.</span><span class="n">itertuples</span><span class="p">()):</span>

            <span class="c1"># Ignore entries before the provided starting point</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="n">start</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_TABLE_N</span><span class="p">:</span>
                <span class="n">bt</span> <span class="o">=</span> <span class="n">MoreTableBt</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats_table</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">table_grid</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>
                <span class="k">break</span>

            <span class="c1"># Create and populate TableLine</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">TableLine</span><span class="p">()</span>
            <span class="n">x</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_name</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">. </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">genes</span><span class="p">)</span>
            <span class="n">x</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_name</span><span class="o">.</span><span class="n">size_hint_x</span> <span class="o">=</span> <span class="mf">0.5</span>

            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">:]):</span>
                <span class="n">x</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

            <span class="c1"># Add TableLine to main grid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stats_table</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">table_grid</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.search_statistics_gene_table"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.search_statistics_gene_table">[docs]</a>    <span class="k">def</span> <span class="nf">search_statistics_gene_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Searches the summary statistic gene table view, according to the</span>
<span class="sd">        provided string.</span>
<span class="sd">        :param s: string. Used to search alignment names.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Store the master gene table on another attribute, so that it can be</span>
        <span class="c1"># later retrieved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gene_master_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_table</span><span class="p">[:]</span>

        <span class="c1"># Info for new table data</span>
        <span class="n">table</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;Gene name&quot;</span><span class="p">,</span> <span class="s2">&quot;Number of sites&quot;</span><span class="p">,</span> <span class="s2">&quot;Number of taxa&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Variable sites&quot;</span><span class="p">,</span> <span class="s2">&quot;Informative sites&quot;</span><span class="p">,</span> <span class="s2">&quot;Gaps&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Missing data&quot;</span><span class="p">]]</span>

        <span class="c1"># clear gene table widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_table</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">table_grid</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>

        <span class="c1"># Search the gene table object for gene names matching the provided</span>
        <span class="c1"># string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gene_table_selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gene_table</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gene_table</span><span class="p">[</span><span class="s2">&quot;genes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">search_add_gene_table_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gene_table_selection</span><span class="p">)</span>

        <span class="c1"># Create new table data</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gene_table_selection</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
            <span class="c1"># Add table line</span>
            <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_table</span> <span class="o">=</span> <span class="n">table</span></div>

<div class="viewcode-block" id="TriFusionApp.search_statistics_clear"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.search_statistics_clear">[docs]</a>    <span class="k">def</span> <span class="nf">search_statistics_clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears the search in the gene table summary statistics</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Only do this if there is an active selection being displayed</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gene_table_selection</span><span class="p">):</span>
            <span class="c1"># Clear gene_table widget</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stats_table</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">table_grid</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>

            <span class="c1"># Re-populate with original genes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">search_add_gene_table_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gene_table</span><span class="p">)</span>

            <span class="c1"># Reset gene_table_selection</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gene_table_selection</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Reset search field hint text</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stats_table</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_txt</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="c1"># Set the current_table attribute to the total gene list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gene_master_table</span><span class="p">[:]</span></div>

<div class="viewcode-block" id="TriFusionApp.search_sort_gene_table"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.search_sort_gene_table">[docs]</a>    <span class="k">def</span> <span class="nf">search_sort_gene_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sortby</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sorts the gene table by any column header.</span>
<span class="sd">        :param str sortby: Column header name to perform the sort</span>
<span class="sd">        :param bool ascending: Whether the sorting will be ascending or</span>
<span class="sd">        descending</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">col_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Gene name&quot;</span><span class="p">:</span> <span class="s2">&quot;genes&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="s2">&quot;nsites&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;Taxa&quot;</span><span class="p">:</span> <span class="s2">&quot;taxa&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;V&quot;</span><span class="p">:</span> <span class="s2">&quot;var&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="s2">&quot;inf&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;Gap&quot;</span><span class="p">:</span> <span class="s2">&quot;gap&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;M&quot;</span><span class="p">:</span> <span class="s2">&quot;missing&quot;</span><span class="p">}</span>

        <span class="c1"># Info for new table data</span>
        <span class="n">table</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;Gene name&quot;</span><span class="p">,</span> <span class="s2">&quot;Number of sites&quot;</span><span class="p">,</span> <span class="s2">&quot;Number of taxa&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Variable sites&quot;</span><span class="p">,</span> <span class="s2">&quot;Informative sites&quot;</span><span class="p">,</span> <span class="s2">&quot;Gaps&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Missing data&quot;</span><span class="p">]]</span>

        <span class="c1"># clear gene table widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_table</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">table_grid</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gene_table</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="n">col_map</span><span class="p">[</span><span class="n">sortby</span><span class="p">]],</span>
                                   <span class="n">ascending</span><span class="o">=</span><span class="n">ascending</span><span class="p">,</span>
                                   <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">search_add_gene_table_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gene_table</span><span class="p">)</span>

        <span class="c1"># Create new table data</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gene_table</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
            <span class="c1"># Add table line</span>
            <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_table</span> <span class="o">=</span> <span class="n">table</span></div>

<div class="viewcode-block" id="TriFusionApp.statistics_populate_groups"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.statistics_populate_groups">[docs]</a>    <span class="k">def</span> <span class="nf">statistics_populate_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is called when the dataset selection buttons in the</span>
<span class="sd">        Statistics sidepanel are pressed. They populate the respective</span>
<span class="sd">        dropdown menu with the currently set groups</span>
<span class="sd">        :param ds_type: string, data set type. Can be either &#39;taxa&#39; or</span>
<span class="sd">        &#39;files&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">set_dd_txt</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="n">wgt</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Using this function instead of lamdba to set the callback on the</span>
<span class="sd">            on_release event of the dropdown buttons ensures that each button</span>
<span class="sd">            has each unique callback and it&#39;s not overwritte (as in the lamdba)</span>
<span class="sd">            :param txt: string, text provided to select() method</span>
<span class="sd">            :param wgt: dummy argument, required because of how the bind()</span>
<span class="sd">            method works</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">dd_wgt</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ds_type</span> <span class="o">==</span> <span class="s2">&quot;taxa&quot;</span><span class="p">:</span>
            <span class="n">dd_wgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_dropdown</span>
            <span class="n">grid_children</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_dropdown</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">children</span>
            <span class="n">group_atr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">taxa_groups</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dd_wgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_dropdown</span>
            <span class="n">grid_children</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">file_dropdown</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">children</span>
            <span class="n">group_atr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_groups</span>

        <span class="c1"># Remove discarded groups</span>
        <span class="k">for</span> <span class="n">bt</span> <span class="ow">in</span> <span class="n">grid_children</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bt</span><span class="o">.</span><span class="n">text</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;All taxa&quot;</span><span class="p">,</span> <span class="s2">&quot;Active taxa&quot;</span><span class="p">,</span> <span class="s2">&quot;All files&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;Active files&quot;</span><span class="p">]:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">bt</span><span class="o">.</span><span class="n">text</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">group_atr</span><span class="p">:</span>
                <span class="n">dd_wgt</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>

        <span class="c1"># Add new groups</span>
        <span class="n">current_groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">grid_children</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">group_atr</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">g</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current_groups</span><span class="p">:</span>
                <span class="n">dd_bt</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span>
                    <span class="n">text</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="n">size_hint_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">background_normal</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                           <span class="s2">&quot;spinner_opt.png&quot;</span><span class="p">))</span>
                <span class="n">dd_bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">set_dd_txt</span><span class="p">,</span> <span class="n">g</span><span class="p">))</span>
                <span class="n">dd_wgt</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">dd_bt</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_general_info"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_general_info">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_general_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the popup with information for several components of the</span>
<span class="sd">        application</span>
<span class="sd">        :param idx: string. Identifier of the informative content to be</span>
<span class="sd">        shown. It must be present in the dictionary keys of the</span>
<span class="sd">        informative_storage variable in data/resources/info_data.py</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">InfoPopup</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>

        <span class="c1"># Retrieve title and body text</span>
        <span class="n">title_str</span><span class="p">,</span> <span class="n">body_str</span> <span class="o">=</span> <span class="n">informative_storage</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

        <span class="c1"># Add text body</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">body_str</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title_str</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span> <span class="n">close_bt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.operation_queue_init"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.operation_queue_init">[docs]</a>    <span class="k">def</span> <span class="nf">operation_queue_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This will create the skeleton for the tree view of the operations</span>
<span class="sd">        queued for execution in an appropriate screen of the side panel.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Create tree view instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operation_tv</span> <span class="o">=</span> <span class="n">TreeView</span><span class="p">(</span><span class="n">hide_root</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">size_hint_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                     <span class="n">height</span><span class="o">=</span><span class="mi">269</span><span class="p">)</span>

        <span class="c1"># Create main nodes for each module</span>
        <span class="n">ortho_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operation_tv</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span>
            <span class="n">TreeViewLabel</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Orthology Operations&quot;</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">font_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="o">.</span><span class="mi">2</span><span class="p">)))</span>
        <span class="n">proc_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operation_tv</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span>
            <span class="n">TreeViewLabel</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Process Operations&quot;</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">font_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>

        <span class="c1"># Main subnodes for Process</span>
        <span class="n">main_op_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operation_tv</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">TreeViewLabel</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Main Operation&quot;</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=.</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">proc_node</span><span class="p">)</span>
        <span class="n">secondary_op_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operation_tv</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">TreeViewLabel</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Secondary Operations&quot;</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
            <span class="n">opacity</span><span class="o">=.</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">proc_node</span><span class="p">)</span>
        <span class="n">format_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operation_tv</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">TreeViewLabel</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Output Formats&quot;</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=.</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">proc_node</span><span class="p">)</span>
        <span class="n">main_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operation_tv</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">TreeViewLabel</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Output File&quot;</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=.</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">proc_node</span><span class="p">)</span>

        <span class="c1"># Save main nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ortho&quot;</span><span class="p">:</span> <span class="n">ortho_node</span><span class="p">,</span> <span class="s2">&quot;proc&quot;</span><span class="p">:</span> <span class="n">proc_node</span><span class="p">,</span>
                           <span class="s2">&quot;proc_main&quot;</span><span class="p">:</span> <span class="n">main_op_node</span><span class="p">,</span>
                           <span class="s2">&quot;proc_form&quot;</span><span class="p">:</span> <span class="n">format_node</span><span class="p">,</span>
                           <span class="s2">&quot;proc_sec&quot;</span><span class="p">:</span> <span class="n">secondary_op_node</span><span class="p">,</span>
                           <span class="s2">&quot;main_file&quot;</span><span class="p">:</span> <span class="n">main_file</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">op_sv</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operation_tv</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.save_operation_queue"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.save_operation_queue">[docs]</a>    <span class="k">def</span> <span class="nf">save_operation_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This populate the operations queue tree view with the operations and</span>
<span class="sd">        options selected by the user</span>

<span class="sd">        As of now, it listens to information stored in:</span>

<span class="sd">            - self.main_operations, to gather the main operation</span>
<span class="sd">            - self.process_switches, to gather secondary operations</span>
<span class="sd">            - self.output_formats, to gather information on the output</span>
<span class="sd">            formats</span>
<span class="sd">            - self.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">clear_nodes</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
            <span class="n">old_nodes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">operation_tv</span><span class="o">.</span><span class="n">iterate_all_nodes</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">!=</span> <span class="n">parent</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                    <span class="n">old_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">old_nodes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operation_tv</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operation_tv</span><span class="o">.</span><span class="n">height</span> <span class="o">-=</span> <span class="mi">24</span>

        <span class="k">def</span> <span class="nf">add_node</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operation_tv</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span>
                <span class="n">TreeViewLabel</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">16</span><span class="p">),</span> <span class="n">parent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operation_tv</span><span class="o">.</span><span class="n">height</span> <span class="o">+=</span> <span class="mi">24</span>
            <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">opacity</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># PROCESS NODES</span>
        <span class="c1"># Main operation</span>
        <span class="c1"># Clear old nodes</span>
        <span class="n">clear_nodes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;proc_main&quot;</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">main_op</span> <span class="o">=</span> <span class="p">[</span><span class="n">nm</span> <span class="k">for</span> <span class="n">nm</span><span class="p">,</span> <span class="n">bl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_operations</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                       <span class="k">if</span> <span class="n">bl</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">main_op</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;proc_main&quot;</span><span class="p">])</span>
            <span class="c1"># Open Process node</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;proc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">is_open</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operation_tv</span><span class="o">.</span><span class="n">toggle_node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;proc&quot;</span><span class="p">])</span>
            <span class="c1"># Open main operation node if closed</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;proc_main&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">is_open</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operation_tv</span><span class="o">.</span><span class="n">toggle_node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;proc_main&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;proc_main&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="o">.</span><span class="mi">2</span>

        <span class="c1"># Output format</span>
        <span class="c1"># Clear old nodes</span>
        <span class="n">clear_nodes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;proc_form&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_formats</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ft</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_formats</span><span class="p">:</span>
                <span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ft</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;proc_form&quot;</span><span class="p">])</span>
            <span class="c1"># Open output format node is closed</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;proc_form&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">is_open</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operation_tv</span><span class="o">.</span><span class="n">toggle_node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;proc_form&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;proc_form&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="o">.</span><span class="mi">2</span>

        <span class="c1"># Secondary operations</span>
        <span class="c1"># Clear old nodes</span>
        <span class="n">clear_nodes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;proc_sec&quot;</span><span class="p">])</span>
        <span class="n">secondary_op</span> <span class="o">=</span> <span class="p">[</span><span class="n">nm</span> <span class="k">for</span> <span class="n">nm</span><span class="p">,</span> <span class="n">bl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_operations</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">bl</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">secondary_op</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">secondary_op</span><span class="p">:</span>
                <span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">op</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;proc_sec&quot;</span><span class="p">])</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;proc_sec&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">is_open</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operation_tv</span><span class="o">.</span><span class="n">toggle_node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;proc_sec&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;proc_sec&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="o">.</span><span class="mi">2</span>

        <span class="c1"># Output file</span>
        <span class="n">clear_nodes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;main_file&quot;</span><span class="p">])</span>
        <span class="c1"># for conversion</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_operations</span><span class="p">[</span><span class="s2">&quot;conversion&quot;</span><span class="p">]:</span>
            <span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;[Based on input] (main)&quot;</span><span class="p">,</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;main_file&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;main_file&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">is_open</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operation_tv</span><span class="o">.</span><span class="n">toggle_node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;main_file&quot;</span><span class="p">])</span>
            <span class="c1"># Output files from secondary operations</span>
            <span class="k">if</span> <span class="n">secondary_op</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">secondary_op</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_options</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_file&quot;</span> <span class="o">%</span> <span class="n">op</span><span class="p">]:</span>
                        <span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;*_</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">op</span><span class="p">),</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;main_file&quot;</span><span class="p">])</span>
        <span class="c1"># for concatenation</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_operations</span><span class="p">[</span><span class="s2">&quot;concatenation&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;[empty] (main)&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;main_file&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (main)&quot;</span> <span class="o">%</span> <span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="p">),</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;main_file&quot;</span><span class="p">])</span>

            <span class="c1"># Output files from secondary operations</span>
            <span class="k">if</span> <span class="n">secondary_op</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">secondary_op</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_options</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_file&quot;</span> <span class="o">%</span> <span class="n">op</span><span class="p">]:</span>
                        <span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="p">),</span>
                                                 <span class="n">op</span><span class="p">,</span> <span class="n">op</span><span class="p">),</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;main_file&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;main_file&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">is_open</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operation_tv</span><span class="o">.</span><span class="n">toggle_node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;main_file&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_nodes</span><span class="p">[</span><span class="s2">&quot;main_file&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="o">.</span><span class="mi">2</span></div>

<div class="viewcode-block" id="TriFusionApp.process_clear_options"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.process_clear_options">[docs]</a>    <span class="k">def</span> <span class="nf">process_clear_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># CORE CHANGES</span>
        <span class="c1"># Clear main operations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_operations</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">op</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">main_operations</span><span class="p">)</span>

        <span class="c1"># Clear active data set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">active_taxa_set</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Active taxa&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">active_file_set</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Active files&quot;</span>

        <span class="c1"># Clear output formats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_formats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fasta&quot;</span><span class="p">]</span>

        <span class="c1"># Clear filters, consensus, haplotype name and zorro suffix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">missing_filter_settings</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">taxa_filter_settings</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">codon_filter_settings</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hap_prefix</span> <span class="o">=</span> <span class="s2">&quot;Hap&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zorro_suffix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zorro_dir</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">consensus_mode</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
            <span class="s2">&quot;IUPAC&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence_types</span> <span class="o">!=</span> <span class="s2">&quot;Protein&quot;</span> <span class="k">else</span> <span class="s2">&quot;Soft mask&quot;</span>

        <span class="c1"># Clear output file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Clear secondary operations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">secondary_operations</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">op</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">secondary_operations</span><span class="p">)</span>

        <span class="c1"># Clear secondary options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">secondary_options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">op</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">secondary_options</span><span class="p">)</span>

        <span class="c1"># APP CHANGES</span>
        <span class="c1"># Deselect main operation</span>
        <span class="k">for</span> <span class="n">bt</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;conv&quot;</span><span class="p">,</span> <span class="s2">&quot;conc&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">bt</span><span class="p">]</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">bt</span><span class="p">]</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Changes in buttons with dynamic text</span>
        <span class="c1"># Output format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">conv_formatbt</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Fasta&quot;</span>
        <span class="c1"># Output file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">conv</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Select...&quot;</span>
        <span class="c1"># Zorro settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">zorro</span><span class="o">.</span><span class="n">background_normal</span> <span class="o">=</span> \
            <span class="s2">&quot;data/backgrounds/bt_process_off.png&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">zorro</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Off&quot;</span>

        <span class="c1"># Turn switches off</span>
        <span class="k">for</span> <span class="n">switch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_operations</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_options</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">switch</span><span class="p">]</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">for</span> <span class="n">switch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_options</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_options</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">switch</span><span class="p">]</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span></div>

<div class="viewcode-block" id="TriFusionApp.orthology_clear_options"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.orthology_clear_options">[docs]</a>    <span class="k">def</span> <span class="nf">orthology_clear_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets orthology search options to default values</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ortho_dir</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orto_export_dir</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">usearch_db</span> <span class="o">=</span> <span class="s2">&quot;goodProteins_db&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usearch_output</span> <span class="o">=</span> <span class="s2">&quot;AllVsAll.out&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usearch_evalue</span> <span class="o">=</span> <span class="s2">&quot;0.00001&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ortholog_prefix</span> <span class="o">=</span> <span class="s2">&quot;MyGroup&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_prefix</span> <span class="o">=</span> <span class="s2">&quot;group&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcl_inflation</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;3&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">orto_max_gene</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orto_min_sp</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">usearch_threads</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">inflation_bt</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;[&#39;3&#39;]&quot;</span></div>

    <span class="c1"># ########################### PLOT SCREENS #############################</span>

<div class="viewcode-block" id="TriFusionApp.show_stats_toggle"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.show_stats_toggle">[docs]</a>    <span class="k">def</span> <span class="nf">show_stats_toggle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args1</span><span class="p">,</span> <span class="n">args2</span><span class="p">,</span> <span class="n">active_bt</span><span class="p">,</span> <span class="n">single_gene</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a toggle widget to some Statistics plots that allow the user to</span>
<span class="sd">        toggle plots between the whole data set and species perspectives</span>
<span class="sd">        :param args1: dictionary, key must be &quot;plt_idx&quot;, and value the</span>
<span class="sd">        plot index string for the species plot type</span>
<span class="sd">        :param args2: dictionary, key must be &quot;plt_idx&quot;, and value the</span>
<span class="sd">        plot index string for the average plot type</span>
<span class="sd">        :param active_bt: string, identifier of the active button. Can be</span>
<span class="sd">        either &quot;sp&quot; (Species), &quot;avg&quot; (Average) or &quot;gene&quot; (Single gene)</span>
<span class="sd">        :param single_gene: dictionary, key must be &quot;plt_idx&quot;, and value the</span>
<span class="sd">        plot index string for the single gene plot type</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">StatsToggleWgt</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">single_gene</span> <span class="ow">and</span> <span class="n">active_bt</span> <span class="o">!=</span> <span class="s2">&quot;gene&quot;</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gene</span><span class="p">)</span>
            <span class="n">content</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gene_sep</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">gene_args</span> <span class="o">=</span> <span class="n">single_gene</span>
            <span class="k">if</span> <span class="n">active_bt</span> <span class="o">==</span> <span class="s2">&quot;gene&quot;</span><span class="p">:</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gene</span><span class="o">.</span><span class="n">background_normal</span> <span class="o">=</span> \
                    <span class="s2">&quot;data/backgrounds/bt_focus.png&quot;</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gene</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Change gene&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gene</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Single gene&quot;</span>

        <span class="k">for</span> <span class="n">wgt_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;avg&quot;</span><span class="p">,</span> <span class="s2">&quot;sp&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">wgt_name</span> <span class="o">==</span> <span class="n">active_bt</span><span class="p">:</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">wgt_name</span><span class="p">]</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">wgt_name</span><span class="p">]</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">wgt_name</span><span class="p">]</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">wgt_name</span><span class="p">]</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">args2</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">args2</span> <span class="o">=</span> <span class="n">args2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">avg</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">args1</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">args1</span> <span class="o">=</span> <span class="n">args1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">previous_stats_toggle</span> <span class="o">=</span> <span class="n">content</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">content</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.show_plot_toolbar"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.show_plot_toolbar">[docs]</a>    <span class="k">def</span> <span class="nf">show_plot_toolbar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">toolbar_type</span><span class="o">=</span><span class="s2">&quot;orto&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a PlotToolbar BoxLayout to self.root_window. This is meant to</span>
<span class="sd">        be an auxiliary toolbar for specific operations related to plots.</span>
<span class="sd">        :param toolbar_type: string, determines whether an orto plot toolbar</span>
<span class="sd">        is displayed (&#39;orto&#39;) or a stats plot toolbar (&#39;stats&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">toolbar_type</span> <span class="o">==</span> <span class="s2">&quot;orto&quot;</span><span class="p">:</span>
            <span class="c1"># Determine position</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">OrtoPlotToolbar</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">StatsPlotToolbar</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">content</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.show_back_bt"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.show_back_bt">[docs]</a>    <span class="k">def</span> <span class="nf">show_back_bt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a back button to self.root_window, which will navigate to the</span>
<span class="sd">        previous screen. This is meant for headless plot screens</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">bt</span> <span class="o">=</span> <span class="n">BackButton</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.dismiss_stats_toggle"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dismiss_stats_toggle">[docs]</a>    <span class="k">def</span> <span class="nf">dismiss_stats_toggle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes the stats toggle widget</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">wgt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                   <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">StatsToggleWgt</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">wgt</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="TriFusionApp.dismiss_plot_wgt"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dismiss_plot_wgt">[docs]</a>    <span class="k">def</span> <span class="nf">dismiss_plot_wgt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes plot widgets from the root window</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">wgt</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                        <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">OrtoPlotToolbar</span><span class="p">)</span> <span class="ow">or</span>
                        <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">BackButton</span><span class="p">)</span> <span class="ow">or</span>
                        <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">StatsPlotToolbar</span><span class="p">)</span> <span class="ow">or</span>
                        <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">StatsToggleWgt</span><span class="p">)]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">wgt</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">pass</span></div>

    <span class="c1"># ######################### ORTHOLOGY SCREEN ###########################</span>

<div class="viewcode-block" id="TriFusionApp.toggle_orto_soptions"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.toggle_orto_soptions">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_orto_soptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Controls the toggling of the GridLayout with the advanced options</span>
<span class="sd">        for the Orthology screen, Ortholog search slide</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">orto_search_height</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">orto_search_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gl_orto_search</span><span class="o">.</span><span class="n">height</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">adv_search_options</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span>
                <span class="s2">&quot;Show additional options&quot;</span><span class="p">):</span>
            <span class="c1"># Add widget to main grid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gl_orto_search</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="p">)</span>
            <span class="c1"># Animate widget entrance</span>
            <span class="n">Animation</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;in_quad&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="p">)</span>
            <span class="c1"># Update button text</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">adv_search_options</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
                <span class="s2">&quot;Hide additional options&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gl_orto_search</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">orto_search_height</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="mi">5</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">mcl_grid</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">+</span> <span class="mi">30</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">adv_search_options</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> \
                <span class="s2">&quot;Hide additional options&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gl_orto_search</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orto_search_height</span>
            <span class="c1"># Remove widget from main grid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gl_orto_search</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="p">)</span>
            <span class="c1"># Update button text</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">adv_search_options</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
                <span class="s2">&quot;Show additional options&quot;</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_search_report"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_search_report">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_search_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stat_storage</span><span class="p">,</span> <span class="n">groups</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the dialog that reports the results of the Orthology search</span>
<span class="sd">        :param stat_storage: dictionary. Each entry corresponds to an</span>
<span class="sd">        inflation value, which will have a list as a value. The list will</span>
<span class="sd">        contain:</span>

<span class="sd">           [total_orts, species_compliant_orts, gene_compliant_orts,</span>
<span class="sd">           final_orts]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">OrthoReportDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">inf</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mcl_inflation</span><span class="p">):</span>
            <span class="n">stats</span> <span class="o">=</span> <span class="n">stat_storage</span><span class="p">[</span><span class="n">inf</span><span class="p">]</span>

            <span class="c1"># Creating graphical report</span>
            <span class="n">report_wgt</span> <span class="o">=</span> <span class="n">OrthoGraphicReport</span><span class="p">()</span>

            <span class="c1"># Setting inflation value attribute</span>
            <span class="n">report_wgt</span><span class="o">.</span><span class="n">inf</span> <span class="o">=</span> <span class="n">inf</span>

            <span class="c1"># Setting total orthologs</span>
            <span class="n">report_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">total_ort</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="c1"># Setting gene compliant</span>
            <span class="n">report_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gf_txt</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">report_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gf_box</span><span class="o">.</span><span class="n">size_hint_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> \
                <span class="nb">float</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="c1"># Setting species compliant</span>
            <span class="n">report_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sf_txt</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">report_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sf_box</span><span class="o">.</span><span class="n">size_hint_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> \
                <span class="nb">float</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="c1"># Setting final orthologs</span>
            <span class="n">report_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">final_txt</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
            <span class="n">report_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">final_box</span><span class="o">.</span><span class="n">size_hint_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">/</span> \
                <span class="nb">float</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="c1"># Adding widget to carousel</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">report_car</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">report_wgt</span><span class="p">)</span>

        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">ok_bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_groups</span><span class="p">(</span>
            <span class="n">groups</span><span class="p">,</span> <span class="n">groups</span><span class="o">.</span><span class="n">filters</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Orthology search report&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">470</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_import_groups"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_import_groups">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_import_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates filechooser dialog to select group files to be imported</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">LoadMultipleDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">,</span>
                                     <span class="n">bookmark_init</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmark_init</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Choose group file(s) to import&quot;</span><span class="p">,</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_mysql"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_mysql">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_mysql</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates dialog for MySQL settings</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">MySQLDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_dlg</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mysql_pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;MySQL root password&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">150</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_protein_filter"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_protein_filter">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_protein_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">ProteinFilterDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Protein filter settings&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">350</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_inflation"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_inflation">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_inflation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates dialog for inflation values selection</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">InflationDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>
        <span class="c1"># Updated dialog with the selected inflation values</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">inflation_bx</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">text</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcl_inflation</span><span class="p">:</span>
                <span class="n">i</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;MCL inflation settings&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">220</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_orto_setfilter"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_orto_setfilter">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_orto_setfilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A similar dialog to dialog_ortho_filter but for the explore screen.</span>
<span class="sd">        Contains an additional option of applying the specified filters</span>
<span class="sd">        to all group files</span>
<span class="sd">        :param group_name: string. name for the group object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">OrtoSetFiltersDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>
        <span class="n">content</span><span class="o">.</span><span class="n">group_name</span> <span class="o">=</span> <span class="n">group_name</span>

        <span class="n">sp_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="o">.</span><span class="n">taxa_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">active_group_name</span><span class="p">]</span>
        <span class="n">excluded_tx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="o">.</span><span class="n">excluded_taxa</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">active_group_name</span><span class="p">]</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">exclude_bt</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> included&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">sp_list</span><span class="p">))</span>
        <span class="n">content</span><span class="o">.</span><span class="n">excluded_tx</span> <span class="o">=</span> <span class="n">excluded_tx</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Set/change ortholog filters for </span><span class="si">%s</span><span class="s2"> file&quot;</span> <span class="o">%</span>
                              <span class="n">group_name</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">390</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_ortho_filter"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_ortho_filter">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_ortho_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates dialog for orthology cluster filters</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">OrtoFilterDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Ortholog filters&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.save_ortho_filters"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.save_ortho_filters">[docs]</a>    <span class="k">def</span> <span class="nf">save_ortho_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gene_filt</span><span class="p">,</span> <span class="n">sp_filt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save orthology clusters filters</span>
<span class="sd">        :param gene_filt: int. Integer for gene filter threshold</span>
<span class="sd">        :param sp_filt: int. Integer for species filter threshold</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">gene_filt</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                    <span class="s2">&quot;Maximum number of gene copies must be higher &quot;</span>
                    <span class="s2">&quot;than 0&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">orto_max_gene</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">gene_filt</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                <span class="s2">&quot;Maximum number of gene copies &#39;</span><span class="si">{}</span><span class="s2">&#39; must be a real &quot;</span>
                <span class="s2">&quot;numbers&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gene_filt</span><span class="p">),</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">sp_filt</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                    <span class="s2">&quot;Minimum number of taxa must be a positive &quot;</span>
                    <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">float</span><span class="p">(</span><span class="n">sp_filt</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">orto_min_sp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sp_filt</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">orto_min_sp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sp_filt</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                <span class="s2">&quot;Minimum number of taxa &#39;</span><span class="si">{}</span><span class="s2">&#39; must be a number&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">sp_filt</span><span class="p">),</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="c1"># Add check for min species. If this filter is set to a number</span>
        <span class="c1"># greater that the number of proteome input files (which should</span>
        <span class="c1"># represent a single species each) this will issue a warning.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span> <span class="ow">and</span> \
                        <span class="nb">int</span><span class="p">(</span><span class="n">sp_filt</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_proteome_files</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;Minimum number of &quot;</span>
                                          <span class="s2">&quot;species larger than the provided&quot;</span>
                                          <span class="s2">&quot; proteomes&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">orto_min_sp</span> <span class="o">=</span> <span class="n">orto_min_sp</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">orto_max_gene</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">orto_min_sp</span></div>

<div class="viewcode-block" id="TriFusionApp.save_inflation"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.save_inflation">[docs]</a>    <span class="k">def</span> <span class="nf">save_inflation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inflation_wgt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save inflation values</span>
<span class="sd">        :param inflation_wgt: Widget. Widget containing the inflation values</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">wgt</span> <span class="ow">in</span> <span class="n">inflation_wgt</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">wgt</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span> <span class="ow">and</span> <span class="n">wgt</span><span class="o">.</span><span class="n">text</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcl_inflation</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mcl_inflation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wgt</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">wgt</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;normal&quot;</span> <span class="ow">and</span> <span class="n">wgt</span><span class="o">.</span><span class="n">text</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcl_inflation</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mcl_inflation</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">wgt</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">inflation_bt</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
            <span class="nb">str</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mcl_inflation</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.save_protein_filters"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.save_protein_filters">[docs]</a>    <span class="k">def</span> <span class="nf">save_protein_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_len</span><span class="p">,</span> <span class="n">max_stop</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves protein length and stop percentage filters</span>
<span class="sd">        :param min_len: int. Minimum sequence length</span>
<span class="sd">        :param max_stop: int. Maximum percentage of stop codons</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check arguments for compliance. Must be int</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Check if max_stop value is between 0 and 100</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">float</span><span class="p">(</span><span class="n">max_stop</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                    <span class="s2">&quot;Maximum codon stops value must be between 0 &quot;</span>
                    <span class="s2">&quot;and 100&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">protein_min_len</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">min_len</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">protein_max_stop</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">max_stop</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> and </span><span class="si">{}</span><span class="s2"> must be &quot;</span>
                <span class="s2">&quot;numbers&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">min_len</span><span class="p">,</span> <span class="n">max_stop</span><span class="p">),</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_export_groups"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_export_groups">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_export_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dialog for group exportation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">ExportGroupDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_all_popups</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Export group as...&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">360</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_export_groups_filechooser"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_export_groups_filechooser">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_export_groups_filechooser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When clicking Export groups in the main dialog for group</span>
<span class="sd">        exportation, the user is redirected to a filechooser to choose</span>
<span class="sd">        the output directory and output file name, in the case of group</span>
<span class="sd">        exportation.</span>
<span class="sd">        :param idx: string. Determines the export mode: if &quot;protein&quot; or</span>
<span class="sd">        &quot;nucleotide&quot;, it will export sequence files, if &quot;group&quot;, it will</span>
<span class="sd">        export to another group file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">SaveDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">,</span>
                             <span class="n">bookmark_init</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmark_init</span><span class="p">)</span>

        <span class="c1"># Set the path from previously imported groups, if any</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sd_filechooser</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orto_export_dir</span><span class="p">)</span> <span class="k">if</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">orto_export_dir</span> <span class="k">else</span> <span class="n">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;nucleotide&quot;</span> <span class="ow">or</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;protein&quot;</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_box</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_box</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Export sequences to directory ...&quot;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Export group file to directory ...&quot;</span>

        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sd_filechooser</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">idx</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.orto_export_groups"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.orto_export_groups">[docs]</a>    <span class="k">def</span> <span class="nf">orto_export_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">export_idx</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">output_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This will handle the group exportation of the orthology screen. The</span>
<span class="sd">        intensive export methods will run in the background while updating</span>
<span class="sd">        the main process of their process.</span>
<span class="sd">        :param export_idx: string, with the identifier of exportation. Can</span>
<span class="sd">        be either &#39;group&#39;, &#39;protein&#39; or &#39;dna&#39; the database from which</span>
<span class="sd">        sequences will be retrieved</span>
<span class="sd">        :param output_dir: string. Path to output directory</span>
<span class="sd">        :param output_name: string, for group exportation, provide the name</span>
<span class="sd">        of the output filtered file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">check_process</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>

            <span class="c1"># Update dialog text</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">act</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1"># Update progress bar</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">pb</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">progress</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1"># Update maximum progress bar value</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">pb</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">max_pb</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminate_group_export</span><span class="p">:</span>

                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Terminating on you command. &quot;</span> \
                                       <span class="s2">&quot;Hang tight!&quot;</span>

                <span class="c1"># Issuing the kill order to the child thread. This signal</span>
                <span class="c1"># will propagate through the worker&#39;s methods and graciously</span>
                <span class="c1"># terminate</span>
                <span class="n">shared_ns</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># This small delay seems to fix manager shutdown issues</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Shutting down manager that provides communication between</span>
                <span class="c1"># parent and child thread</span>
                <span class="n">manager</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

                <span class="c1"># Close loading popup dialog</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span>

                <span class="c1"># Unschedule the current function</span>
                <span class="n">Clock</span><span class="o">.</span><span class="n">unschedule</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

                <span class="c1"># Join child process and exit</span>
                <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="c1"># Check process status</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                            <span class="s2">&quot;An unexpected error occurred when exporting &quot;</span>
                            <span class="s2">&quot;orthologs. Check the app logs.&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="n">Clock</span><span class="o">.</span><span class="n">unschedule</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">missed</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> orthologs successfully exported&quot;</span> <span class="o">%</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">good</span><span class="p">,</span>
                        <span class="n">t</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> orthologs exported. However, </span><span class="si">%s</span><span class="s2"> sequences &quot;</span>
                        <span class="s2">&quot;could not be retrieved! Missed sequence headers &quot;</span>
                        <span class="s2">&quot;were stored in missed_sequences.log&quot;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="n">shared_ns</span><span class="o">.</span><span class="n">good</span><span class="p">,</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">missed</span><span class="p">),</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">)</span>

                <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

        <span class="c1"># Update orthology export directory, if necessary</span>
        <span class="k">if</span> <span class="n">output_dir</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orto_export_dir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">orto_export_dir</span> <span class="o">=</span> <span class="n">output_dir</span>

        <span class="c1"># Get active_group if not already defined by fetching the active</span>
        <span class="c1"># group button in the Explore screen</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="p">:</span>
            <span class="n">group_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_gl</span><span class="o">.</span><span class="n">children</span>
                        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">group_id</span><span class="p">)</span>

        <span class="c1"># Let the current screen define which filters are going to be used</span>
        <span class="c1"># for ortholog export.</span>
        <span class="c1"># If the screen is ORTO_PLOT, then use the fitlers specific to the</span>
        <span class="c1"># current active group.</span>
        <span class="c1"># If the screen is ORTHOLOGY, then use the ortho groups general filters</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Orthology&quot;</span><span class="p">:</span>
            <span class="c1"># Update filter values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">update_filters</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">exclude_taxa</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="o">.</span><span class="n">excluded_taxa</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>

        <span class="c1"># Set up manager and shared name space to share information</span>
        <span class="c1"># between background and main processes</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>
        <span class="n">shared_ns</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">Namespace</span><span class="p">()</span>

        <span class="c1"># Initialize stop flag to allow thread to be killed by the user</span>
        <span class="n">shared_ns</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">method_store</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;group&quot;</span><span class="p">:</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">export_filtered_group</span><span class="p">,</span>
                 <span class="p">[</span><span class="n">output_name</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">]],</span>
            <span class="s2">&quot;protein&quot;</span><span class="p">:</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">retrieve_sequences</span><span class="p">,</span>
                 <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sqldb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protein_db</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">]],</span>
            <span class="s2">&quot;nucleotide&quot;</span><span class="p">:</span>
                <span class="p">[</span><span class="n">protein2dna</span><span class="o">.</span><span class="n">convert_group</span><span class="p">,</span>
                 <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sqldb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cds_db</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protein_db</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">usearch_file</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">]]}</span>

        <span class="c1"># Get method and args</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">method_store</span><span class="p">[</span><span class="n">export_idx</span><span class="p">]</span>

        <span class="c1"># Remove lock from background process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terminate_group_export</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Create process</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">background_export_groups</span><span class="p">,</span>
                             <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shared_ns</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># Remove any previous popups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_all_popups</span><span class="p">()</span>
        <span class="c1"># Create loading process dialog</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">LoadProgressDialog</span><span class="p">()</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">pb</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">all_compliant</span>
        <span class="c1"># Give functionality to cancel button</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">close_bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span>
            <span class="n">on_release</span><span class="o">=</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;terminate_group_export&quot;</span><span class="p">,</span>
                                         <span class="kc">True</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Exporting...&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">250</span><span class="p">),</span> <span class="n">auto_dissmiss</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Schedule function that checks the process&#39; pulse</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">check_process</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_interval</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.orto_report_dialog"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.orto_report_dialog">[docs]</a>    <span class="k">def</span> <span class="nf">orto_report_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a filechooser upon clicking on the &quot;Generate full</span>
<span class="sd">        report&quot; button in Orthology Explore. The filechooser will provide</span>
<span class="sd">        the directory where the report will be generated</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">SaveDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">,</span>
                             <span class="n">bookmark_init</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmark_init</span><span class="p">)</span>

        <span class="c1"># Set the path from previously imported groups, if any</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sd_filechooser</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orto_export_dir</span><span class="p">)</span> <span class="k">if</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">orto_export_dir</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">home_path</span>

        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Generate full report in directory...&quot;</span>

        <span class="c1"># Remove file name text input</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_box</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_box</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>

        <span class="c1"># Set identifier for filechooser</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sd_filechooser</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;orto_report&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.get_active_group_light"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.get_active_group_light">[docs]</a>    <span class="k">def</span> <span class="nf">get_active_group_light</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="p">:</span>
            <span class="n">group_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_gl</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">group_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_group</span></div>

<div class="viewcode-block" id="TriFusionApp.orto_generate_report"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.orto_generate_report">[docs]</a>    <span class="k">def</span> <span class="nf">orto_generate_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">,</span> <span class="n">ns</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates full orthology report on the specified directory.</span>
<span class="sd">        :param out_dir: string, path to directory where the report will be</span>
<span class="sd">        generated</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Create directory that will store figures</span>
        <span class="n">fig_dir</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;Figures&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fig_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">fig_dir</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ns</span><span class="p">:</span>
            <span class="n">ns</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">MultiGroupsLight</span><span class="o">.</span><span class="n">calls</span><span class="p">)</span>

        <span class="n">active_group_light</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_group_light</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">MultiGroupsLight</span><span class="o">.</span><span class="n">calls</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">ns</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ns</span><span class="o">.</span><span class="n">stop</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">KillByUser</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">ns</span><span class="o">.</span><span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">data</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">active_group_light</span><span class="p">,</span> <span class="n">command</span><span class="p">)(</span><span class="n">fig_dir</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">lgd</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">bar_plot</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>

            <span class="n">plot_file</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">fig_dir</span><span class="p">,</span> <span class="n">command</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lgd</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_file</span><span class="p">,</span> <span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">(</span><span class="n">lgd</span><span class="p">,),</span>
                            <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_file</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

        <span class="n">html</span> <span class="o">=</span> <span class="n">HtmlTemplate</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;Orthology report&quot;</span><span class="p">,</span> <span class="n">orthology_plots</span><span class="p">)</span>
        <span class="n">html</span><span class="o">.</span><span class="n">write_file</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;Orthology automatic report successfully &quot;</span>
                               <span class="s2">&quot;generated.&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.orto_compare_groups"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.orto_compare_groups">[docs]</a>    <span class="k">def</span> <span class="nf">orto_compare_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups_objs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">selected_groups</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Switches to the orthology group comparison screen and presents the</span>
<span class="sd">        initial plot comparing total orthologs across group files</span>
<span class="sd">        :param groups_objs: MultiGroupLight object. Provide only when</span>
<span class="sd">        updating filters in the plot screen</span>
<span class="sd">        :param selected_groups: list. If provided, should contain the name</span>
<span class="sd">        of the groups that should be plotted.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Displays correspondence</span>
        <span class="n">displays</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;total_ort&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;sp_ort&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;gn_ort&quot;</span><span class="p">:</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;final_ort&quot;</span><span class="p">:</span> <span class="s2">&quot;4&quot;</span><span class="p">}</span>

        <span class="c1"># Determine MultiGroupLight object</span>
        <span class="k">if</span> <span class="n">groups_objs</span><span class="p">:</span>
            <span class="n">groups_objs</span> <span class="o">=</span> <span class="n">groups_objs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">groups_objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span>

        <span class="c1"># Update slider max values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_spin</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> \
            <span class="nb">max</span><span class="p">(</span><span class="n">groups_objs</span><span class="o">.</span><span class="n">max_extra_copy</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sp_spin</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">groups_objs</span><span class="o">.</span><span class="n">species_number</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Update initial slider values</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">header_content</span><span class="o">.</span><span class="n">original_filt</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_spin</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orto_max_gene</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sp_spin</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orto_min_sp</span> <span class="k">if</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">orto_min_sp</span> <span class="o">!=</span> <span class="mi">3</span> <span class="k">else</span> <span class="n">groups_objs</span><span class="o">.</span><span class="n">species_number</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">header_content</span><span class="o">.</span><span class="n">original_filt</span> <span class="o">=</span> \
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_spin</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sp_spin</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">header_content</span><span class="o">.</span><span class="n">excluded_taxa</span> <span class="o">=</span> \
            <span class="n">groups_objs</span><span class="o">.</span><span class="n">excluded_taxa</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">active_group_name</span><span class="p">]</span>

        <span class="c1"># Set group object for screen. This property will be used when</span>
        <span class="c1"># changing  which filters should be displayed in the compare</span>
        <span class="c1"># plot screen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">group_obj</span> <span class="o">=</span> <span class="n">groups_objs</span>

        <span class="c1"># Get active displays</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">displays</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">active</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">stats</span><span class="p">:</span>
            <span class="c1"># Create first comparison plot of total orthologs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_plot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_lgd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_table</span> <span class="o">=</span> \
                <span class="n">groups_objs</span><span class="o">.</span><span class="n">bar_orthologs</span><span class="p">(</span><span class="n">group_names</span><span class="o">=</span><span class="n">selected_groups</span><span class="p">,</span>
                                          <span class="n">dest</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="n">stats</span><span class="p">)</span>

            <span class="c1"># Load plot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_plot</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;Final_orthologs.png&quot;</span><span class="p">),</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">plot_content</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">plot_content</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_plot_check_filters"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_plot_check_filters">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_plot_check_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">previous_filt</span><span class="p">,</span> <span class="n">prev_tx</span><span class="p">,</span>
                                  <span class="n">current_filt</span><span class="p">,</span> <span class="n">current_tx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dialog that is triggered when exiting a plot screen and the current</span>
<span class="sd">        plot filters are different from the filters before entering the plot</span>
<span class="sd">        screen. Will ask the user if the filters should be updated for the</span>
<span class="sd">        remaining app or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If filters are the same, do nothing and return</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">previous_filt</span> <span class="o">==</span> <span class="n">current_filt</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">prev_tx</span> <span class="o">==</span> <span class="n">current_tx</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">go_previous_screen</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">PlotChangeFilters</span><span class="p">()</span>

        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">prev_gn</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">previous_filt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">cur_gn</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_filt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">content</span><span class="o">.</span><span class="n">prev_filt</span> <span class="o">=</span> <span class="n">previous_filt</span>
        <span class="n">content</span><span class="o">.</span><span class="n">prev_tx</span> <span class="o">=</span> <span class="n">prev_tx</span>
        <span class="n">content</span><span class="o">.</span><span class="n">cur_filt</span> <span class="o">=</span> <span class="n">current_filt</span>
        <span class="n">content</span><span class="o">.</span><span class="n">cur_tx</span> <span class="o">=</span> <span class="n">current_tx</span>

        <span class="k">if</span> <span class="n">previous_filt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">current_filt</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">prev_gn</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_red</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">cur_gn</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_red</span>

        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">prev_min_tx</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">previous_filt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">cur_min_tx</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_filt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">previous_filt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">current_filt</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">prev_min_tx</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_red</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">cur_min_tx</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_red</span>

        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">prev_ex_tx</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prev_tx</span><span class="p">))</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">cur_ex_tx</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">current_tx</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">prev_tx</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">current_tx</span><span class="p">):</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">prev_ex_tx</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_red</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">cur_ex_tx</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_red</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">520</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span>
                        <span class="n">separator_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.orto_show_plot"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.orto_show_plot">[docs]</a>    <span class="k">def</span> <span class="nf">orto_show_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">active_group</span><span class="p">,</span> <span class="n">plt_idx</span><span class="p">,</span> <span class="n">filt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">exclude_taxa</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads a orto_plot screen for orthology graphical exploration based</span>
<span class="sd">        on the plot index. This method can be called in three ways:</span>

<span class="sd">        ..: Orthology Explore screen button, which generates the plot for</span>
<span class="sd">            the first time and sets initial attributes for plot screen</span>
<span class="sd">            header. This only uses the plt_idx argument.</span>
<span class="sd">        ..: Update button in plot screen, used after gene/species filters</span>
<span class="sd">            have been changed. This uses the plt_idx and filt arguments.</span>
<span class="sd">        ..: Taxa filter button in plot screen, used after changing the taxa</span>
<span class="sd">            that should be included in the plot analysis. This uses the</span>
<span class="sd">            plt_idx and exclude_taxa arguments</span>

<span class="sd">        :param active_group: Group Object.</span>
<span class="sd">        :param plt_idx: string, id of the plot in plt_method to issue the</span>
<span class="sd">        appropriate method</span>
<span class="sd">        :param filt: list, contains the gn and sp filters for group object,</span>
<span class="sd">        respectively. If none, this will set a new plot and all plot screen</span>
<span class="sd">        attributes. Else, it will only update the plot image and ortholog</span>
<span class="sd">        statistics.</span>
<span class="sd">        :param exclude_taxa: list, each element should be a taxon name to be</span>
<span class="sd">        excluded from the plot</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Set active group</span>
        <span class="k">if</span> <span class="n">active_group</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_group</span> <span class="o">=</span> <span class="n">active_group</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">active_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_group</span>

        <span class="c1"># Exclude taxa, if any</span>
        <span class="k">if</span> <span class="n">exclude_taxa</span><span class="p">:</span>
            <span class="c1"># If all taxa were excluded issue a warning and do nothing more</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">exclude_taxa</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">species_list</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                    <span class="s2">&quot;At least one taxon must be included.&quot;</span><span class="p">,</span>
                    <span class="n">t</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">)</span>

        <span class="c1"># Setting filters for the first time</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filt</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">exclude_taxa</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_spin</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">max_extra_copy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sp_spin</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">header_content</span><span class="o">.</span><span class="n">original_filt</span> <span class="o">=</span> \
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">max_extra_copy</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">header_content</span><span class="o">.</span><span class="n">root_filt</span> <span class="o">=</span> \
                <span class="p">[</span><span class="n">active_group</span><span class="o">.</span><span class="n">gene_threshold</span><span class="p">,</span> <span class="n">active_group</span><span class="o">.</span><span class="n">species_threshold</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">header_content</span><span class="o">.</span><span class="n">root_excluded</span> <span class="o">=</span> \
                <span class="n">active_group</span><span class="o">.</span><span class="n">excluded_taxa</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">exclude_taxa</span><span class="p">([])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">update_filters</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">max_extra_copy</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">run_in_background</span><span class="p">(</span>
            <span class="n">get_orto_data</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">orto_write_plot</span><span class="p">,</span>
            <span class="p">[</span><span class="n">active_group</span><span class="p">,</span> <span class="n">plt_idx</span><span class="p">,</span> <span class="n">filt</span><span class="p">,</span> <span class="n">exclude_taxa</span><span class="p">],</span>
            <span class="p">[</span><span class="n">plt_idx</span><span class="p">]</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.orto_write_plot"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.orto_write_plot">[docs]</a>    <span class="k">def</span> <span class="nf">orto_write_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot_data</span><span class="p">,</span> <span class="n">plt_idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provide with the data structure and a plt_idx string identifier, this</span>
<span class="sd">        function will create the plot file and update the plot screen.</span>
<span class="sd">        :param plot_data: list/np array, data structure to be used in plot</span>
<span class="sd">        construction</span>
<span class="sd">        :param plt_idx: string, identification string of the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">plot_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">plot_content</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;There is not data to plot with&quot;</span>
                                          <span class="s2">&quot;the current filters&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="c1"># Update excluded taxa attribute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">header_content</span><span class="o">.</span><span class="n">excluded_taxa</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">excluded_taxa</span>

        <span class="c1"># Update orthology filter attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">header_content</span><span class="o">.</span><span class="n">original_filt</span> <span class="o">=</span> \
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">gene_threshold</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">species_threshold</span><span class="p">]</span>

        <span class="c1"># Update orthology filter max values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_spin</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">max_extra_copy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sp_spin</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">species_list</span><span class="p">)</span>
        <span class="c1"># Update slider values if they are outside bounds</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_spin</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_spin</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_spin</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_spin</span><span class="o">.</span><span class="n">max</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sp_spin</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">species_list</span><span class="p">)):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sp_spin</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> \
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">species_list</span><span class="p">)</span>

        <span class="c1"># Set the current plt_idx for update reference</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">header_content</span><span class="o">.</span><span class="n">plt_idx</span> <span class="o">=</span> <span class="n">plt_idx</span>

        <span class="c1"># Update summary attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">orto_sum</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;[size=26][color=71c837ff]</span><span class="si">%s</span><span class="s2">&quot;</span> \
            <span class="s2">&quot;[/color][/size][size=13]/[color=ff5555ff]</span><span class="si">%s</span><span class="s2">[/color]&quot;</span> \
            <span class="s2">&quot;[/size]&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">all_compliant</span><span class="p">),</span>
             <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">all_clusters</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_sum</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;[size=26][color=71c837ff]</span><span class="si">%s</span><span class="s2">&quot;</span> \
            <span class="s2">&quot;[/color][/size][size=13]/[color=ff5555ff]</span><span class="si">%s</span><span class="s2">[/color]&quot;</span> \
            <span class="s2">&quot;[/size]&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">species_list</span><span class="p">),</span>
             <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">excluded_taxa</span><span class="p">)</span> <span class="o">+</span>
             <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">species_list</span><span class="p">))</span>

        <span class="c1"># Call corresponding method and catch plot object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_plot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_lgd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_table</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">orto_plt_method</span><span class="p">[</span><span class="n">plt_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">](</span><span class="o">**</span><span class="n">plot_data</span><span class="p">)</span>

        <span class="c1"># Get plot path</span>
        <span class="n">plot_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">orto_plt_method</span><span class="p">[</span><span class="n">plt_idx</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Save plot figure</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_lgd</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_plot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
                <span class="n">plot_path</span><span class="p">,</span>
                <span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_lgd</span><span class="p">,),</span>
                <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_plot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
                <span class="n">plot_path</span><span class="p">,</span>
                <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

        <span class="c1"># Load plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_plot</span><span class="p">(</span><span class="n">plot_path</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">plot_content</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="TriFusionApp.load_plot"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.load_plot">[docs]</a>    <span class="k">def</span> <span class="nf">load_plot</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">scatter_wgt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads a new plot into a ScatterLayout. This will clear all previous</span>
<span class="sd">        content and load a new image based on the file_path argument.</span>
<span class="sd">        This assumes that the current screen is a plot related screen.</span>
<span class="sd">        :param file_path: string. Path to the image to be loaded</span>
<span class="sd">        :param scatter_wgt: ScatterLayout object, where the plot is to be</span>
<span class="sd">        loaded</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Clear previous content</span>
        <span class="n">scatter_wgt</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>

        <span class="c1"># Add content</span>
        <span class="n">img_wgt</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">nocache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">scatter_wgt</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">img_wgt</span><span class="p">)</span>

        <span class="c1"># Reset position and scale of Scatter</span>
        <span class="n">scatter_wgt</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">scatter_wgt</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_set_exclude_orto_taxa"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_set_exclude_orto_taxa">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_set_exclude_orto_taxa</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a dialog for the orthology change filters option.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">set_excluded</span><span class="p">():</span>
            <span class="n">excluded_taxa</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">_subpopup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">rev_inlist</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                             <span class="n">x</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;normal&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">excluded_taxa</span><span class="p">)</span> <span class="o">==</span> \
                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_subpopup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">rev_inlist</span><span class="o">.</span><span class="n">children</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;At least one taxon must be &quot;</span>
                                              <span class="s2">&quot;included.&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">excluded_tx</span> <span class="o">=</span> <span class="n">excluded_taxa</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">exclude_bt</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> included&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">sp_list</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">ex_list</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">excluded_taxa</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_subpopup</span><span class="p">()</span>

        <span class="n">sp_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="o">.</span><span class="n">taxa_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">active_group_name</span><span class="p">]</span>
        <span class="n">ex_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="o">.</span><span class="n">excluded_taxa</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">active_group_name</span><span class="p">]</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">InputList</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_subpopup</span><span class="p">)</span>
        <span class="c1"># Show the select/deselect all buttons</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">selection_bx</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">50</span>

        <span class="c1"># Add button for each taxon</span>
        <span class="k">for</span> <span class="n">taxon</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sp_list</span> <span class="o">+</span> <span class="n">ex_list</span><span class="p">):</span>
            <span class="n">bt</span> <span class="o">=</span> <span class="n">TGToggleButton</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">taxon</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;down&quot;</span><span class="p">)</span>
            <span class="c1"># deselect button if taxa is excluded</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">excluded_tx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">taxon</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">excluded_tx</span><span class="p">:</span>
                    <span class="n">bt</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
            <span class="k">elif</span> <span class="n">taxon</span> <span class="ow">in</span> <span class="n">ex_list</span><span class="p">:</span>
                <span class="n">bt</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
            <span class="c1"># Add button to list</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">rev_inlist</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>

        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">ok_bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">set_excluded</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Included taxa&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">),</span> <span class="n">popup_level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_exclude_orto_taxa"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_exclude_orto_taxa">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_exclude_orto_taxa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plt_idx</span><span class="p">):</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">InputList</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>
        <span class="c1"># Show the select/deselect all buttons</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">selection_bx</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">50</span>

        <span class="c1"># Add button for each taxon</span>
        <span class="k">for</span> <span class="n">taxon</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">species_list</span> <span class="o">+</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">excluded_taxa</span><span class="p">):</span>
            <span class="n">bt</span> <span class="o">=</span> <span class="n">TGToggleButton</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">taxon</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;down&quot;</span><span class="p">)</span>
            <span class="c1"># deselect button if taxa is excluded</span>
            <span class="k">if</span> <span class="n">taxon</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="o">.</span><span class="n">excluded_taxa</span><span class="p">:</span>
                <span class="n">bt</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
            <span class="c1"># Add button to list</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">rev_inlist</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>

        <span class="c1"># Add bindings to Ok button</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">ok_bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="k">lambda</span> <span class="n">j</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_in_background</span><span class="p">(</span>
                <span class="n">get_active_group</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">orto_show_plot</span><span class="p">,</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_group</span><span class="p">,</span>
                 <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_group_name</span><span class="p">)],</span>
                <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">plt_idx</span><span class="p">),</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_spin</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                 <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sp_spin</span><span class="o">.</span><span class="n">value</span><span class="p">)],</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                     <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">rev_inlist</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;normal&quot;</span><span class="p">]],</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">cancel</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Included taxa&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.orto_change_state"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.orto_change_state">[docs]</a>    <span class="k">def</span> <span class="nf">orto_change_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggle selection or deselection of group checkboxes</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># In case all are already selected, deselect all</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_check</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> \
                <span class="nb">len</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_check</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                     <span class="n">x</span><span class="o">.</span><span class="n">active</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">chk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_check</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">chk</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">chk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_check</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">chk</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="TriFusionApp.orto_check_state"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.orto_check_state">[docs]</a>    <span class="k">def</span> <span class="nf">orto_check_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        sets the &quot;Compare&quot; button disabled attribute according to the</span>
<span class="sd">        number of active check boxes</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Change Compare button state</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_check</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                 <span class="n">x</span><span class="o">.</span><span class="n">active</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">compare_group_bt</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">compare_group_bt</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Check master check box state</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">active</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_check</span><span class="o">.</span><span class="n">children</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">master_chk</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">master_chk</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TriFusionApp.load_groups"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.load_groups">[docs]</a>    <span class="k">def</span> <span class="nf">load_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups_obj</span><span class="p">,</span> <span class="n">default_filters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the group files generated by the Orthology search or manually</span>
<span class="sd">        imported into the app. This method only accepts MultiGroup objects.</span>
<span class="sd">        Loading groups from files is more computationally intensive and</span>
<span class="sd">        should be done in the background using the run_in_background and</span>
<span class="sd">        load_group_files methods.</span>

<span class="sd">        :param groups_obj: MultiGroup object</span>
<span class="sd">        :param default_filters: Tuple. With filters for MultiGroups object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">groups_obj</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="o">.</span><span class="n">add_multigroups</span><span class="p">(</span><span class="n">groups_obj</span><span class="p">)</span>
                <span class="n">new_groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">groups_obj</span><span class="o">.</span><span class="n">groups</span> <span class="k">if</span>
                              <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="o">.</span><span class="n">duplicate_groups</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span> <span class="o">=</span> <span class="n">groups_obj</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="o">.</span><span class="n">filters</span> <span class="o">=</span> <span class="n">default_filters</span>
                <span class="n">new_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ortho_group_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">groups_obj</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

            <span class="c1"># Check if any group file is duplicate. If so, issue a warning</span>
            <span class="k">if</span> <span class="n">groups_obj</span><span class="o">.</span><span class="n">duplicate_groups</span> <span class="ow">or</span> <span class="n">groups_obj</span><span class="o">.</span><span class="n">bad_groups</span><span class="p">:</span>

                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                <span class="k">if</span> <span class="n">groups_obj</span><span class="o">.</span><span class="n">duplicate_groups</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;The following group files were found to be&quot;</span> \
                           <span class="s2">&quot; duplicate and were not loaded:</span><span class="se">\n\n</span><span class="s2">[b]</span><span class="si">%s</span><span class="s2">[/b]&quot;</span> <span class="o">%</span>\
                           <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                                     <span class="n">groups_obj</span><span class="o">.</span><span class="n">duplicate_groups</span><span class="p">)</span>

                    <span class="c1"># Reset duplicate_groups attribute</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="o">.</span><span class="n">duplicate_groups</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">if</span> <span class="n">groups_obj</span><span class="o">.</span><span class="n">bad_groups</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;The following group files could not be parsed &quot;</span>\
                           <span class="s2">&quot;as group files:</span><span class="se">\n\n</span><span class="s2">[b]</span><span class="si">%s</span><span class="s2">[/b]&quot;</span> <span class="o">%</span> \
                           <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                                     <span class="n">groups_obj</span><span class="o">.</span><span class="n">bad_groups</span><span class="p">)</span>

                    <span class="c1"># Reset bad_groups attribute</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="o">.</span><span class="n">bad_groups</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">dialog_warning</span><span class="p">(</span><span class="s2">&quot;Invalid group files detected&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">groups_obj</span><span class="o">.</span><span class="n">groups</span><span class="p">:</span>

                <span class="c1"># Removes &quot;No groups loaded&quot; button if it still exists</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_check</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">no_bt</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ReferenceError</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="c1"># Populate the app gridlayout with group buttons</span>
                <span class="k">for</span> <span class="n">gname</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">groups_obj</span><span class="o">.</span><span class="n">groups</span><span class="p">):</span>

                    <span class="c1"># If group name contains full path, get only file name</span>
                    <span class="n">gname_short</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">gname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="o">.</span><span class="n">duplicate_groups</span><span class="p">:</span>
                        <span class="c1"># Create check box for multiple group selection</span>
                        <span class="n">chk</span> <span class="o">=</span> <span class="n">CheckBox</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">gname</span><span class="p">,</span> <span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                                       <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
                        <span class="n">chk</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">orto_check_state</span><span class="p">())</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_check</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">chk</span><span class="p">)</span>

                        <span class="c1"># Create group button</span>
                        <span class="n">bt</span> <span class="o">=</span> <span class="n">ToggleButton</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">gname_short</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">gname</span><span class="p">,</span>
                            <span class="n">group</span><span class="o">=</span><span class="s2">&quot;group_bts&quot;</span><span class="p">,</span> <span class="n">size_hint_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">shorten</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shorten_from</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
                            <span class="n">halign</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">background_down</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                                 <span class="s2">&quot;bt_process.png&quot;</span><span class="p">),</span>
                            <span class="n">background_normal</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                                   <span class="s2">&quot;bt_process_off.png&quot;</span><span class="p">),</span>
                            <span class="n">background_disabled_down</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span>
                                                          <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                                          <span class="s2">&quot;bt_process.png&quot;</span><span class="p">),</span>
                            <span class="n">disabled_color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

                        <span class="c1"># Apparently I need to use partial instead of lambda</span>
                        <span class="c1"># in order to provide a diferent group object as</span>
                        <span class="c1"># argument. Using lambda will overwrite the group</span>
                        <span class="c1"># objects of all buttons with the last group of the</span>
                        <span class="c1"># iteration.</span>
                        <span class="n">bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orthology_card</span><span class="p">,</span>
                                                   <span class="n">gname</span><span class="p">))</span>

                        <span class="c1"># Add box to gridlayout</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_gl</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>

                        <span class="c1"># Create removal button</span>
                        <span class="n">x_bt</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                            <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">gname</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                            <span class="n">background_normal</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                                   <span class="s2">&quot;remove_bt.png&quot;</span><span class="p">),</span>
                            <span class="n">background_down</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                                 <span class="s2">&quot;remove_bt_down.png&quot;</span><span class="p">))</span>
                        <span class="n">x_bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">check_action</span><span class="p">,</span>
                            <span class="s2">&quot;Are you sure you want to remove this group?&quot;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">remove_groups</span><span class="p">))</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_rm</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">x_bt</span><span class="p">)</span>

                <span class="c1"># If last group name contains a directory, set it as the</span>
                <span class="c1"># default export dir</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">dirname</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">orto_export_dir</span> <span class="o">=</span> <span class="n">path</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">run_in_background</span><span class="p">(</span>
                    <span class="n">orto_update_filters</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">orthology_card</span><span class="p">,</span>
                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[],</span>
                     <span class="n">new_groups</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="kc">False</span><span class="p">,</span>
                    <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Setting up filters...&quot;</span><span class="p">,</span>
                    <span class="n">cancel</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.orthology_card"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.orthology_card">[docs]</a>    <span class="k">def</span> <span class="nf">orthology_card</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the descriptive cards with general information for a group</span>
<span class="sd">        file.</span>
<span class="sd">        :param group_name</span>
<span class="sd">        :param bt: ToggleButton instance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If no group button is active, dispatch the first</span>
        <span class="c1"># The comparison is done with __class__.__name__ to avoid</span>
        <span class="c1"># issues of the isinstance() method comparing the same class</span>
        <span class="c1"># instance from different imports (trifusion.ortho vs. ortho)</span>
        <span class="k">if</span> <span class="n">group_name</span> <span class="ow">and</span> <span class="n">group_name</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;MultiGroupsLight&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span> <span class="o">=</span> <span class="n">group_name</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="n">group_name</span> <span class="ow">and</span> <span class="ow">not</span> \
                <span class="n">group_name</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;MultiGroupsLight&quot;</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_gl</span><span class="o">.</span><span class="n">children</span>
                   <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">]</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_gl</span><span class="o">.</span><span class="n">children</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_gl</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_gl</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">group_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_gl</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">group_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">group_gl</span><span class="o">.</span><span class="n">children</span>
                          <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">active_group_name</span> <span class="o">=</span> <span class="n">group_name</span>

        <span class="c1"># Create desired behaviour for group toggle buttons</span>
        <span class="k">if</span> <span class="n">bt</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggle_groups</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>

        <span class="c1"># Get statistics from group object</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="o">.</span><span class="n">groups_stats</span><span class="p">[</span><span class="n">group_name</span><span class="p">][</span><span class="s2">&quot;stats&quot;</span><span class="p">]</span>

        <span class="c1"># Create cards</span>
        <span class="n">cards</span> <span class="o">=</span> <span class="n">DescriptionBox</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Populate card with group information</span>
        <span class="n">cards</span><span class="o">.</span><span class="n">prot_txt</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">cards</span><span class="o">.</span><span class="n">ortholog_txt</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">cards</span><span class="o">.</span><span class="n">taxa_txt</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="o">.</span><span class="n">groups_stats</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span>
                                 <span class="p">[</span><span class="s2">&quot;species&quot;</span><span class="p">]))</span>
        <span class="n">cards</span><span class="o">.</span><span class="n">group_name</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">group_name</span><span class="p">)</span>

        <span class="c1"># Create gauge plots, if there are any filtered groups</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="n">group_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="n">group_name</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_groups</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>

            <span class="c1"># Create species filter plot and add to box</span>
            <span class="n">sp_filter_plot</span> <span class="o">=</span> <span class="n">GaugePlot</span><span class="p">()</span>
            <span class="n">sp_filter_plot</span><span class="o">.</span><span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;After species filter&quot;</span>
            <span class="n">sp_filter_plot</span><span class="o">.</span><span class="n">proportion</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">sp_filter_plot</span><span class="o">.</span><span class="n">ortholog_num</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:,}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">cards</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gauge_bx</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">sp_filter_plot</span><span class="p">)</span>

            <span class="c1"># Create gene filter plot and add to box</span>
            <span class="n">gn_filter_plot</span> <span class="o">=</span> <span class="n">GaugePlot</span><span class="p">()</span>
            <span class="n">gn_filter_plot</span><span class="o">.</span><span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;After gene filter&quot;</span>
            <span class="n">gn_filter_plot</span><span class="o">.</span><span class="n">proportion</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">gn_filter_plot</span><span class="o">.</span><span class="n">ortholog_num</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:,}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">cards</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gauge_bx</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">gn_filter_plot</span><span class="p">)</span>

            <span class="c1"># Create final ortholog plot</span>
            <span class="n">final_ortholog_plot</span> <span class="o">=</span> <span class="n">GaugePlot</span><span class="p">()</span>
            <span class="n">final_ortholog_plot</span><span class="o">.</span><span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;Final orthologs&quot;</span>
            <span class="n">final_ortholog_plot</span><span class="o">.</span><span class="n">proportion</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">/</span> \
                <span class="nb">float</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">final_ortholog_plot</span><span class="o">.</span><span class="n">ortholog_num</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:,}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
            <span class="n">cards</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gauge_bx</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">final_ortholog_plot</span><span class="p">)</span>

        <span class="c1"># Add button to generate full report</span>
        <span class="n">full_rep_bt</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Generate full report&quot;</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                             <span class="n">background_normal</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                                    <span class="s2">&quot;check_ok.png&quot;</span><span class="p">),</span>
                             <span class="n">background_down</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                                  <span class="s2">&quot;check_cancel.png&quot;</span><span class="p">),</span>
                             <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                             <span class="n">font_size</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
        <span class="n">full_rep_bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">orto_report_dialog</span><span class="p">())</span>
        <span class="c1"># Anchor layout that will hold full report button</span>
        <span class="n">anc</span> <span class="o">=</span> <span class="n">AnchorLayout</span><span class="p">(</span><span class="n">anchor_y</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">achor_x</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                           <span class="n">size_hint_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">anc</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">full_rep_bt</span><span class="p">)</span>
        <span class="n">cards</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">card_gl</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>

        <span class="c1"># Add card</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_once</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">card_gl</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">cards</span><span class="p">),</span> <span class="o">.</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_once</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">Animation</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;out_quart&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span>
                <span class="n">cards</span><span class="p">),</span> <span class="o">.</span><span class="mi">3</span><span class="p">)</span></div>

    <span class="c1"># ########################## POPUP OPS #################################</span>

<div class="viewcode-block" id="TriFusionApp.show_popup"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.show_popup">[docs]</a>    <span class="k">def</span> <span class="nf">show_popup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">separator_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">close_bt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_dissmiss</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">popup_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">border_color</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        General purpose method to create a popup widget</span>

<span class="sd">        :param str title: Title of the popup</span>
<span class="sd">        :param widget content: The contents of the popup widget</span>
<span class="sd">        :param tuple size_hint: Size hint for the widget</span>
<span class="sd">        :param tuple size: The absolute size for the popup. If this</span>
<span class="sd">        argument is used, the size_hint will be ignored</span>
<span class="sd">        :param list separator_color: List with rgb color of popup separator</span>
<span class="sd">        :param bool close_bt: If True, Adds a (X) button to the top</span>
<span class="sd">        right of the popup that dismisses the popup</span>
<span class="sd">        :param bool auto_dismiss: Sets whether the popup should be</span>
<span class="sd">        automatically dismissed on pressing Esc</span>
<span class="sd">        :param int popup_level: Determines the level of the popup. Two</span>
<span class="sd">        values are currently supported. 1 assigns the popup to _popup; 2</span>
<span class="sd">        assigns the popup to _subpopup</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># This prevents defining a mutable argument.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">separator_color</span><span class="p">:</span>
            <span class="n">separator_color</span> <span class="o">=</span> <span class="p">[</span><span class="mi">47</span> <span class="o">/</span> <span class="mf">255.</span><span class="p">,</span> <span class="mi">167</span> <span class="o">/</span> <span class="mf">255.</span><span class="p">,</span> <span class="mi">212</span> <span class="o">/</span> <span class="mf">255.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">border_color</span><span class="p">:</span>
            <span class="n">border_color</span> <span class="o">=</span> <span class="n">separator_color</span>

        <span class="c1"># Ignore size_hint is absolute size is provided</span>
        <span class="k">if</span> <span class="n">size</span><span class="p">:</span>
            <span class="n">popup_obj</span> <span class="o">=</span> <span class="n">CustomPopup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;[b]</span><span class="si">%s</span><span class="s2">[/b]&quot;</span> <span class="o">%</span> <span class="n">title</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                <span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="n">auto_dismiss</span><span class="o">=</span><span class="n">auto_dissmiss</span><span class="p">,</span>
                <span class="n">separator_color</span><span class="o">=</span><span class="n">separator_color</span><span class="p">,</span>
                <span class="n">border_color</span><span class="o">=</span><span class="n">border_color</span><span class="p">,</span>
                <span class="n">separator_height</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
                <span class="n">title_color</span><span class="o">=</span><span class="n">separator_color</span><span class="p">,</span>
                <span class="n">background</span><span class="o">=</span><span class="s2">&quot;data/backgrounds/transparent.png&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">popup_obj</span> <span class="o">=</span> <span class="n">CustomPopup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;[b]</span><span class="si">%s</span><span class="s2">[/b]&quot;</span> <span class="o">%</span> <span class="n">title</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">size_hint</span><span class="o">=</span><span class="n">size_hint</span><span class="p">,</span>
                <span class="n">separator_color</span><span class="o">=</span><span class="n">separator_color</span><span class="p">,</span>
                <span class="n">border_color</span><span class="o">=</span><span class="n">border_color</span><span class="p">,</span>
                <span class="n">auto_dismiss</span><span class="o">=</span><span class="n">auto_dissmiss</span><span class="p">,</span>
                <span class="n">title_color</span><span class="o">=</span><span class="n">separator_color</span><span class="p">,</span>
                <span class="n">separator_height</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
                <span class="n">background</span><span class="o">=</span><span class="s2">&quot;data/backgrounds/transparent.png&quot;</span><span class="p">)</span>

        <span class="n">popup_obj</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_dismiss</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_close_float</span><span class="p">)</span>

        <span class="n">popup_obj</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">popup_level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span> <span class="o">=</span> <span class="n">popup_obj</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_subpopup</span> <span class="o">=</span> <span class="n">popup_obj</span>

        <span class="k">if</span> <span class="n">close_bt</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">25</span><span class="p">,</span>
                   <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">25</span><span class="p">)</span>
            <span class="n">rm_wgt</span> <span class="o">=</span> <span class="n">CloseFloat</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">rm_wgt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span> <span class="k">if</span> <span class="n">popup_level</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_subpopup</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">rm_wgt</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.dismiss_all_popups"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dismiss_all_popups">[docs]</a>    <span class="k">def</span> <span class="nf">dismiss_all_popups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method that force closes all popups in thre screen</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">wgt</span> <span class="ow">in</span> <span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CustomPopup</span><span class="p">)):</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">dismiss</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">rm_wgt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                      <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CloseFloat</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">rm_wgt</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="TriFusionApp.dismiss_close_float"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dismiss_close_float">[docs]</a>    <span class="k">def</span> <span class="nf">dismiss_close_float</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use to automatically remove any possibly CloseFloat widgets from the</span>
<span class="sd">        root window, when a Popup is automatically dismissed</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">rm_wgt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                      <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CloseFloat</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">rm_wgt</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="TriFusionApp.dismiss_popup"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dismiss_popup">[docs]</a>    <span class="k">def</span> <span class="nf">dismiss_popup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        General purpose method to close popups from the screen</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">dismiss</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rm_wgt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                          <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CloseFloat</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">rm_wgt</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span></div>

<div class="viewcode-block" id="TriFusionApp.dismiss_subpopup"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dismiss_subpopup">[docs]</a>    <span class="k">def</span> <span class="nf">dismiss_subpopup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        General purpose method to close sub-popups from the screen</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subpopup</span><span class="o">.</span><span class="n">dismiss</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">rm_wgt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span>
                      <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CloseFloat</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">rm_wgt</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="TriFusionApp.dismiss_exit"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dismiss_exit">[docs]</a>    <span class="k">def</span> <span class="nf">dismiss_exit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dismiss function for exit popup</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exit_popup</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exit_popup</span><span class="o">.</span><span class="n">dismiss</span><span class="p">()</span></div>

    <span class="c1"># ########################## PROCESS SCREEN ############################</span>

<div class="viewcode-block" id="TriFusionApp.save_file"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.save_file">[docs]</a>    <span class="k">def</span> <span class="nf">save_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_close</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds functionality to the save button in the output file chooser. It</span>
<span class="sd">        gathers information on the specified path through filechooser, file</span>
<span class="sd">        name through textinput and the widget text when called.</span>

<span class="sd">        For now, only one main output file can be provided, so the its path</span>
<span class="sd">        is stored in a string attribute.</span>

<span class="sd">        :param path: string. complete path</span>
<span class="sd">        :param file_name: string. file name only</span>
<span class="sd">        :param idx: string. An id of where the filechooser is calling. This</span>
<span class="sd">        allows the addition of custom behaviours for different dialogs</span>
<span class="sd">        :param auto_close: Boolean. When True, the dismiss_popup method is called in</span>
<span class="sd">        the end of the function</span>
<span class="sd">        :param suffix: string. Allow the addition of a suffix to the file name</span>
<span class="sd">        or to be save in an attribute</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;main_output&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_operations</span><span class="p">[</span><span class="s2">&quot;concatenation&quot;</span><span class="p">]:</span>
                <span class="c1"># Adds output file to storage</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">unicode</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;utf8&quot;</span><span class="p">),</span>
                                            <span class="n">file_name</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">path</span>
                <span class="c1"># Renames the output file button text</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">conv</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">file_name</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">conv</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">conversion_suffix</span> <span class="o">=</span> <span class="n">suffix</span>

        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;ortho_dir&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ortho_dir</span> <span class="o">=</span> <span class="n">path</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">orto_dir</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;protein_db&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">protein_db</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;cds_db&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cds_db</span> <span class="o">=</span> <span class="n">path</span>

        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;orto_export_dir&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">orto_export_dir</span> <span class="o">=</span> <span class="n">path</span>

        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;ima2_popfile&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ima2_options</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span>

        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;zorro_dir&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zorro_dir</span> <span class="o">=</span> <span class="n">path</span>

        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;mcl_fix&quot;</span><span class="p">:</span>

            <span class="c1"># The mcl executable requires the .exe extension in windows to</span>
            <span class="c1"># work properly</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;win32&quot;</span><span class="p">,</span> <span class="s2">&quot;cygwin&quot;</span><span class="p">]:</span>
                <span class="n">mcl_string</span> <span class="o">=</span> <span class="s2">&quot;mcl.exe&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mcl_string</span> <span class="o">=</span> <span class="s2">&quot;mcl&quot;</span>

            <span class="c1"># Copy new mcl_file to app_dir</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_exec</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;mcl&quot;</span><span class="p">):</span>
                <span class="c1"># Copy mcl executable to app dir</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data_dir</span><span class="p">,</span> <span class="n">mcl_string</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mcl_file</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data_dir</span><span class="p">,</span> <span class="n">mcl_string</span><span class="p">)</span>
                <span class="c1"># Make it executable</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mcl_file</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mcl_file</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">|</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IEXEC</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_all_popups</span><span class="p">()</span>
                <span class="c1"># Set the orthology fields to green</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">mcl_check</span><span class="o">.</span><span class="n">background_src</span> <span class="o">=</span> \
                    <span class="s2">&quot;data/backgrounds/green_noise.png&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">mcl_check_ico</span><span class="o">.</span><span class="n">icon_src</span> <span class="o">=</span> \
                    <span class="s2">&quot;data/backgrounds/check_icon.png&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">mcl_check_ico</span><span class="o">.</span><span class="n">icon_size</span> <span class="o">=</span> \
                    <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">mcl_check_lbl</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
                    <span class="s2">&quot;MCL is installed and reachable&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">mcl_fix_box</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;The provided MCL executable does &quot;</span>
                                       <span class="s2">&quot;not seem to be correct.&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;usearch_fix&quot;</span><span class="p">:</span>
            <span class="c1"># Copy new usearch_file to app_dir</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data_dir</span><span class="p">,</span> <span class="s2">&quot;usearch&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">usearch_file</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_data_dir</span><span class="p">,</span> <span class="s2">&quot;usearch&quot;</span><span class="p">)</span>
            <span class="c1"># Make it executable</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">usearch_file</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">usearch_file</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">|</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IEXEC</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_exec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">usearch_file</span><span class="p">,</span> <span class="s2">&quot;usearch&quot;</span><span class="p">):</span>
                <span class="c1"># Copy mcl executable to app dir</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_all_popups</span><span class="p">()</span>
                <span class="c1"># Set the orthology fields to green</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">usearch_check</span><span class="o">.</span><span class="n">background_src</span> <span class="o">=</span>\
                    <span class="s2">&quot;data/backgrounds/green_noise.png&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">usearch_check_ico</span><span class="o">.</span><span class="n">icon_src</span> <span class="o">=</span> \
                    <span class="s2">&quot;data/backgrounds/check_icon.png&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">usearch_check_ico</span><span class="o">.</span><span class="n">icon_size</span> <span class="o">=</span> \
                    <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">usearch_check_lbl</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
                    <span class="s2">&quot;USEARCH is installed and reachable&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_search_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">usearch_fix</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">usearch_file</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">usearch_file</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;The provided USEARCH executable&quot;</span>
                                       <span class="s2">&quot; does &quot;</span>
                                       <span class="s2">&quot;not seem to be correct.&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">auto_close</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.save_format"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.save_format">[docs]</a>    <span class="k">def</span> <span class="nf">save_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method that stores the output formats specified through the formats</span>
<span class="sd">        dialog in the Process screen.</span>

<span class="sd">        The active formats are stored in a self.output_formats list</span>

<span class="sd">        :param value: widget object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Add the selected output formats to the storage list and remove</span>
        <span class="c1"># deselected formats if they have been selected before</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">wgt</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wgt</span><span class="p">,</span> <span class="n">ToggleButton</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">wgt</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span> <span class="ow">and</span> <span class="n">idx</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_formats</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_formats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">wgt</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;normal&quot;</span> <span class="ow">and</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_formats</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_formats</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_formats</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                <span class="s2">&quot;Please choose at least one output format&quot;</span><span class="p">,</span>
                <span class="n">t</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span>

        <span class="c1"># If IMa2 is among the chosen ouptut formats, issue its</span>
        <span class="c1"># additional options dialog.</span>
        <span class="k">if</span> <span class="s2">&quot;ima2&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_formats</span><span class="p">:</span>
            <span class="c1"># Only show dialog when the additional options have not been set</span>
            <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ima2_options</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dialog_ima2_extra</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.save_gapfilter"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.save_gapfilter">[docs]</a>    <span class="k">def</span> <span class="nf">save_gapfilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filter_act</span><span class="p">,</span> <span class="n">within_chk</span><span class="p">,</span> <span class="n">among_chk</span><span class="p">,</span> <span class="n">gap_val</span><span class="p">,</span>
                       <span class="n">mis_val</span><span class="p">,</span> <span class="n">min_tx_val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stores the information of the FilterDialog</span>
<span class="sd">        :param filter_act: Boolean, whether the filter is active (True) or</span>
<span class="sd">        not (False)</span>
<span class="sd">        :param within_chk: Boolean, whether the within alignment filter</span>
<span class="sd">        is active (True) or not (False)</span>
<span class="sd">        :param among_chk: Boolean, whether the multiple alignments filter</span>
<span class="sd">        is active (True) or not (False)</span>
<span class="sd">        :param gap_val: integer, proportion of gap threshold</span>
<span class="sd">        :param mis_val: integer, proportion of missing data threshold</span>
<span class="sd">        :param min_tx_val: integer, proportion of minimum taxa</span>
<span class="sd">        representation</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">filter_act</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">within_chk</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">among_chk</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;Warning: No filters were &quot;</span>
                <span class="s2">&quot;checked. Specify at least one to active the filter.&quot;</span><span class="p">,</span>
                                          <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">secondary_options</span><span class="p">[</span><span class="s2">&quot;gap_filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filter_act</span>

        <span class="c1"># Save only when the filter is set to active</span>
        <span class="k">if</span> <span class="n">filter_act</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">missing_filter_settings</span> <span class="o">=</span> <span class="p">[(</span><span class="n">within_chk</span><span class="p">,</span> <span class="n">gap_val</span><span class="p">,</span> <span class="n">mis_val</span><span class="p">),</span>
                                            <span class="p">(</span><span class="n">among_chk</span><span class="p">,</span> <span class="n">min_tx_val</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.save_taxafilter"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.save_taxafilter">[docs]</a>    <span class="k">def</span> <span class="nf">save_taxafilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filter_act</span><span class="p">,</span> <span class="n">filter_mode</span><span class="p">,</span> <span class="n">taxa_group</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stores the information of the taxa filter dialog of the process</span>
<span class="sd">        screen</span>
<span class="sd">        :param filter_mode: string, determines the taxa filtering mode. Can</span>
<span class="sd">        be either &#39;Contain&#39; or &#39;Exclude&#39;</span>
<span class="sd">        :param taxa_group: string, with the name of the taxa group that</span>
<span class="sd">        should be present in the taxa_group attribute</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check if a taxa group has been selected. If not issue a warning</span>
        <span class="c1"># and do not close popup</span>
        <span class="k">if</span> <span class="n">taxa_group</span> <span class="o">==</span> <span class="s2">&quot;No group selected&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;Warning: A taxa group must be &quot;</span>
                <span class="s2">&quot;specified to activate the filter&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">secondary_options</span><span class="p">[</span><span class="s2">&quot;taxa_filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filter_act</span>

        <span class="c1"># Save only when the filter is set to active</span>
        <span class="k">if</span> <span class="n">filter_act</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">taxa_filter_settings</span> <span class="o">=</span> <span class="p">[</span><span class="n">filter_mode</span><span class="p">,</span> <span class="n">taxa_group</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_all_popups</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.save_codonfilter"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.save_codonfilter">[docs]</a>    <span class="k">def</span> <span class="nf">save_codonfilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filter_act</span><span class="p">,</span> <span class="n">position_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stores the information of the alignment filter dialog of the process</span>
<span class="sd">        screen</span>
<span class="sd">        :param filter_act: Boolean, whether the filter is active (True) or</span>
<span class="sd">        not (False)</span>
<span class="sd">        :param position_list: A list of three elements, containing which</span>
<span class="sd">        positions should be saved (True) or filtered (False)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">secondary_options</span><span class="p">[</span><span class="s2">&quot;codon_filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filter_act</span>

        <span class="k">if</span> <span class="n">filter_act</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">codon_filter_settings</span> <span class="o">=</span> <span class="n">position_list</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.save_variationfilter"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.save_variationfilter">[docs]</a>    <span class="k">def</span> <span class="nf">save_variationfilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filter_act</span><span class="p">,</span> <span class="o">*</span><span class="n">pargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stores the information of the variation filter dialog.</span>
<span class="sd">        :param filter_act: Boolean, whether the filter is active (True) or</span>
<span class="sd">        not (False)</span>
<span class="sd">        :param pargs, list of tuples, with first element being the</span>
<span class="sd">        checkbox active property and the second element the value of said</span>
<span class="sd">        parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check if any parameter was checked. If not, issue warning and</span>
        <span class="c1"># do not close popup</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pargs</span><span class="p">])</span> <span class="ow">and</span> <span class="n">filter_act</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;Warning: No parameters were &quot;</span>
                <span class="s2">&quot;checked. Specify at least one to activate the filter.&quot;</span><span class="p">,</span>
                                          <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="c1"># Check if all checked parameters have values. If not,</span>
        <span class="c1"># issue warning and do not close popup</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;Warning: Checked &quot;</span>
                    <span class="s2">&quot;parameters must have values specified.&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="c1"># Check for consistency between min and max values</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pargs</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">pargs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">pargs</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;Warning: Minimum values &quot;</span>
                        <span class="s2">&quot;cannot be greater than maximum values&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">secondary_options</span><span class="p">[</span><span class="s2">&quot;variation_filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filter_act</span>

        <span class="k">if</span> <span class="n">filter_act</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pargs</span><span class="p">):</span>
                <span class="n">p</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">variation_filter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.save_ima2_opts"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.save_ima2_opts">[docs]</a>    <span class="k">def</span> <span class="nf">save_ima2_opts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pop_string</span><span class="p">,</span> <span class="n">mutation</span><span class="p">,</span> <span class="n">inheritance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check each text input parameter given by the user and, if they</span>
<span class="sd">        checkout, saves them.</span>
<span class="sd">        :param pop_string: string, with population tree</span>
<span class="sd">        :param mutation:  string, with mutation model</span>
<span class="sd">        :param inheritance: string, with inheritance scalar</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">msg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ima2_options</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pop_string</span><span class="p">,</span> <span class="n">mutation</span><span class="p">,</span>
                           <span class="n">inheritance</span><span class="p">],</span>
                          <span class="p">[</span><span class="s2">&quot;population file&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;population tree string&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;mutation model&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;inheritance scalar&quot;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;Please specify a &quot;</span>
                                              <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ima2_options</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pop_string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ima2_options</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">mutation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ima2_options</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">inheritance</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_all_popups</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_ima2_extra"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_ima2_extra">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_ima2_extra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">popup_level</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dialog with extra options for IMa2 output format</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">popup_level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">IMa2Extra</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">IMa2Extra</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_subpopup</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ima2_options</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">popfile</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ima2_options</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ima2_options</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="p">[</span><span class="s2">&quot;pop_string&quot;</span><span class="p">,</span>
                                                  <span class="s2">&quot;mutation&quot;</span><span class="p">,</span>
                                                  <span class="s2">&quot;inheritance&quot;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">i</span>

        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;IMa2 additional options&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">380</span><span class="p">,</span> <span class="mi">310</span><span class="p">),</span>
                        <span class="n">popup_level</span><span class="o">=</span><span class="n">popup_level</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_nexus_extra"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_nexus_extra">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_nexus_extra</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dialog with extra options for nexus output format</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">NexusExtra</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_subpopup</span><span class="p">)</span>

        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">nexus_check</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_nexus_partitions</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">nexus_model_check</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_nexus_models</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Nexus extra options&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">210</span><span class="p">),</span> <span class="n">popup_level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_phylip_extra"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_phylip_extra">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_phylip_extra</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dialog with extra options for phylip output format</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">PhylipExtra</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_subpopup</span><span class="p">)</span>

        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">part_check</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_partfile</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">trunc_names_check</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phylip_truncate_name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Phylip extra options&quot;</span><span class="p">,</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">230</span><span class="p">),</span>
                        <span class="n">popup_level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_fasta_extra"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_fasta_extra">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_fasta_extra</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dialog with extra options for fasta output format</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">FastaExtra</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_subpopup</span><span class="p">)</span>

        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">ldhat_check</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ld_hat</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Fasta extra options&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">160</span><span class="p">),</span> <span class="n">popup_level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.save_zorro_settings"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.save_zorro_settings">[docs]</a>    <span class="k">def</span> <span class="nf">save_zorro_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">suffix</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the information provided by the user in the ZorroDialog</span>
<span class="sd">        :param suffix: string, suffix of the ZORRO files</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Only perform file checking is switch is active</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">zorro_switch</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>

            <span class="c1"># Check if the zorro files exist</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span><span class="p">:</span>
                <span class="c1"># Check if a specific directory for the ZORRO files has been</span>
                <span class="c1"># specified. If so, get only the file name of the</span>
                <span class="c1"># active_file_list and use the zorro_dir to provide the path</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zorro_dir</span><span class="p">:</span>
                    <span class="n">f</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">f</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}{}</span><span class="s2">.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zorro_dir</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span> <span class="n">suffix</span><span class="p">)</span>
                <span class="c1"># If zorro_dir is not specified, assume that the ZORRO files</span>
                <span class="c1"># are in he same working directory of the input files</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">f</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">.txt&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                        <span class="s2">&quot;File </span><span class="si">%s</span><span class="s2"> does not exist&quot;</span> <span class="o">%</span> <span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_process_switch</span><span class="p">(</span>
            <span class="s2">&quot;zorro&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">zorro_switch</span><span class="o">.</span><span class="n">active</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_options</span><span class="p">[</span><span class="s2">&quot;zorro&quot;</span><span class="p">]:</span>
            <span class="c1"># Save auxiliary files suffix</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zorro_suffix</span> <span class="o">=</span> <span class="n">suffix</span>
            <span class="c1"># Change background and text of the Zorro button in process</span>
            <span class="c1"># options</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">zorro</span><span class="o">.</span><span class="n">background_normal</span> <span class="o">=</span> \
                <span class="s2">&quot;data/backgrounds/bt_process.png&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">zorro</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Active&quot;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">zorro</span><span class="o">.</span><span class="n">background_normal</span> <span class="o">=</span> \
                <span class="s2">&quot;data/backgrounds/bt_process_off.png&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">zorro</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;OFF&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.save_reverseconc_partfile"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.save_reverseconc_partfile">[docs]</a>    <span class="k">def</span> <span class="nf">save_reverseconc_partfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partfile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save partition file for reverse concatenation an update button in</span>
<span class="sd">        reverse concatenation dialog</span>
<span class="sd">        :param partfile: string. Path to partition file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_subpopup</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">partitions_file</span> <span class="o">=</span> <span class="n">partfile</span>

        <span class="c1"># Update partition file button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">part_file</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">partfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">part_file</span><span class="o">.</span><span class="n">background_normal</span> <span class="o">=</span> \
            <span class="s2">&quot;data/backgrounds/bt_process.png&quot;</span>

        <span class="c1"># Deactivate user defined partitions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">use_parts</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_app_partitions</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Change background of used defined partition button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">use_parts</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_floatcheck"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_floatcheck">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_floatcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dl</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a floating label with informative text on the right upper</span>
<span class="sd">        corner of the app. This is used for showing errors, warnings and</span>
<span class="sd">        general informative messages that fade in and fade out after a time</span>
<span class="sd">        :param text: string, text to appear in the label</span>
<span class="sd">        :param t: string, with type of check. Can be either error or info</span>
<span class="sd">        :param dl: integer, duration of the float</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">fade_in</span><span class="p">():</span>
            <span class="n">Animation</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;out_quart&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">check_wgt</span><span class="p">)</span>
            <span class="n">Animation</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;out_quart&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">rm_wgt</span><span class="p">)</span>
            <span class="n">Animation</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;out_quart&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">ico_wgt</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">fade_out</span><span class="p">():</span>
            <span class="c1"># Get height of warning</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">check_wgt</span><span class="o">.</span><span class="n">height</span>
            <span class="n">pos_h</span> <span class="o">=</span> <span class="n">check_wgt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">wgt</span> <span class="ow">in</span> <span class="p">[</span><span class="n">check_wgt</span><span class="p">,</span> <span class="n">rm_wgt</span><span class="p">,</span> <span class="n">ico_wgt</span><span class="p">]:</span>
                <span class="n">Animation</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;out_quart&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">wgt</span><span class="p">)</span>

            <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_once</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">dt</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">check_wgt</span><span class="p">),</span> <span class="o">.</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_once</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">dt</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">rm_wgt</span><span class="p">),</span> <span class="o">.</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_once</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">dt</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">ico_wgt</span><span class="p">),</span> <span class="o">.</span><span class="mi">2</span><span class="p">)</span>

            <span class="c1"># Check if any warnings are still present. If so, update vertical</span>
            <span class="c1"># position</span>
            <span class="n">current_floats</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span>
                              <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">WarningFloat</span><span class="p">)</span> <span class="ow">or</span>
                              <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">RemoveFloat</span><span class="p">)</span> <span class="ow">or</span>
                              <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">IconFloat</span><span class="p">)]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_floats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">wgt</span> <span class="ow">in</span> <span class="n">current_floats</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">pos_h</span> <span class="o">&gt;</span> <span class="n">wgt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">wgt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">wgt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">15</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span>
                        <span class="n">Animation</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;out_quart&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">wgt</span><span class="p">)</span>

        <span class="c1"># The spacing variable will be updated depending on the number of</span>
        <span class="c1"># warning floats present in the root window.</span>
        <span class="n">spacing</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Check if float is already present.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">wf</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">children</span>
                  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">WarningFloat</span><span class="p">)]</span>

            <span class="c1"># If a warning with the same text is already present, ignore</span>
            <span class="k">if</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">wf</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="n">text</span><span class="p">]:</span>
                <span class="k">return</span>

            <span class="c1"># Else, update the spacing according to the number of floats</span>
            <span class="c1"># present</span>
            <span class="n">spacing</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="mi">15</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">wf</span><span class="p">])</span>

        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Get position from root window</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">size</span>

        <span class="c1"># Create widget</span>
        <span class="n">check_wgt</span> <span class="o">=</span> <span class="n">WarningFloat</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">markup</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">check_wgt</span><span class="o">.</span><span class="n">texture_update</span><span class="p">()</span>
        <span class="n">check_wgt</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">check_wgt</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span> \
            <span class="n">y</span> <span class="o">-</span> <span class="n">check_wgt</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">60</span> <span class="o">-</span> <span class="n">spacing</span>
        <span class="c1"># Create remove button</span>
        <span class="n">rm_wgt</span> <span class="o">=</span> <span class="n">RemoveFloat</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">38</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">75</span> <span class="o">-</span> <span class="n">spacing</span><span class="p">),</span> <span class="n">opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">rm_wgt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="k">lambda</span> <span class="n">arg</span><span class="p">:</span> <span class="n">fade_out</span><span class="p">())</span>
        <span class="c1"># Create icon float</span>
        <span class="n">ico_wgt</span> <span class="o">=</span> <span class="n">IconFloat</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="n">check_wgt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span>
                                 <span class="n">check_wgt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">check_wgt</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                                 <span class="o">-</span> <span class="mi">10</span><span class="p">),</span> <span class="n">opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Determine background color</span>
        <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">]:</span>
            <span class="n">check_wgt</span><span class="o">.</span><span class="n">background_src</span> <span class="o">=</span> <span class="s2">&quot;data/backgrounds/red_noise.png&quot;</span>
            <span class="n">ico_wgt</span><span class="o">.</span><span class="n">icon_src</span> <span class="o">=</span> <span class="s2">&quot;data/backgrounds/warning_icon.png&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">check_wgt</span><span class="o">.</span><span class="n">background_src</span> <span class="o">=</span> <span class="s2">&quot;data/backgrounds/green_noise.png&quot;</span>
            <span class="n">ico_wgt</span><span class="o">.</span><span class="n">icon_src</span> <span class="o">=</span> <span class="s2">&quot;data/backgrounds/check_icon.png&quot;</span>
            <span class="n">ico_wgt</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
            <span class="n">ico_wgt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span>

        <span class="c1"># Add widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">check_wgt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">rm_wgt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_window</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">ico_wgt</span><span class="p">)</span>

        <span class="c1"># Set animations</span>
        <span class="n">fade_in</span><span class="p">()</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_once</span><span class="p">(</span><span class="k">lambda</span> <span class="n">arg</span><span class="p">:</span> <span class="n">fade_out</span><span class="p">(),</span> <span class="n">dl</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.check_partitions_file"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.check_partitions_file">[docs]</a>    <span class="k">def</span> <span class="nf">check_partitions_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This will make some checks on the partitions file provided by the</span>
<span class="sd">        user. It will check for errors in the format of the file itself,</span>
<span class="sd">        and whether the partitions are correctly defined</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">aln_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">retrieve_alignment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rev_infile</span><span class="p">)</span>

        <span class="n">part_obj</span> <span class="o">=</span> <span class="n">Partitions</span><span class="p">()</span>
        <span class="n">part_obj</span><span class="o">.</span><span class="n">set_length</span><span class="p">(</span><span class="n">aln_obj</span><span class="o">.</span><span class="n">locus_length</span><span class="p">)</span>

        <span class="n">er</span> <span class="o">=</span> <span class="n">part_obj</span><span class="o">.</span><span class="n">read_from_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">partitions_file</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">er</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">er</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dialog_warning</span><span class="p">(</span><span class="s2">&quot;Invalid partitions file&quot;</span><span class="p">,</span> <span class="n">er</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">er</span></div>

        <span class="c1"># Check for the validity of the partitions file</span>
        <span class="c1"># if isinstance(er, InvalidPartitionFile):</span>
        <span class="c1">#     return self.dialog_floatcheck(</span>
        <span class="c1">#         &quot;The provided partitions file is invalid. Please check &quot;</span>
        <span class="c1">#         &quot;the file or replace with an appropriate one.&quot;, t=&quot;error&quot;)</span>
        <span class="c1">#</span>
        <span class="c1"># # Check for the validity of the partitions file</span>
        <span class="c1"># if isinstance(aln_er, InvalidPartitionFile):</span>
        <span class="c1">#     return self.dialog_floatcheck(str(aln_er), t=&quot;error&quot;)</span>
        <span class="c1"># else:</span>
        <span class="c1">#     return True</span>

<div class="viewcode-block" id="TriFusionApp.save_reverseconc_settings"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.save_reverseconc_settings">[docs]</a>    <span class="k">def</span> <span class="nf">save_reverseconc_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_parts</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the information provided by the LoadDialog with settings</span>
<span class="sd">        for the reverse concatenation</span>
<span class="sd">        :param use_parts: boolean. If True, use a partition file. Else</span>
<span class="sd">        Use user defined partitions</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitions_file</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rev_infile</span> <span class="ow">and</span> \
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_app_partitions</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">main_operations</span><span class="p">[</span><span class="s2">&quot;reverse_concatenation&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;Please provide a partition &quot;</span>
                    <span class="s2">&quot;file and file to reverse concatenate OR use defined &quot;</span>
                    <span class="s2">&quot;partitions defined in side panel.&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_app_partitions</span><span class="p">:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitions_file</span><span class="p">:</span>
                <span class="c1"># Check if partition file was selected. If not, return</span>
                <span class="c1"># warning</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                    <span class="s2">&quot;Please provide a partitions file.&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rev_infile</span><span class="p">:</span>
                <span class="c1"># Check if file to reverse concatenate was specified. If</span>
                <span class="c1"># not, return warning</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                    <span class="s2">&quot;Please provide a file to reverse concatenate.&quot;</span><span class="p">,</span>
                    <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

            <span class="c1"># Check for the validity of the partitions file</span>
            <span class="n">er</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_partitions_file</span><span class="p">()</span>

            <span class="c1"># Prevent further action is the partitions file is invalid</span>
            <span class="k">if</span> <span class="n">er</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_operations</span><span class="p">[</span><span class="s2">&quot;reverse_concatenation&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">rev_conc</span><span class="o">.</span><span class="n">background_normal</span> <span class="o">=</span> \
                <span class="s2">&quot;data/backgrounds/bt_process.png&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">rev_conc</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Active&quot;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">rev_conc</span><span class="o">.</span><span class="n">background_normal</span> <span class="o">=</span> \
                <span class="s2">&quot;data/backgrounds/bt_process_off.png&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">rev_conc</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;OFF&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_format"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_format">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_format</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the dialog containing the buttons to select output formats.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Inherits the layout defined in the .kv file under &lt;FormatDialog&gt;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">FormatDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>

        <span class="c1"># This will mark the respective buttons for each format as active</span>
        <span class="c1"># or not depending on whether they have been previously selected</span>
        <span class="c1"># or not. It allows the selected button states to be persistent</span>
        <span class="c1"># when visiting the popup multiple times</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">wgt</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_formats</span><span class="p">:</span>
                <span class="n">wgt</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wgt</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>

        <span class="c1"># Show popup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Choose output format&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">500</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_reverse_inlist"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_reverse_inlist">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_reverse_inlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">InputList</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_subpopup</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">set_infile</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="n">wgt</span><span class="p">):</span>

            <span class="c1"># Update file to reverse concatenate button</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rev_infile</span> <span class="o">=</span> <span class="n">txt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">rev_infile</span><span class="o">.</span><span class="n">background_normal</span> <span class="o">=</span> \
                <span class="s2">&quot;data/backgrounds/bt_process.png&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">rev_infile</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
            <span class="c1"># Deactivate use defined partitions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">use_parts</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_app_partitions</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_subpopup</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">:</span>
                <span class="n">bt</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">basename</span><span class="p">(</span><span class="n">infile</span><span class="p">),</span> <span class="n">size_hint_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shorten</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">shorten_from</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">halign</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                            <span class="n">valign</span><span class="o">=</span><span class="s2">&quot;middle&quot;</span><span class="p">)</span>
                <span class="n">bt</span><span class="o">.</span><span class="n">text_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">3.5</span>
                <span class="n">bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">set_infile</span><span class="p">,</span> <span class="n">infile</span><span class="p">))</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">rev_inlist</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Choose input file&quot;</span><span class="p">,</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">),</span>
                        <span class="n">popup_level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_reverse_concatenation"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_reverse_concatenation">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_reverse_concatenation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Choose input file&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a general purpose file chooser to request additional data</span>
<span class="sd">        :param title: string, A custom title for the load data dialog popup</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">RevConcDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">rev_conc</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">main_operations</span><span class="p">[</span><span class="s2">&quot;reverse_concatenation&quot;</span><span class="p">]</span>

        <span class="c1"># Check if use app partitions button has been selected</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_app_partitions</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">use_parts</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>

        <span class="c1"># Check if partitions file was already selected. If so, update the</span>
        <span class="c1"># corresponding button</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitions_file</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">part_file</span><span class="o">.</span><span class="n">background_normal</span> <span class="o">=</span> \
                <span class="s2">&quot;data/backgrounds/bt_process.png&quot;</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">part_file</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">partitions_file</span><span class="p">)</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">defined</span><span class="o">.</span><span class="n">collapse</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">manual</span><span class="o">.</span><span class="n">collapse</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Check if input file to reverse concatenate was already selected.</span>
        <span class="c1">#  If so, update the corresponding button</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rev_infile</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">rev_infile</span><span class="o">.</span><span class="n">background_normal</span> <span class="o">=</span> \
                <span class="s2">&quot;data/backgrounds/bt_process.png&quot;</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">rev_infile</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rev_infile</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">360</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_app_partitions</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">defined</span><span class="o">.</span><span class="n">collapse</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">manual</span><span class="o">.</span><span class="n">collapse</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">manual</span><span class="o">.</span><span class="n">collapse</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">defined</span><span class="o">.</span><span class="n">collapse</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_load_partfile"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_load_partfile">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_load_partfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">SaveDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_subpopup</span><span class="p">,</span>
                             <span class="n">bookmark_init</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmark_init</span><span class="p">)</span>

        <span class="c1"># If input files have already been provided, use their directory</span>
        <span class="c1"># as a starting point for the partition file chooser. Otherwise,</span>
        <span class="c1"># use the home path</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sd_filechooser</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span>
                <span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sd_filechooser</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">home_path</span>

        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sd_filechooser</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;partition_file&quot;</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_box</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_box</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Choose partition file&quot;</span><span class="p">,</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">),</span>
                        <span class="n">popup_level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_filechooser"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_filechooser">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_filechooser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">popup_level</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a file chooser popup for the user to select an output file</span>

<span class="sd">        :param idx: string. An id of where the filechooser is calling. This</span>
<span class="sd">        allows the addition of custom behaviours for different dialogs</span>
<span class="sd">        :param popup_level: int, level of popup. 1 for _popup, 2 for</span>
<span class="sd">        _subpopup and 3 for exit popup</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">update_bw_box</span><span class="p">(</span><span class="n">ext_wgt</span><span class="p">,</span> <span class="n">bw_wgt</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Function used to update the disable status of the black and white</span>
<span class="sd">            check box depending on the plot extensions that is selected</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">ext_wgt</span><span class="o">.</span><span class="n">text</span> <span class="o">!=</span> <span class="s2">&quot;.png&quot;</span><span class="p">:</span>
                <span class="n">bw_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">bw</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">bw_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">bw</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">bw_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">lbl</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bw_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">bw</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">bw_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">lbl</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Determines cancel action depending on popup_level</span>
        <span class="n">cancel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span> <span class="k">if</span> <span class="n">popup_level</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_subpopup</span>

        <span class="c1"># Lists the idx that require the selection of file extensions</span>
        <span class="n">idx_with_ext</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;export_graphic&quot;</span><span class="p">]</span>

        <span class="c1"># Lists the idx that do not required file name</span>
        <span class="n">idx_no_file</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ortho_dir&quot;</span><span class="p">,</span> <span class="s2">&quot;zorro_dir&quot;</span><span class="p">,</span> <span class="s2">&quot;protein_db&quot;</span><span class="p">,</span> <span class="s2">&quot;mcl_fix&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;usearch_fix&quot;</span><span class="p">,</span> <span class="s2">&quot;cds_db&quot;</span><span class="p">]</span>

        <span class="c1"># Maps idx for which an extension label is provided in the filechooser</span>
        <span class="c1"># The key is the idx, the value is the extension to appear in the label</span>
        <span class="n">idx_ext_label</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;export_outliers&quot;</span><span class="p">:</span> <span class="s2">&quot;.txt&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;export_table&quot;</span><span class="p">:</span> <span class="s2">&quot;.csv&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;export&quot;</span><span class="p">:</span> <span class="s2">&quot;.txt&quot;</span><span class="p">}</span>

        <span class="c1"># Inherits the layout defined in the .kv file under &lt;SaveDialog&gt;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">SaveDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="n">cancel</span><span class="p">,</span>
                             <span class="n">bookmark_init</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bookmark_init</span><span class="p">)</span>

        <span class="c1"># Maps the filechooser idx to the corresponding title</span>
        <span class="n">title_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;main_output&quot;</span><span class="p">:</span>
                <span class="s2">&quot;Choose destination directory of output file(s)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;export&quot;</span><span class="p">:</span>
                <span class="s2">&quot;Choose file for exportation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;export_table&quot;</span><span class="p">:</span>
                <span class="s2">&quot;Export as table...&quot;</span><span class="p">,</span>
            <span class="s2">&quot;export_graphic&quot;</span><span class="p">:</span>
                <span class="s2">&quot;Export as graphic...&quot;</span><span class="p">,</span>
            <span class="s2">&quot;zorro_dir&quot;</span><span class="p">:</span>
                <span class="s2">&quot;Choose directory with ZORRO weight files&quot;</span><span class="p">,</span>
            <span class="s2">&quot;protein_db&quot;</span><span class="p">:</span>
                <span class="s2">&quot;Choose protein sequence database file&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cds_db&quot;</span><span class="p">:</span>
                <span class="s2">&quot;Choose cds/transcript sequence database file(s)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;export_outliers&quot;</span><span class="p">:</span>
                <span class="s2">&quot;Export outliers...&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ortho_dir&quot;</span><span class="p">:</span>
                <span class="s2">&quot;Choose destination directory for OrthoMCL output files...&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mcl_fix&quot;</span><span class="p">:</span>
                <span class="s2">&quot;Select the MCL executable...&quot;</span><span class="p">,</span>
            <span class="s2">&quot;usearch_fix&quot;</span><span class="p">:</span>
                <span class="s2">&quot;Select the USEARCH executable...&quot;</span>
        <span class="p">}</span>

        <span class="c1"># Add extension selection spinner, if idx in idx_with_ext</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idx_with_ext</span><span class="p">:</span>
            <span class="n">ext_spinner</span> <span class="o">=</span> <span class="n">ExtSpinner</span><span class="p">()</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_box</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="s2">&quot;ext&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ext_spinner</span>
            <span class="n">bw_box</span> <span class="o">=</span> <span class="n">BWCheck</span><span class="p">()</span>
            <span class="n">ext_spinner</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">update_bw_box</span><span class="p">(</span><span class="n">ext_spinner</span><span class="p">,</span>
                                                             <span class="n">bw_box</span><span class="p">))</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_box</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">ext_spinner</span><span class="p">)</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_box</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">bw_box</span><span class="p">)</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_box</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="s2">&quot;bw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bw_box</span>

        <span class="c1"># Remove file name text input if idx in idx_no_file</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idx_no_file</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_box</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_box</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Add extension label if idx in idx_ext_label</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idx_ext_label</span><span class="p">:</span>
            <span class="n">ext_label</span> <span class="o">=</span> <span class="n">ExtLabel</span><span class="p">()</span>
            <span class="n">ext_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">idx_ext_label</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_box</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">ext_label</span><span class="p">)</span>

        <span class="c1"># Custom behaviour for main output file chooser dialog</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;main_output&quot;</span><span class="p">:</span>
            <span class="c1"># If the main operation is conversion or reverse concatenation,</span>
            <span class="c1"># remove the TextInput asking for the file name</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_operations</span><span class="p">[</span><span class="s2">&quot;conversion&quot;</span><span class="p">]</span> <span class="ow">or</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">main_operations</span><span class="p">[</span><span class="s2">&quot;reverse_concatenation&quot;</span><span class="p">]:</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Suffix:&quot;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conversion_suffix</span><span class="p">:</span>
                    <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">text_input</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conversion_suffix</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">text_input</span><span class="o">.</span><span class="n">hint_text</span> <span class="o">=</span> \
                        <span class="s2">&quot;Suffix that will be appended to each output file &quot;</span> \
                        <span class="s2">&quot;name. You may leave empty.&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">title_map</span><span class="p">[</span><span class="s2">&quot;main_output&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Choose output file&quot;</span>

        <span class="c1"># Custom behaviour for orthology output directory</span>
        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;ortho_dir&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ortho_dir</span><span class="p">:</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sd_filechooser</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ortho_dir</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;cds_db&quot;</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sd_filechooser</span><span class="o">.</span><span class="n">multiselect</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Save output file for conversion/concatenation purposes</span>
        <span class="c1"># Providing this operation will allow the filechooser widget to</span>
        <span class="c1"># know which output file is this</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sd_filechooser</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">idx</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title_map</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">popup_level</span><span class="o">=</span><span class="n">popup_level</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_taxafilter"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_taxafilter">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_taxafilter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates dialog for taxa filter in the additional options of the</span>
<span class="sd">        process screen</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">TaxaFilterDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_all_popups</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Advanced taxa filter&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">350</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_codonfilter"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_codonfilter">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_codonfilter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates dialog for alignment filter in the additional options of</span>
<span class="sd">        the process screen</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">CodonFilterDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Advanced alignment filter&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">330</span><span class="p">,</span> <span class="mi">280</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_filter"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_filter">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the settings popup for filtering options</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">FilterDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>
        <span class="c1"># Update filter values if they were changed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_filter_settings</span><span class="p">:</span>
            <span class="c1"># For within alignment</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">within_chk</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">missing_filter_settings</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gap_sli</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_filter_settings</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">mis_sli</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_filter_settings</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

            <span class="c1"># For minimum taxa</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">among_chk</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">missing_filter_settings</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">min_taxa</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_filter_settings</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gap_filter</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_options</span><span class="p">[</span><span class="s2">&quot;gap_filter&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Set filter thresholds&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">490</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_variationfilter"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_variationfilter">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_variationfilter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the settings popup for variation filter options</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">p_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;var_min&quot;</span><span class="p">,</span> <span class="s2">&quot;var_min_val&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;var_max&quot;</span><span class="p">,</span> <span class="s2">&quot;var_max_val&quot;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s2">&quot;inf_min&quot;</span><span class="p">,</span> <span class="s2">&quot;inf_min_val&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;inf_max&quot;</span><span class="p">,</span> <span class="s2">&quot;inf_max_val&quot;</span><span class="p">)]</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">VariationFilterDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>

        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">variation_filter</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_options</span><span class="p">[</span>
            <span class="s2">&quot;variation_filter&quot;</span><span class="p">]</span>

        <span class="c1"># Populate content with previous filters</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variation_filter</span><span class="p">):</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">p_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">p</span> <span class="k">else</span> <span class="kc">False</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">p_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Set variation filter options&quot;</span><span class="p">,</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">440</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_filter_report"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_filter_report">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_filter_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filtered_stats</span><span class="p">,</span> <span class="n">nalns</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates graphic report at the end of a processing operation</span>
<span class="sd">        with active filters</span>
<span class="sd">        :param filtered_stats: Dictionary with the values of the filtered</span>
<span class="sd">         alignments for each filter type</span>
<span class="sd">        :param nalns: integer, total number of processed alignments</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">FilterGraphicReport</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>

        <span class="c1"># Set total number of alignments</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">total_alns</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nalns</span><span class="p">)</span>

        <span class="c1"># Set final alignments</span>
        <span class="n">final_alns</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">filtered_stats</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="p">])</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">final_box</span><span class="o">.</span><span class="n">size_hint_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">final_alns</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">nalns</span><span class="p">)</span>
        <span class="n">content</span><span class="o">.</span><span class="n">bar_color</span> <span class="o">=</span> <span class="p">(</span><span class="o">.</span><span class="mi">44</span><span class="p">,</span> <span class="o">.</span><span class="mi">78</span><span class="p">,</span> <span class="o">.</span><span class="mi">22</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">final_alns</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">final_txt</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">final_alns</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">final_box</span><span class="o">.</span><span class="n">size_hint_x</span> <span class="o">=</span> <span class="mf">0.00001</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">final_txt2</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>

        <span class="c1"># Set graphics for each filter</span>
        <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">filtered_stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="n">filt_wgt</span> <span class="o">=</span> <span class="n">IndividualFilterWgt</span><span class="p">()</span>
            <span class="n">filt_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_lbl</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">f</span>
            <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
                <span class="n">filt_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gf_box</span><span class="o">.</span><span class="n">size_hint_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">nalns</span><span class="p">)</span>
                <span class="n">filt_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gf_txt</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">filt_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gf_box</span><span class="o">.</span><span class="n">size_hint_x</span> <span class="o">=</span> <span class="mf">0.00001</span>
                <span class="n">filt_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gf_txt2</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">filt_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gf_box</span><span class="o">.</span><span class="n">size_hint_x</span> <span class="o">=</span> <span class="mf">0.00001</span>
                <span class="n">filt_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gf_txt2</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Not applied&quot;</span>

            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">filter_bx</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">filt_wgt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="s2">&quot;Filter report&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">520</span><span class="p">))</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="TriFusionApp.check_variation_filters"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.check_variation_filters">[docs]</a>    <span class="k">def</span> <span class="nf">check_variation_filters</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Same function as check_filters method, but checks only for</span>
<span class="sd">        integer compliance</span>
<span class="sd">        :param value: text_input.text</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># Check if value can be converted to float by removing</span>
            <span class="c1"># all non digits. To avoid problems like converting 2.23</span>
            <span class="c1"># to 223, the first step is to get the first value before</span>
            <span class="c1">#  a &quot;.&quot;, if any</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">all_d</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">maketrans</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">nodigs</span> <span class="o">=</span> <span class="n">all_d</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">all_d</span><span class="p">,</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">,</span> <span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">all_d</span><span class="p">,</span> <span class="n">nodigs</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="TriFusionApp.check_filters"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.check_filters">[docs]</a>    <span class="k">def</span> <span class="nf">check_filters</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method that validates the input of the text input in filter</span>
<span class="sd">        settings. It handles common mistakes, such as using &quot;,&quot; instead</span>
<span class="sd">        of &quot;.&quot; for decimal places and truncates values between the range</span>
<span class="sd">        of 0 and 100. If the text input cannot be converted to float,</span>
<span class="sd">        it will return false and the slider value will not change</span>
<span class="sd">        :param value: text_input.text</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Check if value can be converted to float just by replacing</span>
            <span class="c1"># &quot;,&quot; to &quot;.&quot;</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Check if value can be converted to float by removing</span>
                <span class="c1"># all non digits. To avoid problems like converting 2.23</span>
                <span class="c1"># to 223, the first step is to get the first value before</span>
                <span class="c1">#  a &quot;.&quot;, if any</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">all_d</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">maketrans</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">nodigs</span> <span class="o">=</span> <span class="n">all_d</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">all_d</span><span class="p">,</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">,</span> <span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">all_d</span><span class="p">,</span> <span class="n">nodigs</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">corrected_val</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">corrected_val</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">corrected_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">corrected_val</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="TriFusionApp.check_partition_split"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.check_partition_split">[docs]</a>    <span class="k">def</span> <span class="nf">check_partition_split</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">prange</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method that validates the text input for manual split of partitions.</span>
<span class="sd">        Ensures that the input can be converted to int, and whether it is</span>
<span class="sd">        inside the available range.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Check if value can be converted to int</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Check if value can be converted to int by removing</span>
                <span class="c1"># all non digits.</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">all_d</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">maketrans</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">nodigs</span> <span class="o">=</span> <span class="n">all_d</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">all_d</span><span class="p">,</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">,</span> <span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">all_d</span><span class="p">,</span> <span class="n">nodigs</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">prange</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">corrected_val</span> <span class="o">=</span> <span class="n">prange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">prange</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">corrected_val</span> <span class="o">=</span> <span class="n">prange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">corrected_val</span> <span class="o">=</span> <span class="n">x</span>

        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">corrected_val</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_execution"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_execution">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_execution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the dialog for Process execution. It also preforms several</span>
<span class="sd">        sanity checks before issuing the dialog</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                <span class="s2">&quot;No input files were loaded or are active&quot;</span><span class="p">,</span>
                <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">ExecutionDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>

        <span class="c1"># Get number of files to be processed</span>
        <span class="n">fs_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">active_file_set</span><span class="o">.</span><span class="n">text</span>

        <span class="c1"># Get total number of files loaded</span>
        <span class="k">if</span> <span class="n">fs_name</span> <span class="o">==</span> <span class="s2">&quot;All files&quot;</span><span class="p">:</span>
            <span class="n">file_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">)</span>

        <span class="c1"># Get active files</span>
        <span class="k">elif</span> <span class="n">fs_name</span> <span class="o">==</span> <span class="s2">&quot;Active files&quot;</span><span class="p">:</span>
            <span class="n">file_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span><span class="p">)</span>

        <span class="c1"># Get files from custom file set</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">file_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_groups</span><span class="p">[</span><span class="n">fs_name</span><span class="p">])</span>

        <span class="c1"># Perform pre-execution checks</span>

        <span class="c1"># Get main operation</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">main_op</span> <span class="o">=</span> <span class="p">[</span><span class="n">nm</span> <span class="k">for</span> <span class="n">nm</span><span class="p">,</span> <span class="n">bl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_operations</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                       <span class="k">if</span> <span class="n">bl</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_op</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;[b][size=18][color=37abc8ff]Main &quot;</span> \
                <span class="s2">&quot;operation:[/color][/size][/b] </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">main_op</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                <span class="s2">&quot;Please select a main operation&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="c1"># Get secondary operations</span>
        <span class="n">secondary_op</span> <span class="o">=</span> <span class="p">[</span><span class="n">nm</span> <span class="k">for</span> <span class="n">nm</span><span class="p">,</span> <span class="n">bl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_operations</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">bl</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">secondary_op</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sec_op</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;[b][size=18][color=37abc8ff]&quot;</span> \
                <span class="s2">&quot;Secondary operation(s):[/color][/size][/b] </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>\
                <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">secondary_op</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sec_op</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;[b][size=18][color=37abc8ff]&quot;</span> \
                <span class="s2">&quot;Secondary operation(s):[/color][/size][/b] None&quot;</span>

        <span class="c1"># Get output formats</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">out_form</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;[b][size=18][color=37abc8ff]Output &quot;</span> \
            <span class="s2">&quot;format(s):[/color][/size][/b] </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output_formats</span><span class="p">)</span>

        <span class="c1"># Get output files</span>
        <span class="c1"># In case concatenation</span>
        <span class="k">if</span> <span class="n">main_op</span> <span class="o">==</span> <span class="s2">&quot;concatenation&quot;</span><span class="p">:</span>
            <span class="c1"># Check if an output directory has been selected</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                    <span class="s2">&quot;No output file has been selected&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

            <span class="n">out_file</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="p">)</span>
            <span class="n">add_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">out_file</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">nm</span> <span class="k">for</span> <span class="n">nm</span><span class="p">,</span> <span class="n">bl</span> <span class="ow">in</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">secondary_operations</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">bl</span> <span class="ow">and</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">secondary_options</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_file&quot;</span> <span class="o">%</span> <span class="n">nm</span><span class="p">]]</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">out_files</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;[b][size=18][color=37abc8ff]&quot;</span> \
                <span class="s2">&quot;Output file(s):[/color][/size][/b] (</span><span class="si">%s</span><span class="s2">) </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">add_files</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">out_file</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">add_files</span><span class="p">))</span>

        <span class="c1"># In case conversion</span>
        <span class="k">if</span> <span class="n">main_op</span> <span class="o">==</span> <span class="s2">&quot;conversion&quot;</span><span class="p">:</span>
            <span class="c1"># Check if an output file has been selected</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                    <span class="s2">&quot;No output directory has been selected&quot;</span><span class="p">,</span>
                    <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Check for additional files</span>
                <span class="n">add_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">nm</span> <span class="k">for</span> <span class="n">nm</span><span class="p">,</span> <span class="n">bl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_operations</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                             <span class="k">if</span> <span class="n">bl</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_options</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_file&quot;</span> <span class="o">%</span> <span class="n">nm</span><span class="p">]]</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">out_files</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;[b][size=18][color=37abc8ff]&quot;</span>\
                    <span class="s2">&quot;Output file(s):[/color][/size][/b] </span><span class="si">%s</span><span class="s2"> converted &quot;</span> \
                    <span class="s2">&quot;file(s)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">file_num</span> <span class="o">+</span> <span class="n">file_num</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">add_files</span><span class="p">))</span>
            <span class="c1"># In case aln_obj has not being defined, probably because there</span>
            <span class="c1"># are no input files</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                    <span class="s2">&quot;No input files havebeen selected&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">main_op</span> <span class="o">==</span> <span class="s2">&quot;reverse_concatenation&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                    <span class="s2">&quot;No output directory has been selected&quot;</span><span class="p">,</span>
                    <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">main_op</span> <span class="o">==</span> <span class="s2">&quot;reverse_concatenation&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rev_infile</span> <span class="ow">and</span> \
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                <span class="s2">&quot;Reverse concatenation using partitions defined in &quot;</span>
                <span class="s2">&quot;the app requires only one input alignment. Please select&quot;</span>
                <span class="s2">&quot; a single file to reverse concatenate in the Reverse &quot;</span>
                <span class="s2">&quot;concatenate settings&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Process execution summary - Processing </span><span class="si">%s</span><span class="s2"> file(s)&quot;</span> <span class="o">%</span>
                      <span class="n">file_num</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">350</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                <span class="s2">&quot;No input files have been selected&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="c1"># Check if main operation is reverse concatenation and if the active</span>
        <span class="c1"># taxa set smaller than the complete set. If so, issue a warning</span>
        <span class="c1"># that individual partitions that do not contain any of the selected</span>
        <span class="c1"># taxa will not be written</span>
        <span class="k">if</span> <span class="n">main_op</span> <span class="o">==</span> <span class="s2">&quot;reverse_concatenation&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span> <span class="o">!=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">taxa_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dialog_warning</span><span class="p">(</span><span class="s2">&quot;Reverse concatenation warning&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;A data set is being reverse &quot;</span>
                                <span class="s2">&quot;concatenated with a taxa subset &quot;</span>
                                <span class="s2">&quot;specified. Individual alignments that&quot;</span>
                                <span class="s2">&quot; do not contain the selected/active&quot;</span>
                                <span class="s2">&quot; taxa will not be written&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_text"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_text">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a simple text dialog to capture text input</span>
<span class="sd">        :param title: string. Title of the popup</span>
<span class="sd">        :param idx: string. Identifier of the dialog</span>
<span class="sd">        :param msg: string. Option message to appear in the dialog input</span>
<span class="sd">        text</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;new_folder&quot;</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">TextDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_subpopup</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">TextDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>

        <span class="n">content</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">idx</span>

        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;haplotype&quot;</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_dlg</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hap_prefix</span>

        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;usearch_db&quot;</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_dlg</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">usearch_db</span>

        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;usearch_out&quot;</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_dlg</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">usearch_output</span>

        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;evalue&quot;</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_dlg</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">usearch_evalue</span>

        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;orto_group&quot;</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_dlg</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ortholog_prefix</span>

        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;groups&quot;</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_dlg</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_prefix</span>

        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;change_taxon&quot;</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_dlg</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">msg</span>
            <span class="n">content</span><span class="o">.</span><span class="n">old_name</span> <span class="o">=</span> <span class="n">msg</span>

        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;project&quot;</span><span class="p">:</span>

            <span class="c1"># This will generate a default name for the project, based on</span>
            <span class="c1"># untitled and a number. To avoid duplications, this increases</span>
            <span class="c1"># the counter c while there are untitled_[0-9] projects</span>
            <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projects_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">project_fh</span><span class="p">:</span>
                <span class="n">project_dic</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">project_fh</span><span class="p">)</span>
                <span class="k">while</span> <span class="s2">&quot;untitled_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="n">project_dic</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_dlg</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;untitled_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">txt_dlg</span><span class="o">.</span><span class="n">select_all</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;new_folder&quot;</span><span class="p">:</span>
            <span class="n">popup_level</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">popup_level</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">popup_level</span><span class="o">=</span><span class="n">popup_level</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">150</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_warning"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_warning">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg1</span><span class="p">,</span> <span class="n">msg2</span><span class="p">):</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">WarningDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_subpopup</span><span class="p">)</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">warning_l</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
            <span class="s2">&quot;[b][color=#ff5555ff][size=18]</span><span class="si">%s</span><span class="s2">[/size][/color][/b]</span><span class="se">\n\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>\
            <span class="p">(</span><span class="n">msg1</span><span class="p">,</span> <span class="n">msg2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;[b]Error![/b]&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">550</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>
                        <span class="n">separator_color</span><span class="o">=</span><span class="p">[</span><span class="mi">255</span> <span class="o">/</span> <span class="mf">255.</span><span class="p">,</span> <span class="mi">85</span> <span class="o">/</span> <span class="mf">255.</span><span class="p">,</span> <span class="mi">85</span> <span class="o">/</span> <span class="mf">255.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
                        <span class="n">popup_level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_zorro"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_zorro">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_zorro</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">ZorroDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>

        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">zorro_switch</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_options</span><span class="p">[</span><span class="s2">&quot;zorro&quot;</span><span class="p">]</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">zorro_txt</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zorro_suffix</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;ZORRO support&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">260</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.save_text"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.save_text">[docs]</a>    <span class="k">def</span> <span class="nf">save_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a text input, whose attribute depends on the idx argument</span>
<span class="sd">        :param text: string. The text to be assigned to the attribute</span>
<span class="sd">        :param idx: string. This will determine which attribute will be used</span>
<span class="sd">        property</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;haplotype&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hap_prefix</span> <span class="o">=</span> <span class="n">text</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">hapbt</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>

        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;usearch_db&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">usearch_db</span> <span class="o">=</span> <span class="n">text</span>

        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;usearch_out&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">usearch_output</span> <span class="o">=</span> <span class="n">text</span>

        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;evalue&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">usearch_evalue</span> <span class="o">=</span> <span class="n">text</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                    <span class="s2">&quot;E-value must be a number&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;orto_group&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ortholog_prefix</span> <span class="o">=</span> <span class="n">text</span>

        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="s2">&quot;groups&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">group_prefix</span> <span class="o">=</span> <span class="n">text</span></div>

<div class="viewcode-block" id="TriFusionApp.update_main_operations"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.update_main_operations">[docs]</a>    <span class="k">def</span> <span class="nf">update_main_operations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the app attribute containing the main operations of the</span>
<span class="sd">        Process screen, self.main_operations. Only one main operation can</span>
<span class="sd">        be active.</span>
<span class="sd">        :param op: The name of the operation to turn on (all others will be</span>
<span class="sd">        disabled)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The text of the Output file/directory field changes depending on</span>
<span class="sd">        whether the main operation is a concatenation or a conversion</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_text</span> <span class="o">=</span> <span class="s2">&quot;[size=18][b]Output file[/b][/size]</span><span class="se">\n</span><span class="s2">[size=13]Save &quot;</span> \
                    <span class="s2">&quot;output file to the selected file.[/size]&quot;</span>
        <span class="n">dir_text</span> <span class="o">=</span> <span class="s2">&quot;[size=18][b]Output directory[/b][/size]</span><span class="se">\n</span><span class="s2">[size=13]&quot;</span> \
                   <span class="s2">&quot;Save output file(s) to the selected directory.[/size]&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_operations</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">op</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">main_operations</span><span class="p">}</span>

        <span class="c1"># Disables output file button and other conversion/concatenation</span>
        <span class="c1"># specific buttons</span>
        <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;conversion&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">conv</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Select...&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">conv</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
                    <span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">output_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">dir_text</span>
            <span class="n">Animation</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">32</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;in_quad&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sub_conc</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;concatenation&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">conv</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Select...&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">conv</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
                    <span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">output_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">file_text</span>
            <span class="n">Animation</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">32</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;in_quad&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sub_conc</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;reverse_concatenation&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">conv</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Select...&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">conv</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
                    <span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">output_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">dir_text</span></div>

<div class="viewcode-block" id="TriFusionApp.save_main_operation"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.save_main_operation">[docs]</a>    <span class="k">def</span> <span class="nf">save_main_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This controls the appearance of the general options after the user</span>
<span class="sd">        chooses the main operation (Conversion vs. Concatenation). When the</span>
<span class="sd">        main operation is chosen for the first time, the general options</span>
<span class="sd">        are introduced, but further selection of the main operation only</span>
<span class="sd">        changes the state of the operations button.</span>
<span class="sd">        :param op: string, the main operations. values are &quot;concatenation&quot;</span>
<span class="sd">         and &quot;conversion&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If the general options widget is not shown yet, show them</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">opacity</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Add to Process screen, via the appropriate scrollview</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">process_sv</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="p">)</span>

            <span class="c1"># Store the original height of the gridlayout containing the</span>
            <span class="c1"># general options so that it can be updated</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">height</span>

            <span class="c1"># Animate the appearance of the general options via changes in</span>
            <span class="c1"># opacity to give a fade in effect</span>
            <span class="n">Animation</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">32</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;in_quad&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="p">)</span>

        <span class="c1"># Store the active main operation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_main_operations</span><span class="p">(</span><span class="n">op</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.toggle_process_options"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.toggle_process_options">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_process_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Controls the toggling of the GridLayout with the additional options</span>
<span class="sd">        for the process screen.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Shows additional options</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">opt_bt</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span>

            <span class="c1"># Adds widget to the Process widget tree an animates its</span>
            <span class="c1"># appearance via changes in opacity to give impression of fade</span>
            <span class="c1"># in</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_options</span><span class="p">)</span>

            <span class="n">Animation</span><span class="p">(</span>
                <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;in_quad&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_options</span><span class="p">)</span>

            <span class="c1"># Update the height of the GridLayout to allow scrolling</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_height</span> <span class="o">+</span> \
                <span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">height</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">process_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">filter_grid</span><span class="o">.</span><span class="n">children</span><span class="p">])</span> <span class="o">+</span> <span class="mi">100</span>

            <span class="c1"># Change text in the toggle button</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">opt_bt</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
                <span class="s2">&quot;Hide additional options&quot;</span>

        <span class="c1"># Hides additional options</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">opt_bt</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;normal&quot;</span><span class="p">:</span>

            <span class="c1"># Removes widget from widget tree. However, all settings that</span>
            <span class="c1">#  were change while the widget was visible will be stored</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_options</span><span class="p">)</span>

            <span class="c1"># Change text in the toggle button</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">opt_bt</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
                <span class="s2">&quot;Show additional options&quot;</span></div>

    <span class="c1"># ######################### STATISTICS SCREEN ##########################</span>

<div class="viewcode-block" id="TriFusionApp.toggle_stats_panel"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.toggle_stats_panel">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_stats_panel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_close</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force_open</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Controls the animation of the statistics panel</span>
<span class="sd">        :param force_close: Boolean. If True, close the stats panel</span>
<span class="sd">        regardless of current position</span>
<span class="sd">        :param force_open: Boolean. If True, open the stats panel</span>
<span class="sd">        regardless of current position</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">expanded_width</span> <span class="o">=</span> <span class="mi">410</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">stats_panel</span><span class="o">.</span><span class="n">width</span> <span class="o">==</span> <span class="n">expanded_width</span> <span class="ow">and</span> \
                <span class="ow">not</span> <span class="n">force_open</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sidepanel_animation</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">wgt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">stats_panel</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sidepanel_animation</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
                <span class="n">wgt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sidepanel_container</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">stats_panel</span><span class="o">.</span><span class="n">width</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force_close</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sidepanel_animation</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">expanded_width</span><span class="p">,</span>
                <span class="n">wgt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">stats_panel</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sidepanel_animation</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">expanded_width</span> <span class="o">+</span> <span class="mi">40</span><span class="p">,</span>
                <span class="n">wgt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sidepanel_container</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.toggle_stats_options"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.toggle_stats_options">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_stats_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bt</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggles the main data exploration analyses options in the Statistics</span>
<span class="sd">        screen</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">transfer_wgts</span><span class="p">(</span><span class="n">source_wgts</span><span class="p">,</span> <span class="n">sink_gl</span><span class="p">):</span>

            <span class="k">for</span> <span class="n">wgt</span> <span class="ow">in</span> <span class="n">source_wgts</span><span class="p">:</span>
                <span class="n">sink_gl</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">wgt</span><span class="p">)</span>

            <span class="n">sink_gl</span><span class="o">.</span><span class="n">active_grid</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">bt</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">bt</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Storage of Options buttons separated by major analysis types</span>
        <span class="n">wgts</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;General information&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">general_information</span><span class="p">,</span> <span class="p">[</span><span class="n">SizeDistribution</span><span class="p">(),</span>
                                                   <span class="n">NucAAProportions</span><span class="p">(),</span>
                                                   <span class="n">TaxaDistribution</span><span class="p">()]],</span>
            <span class="s2">&quot;Missing Data&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">missing_data_opts</span><span class="p">,</span> <span class="p">[</span><span class="n">GeneOccupancy</span><span class="p">(),</span>
                                                 <span class="n">MissingOrto</span><span class="p">(),</span>
                                                 <span class="n">MissingData</span><span class="p">(),</span>
                                                 <span class="n">CumulativeMissingOrto</span><span class="p">()]],</span>
            <span class="s2">&quot;Polymorphism and Variation&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">polymorphism_data_opts</span><span class="p">,</span> <span class="p">[</span><span class="n">SequenceSimilarity</span><span class="p">(),</span>
                                                      <span class="n">SegregatingSites</span><span class="p">(),</span>
                                                      <span class="n">LVCorrelation</span><span class="p">(),</span>
                                                      <span class="n">AFS</span><span class="p">()]],</span>
            <span class="s2">&quot;Outlier detection&quot;</span><span class="p">:</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">outlier_opts</span><span class="p">,</span> <span class="p">[</span><span class="n">OutlierMissing</span><span class="p">(),</span>
                                            <span class="n">OutlierSegregating</span><span class="p">(),</span>
                                            <span class="n">OutlierSize</span><span class="p">()]]}</span>

        <span class="c1"># Get active type</span>
        <span class="n">main_gl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_stats_opts</span>
        <span class="k">for</span> <span class="n">gl</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">main_gl</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">OptsGrid</span><span class="p">)]:</span>
            <span class="k">if</span> <span class="n">gl</span><span class="o">.</span><span class="n">active_grid</span><span class="p">:</span>
                <span class="n">active_gl</span> <span class="o">=</span> <span class="n">gl</span>

                <span class="k">if</span> <span class="n">active_gl</span><span class="o">.</span><span class="n">grid_name</span> <span class="o">==</span> <span class="n">idx</span><span class="p">:</span>
                    <span class="n">bt</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">active_gl</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
                    <span class="n">Animation</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">32</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;in_quad&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">active_gl</span><span class="p">)</span>
                    <span class="n">active_gl</span><span class="o">.</span><span class="n">active_grid</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Update sink grid height</span>
        <span class="n">gl_height</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="mi">10</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">wgts</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">5</span>
        <span class="n">Animation</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="n">gl_height</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">32</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;in_quad&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">wgts</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_once</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">transfer_wgts</span><span class="p">(</span><span class="n">wgts</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">wgts</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="o">.</span><span class="mi">32</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.stats_write_plot"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.stats_write_plot">[docs]</a>    <span class="k">def</span> <span class="nf">stats_write_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot_data</span><span class="p">,</span> <span class="n">footer</span><span class="p">,</span> <span class="n">plt_idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provided with the data structure and a plt_idx string identifier,</span>
<span class="sd">        this function will create the plot file and app variable,</span>
<span class="sd">        and load it into the Statistics screen.</span>

<span class="sd">        To configure the Gene/Species/Average plot trigger, this method</span>
<span class="sd">        impors the stats_compliant object from data/resources/stats.py</span>

<span class="sd">        :param plot_data: list/np array, data structure to be used in plot</span>
<span class="sd">        construction</span>
<span class="sd">        :param footer: List, containing information on the number of</span>
<span class="sd">        active genes and taxa</span>
<span class="sd">        :param plt_idx: string, identification string of the plot. Usually</span>
<span class="sd">        is the text property of the issuing button.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plot_data</span><span class="p">,</span> <span class="n">EmptyAlignment</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                <span class="s2">&quot;Active alignment is empty&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot_data</span><span class="p">:</span>

            <span class="k">if</span> <span class="s2">&quot;exception&quot;</span> <span class="ow">in</span> <span class="n">plot_data</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">plot_data</span><span class="p">[</span><span class="s2">&quot;exception&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;empty_data&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">plot_content</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                        <span class="s2">&quot;No data available for plotting&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">plot_data</span><span class="p">[</span><span class="s2">&quot;exception&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;single_alignment&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">plot_content</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                        <span class="s2">&quot;Selected plot cannot be executed on single &quot;</span>
                        <span class="s2">&quot;alignments&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">footer_box</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">populate_stats_footer</span><span class="p">([</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span> <span class="s2">&quot;NA&quot;</span><span class="p">])</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_plot_wgt</span><span class="p">()</span>

            <span class="c1"># Set new plot attributes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_plot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_lgd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_table</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">stats_plt_method</span><span class="p">[</span><span class="n">plt_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">](</span><span class="o">**</span><span class="n">plot_data</span><span class="p">)</span>

            <span class="c1"># Save plot elements in a backup. This backup can then be</span>
            <span class="c1"># accessed when fast switching plots.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_backups</span><span class="p">[</span><span class="n">plt_idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_table</span>

            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_plot</span><span class="p">,</span>
                        <span class="nb">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">plt_idx</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)),</span>
                             <span class="s2">&quot;wb&quot;</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_lgd</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_plot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
                    <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_plt_method</span><span class="p">[</span><span class="n">plt_idx</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_lgd</span><span class="p">,),</span>
                    <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_plot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
                    <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_plt_method</span><span class="p">[</span><span class="n">plt_idx</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

        <span class="c1"># Dismiss stats toggle widget, if present</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_stats_toggle</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">plt_idx</span> <span class="ow">in</span> <span class="n">stats_compliant</span><span class="p">:</span>
            <span class="c1"># Show toggle widget</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_stats_toggle</span><span class="p">(</span><span class="o">**</span><span class="n">stats_compliant</span><span class="p">[</span><span class="n">plt_idx</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_stats_toggle</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># List of plots for which an horizontal separator is available:</span>
        <span class="n">hseparator_plots</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Pairwise sequence similarity gn&quot;</span><span class="p">]</span>

        <span class="c1"># List of plots with a switcher between absolute values and</span>
        <span class="c1"># proportions</span>
        <span class="n">prop_plots</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;Segregating sites&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;Allele Frequency Spectrum&quot;</span><span class="p">],</span>
                      <span class="p">[</span><span class="s2">&quot;Segregating sites prop&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;Allele Frequency Spectrum prop&quot;</span><span class="p">]]</span>

        <span class="c1"># List of plots with outlier footer</span>
        <span class="n">outlier_plots</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Missing data outliers&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;Missing data outliers sp&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;Segregating sites outliers&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;Segregating sites outliers sp&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;Sequence size outliers&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;Sequence size outliers sp&quot;</span><span class="p">]</span>

        <span class="c1"># Adds or removes the horizontal threshold option slider from the</span>
        <span class="c1"># Screen footer</span>
        <span class="k">if</span> <span class="n">plt_idx</span> <span class="ow">in</span> <span class="n">hseparator_plots</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">footer_box</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
            <span class="n">hwgt</span> <span class="o">=</span> <span class="n">HseparatorFooter</span><span class="p">()</span>
            <span class="n">ylims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_plot</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="n">hwgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">hwgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> \
                <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ylims</span><span class="p">]</span>
            <span class="n">hwgt</span><span class="o">.</span><span class="n">plt_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_plt_method</span><span class="p">[</span><span class="n">plt_idx</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">footer_box</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">hwgt</span><span class="p">)</span>

        <span class="c1"># Adds or removes the Absolute/Proportion switcher from the footer</span>
        <span class="k">elif</span> <span class="n">plt_idx</span> <span class="ow">in</span> <span class="n">prop_plots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">prop_plots</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>

            <span class="n">swt</span> <span class="o">=</span> <span class="n">PropSwitcher</span><span class="p">()</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">prop_idx</span> <span class="o">=</span> <span class="n">prop_plots</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">prop_plots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">plt_idx</span><span class="p">)]</span>
                <span class="n">abs_idx</span> <span class="o">=</span> <span class="n">plt_idx</span>
                <span class="n">swt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">abs</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">abs_idx</span> <span class="o">=</span> <span class="n">prop_plots</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">prop_plots</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">plt_idx</span><span class="p">)]</span>
                <span class="n">prop_idx</span> <span class="o">=</span> <span class="n">plt_idx</span>
                <span class="n">swt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">proportion</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>

            <span class="c1"># Clear footer box</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">footer_box</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>

            <span class="c1"># Create PropSwitcher instance and provide plt_idx to checkboxes</span>
            <span class="n">swt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">abs</span><span class="o">.</span><span class="n">plt_idx</span> <span class="o">=</span> <span class="n">abs_idx</span>
            <span class="n">swt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">proportion</span><span class="o">.</span><span class="n">plt_idx</span> <span class="o">=</span> <span class="n">prop_idx</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">footer_box</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">swt</span><span class="p">)</span>

        <span class="c1"># Adds or removes outlier footer</span>
        <span class="k">elif</span> <span class="n">plt_idx</span> <span class="ow">in</span> <span class="n">outlier_plots</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">footer_box</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
            <span class="n">outlier_wgt</span> <span class="o">=</span> <span class="n">OutlierFooter</span><span class="p">()</span>

            <span class="c1"># Outliers are present when self.current_table is not None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_table</span><span class="p">:</span>
                <span class="n">outlier_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_table</span><span class="p">)</span>
                <span class="c1"># Set label with number of outliers</span>
                <span class="n">outlier_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">outlier_number</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
                    <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> outliers found&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outlier_num</span><span class="p">)</span>
                <span class="c1"># Set the data set type based on the ending of the</span>
                <span class="c1"># plt_idx. Species plots always end with &quot; sp&quot;</span>
                <span class="k">if</span> <span class="n">plt_idx</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot; sp&quot;</span><span class="p">):</span>
                    <span class="n">outlier_wgt</span><span class="o">.</span><span class="n">ds_type</span> <span class="o">=</span> <span class="s2">&quot;Taxa&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">outlier_wgt</span><span class="o">.</span><span class="n">ds_type</span> <span class="o">=</span> <span class="s2">&quot;Files&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If no outliers were found, disabled all buttons</span>
                <span class="n">outlier_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">o_rm</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">outlier_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">o_exp</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">outlier_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">o_view</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">outlier_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">outlier_number</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;No outliers found&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">footer_box</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">outlier_wgt</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">footer_box</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>

        <span class="c1"># Add plot toolbar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_plot_toolbar</span><span class="p">(</span><span class="n">toolbar_type</span><span class="o">=</span><span class="s2">&quot;stats&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_plot</span><span class="p">(</span>
                <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_plt_method</span><span class="p">[</span><span class="n">plt_idx</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">plot_content</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">footer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">populate_stats_footer</span><span class="p">(</span><span class="n">footer</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.stats_sethline"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.stats_sethline">[docs]</a>    <span class="k">def</span> <span class="nf">stats_sethline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">plt_file</span><span class="p">,</span> <span class="n">inverted</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets an horizontal threshold bar to the current plot object</span>
<span class="sd">        :param val: integer, The y-axis value for the horizontal line</span>
<span class="sd">        :param plt_file: string, The path to the plot file</span>
<span class="sd">        :param inverted: Boolean, Determine whether the shade will be</span>
<span class="sd">        above or below the plot</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get plot limits for patch position and size</span>
        <span class="n">xlim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_plot</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_plot</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>

        <span class="c1"># Removes previous patch, if present</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plt_patch</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Get position and size</span>
        <span class="k">if</span> <span class="n">inverted</span><span class="p">:</span>
            <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">val</span><span class="p">)</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">val</span> <span class="o">-</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plt_patch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
            <span class="n">xy</span><span class="p">,</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">height</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;#dcdcdc&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=.</span><span class="mi">7</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_plot</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plt_patch</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_plot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">plt_file</span><span class="p">),</span>
                                  <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_plot</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">plt_file</span><span class="p">),</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">plot_content</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.stats_select_plot"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.stats_select_plot">[docs]</a>    <span class="k">def</span> <span class="nf">stats_select_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gn_idx</span><span class="p">,</span> <span class="n">sp_idx</span><span class="p">,</span> <span class="n">avg_idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dialog used for plot type selection when choosing an option from the</span>
<span class="sd">        stats panel</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check whether there is data loaded</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;Warning: No data has been &quot;</span>
                                          <span class="s2">&quot;loaded into the app&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="c1"># Check if active file list is empty</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;Warning: There are no active &quot;</span>
                                          <span class="s2">&quot;files selected&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="n">wgts</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;gene&quot;</span><span class="p">,</span> <span class="s2">&quot;sp&quot;</span><span class="p">,</span> <span class="s2">&quot;avg&quot;</span><span class="p">]</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">PlotTriageDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">wgts</span><span class="p">,</span> <span class="p">[</span><span class="n">gn_idx</span><span class="p">,</span> <span class="n">sp_idx</span><span class="p">,</span> <span class="n">avg_idx</span><span class="p">]):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">w</span><span class="p">]</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">w</span><span class="p">]</span><span class="o">.</span><span class="n">plt_idx</span> <span class="o">=</span> <span class="n">f</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Select plot type&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">180</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.stats_handle_outliers"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.stats_handle_outliers">[docs]</a>    <span class="k">def</span> <span class="nf">stats_handle_outliers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">ds_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function that handles the processing of outliers in the stats plots</span>
<span class="sd">        :param operation: string, three operations are available:</span>
<span class="sd">            .:remove: Removes outliers from data set</span>
<span class="sd">            .:export: Export outliers to text file</span>
<span class="sd">            .:view: Opens a new dialog with the list of outliers</span>
<span class="sd">        :param ds_type: string, two ds_types are available:</span>
<span class="sd">            .:Taxa: Removes taxa</span>
<span class="sd">            .:Files: Removes files</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Remove elements from app</span>
        <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;remove&quot;</span><span class="p">:</span>

            <span class="c1"># The removal of taxa/files uses the export_table function to</span>
            <span class="c1"># dump the outliers into a file and then the</span>
            <span class="c1"># remove_bt_from_file function to remove them form the app</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">export_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;outlier_temp&quot;</span><span class="p">,</span> <span class="n">warning_dlg</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">remove_bt_from_selection</span><span class="p">(</span><span class="n">ds_type</span><span class="p">,</span>
                                     <span class="n">txt_file</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span>
                                                   <span class="s2">&quot;outlier_temp.csv&quot;</span><span class="p">))</span>

            <span class="c1"># Remove temporary outlier text file</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;outlier_temp.csv&quot;</span><span class="p">))</span>

            <span class="c1"># Refresh plot after outlier removal</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stats_show_plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_plt_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">current_plt_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> outliers where removed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_table</span><span class="p">)),</span>
                <span class="n">t</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;export&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dialog_filechooser</span><span class="p">(</span><span class="s2">&quot;export_outliers&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;view&quot;</span><span class="p">:</span>

            <span class="n">content</span> <span class="o">=</span> <span class="n">InputList</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">ok_bx</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">ok_bt</span><span class="p">)</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">ok_bx</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">100</span>
            <span class="k">for</span> <span class="n">outlier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_table</span><span class="p">:</span>
                <span class="n">bt</span> <span class="o">=</span> <span class="n">TFButton</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">outlier</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">rev_inlist</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> outlier(s)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_table</span><span class="p">),</span>
                                                <span class="n">ds_type</span><span class="p">),</span>
                <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.populate_stats_footer"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.populate_stats_footer">[docs]</a>    <span class="k">def</span> <span class="nf">populate_stats_footer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">footer</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populates the footer of the Statistics screen with information on</span>
<span class="sd">        the active number of genes and taxa</span>
<span class="sd">        :param footer: list, first element contains the number of genes, the</span>
<span class="sd">        second element contains the number of taxa</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gene_num</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
            <span class="s2">&quot;Genes: [color=37abc8ff]</span><span class="si">{}</span><span class="s2">[/color]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">footer</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">taxa_num</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
            <span class="s2">&quot;Taxa: [color=37abc8ff]</span><span class="si">{}</span><span class="s2">[/color]&quot;</span><span class="o">.</span> <span class="nb">format</span><span class="p">(</span><span class="n">footer</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="TriFusionApp.get_active_sets"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.get_active_sets">[docs]</a>    <span class="k">def</span> <span class="nf">get_active_sets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_set_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">taxa_set_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a tuple with the file set list as first element and taxa</span>
<span class="sd">        set list as second element. List sets are only return for non</span>
<span class="sd">        None arguments. If, for example, only file_set_name is provided,</span>
<span class="sd">        then the return tuple will be ([file list], None)</span>
<span class="sd">        :param file_set_name: string, name of file set</span>
<span class="sd">        :param taxa_set_name: string, name of file set</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_set_name</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file_set_name</span> <span class="o">==</span> <span class="s2">&quot;All files&quot;</span><span class="p">:</span>
                <span class="n">file_set</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">file_set_name</span> <span class="o">==</span> <span class="s2">&quot;Active files&quot;</span><span class="p">:</span>
                <span class="n">file_set</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">file_set</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">file_groups</span><span class="p">[</span><span class="n">file_set_name</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">file_set</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">taxa_set_name</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">taxa_set_name</span> <span class="o">==</span> <span class="s2">&quot;Active taxa&quot;</span><span class="p">:</span>
                <span class="n">taxa_set</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">taxa_set_name</span> <span class="o">==</span> <span class="s2">&quot;All taxa&quot;</span><span class="p">:</span>
                <span class="n">taxa_set</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">taxa_names</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">taxa_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">taxa_groups</span><span class="p">[</span><span class="n">taxa_set_name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">taxa_set</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">file_set</span><span class="p">,</span> <span class="n">taxa_set</span></div>

<div class="viewcode-block" id="TriFusionApp.stats_show_plot"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.stats_show_plot">[docs]</a>    <span class="k">def</span> <span class="nf">stats_show_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plt_idx</span><span class="p">,</span> <span class="n">additional_args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrapper that executes plot data gathering and execution. The method</span>
<span class="sd">        that gathers the data for plot production runs in the background.</span>
<span class="sd">        Once it&#39;s finished, that data is fed to the stats_write_plot</span>
<span class="sd">        method that will create the plot file and load it into the program.</span>

<span class="sd">        :param plt_idx: string, identification string of the plot. Usually</span>
<span class="sd">        is the text property of the issuing button.</span>
<span class="sd">        :param additional_args:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Interrupt summary statistics, if running</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terminate_stats</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Reset scatter properties for plots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">plot_content</span><span class="o">.</span><span class="n">do_scale</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">plot_content</span><span class="o">.</span><span class="n">do_translation</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">plot_content</span><span class="o">.</span><span class="n">do_rotation</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Check whether there is data loaded</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;Warning: No data has been &quot;</span>
                                          <span class="s2">&quot;loaded into the app&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="c1"># Check if active file list is empty</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;Warning: There are no active &quot;</span>
                                          <span class="s2">&quot;files selected&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="c1"># Set active file and taxa sets</span>
        <span class="n">file_set_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">active_file_set</span><span class="o">.</span><span class="n">text</span>
        <span class="n">taxa_set_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">active_taxa_set</span><span class="o">.</span><span class="n">text</span>

        <span class="c1"># Note: When setting file_set, the objects file_list,</span>
        <span class="c1"># active_taxa_list, etc should not be directly assigned since</span>
        <span class="c1"># changes to these objects will also change the taxa_set,</span>
        <span class="c1"># and consequently, the self.previous_sets</span>
        <span class="n">file_set</span><span class="p">,</span> <span class="n">taxa_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_sets</span><span class="p">(</span><span class="n">file_set_name</span><span class="p">,</span>
                                                  <span class="n">taxa_set_name</span><span class="p">)</span>

        <span class="c1"># List of gene specific plots. These are always removed</span>
        <span class="n">gene_specific</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Pairwise sequence similarity gn&quot;</span><span class="p">:</span>
            <span class="s2">&quot;similarity_distribution_gn.png&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Segregating sites gn&quot;</span><span class="p">:</span> <span class="s2">&quot;segregating_sites_gn.png&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Allele Frequency Spectrum gn&quot;</span><span class="p">:</span>
            <span class="s2">&quot;allele_frequency_spectrum_gn.png&quot;</span><span class="p">}</span>

        <span class="c1"># Remove gene specific plots if they exist</span>
        <span class="k">if</span> <span class="n">plt_idx</span> <span class="ow">in</span> <span class="n">gene_specific</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">gene_specific</span><span class="p">[</span><span class="n">plt_idx</span><span class="p">]))</span>
            <span class="k">except</span> <span class="ne">EnvironmentError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c1"># This will check if the current data sets are different from the</span>
        <span class="c1"># previous. If not so, it will then check if there is a temporary</span>
        <span class="c1"># plot file for the current plt_idx. If so, do not run</span>
        <span class="c1"># get_stats_data and show the previous plot instead.</span>
        <span class="k">if</span> <span class="n">file_set</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_sets</span><span class="p">[</span><span class="s2">&quot;Files&quot;</span><span class="p">]</span> <span class="ow">and</span> \
                <span class="n">taxa_set</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_sets</span><span class="p">[</span><span class="s2">&quot;Taxa&quot;</span><span class="p">]:</span>

            <span class="c1"># Checks if the figure file for the selected plot already exists</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">stats_plt_method</span><span class="p">[</span><span class="n">plt_idx</span><span class="p">][</span><span class="mi">1</span><span class="p">])):</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">toggle_stats_panel</span><span class="p">(</span><span class="n">force_close</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># Get the current plot from the backup</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_backups</span><span class="p">[</span><span class="n">plt_idx</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_plot</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                    <span class="nb">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">plt_idx</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)),</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>

                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_write_plot</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">plt_idx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Update previous sets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_sets</span><span class="p">[</span><span class="s2">&quot;Files&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_set</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_sets</span><span class="p">[</span><span class="s2">&quot;Taxa&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">taxa_set</span>

            <span class="c1"># Remove previous plots when data sets are modified</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_plt_method</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">run_in_background</span><span class="p">(</span>
            <span class="n">func</span><span class="o">=</span><span class="n">get_stats_data</span><span class="p">,</span>
            <span class="n">second_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stats_write_plot</span><span class="p">,</span>
            <span class="n">args1</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="p">,</span> <span class="n">plt_idx</span><span class="p">,</span> <span class="n">file_set</span><span class="p">,</span>
                   <span class="nb">list</span><span class="p">(</span><span class="n">taxa_set</span><span class="p">),</span> <span class="n">additional_args</span><span class="p">,</span>
                   <span class="s2">&quot;use_ns&quot;</span><span class="p">],</span>
            <span class="n">args2</span><span class="o">=</span><span class="p">[</span><span class="n">plt_idx</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">toggle_stats_panel</span><span class="p">(</span><span class="n">force_close</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Sets the current_plt_idx so that plots can be updated and</span>
        <span class="c1"># reload the current plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_plt_idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">plt_idx</span><span class="p">,</span> <span class="n">additional_args</span><span class="p">]</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_select_gene"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_select_gene">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_select_gene</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plt_idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates dialog for selecting gene for single gene plot creation</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">no_window</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Allele Frequency Spectrum gn&quot;</span><span class="p">]</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">SelectGeneDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>

        <span class="c1"># Remove sliding window parameter if plt_idx does not use it</span>
        <span class="k">if</span> <span class="n">plt_idx</span> <span class="ow">in</span> <span class="n">no_window</span><span class="p">:</span>
            <span class="n">content</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sliding_window</span><span class="p">)</span>

        <span class="n">content</span><span class="o">.</span><span class="n">plt_idx</span> <span class="o">=</span> <span class="n">plt_idx</span>

        <span class="c1"># By default show up to 20 files at first</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                <span class="n">bt</span> <span class="o">=</span> <span class="n">TGToggleButton</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                    <span class="n">shorten</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shorten_from</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
                    <span class="n">disabled_color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="n">background_disabled_down</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                                  <span class="s2">&quot;bt_process.png&quot;</span><span class="p">))</span>

                <span class="n">bt</span><span class="o">.</span><span class="n">text_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
                <span class="n">bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_groups</span><span class="p">)</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_grid</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>
                <span class="n">content</span><span class="o">.</span><span class="n">gene_counter</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">[</span><span class="n">content</span><span class="o">.</span><span class="n">gene_counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_grid</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">StatsMoreBt</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Select gene for sliding window analysis...&quot;</span><span class="p">,</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">4</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">))</span></div>

<div class="viewcode-block" id="TriFusionApp.stats_search_genes"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.stats_search_genes">[docs]</a>    <span class="k">def</span> <span class="nf">stats_search_genes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">txt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Searches loaded genes for the single gene display of the Statistics</span>
<span class="sd">        screen</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># When empty search, clear grid layout</span>
        <span class="k">if</span> <span class="n">txt</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_grid</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_grid</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>

        <span class="n">found_bts</span> <span class="o">=</span> <span class="p">[</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span> <span class="k">if</span>
                     <span class="n">txt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">found_bts</span><span class="p">:</span>

            <span class="n">bt</span> <span class="o">=</span> <span class="n">TGToggleButton</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                <span class="n">shorten</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shorten_from</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
                <span class="n">disabled_color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">background_disabled_down</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                              <span class="s2">&quot;bt_process.png&quot;</span><span class="p">))</span>

            <span class="n">bt</span><span class="o">.</span><span class="n">text_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
            <span class="n">bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_groups</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_grid</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.stats_load_more_genes"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.stats_load_more_genes">[docs]</a>    <span class="k">def</span> <span class="nf">stats_load_more_genes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Functionality to the load next 20 genes in the stats gene selection</span>
<span class="sd">        dialog</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Remove previous StatsMorebt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_grid</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_grid</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">gene_counter</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">gene_counter</span> <span class="o">+</span> <span class="mi">20</span><span class="p">):</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                <span class="n">bt</span> <span class="o">=</span> <span class="n">TGToggleButton</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                    <span class="n">shorten</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shorten_from</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
                    <span class="n">disabled_color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="n">background_disabled_down</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                                  <span class="s2">&quot;bt_process.png&quot;</span><span class="p">))</span>

                <span class="n">bt</span><span class="o">.</span><span class="n">text_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
                <span class="n">bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_groups</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_grid</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">gene_counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_grid</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">StatsMoreBt</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="TriFusionApp.stats_clear_search"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.stats_clear_search">[docs]</a>    <span class="k">def</span> <span class="nf">stats_clear_search</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears stats gene search to default buttons</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_grid</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                <span class="n">bt</span> <span class="o">=</span> <span class="n">TGToggleButton</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                    <span class="n">shorten</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shorten_from</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
                    <span class="n">disabled_color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="n">background_disabled_down</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;backgrounds&quot;</span><span class="p">,</span>
                                                  <span class="s2">&quot;bt_process.png&quot;</span><span class="p">))</span>
                <span class="n">bt</span><span class="o">.</span><span class="n">text_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
                <span class="n">bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_release</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_groups</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_popup</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gn_grid</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">break</span></div>

    <span class="c1"># ##################################</span>
    <span class="c1">#</span>
    <span class="c1"># CORE RELATED METHODS AND FUNCTIONS</span>
    <span class="c1">#</span>
    <span class="c1"># ##################################</span>

<div class="viewcode-block" id="TriFusionApp.load_files_subproc"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.load_files_subproc">[docs]</a>    <span class="k">def</span> <span class="nf">load_files_subproc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="p">):</span>

        <span class="n">multiprocessing</span><span class="o">.</span><span class="n">freeze_support</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">check_proc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">pb</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">progress</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">m</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>

                <span class="n">Clock</span><span class="o">.</span><span class="n">unschedule</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">exception</span> <span class="o">==</span> <span class="s2">&quot;multiple_type&quot;</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_warning</span><span class="p">(</span>
                            <span class="s2">&quot;Multiple sequence types detected&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;The selected input alignments contain more &quot;</span>
                            <span class="s2">&quot;than one sequence type (DNA, RNA, Protein). &quot;</span>
                            <span class="s2">&quot;Please select input files of the  same &quot;</span>
                            <span class="s2">&quot;sequence type&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                            <span class="s2">&quot;Unexpected error when loading input data. &quot;</span>
                            <span class="s2">&quot;Check app logs&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="c1"># Get the alignment object from the child thread and load</span>
                <span class="c1"># it into the app</span>
                <span class="n">aln_obj</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_files</span><span class="p">(</span><span class="n">file_list</span><span class="p">,</span> <span class="n">aln_obj</span><span class="p">)</span>

                <span class="c1"># Shutting down manager that provides communication between</span>
                <span class="c1"># parent and child thread</span>
                <span class="n">manager</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

                <span class="c1"># Join child process and exit</span>
                <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="c1"># Kill switch</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminate_load_files</span><span class="p">:</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Canceling...&quot;</span>

                <span class="c1"># Issuing the kill order to the child thread. This signal</span>
                <span class="c1"># will propagate through the worker&#39;s methods and graciously</span>
                <span class="c1"># terminate</span>
                <span class="n">shared_ns</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># This small delay seems to fix manager shutdown issues</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Shutting down manager that provides communication between</span>
                <span class="c1"># parent and child thread</span>
                <span class="n">manager</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

                <span class="c1"># Close loading popup dialog</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span>

                <span class="c1"># Unschedule the current function</span>
                <span class="n">Clock</span><span class="o">.</span><span class="n">unschedule</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

                <span class="c1"># Clean up alignments that were already loaded into the</span>
                <span class="c1"># AlignmentList object</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">remove_file</span><span class="p">(</span><span class="n">file_list</span><span class="p">)</span>

                <span class="c1"># Join child process and exit</span>
                <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
                <span class="k">return</span>

        <span class="c1"># Check if proteome files have already been loaded. If so, issue</span>
        <span class="c1"># warning, since the two data types cannot be loaded in simultaneous</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_warning</span><span class="p">(</span><span class="s2">&quot;Cannot mix alignment and proteome &quot;</span>
                                       <span class="s2">&quot;data&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;TriFusion currently has proteome data&quot;</span>
                                       <span class="s2">&quot; loaded. If you want to load alignment&quot;</span>
                                       <span class="s2">&quot; data, please remove the current&quot;</span>
                                       <span class="s2">&quot; data set.&quot;</span><span class="p">)</span>

        <span class="c1"># To support for opening all files in one or more directories, all</span>
        <span class="c1"># entries in files will be checked if they are directories. If so,</span>
        <span class="c1"># all files in that directory will be appended to file_list instead</span>
        <span class="n">file_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">file_list</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">join</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                                 <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                                 <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">))])</span>
            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">file_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If the file has not been found, try joining the called_dir</span>
                <span class="c1"># path with the file name</span>
                <span class="n">mod_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">called_dir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">mod_path</span><span class="p">):</span>
                    <span class="n">file_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mod_path</span><span class="p">)</span>

        <span class="n">file_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">file_list</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;No valid input files were&quot;</span>
                                          <span class="s2">&quot; provided&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="c1"># Set up manager and shared name space to share information</span>
        <span class="c1"># between background and main processes</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>
        <span class="n">shared_ns</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">Namespace</span><span class="p">()</span>
        <span class="n">queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>

        <span class="c1"># Initialize stop flag to allow thread to be killed by the user</span>
        <span class="n">shared_ns</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Remove lock from background process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terminate_load_files</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Create process</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span>
                <span class="n">target</span><span class="o">=</span><span class="n">load_proc</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="p">,</span> <span class="n">file_list</span><span class="p">,</span> <span class="n">shared_ns</span><span class="p">,</span>
                      <span class="n">queue</span><span class="p">))</span>

        <span class="n">p</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># Remove any possible previous popups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span>

        <span class="c1"># Create loading process dialog</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">LoadProgressDialog</span><span class="p">()</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Initializing&quot;</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">pb</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_list</span><span class="p">)</span>

        <span class="c1"># Give functionality to cancel button</span>
        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">close_bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span>
            <span class="n">on_release</span><span class="o">=</span><span class="k">lambda</span> <span class="n">j</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;terminate_load_files&quot;</span><span class="p">,</span>
                                         <span class="kc">True</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Loading files&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span> <span class="n">auto_dissmiss</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Schedule function that checks the process&#39; pulse</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">check_proc</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_interval</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">.</span><span class="mi">01</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.load_files"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.load_files">[docs]</a>    <span class="k">def</span> <span class="nf">load_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aln_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the selected input files into the program using the</span>
<span class="sd">        AlignmentList object provided by aln_list. The loading process is</span>
<span class="sd">        divided in phases:</span>

<span class="sd">        .: Load the AlignmentList object from a pickle object</span>

<span class="sd">        .: Check for invalid alignments (duplicates, invalid input</span>
<span class="sd">        formats, sequences with unequal length) and issue warning message</span>

<span class="sd">        .: If any valid input files passed all checks, then the app</span>
<span class="sd">        structures are updated</span>

<span class="sd">        To allow different files to be loaded in different occasions,</span>
<span class="sd">        all checks are performed on the aln_list object, and not in the</span>
<span class="sd">        app attribute self.alignment_list</span>

<span class="sd">        :param aln_pickle: string, path to pickle file with the</span>
<span class="sd">        AlignmentObject</span>
<span class="sd">        :param selection: list, with the path of all files provided to</span>
<span class="sd">        the app</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check for consistency in sequence type across alignments</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence_types</span><span class="p">:</span>
            <span class="n">current_seq_type</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">sequence_types</span><span class="p">]</span> <span class="o">+</span>
                <span class="n">aln_list</span><span class="o">.</span><span class="n">format_list</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current_seq_type</span> <span class="o">=</span> <span class="n">aln_list</span><span class="o">.</span><span class="n">format_list</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence_types</span> <span class="ow">and</span> <span class="n">current_seq_type</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequence_types</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">current_seq_type</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Set the new alignment_list attribute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span> <span class="o">=</span> <span class="n">aln_list</span>
        <span class="c1"># Updating active alignment list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">taxa_names</span>

        <span class="c1"># removes bad alignment files from selection list</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">selection</span> <span class="k">if</span> <span class="n">path</span> <span class="ow">not</span> <span class="ow">in</span>
                     <span class="n">aln_list</span><span class="o">.</span><span class="n">bad_alignments</span> <span class="o">+</span> <span class="n">aln_list</span><span class="o">.</span><span class="n">non_alignments</span><span class="p">]</span>

        <span class="c1"># If duplicate alignments were loaded, issue a warning</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">duplicate_alignments</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                <span class="s2">&quot;Duplicate input alignments detected and ignored&quot;</span><span class="p">,</span>
                <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
            <span class="c1"># Reset the duplicate alignment storage, so that it doesn&#39;t</span>
            <span class="c1"># issue the warning every time data is loaded</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">duplicate_alignments</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Checking if there are invalid input alignments</span>
        <span class="k">if</span> <span class="n">aln_list</span><span class="o">.</span><span class="n">bad_alignments</span> <span class="ow">or</span> <span class="n">aln_list</span><span class="o">.</span><span class="n">non_alignments</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">aln_list</span><span class="o">.</span><span class="n">bad_alignments</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;The following input file(s) could not be open:&quot;</span>\
                    <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">[b]</span><span class="si">%s</span><span class="s2">[/b]</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                                                    <span class="n">aln_list</span><span class="o">.</span><span class="n">bad_alignments</span><span class="p">)</span>

                <span class="c1"># Reset the bad_alignments attribute to avoid triggering</span>
                <span class="c1"># this in subsequent loading operations</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">bad_alignments</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="n">aln_list</span><span class="o">.</span><span class="n">non_alignments</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;The following input file(s) contain(s) &quot;</span> \
                    <span class="s2">&quot;sequences of unequal length:</span><span class="se">\n\n</span><span class="s2">[b]</span><span class="si">%s</span><span class="s2">[/b]&quot;</span> <span class="o">%</span> \
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">aln_list</span><span class="o">.</span><span class="n">non_alignments</span><span class="p">)</span>

                <span class="c1"># Reset the non_alignments attribute to avoid triggering</span>
                <span class="c1"># this in subsequent loading operations</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">non_alignments</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># After gathering all information on bad input files and</span>
            <span class="c1"># non-aligned sequences, issue the error message</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dialog_warning</span><span class="p">(</span><span class="s2">&quot;Invalid input file(s) detected&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

        <span class="c1"># If new alignments have been provided update app structures. If</span>
        <span class="c1"># all provided alignments were bad, ignore this</span>
        <span class="k">if</span> <span class="n">selection</span><span class="p">:</span>
            <span class="c1"># If data has been previously loaded, updated these attributes</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">:</span>
                <span class="c1"># Updating complete and active file lists</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>
                <span class="c1"># Update the filename - path mapping attribute</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span>
                    <span class="nb">zip</span><span class="p">([</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">],</span> <span class="n">selection</span><span class="p">)))</span>

            <span class="c1"># If no data has been previously loaded, set the attributed</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Set an attribute with the input file list</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span> <span class="o">=</span> <span class="n">selection</span>
                <span class="c1"># Setting active file list and path list</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_file_list</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">)</span>
                <span class="c1"># Sett the filename - path mapping attribute</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">],</span> <span class="n">selection</span><span class="p">))</span>

            <span class="c1"># Update active taxa list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_taxa</span><span class="p">()</span>
            <span class="c1"># Populates files and taxa contents</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_tabs</span><span class="p">()</span>
            <span class="c1"># Gathers taxa  and file information</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_taxa_information</span><span class="p">()</span>

            <span class="c1"># Issue final dialog with the number of files successfully</span>
            <span class="c1"># loaded</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> file(s) successfully loaded&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">selection</span><span class="p">),</span>
                <span class="n">t</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">)</span>

            <span class="c1"># If on statistics screen, issue the summary statistics overview</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_screen</span> <span class="o">==</span> <span class="s2">&quot;Statistics&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">statistics_show_summary</span><span class="p">()</span></div>

<div class="viewcode-block" id="TriFusionApp.get_taxon_information"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.get_taxon_information">[docs]</a>    <span class="k">def</span> <span class="nf">get_taxon_information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tx</span><span class="p">,</span> <span class="n">aln_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Akin to the get_taxa_information method, but it only looks for</span>
<span class="sd">        the information of a single taxon.</span>

<span class="sd">        :param tx: string, taxon name</span>
<span class="sd">        :param aln_list: AlignmentList object from where the information</span>
<span class="sd">        will be retrieved</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tx_inf</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Counter for alignment missing the taxa</span>
        <span class="n">tx_missing</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Get full sequence</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># This assures that the information will only be gathered if the</span>
        <span class="c1"># active data set is not empty</span>
        <span class="k">if</span> <span class="n">aln_list</span><span class="o">.</span><span class="n">alignments</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">aln</span> <span class="ow">in</span> <span class="n">aln_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tx</span> <span class="ow">in</span> <span class="n">aln</span><span class="o">.</span><span class="n">taxa_list</span><span class="p">:</span>
                    <span class="n">sequence</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aln</span><span class="o">.</span><span class="n">get_sequence</span><span class="p">(</span><span class="n">tx</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tx_missing</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Retrieve missing data symbol</span>
            <span class="n">missing_symbol</span> <span class="o">=</span> <span class="n">aln</span><span class="o">.</span><span class="n">sequence_code</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>

            <span class="c1"># Get sequence length</span>
            <span class="n">seq_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
            <span class="n">tx_inf</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">seq_len</span>
            <span class="c1"># Get indel number</span>
            <span class="n">tx_inf</span><span class="p">[</span><span class="s2">&quot;indel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
            <span class="c1"># Get missing data</span>
            <span class="n">tx_inf</span><span class="p">[</span><span class="s2">&quot;missing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">missing_symbol</span><span class="p">)</span>
            <span class="c1"># Get effective sequence length in absolute and percentage</span>
            <span class="n">tx_inf</span><span class="p">[</span><span class="s2">&quot;effective_len&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">seq_len</span> <span class="o">-</span> \
                <span class="p">(</span><span class="n">tx_inf</span><span class="p">[</span><span class="s2">&quot;indel&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">tx_inf</span><span class="p">[</span><span class="s2">&quot;missing&quot;</span><span class="p">])</span>

            <span class="n">tx_inf</span><span class="p">[</span><span class="s2">&quot;effective_len_per&quot;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="nb">round</span><span class="p">((</span><span class="n">tx_inf</span><span class="p">[</span><span class="s2">&quot;effective_len&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span> <span class="n">seq_len</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

            <span class="c1"># Get number of files containing the taxa in absolute and</span>
            <span class="c1"># percentage</span>
            <span class="n">tx_inf</span><span class="p">[</span><span class="s2">&quot;fl_coverage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aln_list</span><span class="o">.</span><span class="n">alignments</span><span class="p">)</span> <span class="o">-</span>\
                <span class="n">tx_missing</span>
            <span class="n">tx_inf</span><span class="p">[</span><span class="s2">&quot;fl_coverage_per&quot;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="nb">round</span><span class="p">(((</span><span class="n">tx_inf</span><span class="p">[</span><span class="s2">&quot;fl_coverage&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span>
                       <span class="nb">len</span><span class="p">(</span><span class="n">aln_list</span><span class="o">.</span><span class="n">alignments</span><span class="p">)),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># This handles the case where the active data set is empty</span>
            <span class="n">tx_inf</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
            <span class="n">tx_inf</span><span class="p">[</span><span class="s2">&quot;indel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
            <span class="n">tx_inf</span><span class="p">[</span><span class="s2">&quot;missing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
            <span class="n">tx_inf</span><span class="p">[</span><span class="s2">&quot;effective_len&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
            <span class="n">tx_inf</span><span class="p">[</span><span class="s2">&quot;effective_len_per&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
            <span class="n">tx_inf</span><span class="p">[</span><span class="s2">&quot;fl_coverage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
            <span class="n">tx_inf</span><span class="p">[</span><span class="s2">&quot;fl_coverage_per&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>

        <span class="k">return</span> <span class="n">tx_inf</span></div>

<div class="viewcode-block" id="TriFusionApp.get_taxa_information"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.get_taxa_information">[docs]</a>    <span class="k">def</span> <span class="nf">get_taxa_information</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method will gather all available information for all taxa and</span>
<span class="sd">        sets a number of related attributes. This methods should only be</span>
<span class="sd">        used to generate data for the complete data set. The active data</span>
<span class="sd">        set is usually only gathered for a single taxon and upon demand.</span>

<span class="sd">        Sets the self.original_tx_inf attribute. Contains the relevant</span>
<span class="sd">        information for the taxa popup. All corresponding values are the</span>
<span class="sd">        result of additions across all active input alignments. Contains</span>
<span class="sd">        the following keys:</span>

<span class="sd">            - length: Total alignment length including missing data and gaps</span>
<span class="sd">            - indel: The number columns containing indel/gaps</span>
<span class="sd">            - missing: The number of columns containing missing data</span>
<span class="sd">            - effective_len: Alignment length excluding gaps and missing</span>
<span class="sd">            data</span>
<span class="sd">            - effective_len_per: Same as above but in percentage</span>
<span class="sd">            - fl_coverage: The number of files containing the focal taxon</span>
<span class="sd">            - fl_coverage_per: Same as above but in percentage</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Reset trigger for taxa update</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger_taxa_update</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">tx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span><span class="p">:</span>
            <span class="c1"># Add entry to storage dictionary</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">original_tx_inf</span><span class="p">[</span><span class="n">tx</span><span class="p">]</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">get_taxon_information</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.get_file_information"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.get_file_information">[docs]</a>    <span class="k">def</span> <span class="nf">get_file_information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;alignment&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Similar to get_taxa_information, but generating information for the</span>
<span class="sd">        files in the file tab.</span>
<span class="sd">        :param mode: string. The type of file information to retrieve. May</span>
<span class="sd">        be &#39;alignment&#39; or &#39;proteome&#39;</span>

<span class="sd">        :return: file_inf (dictionary). Contains all relevant content for</span>
<span class="sd">        the file popup. It contains the following keys:</span>

<span class="sd">            ..:mode: alignment:</span>
<span class="sd">                - aln_format: The format of the input file</span>
<span class="sd">                - seq_type: The sequence type. If DNA, RNA, Protein.</span>
<span class="sd">                - n_taxa: Number of taxa</span>
<span class="sd">                - aln_len: Length of the alignment</span>
<span class="sd">                - model: The model of sequence evolution, if applicable.</span>
<span class="sd">                 This is</span>
<span class="sd">                usually only present on Nexus input format</span>
<span class="sd">            ..mode: proteome:</span>
<span class="sd">                - n_seq: Number of sequences</span>
<span class="sd">                - n_res: Number of residues</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># main storage</span>
        <span class="n">file_inf</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;alignment&quot;</span><span class="p">:</span>
            <span class="c1"># Iterating over file path since the name of the Alignment</span>
            <span class="c1"># objects contain the full path</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="p">:</span>
                <span class="n">aln_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">[</span><span class="n">file_name</span><span class="p">]</span>
                <span class="n">aln</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">retrieve_alignment</span><span class="p">(</span><span class="n">aln_path</span><span class="p">)</span>

                <span class="c1"># Get input format</span>
                <span class="n">file_inf</span><span class="p">[</span><span class="s2">&quot;aln_format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aln</span><span class="o">.</span><span class="n">input_format</span>

                <span class="c1"># Get sequence type</span>
                <span class="n">file_inf</span><span class="p">[</span><span class="s2">&quot;seq_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aln</span><span class="o">.</span><span class="n">sequence_code</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="c1"># Get number of species</span>
                <span class="n">file_inf</span><span class="p">[</span><span class="s2">&quot;n_taxa&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                    <span class="n">aln</span><span class="o">.</span><span class="n">taxa_list</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span><span class="p">])</span>

                <span class="c1"># Get length of largest sequence if not aligned, or</span>
                <span class="c1"># alignment length</span>
                <span class="n">file_inf</span><span class="p">[</span><span class="s2">&quot;aln_len&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aln</span><span class="o">.</span><span class="n">locus_length</span>

        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;proteome&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span><span class="p">:</span>
                <span class="n">p_name</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="n">file_inf</span><span class="p">[</span><span class="n">p_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">n_seq</span><span class="p">,</span> <span class="n">n_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_proteome_information</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

                <span class="n">file_inf</span><span class="p">[</span><span class="n">p_name</span><span class="p">][</span><span class="s2">&quot;n_seq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_seq</span>
                <span class="n">file_inf</span><span class="p">[</span><span class="n">p_name</span><span class="p">][</span><span class="s2">&quot;n_res&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_res</span>

        <span class="k">return</span> <span class="n">file_inf</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="TriFusionApp.get_proteome_information"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.get_proteome_information">[docs]</a>    <span class="k">def</span> <span class="nf">get_proteome_information</span><span class="p">(</span><span class="n">proteome_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns informative stats for a given proteome_file</span>
<span class="sd">        :param proteome_file: string. Path to proteome file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">file_handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">proteome_file</span><span class="p">)</span>

        <span class="n">n_seq</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">n_res</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file_handle</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">):</span>
                <span class="n">n_seq</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n_res</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="n">file_handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">n_seq</span><span class="p">,</span> <span class="n">n_res</span></div>

<div class="viewcode-block" id="TriFusionApp.update_process_switch"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.update_process_switch">[docs]</a>    <span class="k">def</span> <span class="nf">update_process_switch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">switch_id</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Listens and updates the attribute process_switches when their state</span>
<span class="sd">        changes.</span>
<span class="sd">        :param switch_id: string, name of the switch according to the keys</span>
<span class="sd">        in process_switches</span>
<span class="sd">        :param state: Boolean, current state of the corresponding switch</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">switch_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_operations</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">secondary_operations</span><span class="p">[</span><span class="n">switch_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">secondary_options</span><span class="p">[</span><span class="n">switch_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_orto_execution"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_orto_execution">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_orto_execution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates and populates the pre-execution dialog for orthology search</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check for input proteomes</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">proteome_files</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                <span class="s2">&quot;Please provide proteome files as input data&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="c1"># Check for output directory</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ortho_dir</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                <span class="s2">&quot;Please specify an output directory for orthology results&quot;</span><span class="p">,</span>
                <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="c1"># Check for the USEARCH executable</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">usearch_file</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_usearch_fix</span><span class="p">()</span>

        <span class="c1"># check for the MCL executable</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcl_file</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_mcl_fix</span><span class="p">()</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">OrtoExecutionDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Orthology search execution summary - Processing </span><span class="si">%s</span><span class="s2">&quot;</span>
                  <span class="s2">&quot; file(s)&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_proteome_files</span><span class="p">),</span>
            <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">550</span><span class="p">,</span> <span class="mi">350</span><span class="p">))</span>

        <span class="c1"># Correct minimum species filter</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orto_min_sp</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_proteome_files</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">orto_min_sp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_proteome_files</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                <span class="s2">&quot;Corrected the minimum number of taxa per cluster value &quot;</span>
                <span class="s2">&quot;to the maximum number allowed by the active proteomes.&quot;</span><span class="p">,</span>
                <span class="n">t</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">)</span>

        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">gene_filter</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
            <span class="s2">&quot;[b][size=18][color=37abc8ff]Maximum number of gene copies &quot;</span> \
            <span class="s2">&quot;per cluster:[/color][/size][/b] </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">orto_max_gene</span>

        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">sp_filter</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
            <span class="s2">&quot;[b][size=18][color=37abc8ff]Minimum number of taxa per &quot;</span> \
            <span class="s2">&quot;cluster:[/color][/size][/b] </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">orto_min_sp</span>

        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">eval</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span>\
            <span class="s2">&quot;[b][size=18][color=37abc8ff]USEARCH e-value threshold:&quot;</span> \
            <span class="s2">&quot;[/color][/size][/b] </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">usearch_evalue</span>

        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">inflation</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
            <span class="s2">&quot;[b][size=18][color=37abc8ff]MCL inflation value(s):&quot;</span> \
            <span class="s2">&quot;[/color][/size][/b] </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>\
            <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mcl_inflation</span><span class="p">)</span>

        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">threads</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> \
            <span class="s2">&quot;[b][size=18][color=37abc8ff]Threads :[/color][/size][/b] </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">usearch_threads</span><span class="o">.</span><span class="n">text</span></div>

<div class="viewcode-block" id="TriFusionApp.orthology_search_exec"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.orthology_search_exec">[docs]</a>    <span class="k">def</span> <span class="nf">orthology_search_exec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Main function that executes all queued procedures of the orthology</span>
<span class="sd">        module</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tasks_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;schema&quot;</span><span class="p">:</span> <span class="s2">&quot;Database setup&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;adjust&quot;</span><span class="p">:</span> <span class="s2">&quot;Adjusting Fasta files&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="s2">&quot;Filtering Fasta files&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;usearch&quot;</span><span class="p">:</span> <span class="s2">&quot;Running USearch&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;parse&quot;</span><span class="p">:</span> <span class="s2">&quot;Parsing USearch output&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;pairs&quot;</span><span class="p">:</span> <span class="s2">&quot;Obtaining pairs&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;mcl&quot;</span><span class="p">:</span> <span class="s2">&quot;Running MCL&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;dump&quot;</span><span class="p">:</span> <span class="s2">&quot;Dumping groups&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;filter_groups&quot;</span><span class="p">:</span> <span class="s2">&quot;Filtering group files&quot;</span><span class="p">}</span>

        <span class="n">wgt_ref</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">def</span> <span class="nf">finish_op</span><span class="p">(</span><span class="n">wgt</span><span class="p">,</span> <span class="n">op_name</span><span class="p">):</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">load_box</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
            <span class="n">check_wgt</span> <span class="o">=</span> <span class="n">ProgressFinished</span><span class="p">()</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">load_box</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">check_wgt</span><span class="p">)</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_lbl</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="mi">18</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_lbl</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_lbl</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">tasks_map</span><span class="p">[</span><span class="n">op_name</span><span class="p">]</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">secondary_lbl</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">secondary_lbl</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">closed_ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op_name</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">start_op</span><span class="p">(</span><span class="n">wgt</span><span class="p">):</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">load_box</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
            <span class="n">spinner</span> <span class="o">=</span> <span class="n">LoadSpinner</span><span class="p">()</span>
            <span class="n">counter</span> <span class="o">=</span> <span class="n">LoadCounter</span><span class="p">()</span>
            <span class="n">wgt_ref</span><span class="p">[</span><span class="s2">&quot;spinner&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spinner</span>
            <span class="n">wgt_ref</span><span class="p">[</span><span class="s2">&quot;counter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">counter</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">load_box</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">load_box</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">spinner</span><span class="p">)</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_lbl</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="mi">18</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_lbl</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blue</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">secondary_lbl</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blue</span>

        <span class="k">def</span> <span class="nf">check_process</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Checks the status of the background process &quot;p&quot; and updates</span>
<span class="sd">            the progress dialog label</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="c1"># Listens for cancel signal</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminate_orto_search</span><span class="p">:</span>
                <span class="c1"># Issuing the kill order to the child thread. This signal</span>
                <span class="c1"># will propagate through the worker&#39;s methods and graciously</span>
                <span class="c1"># terminate</span>
                <span class="n">shared_ns</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># If a subprocess has been issued, kill it</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">subp</span><span class="p">:</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="n">shared_ns</span><span class="o">.</span><span class="n">subp</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">)</span>
                        <span class="n">shared_ns</span><span class="o">.</span><span class="n">subp</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="c1"># This small delay seems to fix manager shutdown issues</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Shutting down manager that provides communication between</span>
                <span class="c1"># parent and child thread</span>
                <span class="n">manager</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

                <span class="c1"># Close loading popup dialog</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span>

                <span class="c1"># Unschedule the current function</span>
                <span class="n">Clock</span><span class="o">.</span><span class="n">unschedule</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

                <span class="c1"># Clear sqlitedb</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;orthoDB.db&quot;</span><span class="p">))</span>

                <span class="c1"># Join child process and exit</span>
                <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="c1"># Update progress dialog</span>
            <span class="k">try</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">shared_ns</span><span class="p">:</span>
                    <span class="c1"># If current_op is not an empty list, it means that this</span>
                    <span class="c1"># is not the first task.</span>
                    <span class="k">if</span> <span class="n">current_op</span><span class="p">:</span>
                        <span class="c1"># Check if the task defined in the previous cycle is</span>
                        <span class="c1"># the same as the current task. If not, do this</span>
                        <span class="k">if</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">task</span> <span class="o">!=</span> <span class="n">current_op</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                            <span class="c1"># Check if all finished tasks where closed</span>
                            <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">finished_tasks</span>
                                       <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">closed_ops</span><span class="p">]:</span>
                                <span class="c1"># This will get previously finished tasks</span>
                                <span class="c1"># that were completed sooner</span>
                                <span class="k">if</span> <span class="n">op</span> <span class="o">!=</span> <span class="n">current_op</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                                    <span class="n">pwgt</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">op</span><span class="p">]</span>
                                    <span class="n">finish_op</span><span class="p">(</span><span class="n">pwgt</span><span class="p">,</span> <span class="n">op</span><span class="p">)</span>
                            <span class="c1"># Get the previous task progress widget</span>
                            <span class="n">pwgt</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">current_op</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                            <span class="c1"># Finish animation for previous task</span>
                            <span class="n">finish_op</span><span class="p">(</span><span class="n">pwgt</span><span class="p">,</span> <span class="n">current_op</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="c1"># Set current task progress as the current_op</span>
                            <span class="n">current_op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">task</span>
                            <span class="c1"># Get the current task progress widget</span>
                            <span class="n">cwgt</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">shared_ns</span><span class="o">.</span><span class="n">task</span><span class="p">]</span>
                            <span class="c1"># Start progress animations for current task</span>
                            <span class="n">start_op</span><span class="p">(</span><span class="n">cwgt</span><span class="p">)</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">pass</span>
                    <span class="c1"># This means that this is the first task</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Add the first task to current_op</span>
                        <span class="n">current_op</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shared_ns</span><span class="o">.</span><span class="n">task</span><span class="p">)</span>
                        <span class="c1"># Get current progress task widget</span>
                        <span class="n">cwgt</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">shared_ns</span><span class="o">.</span><span class="n">task</span><span class="p">]</span>
                        <span class="c1"># Start progress animations for current task</span>
                        <span class="n">start_op</span><span class="p">(</span><span class="n">cwgt</span><span class="p">)</span>

                    <span class="c1"># Update the current spinner... spin</span>
                    <span class="n">wgt_ref</span><span class="p">[</span><span class="s2">&quot;spinner&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">rotation</span> <span class="o">-=</span> <span class="mi">10</span>

                    <span class="c1"># Update the counter percentage</span>
                    <span class="k">if</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">total</span> <span class="ow">and</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">counter</span> <span class="ow">and</span> \
                            <span class="n">current_op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;usearch&quot;</span> <span class="ow">and</span> \
                                    <span class="n">current_op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;mcl&quot;</span><span class="p">:</span>

                        <span class="c1"># Get percentage</span>
                        <span class="n">perc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">shared_ns</span><span class="o">.</span><span class="n">counter</span><span class="p">)</span> <span class="o">/</span>
                                    <span class="nb">float</span><span class="p">(</span><span class="n">shared_ns</span><span class="o">.</span><span class="n">total</span><span class="p">))</span> <span class="o">*</span> <span class="mf">100.</span><span class="p">)</span>

                        <span class="c1"># Set percentage on progress dialog</span>
                        <span class="n">wgt_ref</span><span class="p">[</span><span class="s2">&quot;counter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">perc</span><span class="p">)</span>

                        <span class="c1"># Set secondary progress label, if any</span>
                        <span class="k">if</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">msg</span><span class="p">:</span>
                            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">shared_ns</span><span class="o">.</span><span class="n">task</span><span class="p">]</span><span class="o">.</span>\
                                <span class="n">ids</span><span class="o">.</span><span class="n">secondary_lbl</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">msg</span>

                    <span class="k">if</span> <span class="n">current_op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;usearch&quot;</span> <span class="ow">or</span> <span class="n">current_op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;mcl&quot;</span><span class="p">:</span>

                        <span class="c1"># Provide uncertain counter for usearch and mcl</span>
                        <span class="c1"># operations.</span>
                        <span class="n">wgt_ref</span><span class="p">[</span><span class="s2">&quot;counter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;??&quot;</span>

            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>

                <span class="n">Clock</span><span class="o">.</span><span class="n">unschedule</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="n">shared_ns</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span>
                                               <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Set the protein database file</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">protein_db</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ortho_dir</span><span class="p">,</span>
                                           <span class="s2">&quot;backstage_files&quot;</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">usearch_db</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dialog_search_report</span><span class="p">(</span><span class="n">shared_ns</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span>
                                              <span class="n">shared_ns</span><span class="o">.</span><span class="n">groups</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span><span class="s2">&quot;Unexpected error when &quot;</span>
                                               <span class="s2">&quot;search orthologs. Check &quot;</span>
                                               <span class="s2">&quot;app logs.&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

                <span class="n">manager</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
                <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

        <span class="c1"># Create directory that will store intermediate files during</span>
        <span class="c1"># orthology search</span>
        <span class="n">int_dir</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ortho_dir</span><span class="p">,</span> <span class="s2">&quot;backstage_files&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">int_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">int_dir</span><span class="p">)</span>

        <span class="c1"># Set up manager and shared name space to share information</span>
        <span class="c1"># between background and main processes</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>
        <span class="n">shared_ns</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">Namespace</span><span class="p">()</span>

        <span class="n">shared_ns</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">shared_ns</span><span class="o">.</span><span class="n">exception</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">shared_ns</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">shared_ns</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">shared_ns</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">current_op</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">closed_ops</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Remove lock from background process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terminate_orto_search</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Create Process instance</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span>
            <span class="n">target</span><span class="o">=</span><span class="n">orto_execution</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="p">(</span>
                <span class="n">shared_ns</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_proteome_files</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">protein_min_len</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">protein_max_stop</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">usearch_file</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">usearch_evalue</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">usearch_threads</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">usearch_output</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mcl_file</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mcl_inflation</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ortholog_prefix</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">group_prefix</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">orto_max_gene</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">orto_min_sp</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sqldb</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ortho_dir</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">usearch_db</span><span class="p">))</span>

        <span class="n">p</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># Remove any possible previous popups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span>
        <span class="c1"># Create Progression dialog</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">OrtoProgressDialog</span><span class="p">()</span>

        <span class="c1"># Populate progress dialog content</span>
        <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">txt</span> <span class="ow">in</span> <span class="n">tasks_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">op</span><span class="p">]</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_lbl</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">txt</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Running Orthology Search&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">340</span><span class="p">,</span> <span class="mi">600</span><span class="p">),</span> <span class="n">auto_dissmiss</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Schedule function that checks the process&#39; pulse</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">check_process</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_interval</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">.</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.dialog_fileoverwrite"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.dialog_fileoverwrite">[docs]</a>    <span class="k">def</span> <span class="nf">dialog_fileoverwrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        General dialog for querying whether an existing file should be</span>
<span class="sd">        overwritten or skipped</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">FileOverwriteDialog</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dismiss_subpopup</span><span class="p">)</span>

        <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">dlg_text</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">msg</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;File already exists...&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">220</span><span class="p">),</span> <span class="n">popup_level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="TriFusionApp.process_exec"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.TriFusionApp.process_exec">[docs]</a>    <span class="k">def</span> <span class="nf">process_exec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Main function that executes all queued procedures of the process</span>
<span class="sd">        module</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ops_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;reverse_concatenation&quot;</span><span class="p">:</span> <span class="s2">&quot;Reverse concatenation&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;collapse_filter&quot;</span><span class="p">:</span> <span class="s2">&quot;Filter (Collapse)&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="s2">&quot;Filter&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;concatenation&quot;</span><span class="p">:</span> <span class="s2">&quot;Concatenation&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;collapse&quot;</span><span class="p">:</span> <span class="s2">&quot;Collapse&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;gcoder&quot;</span><span class="p">:</span> <span class="s2">&quot;Gap coding&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;consensus&quot;</span><span class="p">:</span> <span class="s2">&quot;Consensus&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;write&quot;</span><span class="p">:</span> <span class="s2">&quot;Writing output&quot;</span><span class="p">}</span>

        <span class="k">def</span> <span class="nf">build_progress_dialog</span><span class="p">(</span><span class="n">wgt</span><span class="p">):</span>

            <span class="c1"># Get the main and additional file operations</span>
            <span class="n">main_ops</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">additional_ops</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Iterate over a fixed order list of possible ops</span>
            <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;reverse_concatenation&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;collapse_filter&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;filter&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;concatenation&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;collapse&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;gcoder&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;consensus&quot;</span><span class="p">]:</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Add to main ops if op is a main operation and set to True</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_operations</span><span class="p">[</span><span class="n">op</span><span class="p">]:</span>
                        <span class="n">main_ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_operations</span><span class="p">[</span><span class="n">op</span><span class="p">]:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># Add to additional ops if op is True for secondary</span>
                            <span class="c1"># operations and true for *_file</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_options</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_file&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">op</span><span class="p">)]:</span>
                                <span class="n">additional_ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">main_ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="c1"># Add to main ops if op is True for secondary</span>
                            <span class="c1"># operations but not True for *_file</span>
                            <span class="n">main_ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="c1"># Set width of dialog based on the presence or not of additional</span>
            <span class="c1"># files</span>
            <span class="k">if</span> <span class="n">additional_ops</span><span class="p">:</span>
                <span class="n">width</span> <span class="o">=</span> <span class="mi">650</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">width</span> <span class="o">=</span> <span class="mi">350</span>
                <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">additional_outputs</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
                <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">additional_outputs</span><span class="o">.</span><span class="n">size_hint_x</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">additional_outputs</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">wgt</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">additional_outputs</span><span class="p">)</span>

            <span class="c1"># Set height of dialog based on the number of main/additional ops</span>
            <span class="n">ml</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">main_ops</span><span class="p">)</span>
            <span class="n">al</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">additional_ops</span><span class="p">)</span>
            <span class="n">max_ops</span> <span class="o">=</span> <span class="n">ml</span> <span class="k">if</span> <span class="n">ml</span> <span class="o">&gt;</span> <span class="n">al</span> <span class="k">else</span> <span class="n">al</span>

            <span class="n">height</span> <span class="o">=</span> <span class="mi">200</span> <span class="o">+</span> <span class="p">(</span><span class="n">max_ops</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>

            <span class="n">wgt_ref</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c1"># Add main ops</span>
            <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">main_ops</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">ProgressBox</span><span class="p">()</span>
                <span class="n">p</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_lbl</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">ops_map</span><span class="p">[</span><span class="n">op</span><span class="p">]</span>
                <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_box</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="n">wgt_ref</span><span class="p">[</span><span class="n">op</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>

            <span class="c1"># Create write files operation</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">ProgressBox</span><span class="p">()</span>
            <span class="n">p</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_lbl</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">ops_map</span><span class="p">[</span><span class="s2">&quot;write&quot;</span><span class="p">]</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_box</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">wgt_ref</span><span class="p">[</span><span class="s2">&quot;write&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>

            <span class="c1"># Add additional ops</span>
            <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">additional_ops</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">ProgressBox</span><span class="p">()</span>
                <span class="n">p</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_lbl</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">ops_map</span><span class="p">[</span><span class="n">op</span><span class="p">]</span>
                <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">ad_box</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="n">wgt_ref</span><span class="p">[</span><span class="n">op</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>

            <span class="c1"># Give functionality to cancel button</span>
            <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">cancel_bt</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span>
                <span class="n">on_release</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                             <span class="s2">&quot;terminate_process_exec&quot;</span><span class="p">,</span>
                                             <span class="kc">True</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_popup</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Process execution...&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                            <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="n">auto_dissmiss</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">wgt_ref</span>

        <span class="k">def</span> <span class="nf">finish_op</span><span class="p">(</span><span class="n">wgt</span><span class="p">,</span> <span class="n">op_name</span><span class="p">):</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">load_box</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
            <span class="n">check_wgt</span> <span class="o">=</span> <span class="n">ProgressFinished</span><span class="p">()</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">load_box</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">check_wgt</span><span class="p">)</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_lbl</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="mi">18</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_lbl</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_lbl</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">ops_map</span><span class="p">[</span><span class="n">op_name</span><span class="p">]</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">secondary_lbl</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">secondary_lbl</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">start_op</span><span class="p">(</span><span class="n">wgt</span><span class="p">):</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">load_box</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
            <span class="n">spinner</span> <span class="o">=</span> <span class="n">LoadSpinner</span><span class="p">()</span>
            <span class="n">counter</span> <span class="o">=</span> <span class="n">LoadCounter</span><span class="p">()</span>
            <span class="n">wgt_ref</span><span class="p">[</span><span class="s2">&quot;spinner&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spinner</span>
            <span class="n">wgt_ref</span><span class="p">[</span><span class="s2">&quot;counter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">counter</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">load_box</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">load_box</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">spinner</span><span class="p">)</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_lbl</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="mi">18</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_lbl</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blue</span>
            <span class="n">wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">secondary_lbl</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blue</span>

        <span class="k">def</span> <span class="nf">check_process</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">man</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>

            <span class="c1"># Update progress dialog</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Start only when the first task has been initiated</span>
                <span class="k">if</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">task</span><span class="p">:</span>
                    <span class="c1"># If current_op is not empty, it means some task has</span>
                    <span class="c1"># already been previously provided.</span>
                    <span class="k">if</span> <span class="n">current_op</span><span class="p">:</span>
                        <span class="c1"># Check if the previously provided task does not match</span>
                        <span class="c1"># with the current task. If True, modify the progress</span>
                        <span class="c1"># dialog so that the previous task is finished and</span>
                        <span class="c1"># start the current task</span>
                        <span class="k">if</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">task</span> <span class="o">!=</span> <span class="n">current_op</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                            <span class="c1"># Get widget of previous task</span>
                            <span class="n">pwgt</span> <span class="o">=</span> <span class="n">wgt_ref</span><span class="p">[</span><span class="n">current_op</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                            <span class="c1"># Modify progress dialog of previous task so that</span>
                            <span class="c1"># it appears as finished</span>
                            <span class="n">finish_op</span><span class="p">(</span><span class="n">pwgt</span><span class="p">,</span> <span class="n">current_op</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="c1"># Set the previous task as the current task for</span>
                            <span class="c1"># future comparisons</span>
                            <span class="n">current_op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">task</span>
                            <span class="c1"># Get widget of current task</span>
                            <span class="n">cwgt</span> <span class="o">=</span> <span class="n">wgt_ref</span><span class="p">[</span><span class="n">shared_ns</span><span class="o">.</span><span class="n">task</span><span class="p">]</span>
                            <span class="c1"># Start loading progress of current task</span>
                            <span class="n">start_op</span><span class="p">(</span><span class="n">cwgt</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">cwgt</span> <span class="o">=</span> <span class="n">wgt_ref</span><span class="p">[</span><span class="n">shared_ns</span><span class="o">.</span><span class="n">task</span><span class="p">]</span>

                    <span class="c1"># In this case, this is the first task being performed.</span>
                    <span class="c1"># We only need to start the loading process of the current</span>
                    <span class="c1"># task</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Set the previous task as the current task</span>
                        <span class="n">current_op</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shared_ns</span><span class="o">.</span><span class="n">task</span><span class="p">)</span>
                        <span class="c1"># Get widget of current task</span>
                        <span class="n">cwgt</span> <span class="o">=</span> <span class="n">wgt_ref</span><span class="p">[</span><span class="n">shared_ns</span><span class="o">.</span><span class="n">task</span><span class="p">]</span>
                        <span class="c1"># Start loading progress of current task</span>
                        <span class="n">start_op</span><span class="p">(</span><span class="n">cwgt</span><span class="p">)</span>

                    <span class="n">wgt_ref</span><span class="p">[</span><span class="s2">&quot;spinner&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">rotation</span> <span class="o">-=</span> <span class="mi">10</span>

                    <span class="k">if</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">total</span> <span class="ow">and</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">counter</span><span class="p">:</span>
                        <span class="c1"># Get percentage</span>
                        <span class="n">perc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">shared_ns</span><span class="o">.</span><span class="n">counter</span><span class="p">)</span> <span class="o">/</span>
                                    <span class="nb">float</span><span class="p">(</span><span class="n">shared_ns</span><span class="o">.</span><span class="n">total</span><span class="p">))</span> <span class="o">*</span> <span class="mf">100.</span><span class="p">)</span>

                        <span class="c1"># Set percentage on progress dialog</span>
                        <span class="n">wgt_ref</span><span class="p">[</span><span class="s2">&quot;counter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">perc</span><span class="p">)</span>

                        <span class="c1"># Set main label, if any</span>
                        <span class="k">if</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">main_msg</span><span class="p">:</span>
                            <span class="n">cwgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">main_lbl</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">main_msg</span>

                        <span class="c1"># Set secondary label, if any</span>
                        <span class="k">if</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">msg</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">cwgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">secondary_lbl</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">msg</span>
                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                                <span class="k">pass</span>

            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1"># Interrupt subporcess on user demand</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminate_process_exec</span><span class="p">:</span>
                <span class="n">shared_ns</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">man</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
                <span class="n">Clock</span><span class="o">.</span><span class="n">unschedule</span><span class="p">(</span><span class="n">check_func</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_all_popups</span><span class="p">()</span>
                <span class="c1"># Removes all temporary database tables</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">remove_tables</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">get_tables</span><span class="p">())</span>
                <span class="k">return</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">content</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">msg</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1"># Checks for signal that the current file being processed</span>
            <span class="c1"># already exists</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">file_dialog</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dialog_fileoverwrite</span><span class="p">(</span><span class="s2">&quot;File </span><span class="si">%s</span><span class="s2"> already exists&quot;</span> <span class="o">%</span>
                                              <span class="n">basename</span><span class="p">(</span><span class="n">shared_ns</span><span class="o">.</span><span class="n">file_dialog</span><span class="p">))</span>
                    <span class="c1"># This will prevent the dialog from being</span>
                    <span class="c1"># re-generated while the user chooses the option</span>
                    <span class="n">shared_ns</span><span class="o">.</span><span class="n">file_dialog</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1"># Transmit to the subprocess the option of overwrite/skip</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_overwrite</span><span class="p">:</span>
                    <span class="n">shared_ns</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_overwrite</span>
                    <span class="c1"># If the user does not check the apply to all,</span>
                    <span class="c1"># reset the file_overwrite attribute for the next file</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_apply_all</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">file_overwrite</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="n">shared_ns</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">shared_ns</span><span class="o">.</span><span class="n">apply_all</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
                <span class="c1"># Resets file_apply_all and file_overwrite attributes</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file_apply_all</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file_overwrite</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">Clock</span><span class="o">.</span><span class="n">unschedule</span><span class="p">(</span><span class="n">check_func</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_all_popups</span><span class="p">()</span>

                <span class="c1"># Removes all temporary database tables</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">remove_tables</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="o">.</span><span class="n">get_tables</span><span class="p">())</span>

                <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

                <span class="c1"># If process execution ended with an error, issue warning.</span>
                <span class="k">try</span><span class="p">:</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">dialog_warning</span><span class="p">(</span><span class="n">shared_ns</span><span class="o">.</span><span class="n">exception</span><span class="p">[</span><span class="s2">&quot;exception&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                        <span class="n">shared_ns</span><span class="o">.</span><span class="n">exception</span><span class="p">[</span><span class="s2">&quot;exception&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">man</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">proc_files</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                            <span class="s2">&quot;All Done! </span><span class="si">%s</span><span class="s2"> file was successfully processed&quot;</span>
                            <span class="o">%</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">proc_files</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dialog_floatcheck</span><span class="p">(</span>
                            <span class="s2">&quot;All Done! </span><span class="si">%s</span><span class="s2"> files were successfully processed&quot;</span>
                            <span class="o">%</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">proc_files</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">filtered_alns</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dialog_filter_report</span><span class="p">(</span><span class="n">shared_ns</span><span class="o">.</span><span class="n">filtered_alns</span><span class="p">,</span>
                                                  <span class="n">shared_ns</span><span class="o">.</span><span class="n">proc_files</span><span class="p">)</span>
                    <span class="n">man</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

        <span class="c1"># Set up manager and shared name space to share information</span>
        <span class="c1"># between background and main processes</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>
        <span class="n">shared_ns</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">Namespace</span><span class="p">()</span>
        <span class="n">shared_ns</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">shared_ns</span><span class="o">.</span><span class="n">apply_all</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">shared_ns</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">shared_ns</span><span class="o">.</span><span class="n">task</span> <span class="o">=</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> \
            <span class="n">shared_ns</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">shared_ns</span><span class="o">.</span><span class="n">main_msg</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">shared_ns</span><span class="o">.</span><span class="n">finished_tasks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current_op</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Packing arguments to background process</span>
        <span class="n">process_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;aln_list&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alignment_list</span><span class="p">,</span>
            <span class="s2">&quot;file_set_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">active_file_set</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="s2">&quot;file_list&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">),</span>
            <span class="s2">&quot;filename_map&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_map</span><span class="p">),</span>
            <span class="s2">&quot;file_groups&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_groups</span><span class="p">),</span>
            <span class="s2">&quot;taxa_set_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_grid_wgt</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">active_taxa_set</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="s2">&quot;active_taxa_list&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_taxa_list</span><span class="p">),</span>
            <span class="s2">&quot;ns&quot;</span><span class="p">:</span> <span class="n">shared_ns</span><span class="p">,</span>
            <span class="s2">&quot;taxa_groups&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taxa_groups</span><span class="p">),</span>
            <span class="s2">&quot;hap_prefix&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hap_prefix</span><span class="p">),</span>
            <span class="s2">&quot;secondary_operations&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_operations</span><span class="p">,</span>
            <span class="s2">&quot;secondary_options&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">secondary_options</span><span class="p">),</span>
            <span class="s2">&quot;missing_filter_settings&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">missing_filter_settings</span><span class="p">),</span>
            <span class="s2">&quot;taxa_filter_settings&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taxa_filter_settings</span><span class="p">),</span>
            <span class="s2">&quot;codon_filter_settings&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codon_filter_settings</span><span class="p">),</span>
            <span class="s2">&quot;variation_filter_settings&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variation_filter</span><span class="p">),</span>
            <span class="s2">&quot;output_file&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_file</span><span class="p">,</span>
            <span class="s2">&quot;conversion_suffix&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">conversion_suffix</span><span class="p">,</span>
            <span class="s2">&quot;rev_infile&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rev_infile</span><span class="p">,</span>
            <span class="s2">&quot;main_operations&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_operations</span><span class="p">),</span>
            <span class="s2">&quot;zorro_suffix&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zorro_suffix</span><span class="p">),</span>
            <span class="s2">&quot;partitions_file&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitions_file</span><span class="p">,</span>
            <span class="s2">&quot;output_formats&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_formats</span><span class="p">),</span>
            <span class="s2">&quot;create_partfile&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_partfile</span><span class="p">),</span>
            <span class="s2">&quot;use_nexus_partitions&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_nexus_partitions</span><span class="p">),</span>
            <span class="s2">&quot;use_nexus_models&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_nexus_models</span><span class="p">),</span>
            <span class="s2">&quot;phylip_truncate_name&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phylip_truncate_name</span><span class="p">),</span>
            <span class="s2">&quot;output_dir&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">,</span>
            <span class="s2">&quot;use_app_partitions&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_app_partitions</span><span class="p">),</span>
            <span class="s2">&quot;consensus_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_options</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">consensus_mode</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="s2">&quot;ld_hat&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ld_hat</span><span class="p">),</span>
            <span class="s2">&quot;ima2_params&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ima2_options</span><span class="p">)}</span>

        <span class="c1"># Remove lock from background process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terminate_process_exec</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Create process</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">process_execution</span><span class="p">,</span>
                     <span class="n">kwargs</span><span class="o">=</span><span class="n">process_kwargs</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># Remove any possible previous popups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dismiss_popup</span><span class="p">()</span>
        <span class="c1"># Create waiting dialog</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">ProcessExecutionProgress</span><span class="p">()</span>
        <span class="n">wgt_ref</span> <span class="o">=</span> <span class="n">build_progress_dialog</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

        <span class="c1"># Schedule function that checks the process&#39; pulse</span>
        <span class="n">check_func</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">check_process</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">manager</span><span class="p">)</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_interval</span><span class="p">(</span><span class="n">check_func</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../trifusion.app.html#trifusion.app.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="n">multiprocessing</span><span class="o">.</span><span class="n">freeze_support</span><span class="p">()</span>

    <span class="k">global</span> <span class="n">MCL_FILE</span>

    <span class="c1"># This will handle the pointer to the kv file whether TriFusion is a</span>
    <span class="c1"># one-file executable, a one-dir executable, or running from source.</span>
    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s2">&quot;frozen&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>

        <span class="c1"># Get relative path of mcl binary</span>
        <span class="n">mcl_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;linux2&quot;</span><span class="p">:</span>
            <span class="n">mcl_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;resources&quot;</span><span class="p">,</span> <span class="s2">&quot;mcl&quot;</span><span class="p">,</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span> <span class="s2">&quot;mcl&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;win32&quot;</span><span class="p">,</span> <span class="s2">&quot;cygwin&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">architecture</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;64bit&quot;</span><span class="p">:</span>
                <span class="n">mcl_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;resources&quot;</span><span class="p">,</span> <span class="s2">&quot;mcl&quot;</span><span class="p">,</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;64bit&quot;</span><span class="p">,</span> <span class="s2">&quot;mcl64.exe&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mcl_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;resources&quot;</span><span class="p">,</span> <span class="s2">&quot;mcl&quot;</span><span class="p">,</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;32bit&quot;</span><span class="p">,</span> <span class="s2">&quot;mcl32.exe&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;darwin&quot;</span><span class="p">:</span>
            <span class="n">mcl_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;resources&quot;</span><span class="p">,</span> <span class="s2">&quot;mcl&quot;</span><span class="p">,</span> <span class="s2">&quot;MacOS&quot;</span><span class="p">,</span> <span class="s2">&quot;mcl&quot;</span><span class="p">)</span>

        <span class="c1"># One-file</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Get main kv file</span>
            <span class="n">kv_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_MEIPASS</span><span class="p">,</span> <span class="s2">&quot;trifusion.kv&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_MEIPASS</span><span class="p">)</span>
            <span class="c1"># Get mcl executable path</span>
            <span class="n">MCL_FILE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_MEIPASS</span><span class="p">,</span> <span class="n">mcl_path</span><span class="p">)</span>
        <span class="c1"># One-dir</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">kv_file</span> <span class="o">=</span> <span class="s2">&quot;trifusion.kv&quot;</span>
            <span class="n">MCL_FILE</span> <span class="o">=</span> <span class="n">mcl_path</span>

    <span class="c1"># Source</span>
    <span class="k">elif</span> <span class="vm">__file__</span><span class="p">:</span>
        <span class="n">kv_file</span> <span class="o">=</span> <span class="s2">&quot;trifusion.kv&quot;</span>

    <span class="n">TriFusionApp</span><span class="p">(</span><span class="n">kv_file</span><span class="o">=</span><span class="s2">&quot;trifusion.kv&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Diogo N. Silva.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.5.5',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>