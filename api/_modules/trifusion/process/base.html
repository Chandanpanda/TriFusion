

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>trifusion.process.base &mdash; TriFusion 0.5.5 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="TriFusion 0.5.5 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> TriFusion
          

          
          </a>

          
            
            
              <div class="version">
                0.5.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../trifusion.html">TriFusion modules and API reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">TriFusion</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>trifusion.process.base</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for trifusion.process.base</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python2</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">#</span>
<span class="c1">#  Copyright 2012 Unknown &lt;diogo@arch&gt;</span>
<span class="c1">#  </span>
<span class="c1">#  This program is free software; you can redistribute it and/or modify</span>
<span class="c1">#  it under the terms of the GNU General Public License as published by</span>
<span class="c1">#  the Free Software Foundation; either version 2 of the License, or</span>
<span class="c1">#  (at your option) any later version.</span>
<span class="c1">#  </span>
<span class="c1">#  This program is distributed in the hope that it will be useful,</span>
<span class="c1">#  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1">#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1">#  GNU General Public License for more details.</span>
<span class="c1">#  </span>
<span class="c1">#  You should have received a copy of the GNU General Public License</span>
<span class="c1">#  along with this program; if not, write to the Free Software</span>
<span class="c1">#  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,</span>
<span class="c1">#  MA 02110-1301, USA.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The `base` module includes the `Base` class, which is inherited by `Alignment`</span>
<span class="sd">and `AlignmentList` classes and provides several methods of general use.</span>

<span class="sd">It also defines the `CleanUp` decorator used by TriSeq and TriStats</span>
<span class="sd">to handle the generation of temporary data during their execution as well</span>
<span class="sd">as keyboard interruptions.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">process.error_handling</span> <span class="k">import</span> <span class="n">InputError</span><span class="p">,</span> <span class="n">EmptyAlignment</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">trifusion.process.error_handling</span> <span class="k">import</span> <span class="n">InputError</span><span class="p">,</span> <span class="n">EmptyAlignment</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">Counter</span>

<span class="n">dna_chars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">]</span>

<span class="n">aminoacid_table</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">({</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Alanine&quot;</span><span class="p">,</span> <span class="s2">&quot;nonpolar&quot;</span><span class="p">,</span> <span class="s2">&quot;neutral&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Arginine&quot;</span><span class="p">,</span> <span class="s2">&quot;polar&quot;</span><span class="p">,</span> <span class="s2">&quot;positive&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Asparagine&quot;</span><span class="p">,</span> <span class="s2">&quot;polar&quot;</span><span class="p">,</span> <span class="s2">&quot;neutral&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Aspartate&quot;</span><span class="p">,</span> <span class="s2">&quot;polar&quot;</span><span class="p">,</span> <span class="s2">&quot;negative&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Cysteine&quot;</span><span class="p">,</span> <span class="s2">&quot;nonpolar&quot;</span><span class="p">,</span> <span class="s2">&quot;neutral&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;e&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Glutamate&quot;</span><span class="p">,</span> <span class="s2">&quot;polar&quot;</span><span class="p">,</span> <span class="s2">&quot;negative&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;q&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Glutamine&quot;</span><span class="p">,</span> <span class="s2">&quot;polar&quot;</span><span class="p">,</span> <span class="s2">&quot;neutral&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;g&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Glycine&quot;</span><span class="p">,</span> <span class="s2">&quot;nonpolar&quot;</span><span class="p">,</span> <span class="s2">&quot;neutral&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Histidine&quot;</span><span class="p">,</span> <span class="s2">&quot;polar&quot;</span><span class="p">,</span> <span class="s2">&quot;neutral&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;i&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Isoleucine&quot;</span><span class="p">,</span> <span class="s2">&quot;nonpolar&quot;</span><span class="p">,</span> <span class="s2">&quot;neutral&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;l&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Leucine&quot;</span><span class="p">,</span> <span class="s2">&quot;nonpolar&quot;</span><span class="p">,</span> <span class="s2">&quot;neutral&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Lysine&quot;</span><span class="p">,</span> <span class="s2">&quot;polar&quot;</span><span class="p">,</span> <span class="s2">&quot;positive&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;m&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Methionine&quot;</span><span class="p">,</span> <span class="s2">&quot;nonpolar&quot;</span><span class="p">,</span> <span class="s2">&quot;neutral&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;f&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Phenylalanine&quot;</span><span class="p">,</span> <span class="s2">&quot;nonpolar&quot;</span><span class="p">,</span> <span class="s2">&quot;neutral&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Proline&quot;</span><span class="p">,</span> <span class="s2">&quot;nonpolar&quot;</span><span class="p">,</span> <span class="s2">&quot;neutral&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Serine&quot;</span><span class="p">,</span> <span class="s2">&quot;polar&quot;</span><span class="p">,</span> <span class="s2">&quot;neutral&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Threonine&quot;</span><span class="p">,</span> <span class="s2">&quot;polar&quot;</span><span class="p">,</span> <span class="s2">&quot;neutral&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Tryptophan&quot;</span><span class="p">,</span> <span class="s2">&quot;nonpolar&quot;</span><span class="p">,</span> <span class="s2">&quot;neutral&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Tyrosine&quot;</span><span class="p">,</span> <span class="s2">&quot;polar&quot;</span><span class="p">,</span> <span class="s2">&quot;neutral&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Valine&quot;</span><span class="p">,</span> <span class="s2">&quot;nonpolar&quot;</span><span class="p">,</span> <span class="s2">&quot;neutral&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;u&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Selenocysteine&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;o&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Pyrrolysine&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Missing&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]})</span>

<span class="n">iupac</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ag&quot;</span><span class="p">:</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;ct&quot;</span><span class="p">:</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;cg&quot;</span><span class="p">:</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;at&quot;</span><span class="p">:</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;gt&quot;</span><span class="p">:</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="s2">&quot;ac&quot;</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
         <span class="s2">&quot;cgt&quot;</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;agt&quot;</span><span class="p">:</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;act&quot;</span><span class="p">:</span> <span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="s2">&quot;acg&quot;</span><span class="p">:</span> <span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;acgt&quot;</span><span class="p">:</span> <span class="s2">&quot;n&quot;</span><span class="p">}</span>

<span class="n">iupac_rev</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="s2">&quot;acg&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="s2">&quot;ag&quot;</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span> <span class="s2">&quot;ac&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="s2">&quot;cg&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="s2">&quot;agt&quot;</span><span class="p">,</span>
             <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="s2">&quot;cgt&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="s2">&quot;acgt&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="s2">&quot;act&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;ct&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="s2">&quot;at&quot;</span><span class="p">,</span>
             <span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="s2">&quot;gt&quot;</span><span class="p">}</span>

<span class="n">iupac_conv</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="s2">&quot;acg&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="s2">&quot;ag&quot;</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span> <span class="s2">&quot;ac&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="s2">&quot;cg&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="s2">&quot;agt&quot;</span><span class="p">,</span>
              <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="s2">&quot;cgt&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="s2">&quot;acgt&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="s2">&quot;act&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;ct&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="s2">&quot;at&quot;</span><span class="p">,</span>
              <span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="s2">&quot;gt&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;aa&quot;</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="s2">&quot;tt&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="s2">&quot;cc&quot;</span><span class="p">,</span> <span class="s2">&quot;g&quot;</span><span class="p">:</span> <span class="s2">&quot;gg&quot;</span><span class="p">}</span>


<div class="viewcode-block" id="CleanUp"><a class="viewcode-back" href="../../../trifusion.process.base.html#trifusion.process.base.CleanUp">[docs]</a><span class="k">class</span> <span class="nc">CleanUp</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decorator class that handles temporary data for TriSeq and TriStats.</span>
<span class="sd">    </span>
<span class="sd">    This decorator class wraps the main execution functions of TriSeq and</span>
<span class="sd">    TriStats programs. The __init__ requires only the function reference,</span>
<span class="sd">    defines the name of the temporary directory and evaluates whether the</span>
<span class="sd">    provided `func` is from TriSeq or TriStats. The only requirement of </span>
<span class="sd">    `func` is that its first argument is the argparser namespace (that is,</span>
<span class="sd">    the arguments must be parsed in the corresponding program before </span>
<span class="sd">    calling the main function).</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    func : function</span>
<span class="sd">        Main function of TriSeq or TriStats</span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    func : function</span>
<span class="sd">        Main function of TriSeq or TriStats</span>
<span class="sd">    temp_dir : str</span>
<span class="sd">        Path to temporary directory where the temporary data will be stored</span>
<span class="sd">    idx : int</span>
<span class="sd">        Integer identifier of the main function&#39;s program. 0 for TriSeq and</span>
<span class="sd">        2 for TriStats</span>
<span class="sd">        </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    print_col</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
        <span class="c1"># Set name of temporary directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span> <span class="o">=</span> <span class="s2">&quot;.trifusion-temp&quot;</span>
        <span class="c1"># Evaluate whether func is from TriSeq or TriStats from its name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;main_parser&quot;</span> <span class="k">else</span> <span class="mi">2</span>

<div class="viewcode-block" id="CleanUp.__call__"><a class="viewcode-back" href="../../../trifusion.process.base.html#trifusion.process.base.CleanUp.__call__">[docs]</a>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wraps the call of `func`.</span>
<span class="sd">        </span>
<span class="sd">        When the main `func` is called, this code is wrapped around its</span>
<span class="sd">        execution. This mainly ensures that the temporary data stored in</span>
<span class="sd">        `temp_dir` is correctly removed at the end of the execution, whether</span>
<span class="sd">        it terminals successfully or not. It also clocks the duration of the</span>
<span class="sd">        execution.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        args : list</span>
<span class="sd">            Arbitrary list of positional arguments of `func`. The only </span>
<span class="sd">            requirement is that the first element is the argparse namespace</span>
<span class="sd">            object.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Set starting time for clocking execution duration</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="c1"># Execute main function</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

            <span class="c1"># If program was not executed with &#39;quiet&#39; flag, print final</span>
            <span class="c1"># execution message</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">quiet</span><span class="p">:</span>
                <span class="n">print_col</span><span class="p">(</span><span class="s2">&quot;Program execution successfully completed in </span><span class="si">%s</span><span class="s2"> &quot;</span>
                          <span class="s2">&quot;seconds&quot;</span> <span class="o">%</span>
                          <span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">GREEN</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">)</span>

        <span class="c1"># Handle execution termination via Ctrl+C. Ensures that all temporary</span>
        <span class="c1"># data is remove.</span>
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="c1"># Removing temporary directory, if any</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">):</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">)</span>
            <span class="n">print_col</span><span class="p">(</span><span class="s2">&quot;Interrupting, by your command&quot;</span><span class="p">,</span> <span class="n">RED</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">)</span>

        <span class="c1"># The broad exception handling is used to remove the temporary</span>
        <span class="c1"># directory under any circumstances</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="c1"># Removing temporary directory, if any</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">):</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">quiet</span><span class="p">:</span>
                <span class="n">print_col</span><span class="p">(</span><span class="s2">&quot;Program exited with errors!&quot;</span><span class="p">,</span> <span class="n">RED</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">)</span>

        <span class="c1"># Removing temporary directory, if any</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="merger"><a class="viewcode-back" href="../../../trifusion.process.base.html#trifusion.process.base.merger">[docs]</a><span class="k">def</span> <span class="nf">merger</span><span class="p">(</span><span class="n">ranges</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generator that merges continuous ranges of tuples in a list.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ranges : list</span>
<span class="sd">        List of tuples, each with two integer elements defining a range,</span>
<span class="sd">        (0, 100) for instance.</span>
<span class="sd">    </span>
<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    If the provide ranges are [(1, 234), (235, 456), (560, 607), (607,789)]</span>
<span class="sd">    this generator will yield the elements (1, 456) and (560, 789)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">previous</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">last_start</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">st</span><span class="p">,</span> <span class="n">en</span> <span class="ow">in</span> <span class="n">ranges</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">previous</span><span class="p">:</span>
            <span class="n">last_start</span> <span class="o">=</span> <span class="n">st</span>
            <span class="n">previous</span> <span class="o">=</span> <span class="n">en</span>
        <span class="k">elif</span> <span class="n">st</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">previous</span><span class="p">:</span>
            <span class="n">previous</span> <span class="o">=</span> <span class="n">en</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">last_start</span><span class="p">,</span> <span class="n">previous</span>
            <span class="n">previous</span> <span class="o">=</span> <span class="n">en</span>
            <span class="n">last_start</span> <span class="o">=</span> <span class="n">st</span>

    <span class="k">yield</span> <span class="n">last_start</span><span class="p">,</span> <span class="n">en</span></div>


<span class="k">def</span> <span class="nf">has_colours</span><span class="p">(</span><span class="n">stream</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s2">&quot;isatty&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">stream</span><span class="o">.</span><span class="n">isatty</span><span class="p">():</span>
        <span class="k">return</span> <span class="kc">False</span> <span class="c1"># auto color only on TTYs</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">curses</span>
        <span class="n">curses</span><span class="o">.</span><span class="n">setupterm</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">curses</span><span class="o">.</span><span class="n">tigetnum</span><span class="p">(</span><span class="s2">&quot;colors&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c1"># guess false in case of error</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="c1"># Support for terminal colors</span>
<span class="n">BLACK</span><span class="p">,</span> <span class="n">RED</span><span class="p">,</span> <span class="n">GREEN</span><span class="p">,</span> <span class="n">YELLOW</span><span class="p">,</span> <span class="n">BLUE</span><span class="p">,</span> <span class="n">MAGENTA</span><span class="p">,</span> <span class="n">CYAN</span><span class="p">,</span> <span class="n">WHITE</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="n">has_colours</span> <span class="o">=</span> <span class="n">has_colours</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>


<div class="viewcode-block" id="print_col"><a class="viewcode-back" href="../../../trifusion.process.base.html#trifusion.process.base.print_col">[docs]</a><span class="k">def</span> <span class="nf">print_col</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Custom print function for terminal updates of CLI programs.</span>
<span class="sd">    </span>
<span class="sd">    This print function homogenizes the progress logging of all CLI programs</span>
<span class="sd">    while providing some freedom on the formatting of the progress message,</span>
<span class="sd">    name the colors of the messages. A list of terminal colors is provided</span>
<span class="sd">    and a `has_colors` function checks whether they are supported on the </span>
<span class="sd">    terminal. The colors in use are green for normal logging, yellow for</span>
<span class="sd">    warnings and red for errors. The final formatting of the message is </span>
<span class="sd">    something like:</span>
<span class="sd">    </span>
<span class="sd">    [&lt;Program Name&gt;[-Error/Warning]] &lt;message&gt;</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    text : str</span>
<span class="sd">        The message that will appear in the terminal</span>
<span class="sd">    color : variable reference</span>
<span class="sd">        Reference to the terminal colors defined in process.base. Provided </span>
<span class="sd">        that they are imported in the module where they are being called, the</span>
<span class="sd">        options are: {GREEN, YELLOW, RED}</span>
<span class="sd">    i : int</span>
<span class="sd">        Integer that specified which CLI program is being logged. The options</span>
<span class="sd">        are:</span>
<span class="sd">        0: TriSeq</span>
<span class="sd">        1: OrthoMCL Pipeline</span>
<span class="sd">        2: TriStats</span>
<span class="sd">        3: TriOrtho</span>
<span class="sd">    quiet : bool</span>
<span class="sd">        Determines whether the message is logged. If True, no messages are</span>
<span class="sd">        printed to the terminal</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;TriSeq&quot;</span><span class="p">,</span> <span class="s2">&quot;OrthoMCl Pipeline&quot;</span><span class="p">,</span> <span class="s2">&quot;TriStats&quot;</span><span class="p">,</span> <span class="s2">&quot;TriOrtho&quot;</span><span class="p">]</span>
        <span class="n">suf</span> <span class="o">=</span> <span class="p">{</span><span class="n">GREEN</span><span class="p">:</span> <span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">] &quot;</span> <span class="o">%</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">YELLOW</span><span class="p">:</span> <span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">-Warning] &quot;</span> <span class="o">%</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
               <span class="n">RED</span><span class="p">:</span> <span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">-Error] &quot;</span> <span class="o">%</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]}</span>
        <span class="k">if</span> <span class="n">has_colours</span><span class="p">:</span>
            <span class="n">seq</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[1;</span><span class="si">%d</span><span class="s2">m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">30</span> <span class="o">+</span> <span class="n">color</span><span class="p">)</span> <span class="o">+</span> <span class="n">suf</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">+</span> <span class="n">text</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="n">RED</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span></div>


<div class="viewcode-block" id="Base"><a class="viewcode-back" href="../../../trifusion.process.base.html#trifusion.process.base.Base">[docs]</a><span class="k">class</span> <span class="nc">Base</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

<div class="viewcode-block" id="Base.autofinder"><a class="viewcode-back" href="../../../trifusion.process.base.html#trifusion.process.base.Base.autofinder">[docs]</a>    <span class="k">def</span> <span class="nf">autofinder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reference_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Autodetects format, missing data symbol and sequence type.</span>
<span class="sd">        </span>
<span class="sd">        Attempts to find the file format, missing data symbol and sequence</span>
<span class="sd">        type from a reference file. Due to performance reasons, this function</span>
<span class="sd">        will only read the `referenced_file` until it finds the first sequence.</span>
<span class="sd">        Then, it evaluates the file format and sequence type. It also</span>
<span class="sd">        attempts to get the missing data symbol, but the first sequence may</span>
<span class="sd">        have no missing data. In that case, the missing data symbol will remain</span>
<span class="sd">        undefined and will be re-evaluated during alignment parsing.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        reference_file : str</span>
<span class="sd">            Path to sequence file</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fmt : str</span>
<span class="sd">            File format of `reference_file`</span>
<span class="sd">        code : tuple</span>
<span class="sd">            The sequence type as string in first element and missing data</span>
<span class="sd">            symbol as string in the second element</span>
<span class="sd">        </span>
<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        guess_code</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">file_handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">reference_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>

        <span class="c1"># Set to True when the format has been detected</span>
        <span class="n">format_found</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># If input file is not a simple text file, which means it&#39;s invalid,</span>
        <span class="c1"># handle this exception</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">file_handle</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">InputError</span><span class="p">(</span><span class="s2">&quot;Invalid input file.&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Skips first empty lines, if any</span>
            <span class="k">while</span> <span class="n">header</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="n">header</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">file_handle</span><span class="p">)</span>

            <span class="c1"># Recognition of NEXUS files is based on the existence of the</span>
            <span class="c1"># string &quot;#NEXUS&quot; in the first non-empty line</span>
            <span class="k">if</span> <span class="n">header</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#NEXUS&quot;</span><span class="p">):</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;nexus&quot;</span>
                <span class="n">format_found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">file_handle</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;matrix&quot;</span><span class="p">:</span>
                            <span class="n">next_line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">file_handle</span><span class="p">)</span>
                            <span class="k">while</span> <span class="n">next_line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
                                <span class="n">next_line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">file_handle</span><span class="p">)</span>
                            <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">next_line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="k">break</span>

            <span class="c1"># Recognition of Stockhold files is based on the existence of the</span>
            <span class="c1"># string &quot;# stockholm&quot; in the first non-empty line</span>
            <span class="c1"># (case insensitive)</span>
            <span class="k">elif</span> <span class="n">header</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;# STOCKHOLM&quot;</span><span class="p">)</span> <span class="ow">or</span> \
                    <span class="n">header</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#STOCKHOLM&quot;</span><span class="p">):</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;stockholm&quot;</span>
                <span class="n">format_found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">file_handle</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">sequence</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">break</span>

            <span class="c1"># Recognition of FASTA or .loci files is based on the existence</span>
            <span class="c1"># of a &quot;&gt;&quot; character as the first character of a non-empty line</span>
            <span class="k">elif</span> <span class="n">header</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">):</span>
                <span class="n">next_line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">file_handle</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">next_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">):</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;loci&quot;</span>
                    <span class="n">format_found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">sequence</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;fasta&quot;</span>
                    <span class="n">format_found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">sequence</span> <span class="o">=</span> <span class="n">next_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file_handle</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">:</span>
                            <span class="n">sequence</span> <span class="o">+=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">:</span>
                            <span class="k">break</span>

            <span class="c1"># Recognition of Phylip files is based on the existence of two</span>
            <span class="c1"># integers separated by whitespace on the first non-empy line</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">header</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>\
                    <span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="n">header</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>

                <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;phylip&quot;</span>
                <span class="n">format_found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file_handle</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="c1"># Recognition of ipyrad loci file, which does not start with a &quot;&gt;&quot;</span>
            <span class="c1"># character</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">format_found</span><span class="p">:</span>
                <span class="k">while</span> <span class="ow">not</span> <span class="n">header</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;//&quot;</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">header</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">file_handle</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="k">if</span> <span class="n">header</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;//&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">header</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;loci&quot;</span>
                            <span class="n">format_found</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="n">sequence</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">file_handle</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Check if there is any sequence. If not, the alignment file has no</span>
            <span class="c1"># sequence</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">format_found</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">InputError</span><span class="p">(</span><span class="s2">&quot;Unknown input file format.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sequence</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">EmptyAlignment</span><span class="p">(</span><span class="s2">&quot;Alignment is empty&quot;</span><span class="p">)</span>

            <span class="c1"># Guessing the genetic code</span>
            <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">guess_code</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">EmptyAlignment</span><span class="p">(</span><span class="s2">&quot;Alignment is empty&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">code</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Base.get_loci_taxa"><a class="viewcode-back" href="../../../trifusion.process.base.html#trifusion.process.base.Base.get_loci_taxa">[docs]</a>    <span class="k">def</span> <span class="nf">get_loci_taxa</span><span class="p">(</span><span class="n">loci_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the list of taxa from a .loci file.</span>
<span class="sd">        </span>
<span class="sd">        This is required prior to parsing the alignment in order to </span>
<span class="sd">        correctly add missing data when certain taxa are not present in </span>
<span class="sd">        a locus</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        loci_file : str</span>
<span class="sd">            Path to the .loci file.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        taxa_list : list</span>
<span class="sd">            List of the taxon names as strings.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">file_handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">loci_file</span><span class="p">)</span>
        <span class="n">taxa_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file_handle</span><span class="p">:</span>
            <span class="c1"># Skip empty lines and lines starting with //</span>
            <span class="c1"># The .lstrip(&quot;&gt;&quot;) supports the new format of pyRAD&#39;s .loci</span>
            <span class="c1"># where taxon names start with a &quot;&gt;&quot; character</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;//&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">taxon</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">taxon</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">taxa_list</span><span class="p">:</span>
                    <span class="n">taxa_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">taxon</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">taxa_list</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Base.guess_code"><a class="viewcode-back" href="../../../trifusion.process.base.html#trifusion.process.base.Base.guess_code">[docs]</a>    <span class="k">def</span> <span class="nf">guess_code</span><span class="p">(</span><span class="n">sequence</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Guess the sequence type, i.e. protein.</span>
<span class="sd">        </span>
<span class="sd">        Guesses the code of the provided `sequence`, that is, if it is a</span>
<span class="sd">        DNA or Protein sequence based on the first sequence of </span>
<span class="sd">        the reference file. The second item of the returned `code` variable </span>
<span class="sd">        is a placeholder for the missing data symbol (can be either &quot;?&quot;, &quot;n&quot;</span>
<span class="sd">        or &quot;x&quot;). This symbol will be evaluated during the Alignment parsing.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sequence : string</span>
<span class="sd">            Sequence string that will be used to guess the type</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        code : list</span>
<span class="sd">            Provides the (&lt;sequence type&gt;, &lt;missing symbol character&gt;).</span>
<span class="sd">            sequence type can be either &quot;DNA&quot; or &quot;Protein&quot;. The</span>
<span class="sd">            missing symbol character may be &quot;?&quot;, &quot;n&quot;, &quot;x&quot; or None (See Notes).</span>
<span class="sd">        </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        autofinder</span>
<span class="sd">        process.sequence.Alignment.read_alignment</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The missing symbol character that is provided in the returned `code`</span>
<span class="sd">        tuple may be None if the missing character cannot be determined</span>
<span class="sd">        from the first reference sequence that is used to guess the </span>
<span class="sd">        sequence type. If none of the potential missing data symbol is </span>
<span class="sd">        present in this reference sequence, it will remain undetermined and</span>
<span class="sd">        will be evaluated during the alignment parsing. </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Removes gaps from the sequence so that the frequencies are not biased</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Try to evaluate whether missing data is in ? or N/X format. Since</span>
        <span class="c1"># the &#39;?&#39; character should only occur in sequences as missing data</span>
        <span class="c1"># (unlike the N character, which can be an amino acid residue),</span>
        <span class="c1"># we assume that if it exists in the sequence, that&#39;s the missing</span>
        <span class="c1"># data character</span>
        <span class="k">if</span> <span class="n">sequence</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">):</span>
            <span class="n">missing</span> <span class="o">=</span> <span class="s2">&quot;?&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">missing</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">dna_count</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">sequence</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span> <span class="o">+</span> \
            <span class="n">sequence</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;G&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">sequence</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">)</span> <span class="o">+</span> \
            <span class="n">sequence</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">)</span>

        <span class="n">dna_proportion</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dna_count</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">))</span>

        <span class="c1"># The 0.9 cut-off has been effective so far</span>
        <span class="k">if</span> <span class="n">dna_proportion</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sequence</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">):</span>
                <span class="n">missing</span> <span class="o">=</span> <span class="s2">&quot;n&quot;</span>
            <span class="n">code</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DNA&quot;</span><span class="p">,</span> <span class="n">missing</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sequence</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">):</span>
                <span class="n">missing</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span>
            <span class="n">code</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Protein&quot;</span><span class="p">,</span> <span class="n">missing</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">code</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Base.rm_illegal"><a class="viewcode-back" href="../../../trifusion.process.base.html#trifusion.process.base.Base.rm_illegal">[docs]</a>    <span class="k">def</span> <span class="nf">rm_illegal</span><span class="p">(</span><span class="n">taxon_string</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes illegal characters from taxon name.</span>
<span class="sd">        </span>
<span class="sd">        The illegal characters are defined in the `illegal_chars`</span>
<span class="sd">        variable</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        taxon_string : str</span>
<span class="sd">            Taxon name</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        clean_name : str</span>
<span class="sd">            Taxon name without illegal characters</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Additional illegal characters are added here</span>
        <span class="n">illegal_chars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;&quot;, &quot;&quot;&quot;</span><span class="p">]</span>

        <span class="n">clean_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">char</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">taxon_string</span> <span class="k">if</span> <span class="n">char</span> <span class="ow">not</span> <span class="ow">in</span>
                              <span class="n">illegal_chars</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">clean_name</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Base.duplicate_taxa"><a class="viewcode-back" href="../../../trifusion.process.base.html#trifusion.process.base.Base.duplicate_taxa">[docs]</a>    <span class="k">def</span> <span class="nf">duplicate_taxa</span><span class="p">(</span><span class="n">taxa_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Identified duplicate items in a list.</span>
<span class="sd">        </span>
<span class="sd">        Used to detect, for instance, duplicated taxa in the Alignment object</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        taxa_list : list</span>
<span class="sd">            List with taxon names</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        duplicated_taxa : list</span>
<span class="sd">            List with duplicated taxa from `taxa_list`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">duplicated_taxa</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">taxa_list</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                           <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">duplicated_taxa</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Base.read_basic_csv"><a class="viewcode-back" href="../../../trifusion.process.base.html#trifusion.process.base.Base.read_basic_csv">[docs]</a>    <span class="k">def</span> <span class="nf">read_basic_csv</span><span class="p">(</span><span class="n">file_handle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a basic CSV into a list.</span>
<span class="sd">        </span>
<span class="sd">        Parses a simples CSV file with only one column and one</span>
<span class="sd">        or more lines while stripping whitespace.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_handle : file object</span>
<span class="sd">            File object of the CSV file</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : list</span>
<span class="sd">            Contents of the CSV file with each line in a different entry</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file_handle</span><span class="p">:</span>

            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">result</span></div></div>


<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Diogo N. Silva&quot;</span>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Diogo N. Silva.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.5.5',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>