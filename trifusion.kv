#:kivy 1.8.0

<ShowcaseScreen>:
    ScrollView:
        do_scroll_x: False
        do_scroll_y: False if root.fullscreen else (content.height > root.height - dp(16))
        AnchorLayout:
            size_hint_y: None
            height: root.height if root.fullscreen else max(root.height, content.height)
            GridLayout:
                id: content
                cols: 1

<PopupLabel@Label>:
    bold: True
    halign: "left"
    valign: "middle"
    text_size: self.size
    size_hint_x: .6

<PopupText@TextInput>:
    multiline: False
    readonly: True
    size_hint_x: .4

<PopupBox@BoxLayout>:
    size_hint_y: None
    height: 30
    spacing: 10

<FilePopup@BoxLayout>
    orientation: "vertical"
    padding: 10
    spacing: 5
    BoxLayout:
        orientation: "vertical"
        spacing: 10
        PopupBox:
            PopupLabel:
                text: "Input format:"
            PopupText:
                id: in_format
        PopupBox:
            PopupLabel:
                text: "Sequence type:"
            PopupText:
                id: seq_type
        PopupBox:
            PopupLabel:
                text: "Alignment:"
            PopupText:
                id: is_aln
        PopupBox:
            PopupLabel:
                text: "Sequence size:"
            PopupText:
                id: seq_size
        PopupBox:
            PopupLabel:
                text: "Number of taxa:"
            PopupText:
                id: n_taxa
    Button:
        size_hint_y: None
        height: 30
        text: "Cancel"
        on_release:
            root.cancel()

<TaxaPopup>
    orientation: "vertical"
    size_hint_y: None
    padding: 15
    spacing: 5
    PopupLabel:
        background_color: (.7, .7, .7)
        id: dataset_label
        halign: "center"
        size_hint_x: 1
        size_hint_y: None
        height: 30
        canvas.before:
            Color:
                rgba: .35, .35, .35, 1
            Rectangle:
                pos: self.pos
                size: self.size
    PopupBox:
        PopupLabel:
            #size_hint_x: .45
            text: "Sequence length:"
        PopupText:
            #size_hint_x: .55
            id: seq_len
    PopupBox:
        PopupLabel:
            #size_hint_x: .45
            text: "Number of indels:"
        PopupText:
            #size_hint_x: .55
            id: indels
    PopupBox:
        PopupLabel:
            #size_hint_x: .65
            text: "Number of missing data:"
        PopupText:
            #size_hint_x: .35
            id: missing
    PopupBox:
        PopupLabel:
            #size_hint_x: .7
            text: "Effective sequence length:"
        PopupText:
            #size_hint_x: .3
            id: ef_seq_len
    PopupBox:
        PopupLabel:
            #size_hint_x: .35
            text: "File coverage"
        PopupText:
            #size_hint_x: .65
            id: file_cov

<CheckDialog@BoxLayout>:
    orientation: "vertical"
    id: check
    text: None
    Label:
        valign: "middle"
        halign: "center"
        text_size: (self.size[0] - 5, self.size[1])
        id: check_text
    BoxLayout:
        size_hint_y: None
        height: 30
        spacing: 5
        Button:
            text: "Yes"
            id: check_ok
            on_release:
                root.cancel()
        Button:
            text: "No"
            on_release:
                root.cancel()

<WarningDialog@BoxLayout>:
    padding: 10
    orientation: "vertical"
    Label:
        id: warning_l
        halign: "center"
        valign: "middle"
        text_size: self.size
        markup: True
    Button:
        size_hint_y: None
        height: 30
        text: "Close"
        on_release:
            root.cancel()

<TaxaGroupDialog@BoxLayout>:
    orientation: "vertical"
    padding: 10
    spacing: 10
    BoxLayout:
        size_hint_y: .1
        BoxLayout:
            spacing: 10
            Label:
                text: "Set group name:"
                size_hint_x: .5
            TextInput:
                id: group_name
                text: "untitled_1"
        Widget:
            size_hint_x: .15
        Widget
    BoxLayout:
        BoxLayout:
            orientation: "vertical"
            Label:
                canvas.before:
                    Color:
                        rgba: .2, .2, .2, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size
                text: "Selected taxa"
                size_hint_y: None
                height: 40
                bold: True
            Hseparator
            ScrollView:
                canvas.before:
                    Color:
                        rgba: .3, .3, .3, .5
                    Rectangle:
                        pos: self.pos
                        size: self.size
                GridLayout:
                    id: select_grid
                    cols:1
                    size_hint_y: None
                    height: 0
            Widget:
                size_hint_y: None
                height: 15
            Button:
                size_hint_y: .15
                text: "Save"
                on_release:
                    if root.ids.group_name.text not in app.taxa_groups: app.save_taxa_group(root.ids.select_grid, root.ids.group_name.text); root.cancel()
        BoxLayout:
            orientation: "vertical"
            size_hint_x: .30
            spacing: 10
            BoxLayout:
                padding: 20
                spacing: 20
                orientation: "vertical"
                Button:
                    text: "<<"
                    bold: True
                    on_release:
                        app.taxagroup_move_taxa(root.ids.all_grid, root.ids.select_grid, True)
                Button:
                    text: "<"
                    bold: True
                    on_release:
                        app.taxagroup_move_taxa(root.ids.all_grid, root.ids.select_grid, False)
                Button:
                    text: ">"
                    bold: True
                    on_release:
                        app.taxagroup_move_taxa(root.ids.select_grid, root.ids.all_grid, False)
                Button:
                    text: ">>"
                    bold: True
                    on_release:
                        app.taxagroup_move_taxa(root.ids.select_grid, root.ids.all_grid, True)
            Widget:
                size_hint_y: .15
        BoxLayout:
            orientation: "vertical"
            Label:
                canvas.before:
                    Color:
                        rgba: .2, .2, .2, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size
                text: "All taxa"
                size_hint_y: None
                height: 40
                bold: True
            Hseparator
            ScrollView:
                canvas.before:
                    Color:
                        rgba: .3, .3, .3, .5
                    Rectangle:
                        pos: self.pos
                        size: self.size
                GridLayout:
                    id: all_grid
                    cols:1
                    size_hint_y: None
                    height: 0
            Widget:
                size_hint_y: None
                height: 15
            Button:
                size_hint_y: .15
                text: "Cancel"
                on_release:
                    root.cancel()

<LoadDialog>:
    orientation: "vertical"
    spacing: 10
    padding: 10

    BoxLayout:
        size_hint_y: .15
        Widget
            size_hint_x: .45
        LightBox:
            canvas.before:
                Color:
                    rgba: (.3, .3, .3, .8)
                Rectangle:
                    pos: self.pos
                    size: self.size
            Label:
                size_hint_x: .8
                text: "Activate reverse concatenation"
                bold: True
                halign: "left"
                valign: "middle"
                text_size: self.size
            Switch:
                size_hint_x: .2
                id: rev_concatenation

        Widget:
            size_hint_x: .45

    FileChooserIconView:
        id: ld_filechooser

    BoxLayout:
        size_hint_y: None
        height: 35
        spacing: 10

        Button:
            id: part_bt
            text: "OK"
            on_release:
                app.save_reverseconc_settings(ld_filechooser.selection)
                root.cancel()


        Button:
            text: "Cancel"
            on_release: root.cancel()

<SaveDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        spacing: 10

        FileChooserListView:
            id: sd_filechooser
            text: "master"
            on_selection: text_input.text = self.selection

        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: 30
            Label:
                size_hint_x: None
                width: 100
                text: "File name:"
            TextInput:
                id: text_input
                multiline: False

        BoxLayout:
            size_hint_y: None
            height: 30

            Button:
                text: "Save"
                on_release: app.save_file(sd_filechooser.path, text_input.text, sd_filechooser.text)

            Button:
                text: "Cancel"
                on_release: root.cancel()

<SettingsBt@Button>:
    size_hint_x: .2
    disabled: True
    Image:
        source: "data/backgrounds/settings.png"
        pos: self.parent.x + 8, self.parent.y + 8
        #x: self.parent.x
        size: 18, 18
        allow_stretch: True

<FormatDialog>:
    padding: [30, 20, 30, 20]
    spacing: 10
    orientation: "vertical"
    id: format_dlg
    BoxLayout:
        ToggleButton:
            id: fasta
            state: "down"
            text: "Fasta"
        SettingsBt
    BoxLayout:
        ToggleButton:
            id: phylip
            text: "Phylip"
        SettingsBt:
            disabled: False
            on_release:
                app.save_phylip_extra()
    BoxLayout:
        ToggleButton:
            id: nexus
            text: "Nexus"
        SettingsBt
    BoxLayout:
        ToggleButton:
            id: mcmctree
            text: "MCMCTree"
        SettingsBt
    BoxLayout:
        ToggleButton:
            id: ima2
            text: "IMa2"
            disabled: True
        SettingsBt
    Widget
    BoxLayout:
        orientation: "horizontal"
        Button:
            text: "Done"
            on_release: app.save_format(format_dlg)
        Button:
            text: "Cancel"
            on_release: root.cancel()

<PhylipExtra@BoxLayout>:
    padding: 10
    spacing: 10
    orientation: "vertical"
    BoxLayout:
        Label:
            text: "Create partition file when concatenating"
        CheckBox:
            id: part_check
            size_hint_x: .2

    BoxLayout:
        size_hint_y: None
        height: 30
        orientation: "horizontal"
        spacing: 20
        Button:
            text: "Done"
            on_release:
                app.create_partfile = root.ids.part_check.active
                app.dismiss_subpopup()
        Button:
            text: "Cancel"
            on_release: root.cancel()

<ZorroDialog>:
    orientation: "vertical"
    padding: 10
    spacing: 15
    Switch:
        id: zorro_switch
    BoxLayout:
        spacing: 10
        size_hint_y: None
        height: 30
        Label:
            valign: "middle"
            halign: "left"
            text_size: self.size
            size_hint_x: .5
            text: "ZORRO files suffix:"
            bold: True
        TextInput:
            id: zorro_txt
            multiline: False
            size_hint_x: .5

    BoxLayout:
        orientation: "horizontal"
        spacing: 10
        Button:
            text: "Done"
            on_release: app.save_zorro_settings(zorro_txt.text)
        Button:
            text: "Cancel"
            on_release: root.cancel()


<TextDialog>:
    orientation: "vertical"
    padding: 10
    spacing: 10
    TextInput:
        id: txt_dlg
    BoxLayout:
        orientation: "horizontal"
        Button:
            text: "Done"
            on_release:
                app.save_hap_prefix(txt_dlg)
                root.cancel()
        Button:
            text: "Cancel"
            on_release: root.cancel()

<FilterDialog>:
    orientation: "vertical"
    padding: 20
    spacing: 20

    Label:
        text: "Gap threshold"
        bold: True
        halign: "left"
        valign: "middle"
        text_size: self.size

    BoxLayout:
        orientation: "horizontal"
        size_hint_y: None
        height: 30
        spacing: 20
        Slider:
            id: gap_sli
            size_hint_x: .85
            min: 0
            max: 100
            step: 1
            value: 25
        TextInput:
            size_hint_x: .15
            id: gap_ti
            text: "{}".format(round(gap_sli.value))
            multiline: False
            on_text_validate: if app.check_filters(gap_ti.text): gap_sli.value = app.check_filters(gap_ti.text)[1]

    Label:
        text: "Missing data threshold"
        bold: True
        halign: "left"
        valign: "middle"
        text_size: self.size

    BoxLayout:
        orientation: "horizontal"
        size_hint_y: None
        height: 30
        spacing: 20
        Slider:
            id: mis_sli
            size_hint_x: .85
            min: 0
            max: 100
            step: 1
            value: 50
        TextInput:
            size_hint_x: .15
            id: mis_ti
            text: "{}".format(round(mis_sli.value))
            multiline: False
            on_text_validate: if app.check_filters(mis_ti.text): mis_sli.value = app.check_filters(mis_ti.text)[1]

    BoxLayout:
        orientation: "horizontal"
        size_hint_y: None
        height: 30
        Button:
            text: "Done"
            on_release: app.save_filter(gap_sli.value, mis_sli.value)
        Button:
            text: "Cancel"
            on_release: root.cancel()

<MainHeader@ActionToggleButton>:
    size_hint_x: 1
    font_size: 20
    bold: True
    group: "main_header"
    disabled_color: (1, 1, 1, 1)

<SelectionBox@BoxLayout>:
    orientation: "horizontal"
    size_hint_y: None
    height: 35
    spacing: 20
    Button:
        text: "Select All"
        disabled: True
    Button:
        text: "Deselect All"
        disabled: True

<SideButton@ToggleButton>:
    group: "side_buttons"
    size_hint_y: .1
    font_size: 30
    bold: True
    background_down: "data/backgrounds/side_panel_bt_down.png"
    background_normal: "data/backgrounds/side_panel_bt_normal.png"
    background_disabled_down: "data/backgrounds/side_panel_bt_down.png"
    disabled_color: (1,1,1,1)

<ModuleLabel@Label>:
    size_hint_y: None
    height: 40
    bold: True
    font_size: 20
    canvas.before:
        Color:
            rgba: (.4,.4,.4,1)
        Rectangle:
            pos: self.pos
            size: self.size

############################ PROCESS SCREEN ####################################


<Sidebt@ToggleButton>:
    #background_color: [0,0,0,1]
    size_hint_y: None
    height: 50
    background_normal: "data/backgrounds/main_op_bt.png"
    background_down: "data/backgrounds/bt_sideprocess.png"
    background_disabled_down: "data/backgrounds/bt_sideprocess.png"
    disabled_color: (1, 1, 1, 1)
    halign: "center"
    valign: "middle"
    text_size: self.size
    bold: True
    font_size: 18
    padding: (20, 0)

# Vertical light grey separator
<Vseparator@Widget>:
    size_hint_x: None
    width: 3
    canvas:
        Color:
            rgb: .5, .5, .5
        Rectangle:
            pos: self.center_x, -5
            size: .3, self.height

<LightBox@BoxLayout>:
    height: 40
    orientation: "horizontal"
    size_hint_y: None
    padding: 10
    canvas.before:
        Color:
            rgba: (.2, .2, .2, .8)
        Rectangle:
            pos: self.pos
            size: self.size

<DarkBox@BoxLayout>:
    height: 60
    orientation: "horizontal"
    size_hint_y: None
    padding: 10

<Hseparator@Widget>:
    size_hint_y: None
    height: self.thickness + 2 * self.margin
    thickness: 1
    margin: 1
    canvas:
        Color:
            rgb: .5, .5, .5
        Rectangle:
            pos: self.x + self.margin, self.y + self.margin +1
            size: self.width - 2 * self.margin, self.thickness

<ProcessBt@Button>:
    background_normal: "data/backgrounds/bt_process.png"
    size_hint_x: .2
    bold: True
    shorten: True
    shorten_from: "right"
    text_size: self.size
    halign: "center"
    valign: "middle"

<ProcessGeneral@GridLayout>:
    size_hint_y: None
    #height: 45 * len([x for y in [z.children for z in self.children] for x in y])
    height: (45 * len(self.children[0].children))
    cols: 1
    opacity: 0
    __safe_id: [dataset_dropdown.__self__]
    GridLayout:
        cols: 1
        padding: 5
        spacing: 5
        size_hint_y: None
        height: 50 * len(self.children)
        LightBox:
            Label:
                markup: True
                text: "[size=15][b]General[/b][/size]"
                halign: "left"
                valign: "middle"
                color: [.85, .85, .85, 1]
                text_size: self.size

        DarkBox:
            Label:
                size_hint_x: .8
                markup: True
                text: "[size=18][b]Data set[/b][/size]\n[size=13]Select the active taxa data set to perform operations[/size]"
                halign: "left"
                valign: "middle"
                text_size: self.size
            ProcessBt:
                id: active_taxa_set
                text: "All taxa"
                on_release: dataset_dropdown.open(self)

            DropDown:
                id: dataset_dropdown
                on_select: active_taxa_set.text = args[1]
                canvas.before:
                    Color:
                        rgba: (0,0,0,1)
                    Rectangle:
                        pos: self.pos
                        size: self.size
                Widget:
                    size_hint_y: None
                    height: 3
                ProcessBt:
                    background_color: (1,1,1,.3)
                    text: 'All taxa'
                    size_hint_y: None
                    height: 40
                    on_release: dataset_dropdown.select(self.text)
                Widget:
                    size_hint_y: None
                    height: 3
                ProcessBt:
                    background_color: (1,1,1,.3)
                    text: 'Active taxa'
                    size_hint_y: None
                    height: 40
                    on_release: dataset_dropdown.select(self.text)


        Hseparator

        DarkBox:
            Label:
                size_hint_x: .8
                markup: True
                text: "[size=18][b]Output Format[/b][/size]\n[size=13]Choose the format of the output file(s). Multiple formats may be chosen[/size]"
                halign: "left"
                valign: "middle"
                text_size: self.size
            ProcessBt:
                id: conv_formatbt
                text: "Fasta"
                on_release: app.dialog_format()
        Hseparator

        DarkBox:
            id: dark_l
            Label:
                size_hint_x: .8
                markup: True
                text: "[size=18][b]Output file[/b][/size]\n[size=13]Save output file to...[/size]"
                halign: "left"
                valign: "middle"
                text_size: self.size
            ProcessBt:
                id: conv
                text: "Select..."
                on_release: app.dialog_filechooser("conversion")

        BoxLayout:
            padding: [100,10,100,10]
            size_hint_y: None
            height: 60
            Button:
                bold: True
                id: opt_bt
                text: "Show additional options"
                on_release:
                    app.toggle_process_options()

<AdditionalProcessContents@TabbedPanel>:
    do_default_tab: False
    tab_pos: "top_left"
    background_color: (0,0,0,0)
    opacity: 0

    TabbedPanelItem:
        id: main_tab
        text: "Formatting"

        GridLayout:
            id: main_grid
            cols: 1
            padding: 5
            spacing: 5
            opacity: 1

            LightBox:
                Label:
                    markup: True
                    text: "[size=15][b]Formatting options[/b][/size]"
                    halign: "left"
                    valign: "middle"
                    color: [.85, .85, .85, 1]
                    text_size: self.size

            DarkBox:
                Label:
                    size_hint_x: .8
                    markup: True
                    text: "[size=18][b]Interleave[/b][/size]\n[size=13]If sequences should be in interleave format or leave"
                    halign: "left"
                    valign: "middle"
                    text_size: self.size
                Switch:
                    id: interleave
                    size_hint_x: .2
                    on_active:
                        app.update_process_switch("interleave", self.active)

            Hseparator

            DarkBox:
                Label:
                    size_hint_x: .8
                    markup: True
                    text: "[size=18][b]ZORRO weights support[/b][/size]\n[size=13]Concatenation only. Concatenates auxiliary Zorro weight files into a single *_zorro.out file."
                    halign: "left"
                    valign: "middle"
                    text_size: self.size
                ProcessBt:
                    id: zorro
                    background_normal: "data/backgrounds/bt_process_off.png"
                    size_hint_x: .2
                    text: "OFF"
                    disabled: True
                    on_release:
                        app.dialog_zorro()

            Hseparator

            DarkBox:
                Label:
                    size_hint_x: .8
                    markup: True
                    text: "[size=18][b]Substitution model[/b][/size]\n[size=13] Specify the substitution model. Only supported for Nexus and Phylip formats"
                    halign: "left"
                    valign: "middle"
                    text_size: self.size
                ProcessBt:
                    text: "Select..."
                    disabled: True

    TabbedPanelItem:
        id: partition_tab
        text: "Partitions"

        GridLayout:
            id: partition_grid
            cols: 1
            padding: 5
            spacing: 5
            opacity: 1

            LightBox:
                Label:
                    markup: True
                    text: "[size=15][b]Partitioning options[/b][/size]"
                    halign: "left"
                    valign: "middle"
                    color: [.85, .85, .85, 1]
                    text_size: self.size

            DarkBox:
                Label:
                    size_hint_x: .8
                    markup: True
                    id: test2
                    text: "[size=18][b]Reverse concatenation[/b][/size]\n[size=13]In case the active input file is concatenated, revert to individual files (In development) [/size]"
                    halign: "left"
                    valign: "middle"
                    text_size: self.size
                Switch:
                    id: reverse_concatenation
                    size_hint_x: .2
                    disabled: True
                    on_active:
                        app.update_process_switch("rev_concatenation", self.active)

            Hseparator

            DarkBox:
                Label:
                    size_hint_x: .8
                    markup: True
                    id: test2
                    text: "[size=18][b]Partition file[/b][/size]\n[size=13]Provide the partitioning file either in nexus or RAxML like format [/size]"
                    halign: "left"
                    valign: "middle"
                    text_size: self.size
                ProcessBt:
                    text: "Select..."
                    disabled: True

    TabbedPanelItem:
        id: collapse_tab
        text: "Collapse"

        GridLayout:
            id: collapse_grid
            cols: 1
            padding: 5
            spacing: 5
            opacity: 1

            LightBox:
                Label:
                    size_hint_x: .8
                    markup: True
                    text: "[size=15][b]Sequence collapsing options[/b][/size]"
                    halign: "left"
                    valign: "middle"
                    color: [.85, .85, .85, 1]
                    text_size: self.size
                Switch:
                    id: collapse
                    size_hint_x: .2
                    on_active:
                        if self.active == True: root.ids.hapbt.disabled = False; root.ids.collapse_file.disabled = False
                        if self.active == False: root.ids.hapbt.disabled = True; root.ids.collapse_file.disabled = True
                        app.update_process_switch("collapse", self.active)

            DarkBox:
                Label:
                    size_hint_x: .8
                    markup: True
                    id: test2
                    text: "[size=18][b]Save in new output file[/b][/size]\n[size=13] If checked, the collapsed alignments will be saved in a file with an '_haplotype' suffix in addition to the main output file[/size]"
                    halign: "left"
                    valign: "middle"
                    text_size: self.size
                CheckBox:
                    id: collapse_file
                    size_hint_x: .2
                    disabled: True
                    on_active:
                        app.update_process_switch("collapse_file", self.active)

            Hseparator

            DarkBox:
                Label:
                    size_hint_x: .8
                    markup: True
                    id: test2
                    text: "[size=18][b]Haplotype prefix[/b][/size]\n[size=13] Select the prefix name for the haplotypes [/size]"
                    halign: "left"
                    valign: "middle"
                    text_size: self.size
                ProcessBt:
                    id: hapbt
                    disabled: True
                    text: "Select..."
                    on_release:
                        app.dialog_text("Haplotype prefix")

    TabbedPanelItem:
        id: filter_tab
        text: "Filter"

        GridLayout:
            id: filter_grid
            cols: 1
            padding: 5
            spacing: 5
            opacity: 1

            LightBox:
                Label:
                    size_hint_x: .8
                    markup: True
                    text: "[size=15][b]Sequence filter options[/b][/size]"
                    halign: "left"
                    valign: "middle"
                    color: [.85, .85, .85, 1]
                    text_size: self.size
                Switch:
                    id: filter
                    size_hint_x: .2
                    on_active:
                        if self.active == True: root.ids.cv_filterbt.disabled = False; root.ids.filter_file.disabled = False
                        if self.active == False: root.ids.cv_filterbt.disabled = True; root.ids.filter_file.disabled = True
                        app.update_process_switch("filter", self.active)

            DarkBox:
                Label:
                    size_hint_x: .8
                    markup: True
                    text: "[size=18][b]Save in new output file[/b][/size]\n[size=13] If checked, the filtered alignments will be saved in a file with an '_filtered' suffix in addition to the main output file[/size]"
                    halign: "left"
                    valign: "middle"
                    text_size: self.size
                CheckBox:
                    id: filter_file
                    size_hint_x: .2
                    disabled: True
                    on_active:
                        app.update_process_switch("filter_file", self.active)

            Hseparator

            DarkBox:
                Label:
                    size_hint_x: .8
                    markup: True
                    id: test2
                    text: "[size=18][b]Gap/Missing data filter[/b][/size]\n[size=13] Set filters to remove alignment columns with excessive gap and/or missing data [/size]"
                    halign: "left"
                    valign: "middle"
                    text_size: self.size
                ProcessBt:
                    id: cv_filterbt
                    disabled: True
                    text: "Set filters"
                    on_release: app.dialog_filter()

    TabbedPanelItem:
        id: gcoder_tab
        text: "Gcoder"

        GridLayout:
            id: gcoder_grid
            cols: 1
            padding: 5
            spacing: 5
            opacity: 1

            LightBox:
                Label:
                    size_hint_x: .8
                    markup: True
                    text: "[size=15][b]Gap coding options[/b][/size]"
                    halign: "left"
                    valign: "middle"
                    color: [.85, .85, .85, 1]
                    text_size: self.size
                Switch:
                    id: gcoder
                    size_hint_x: .2
                    disabled: True
                    on_active:
                        if self.active == True: root.ids.gcoder_file.disabled = False
                        if self.active == False: root.ids.gcoder_file.disabled = True
                        app.update_process_switch("gcoder", self.active)

            DarkBox:
                Label:
                    size_hint_x: .8
                    markup: True
                    text: "[size=18][b]Save in new output file[/b][/size]\n[size=13] If checked, the coded alignments will be saved in a file with an '_coded' suffix in addition to the main output file[/size]"
                    halign: "left"
                    valign: "middle"
                    text_size: self.size
                CheckBox:
                    id: gcoder_file
                    size_hint_x: .2
                    disabled: True
                    on_active:
                        app.update_process_switch("gcoder_file", self.active)

            Hseparator

            DarkBox:
                Label:
                    size_hint_x: .8
                    markup: True
                    text: "[size=18][b]Gap coding method[/b][/size]\n[size=13] Choose the coding method [/size]"
                    halign: "left"
                    valign: "middle"
                    text_size: self.size
                ProcessBt:
                    id: gcode_bt
                    disabled: True
                    text: "Choose..."

############################# ROOT SCREEN ######################################

FloatLayout:
    BoxLayout:
        orientation: "vertical"
        canvas.before:
            Color:
                rgba: (.8,.8,.8,.4)
            Rectangle:
                source: "data/backgrounds/master_background.jpg"
                pos: self.pos
                size: self.size

        ActionBar:
            pos_hint: {'top':1}

            ActionView:
                id: av
                ActionPrevious:
                    id: ap
                    size_hint_x: 0.4
                    title: "Menu"
                    with_previous: False
                    on_release:
                        app.toggle_sidepanel()
                    canvas.before:
                        Color:
                            rgba: (0.180, 0.180, 0.180, .8)
                        Rectangle:
                            pos: self.pos
                            size: self.size

                MainHeader:
                    id: h_ortho
                    text: "Orthology"
                    background_down: "data/backgrounds/orthology_down.png"
                    background_disabled_down: "data/backgrounds/orthology_down.png"
                    canvas.before:
                        Color:
                            rgba: [255, .200, .200, .3]
                        Rectangle:
                            pos: self.pos
                            size: self.size
                    on_release:
                        idx = app.screen_names.index("Orthology")
                        app.go_screen(idx)
                        app.toggle_groups(self)

                MainHeader:
                    id: h_process
                    text: "Process"
                    background_down: "data/backgrounds/process_down.png"
                    background_disabled_down: "data/backgrounds/process_down.png"
                    canvas.before:
                        Color:
                            rgba: (0.200, 0.200, 255, .3)
                        Rectangle:
                            pos: self.pos
                            size: self.size
                    on_release:
                        idx = app.screen_names.index("Process")
                        app.go_screen(idx)
                        app.toggle_groups(self)

                MainHeader:
                    id: h_stat
                    text: "Statistics"
                    background_down: "data/backgrounds/statistics_down.png"
                    background_disabled_down: "data/backgrounds/statistics_down.png"
                    canvas.before:
                        Color:
                            rgba: (0.200, 255, 0.200, .3)
                        Rectangle:
                            pos: self.pos
                            size: self.size
                    on_release:
                        idx = app.screen_names.index("Statistics")
                        app.go_screen(idx)
                        app.toggle_groups(self)

        BoxLayout:
            id: bx1
            orientation: "horizontal"

            # This BoxLayout will two ScrollView layouts.
            # The first will be the side column with several buttons that will
            # switch the content in the second scrollview layout
            # The second will be the main panel containing the important content
            FloatLayout:
                id: panel_float
                size_hint_x: None
                opacity: 1.2
                BoxLayout:
                    orientation: "horizontal"
                    id: main_box
                    size_hint_x: None
                    width: 0
                    canvas.before:
                        Color:
                            rgb: (.2, .2, .2)
                        Rectangle:
                            pos: self.pos
                            size: self.size

                    # Both these ScrollView layouts are here because it is the only way
                    # that the children layouts' width will be truly 0. If a
                    # BoxLayout, Floatlayout, etc would be used, the contents would
                    # still appear.
                    ScrollView:
                        id: sp_bts
                        size_hint_x: None
                        width: 0
                        BoxLayout:
                            orientation: "vertical"
                            SideButton:
                                id: first_sidebt
                                state: "down"
                                disabled: True
                                text: "H"
                                on_release:
                                    carousel.load_slide(carousel.slides[0])
                                    app.toggle_groups(self)
                            SideButton:
                                id: second_sidebt
                                text: "G"
                                on_release:
                                    carousel.load_slide(carousel.slides[1])
                                    app.toggle_groups(self)
                            SideButton:
                                id: third_sidebt
                                text: "Q"
                                on_release:
                                    app.save_operation_queue()
                                    carousel.load_slide(carousel.slides[2])
                                    app.toggle_groups(self)
                            Widget:
                                size_hint_y: .8
                                canvas.before:
                                    Color:
                                        rgba: (0.180, 0.180, 0.180, .8)
                                    Rectangle:
                                        pos: self.pos
                                        size: self.size
                    ScrollView:
                        id: sv_over
                        size_hint_x: None
                        width: 0
                        BoxLayout:
                            orientation: "vertical"
                            Button:
                                id: first_lb
                                background_normal: "data/backgrounds/side_panel_bt_normal.png"
                                size_hint_y: .1
                                border: (16,16,32,16)
                                text: "Some stuff"
                            Button:
                                id: second_lb
                                background_normal: "data/backgrounds/side_panel_bt_normal.png"
                                size_hint_y: .1
                                text: "Some stuff"
                            Widget:
                                size_hint_y: .8
                                canvas.before:
                                    Color:
                                        rgba: (0.180, 0.180, 0.180, .8)
                                    Rectangle:
                                        pos: self.pos
                                        size: self.size

                    ScrollView:
                        id: sp
                        size_hint_x: .8
                        width: 0

                        Carousel:
                            id: carousel
                            direction: "bottom"
                            BoxLayout:
                                orientation: "vertical"
                                padding: 10
                                spacing: 10
                                id: main_slide

                                canvas.before:
                                    Color:
                                        rgba: (0.180, 0.180, 0.180, .8)
                                    Rectangle:
                                        pos: self.pos
                                        size: self.size

                                BoxLayout:
                                    size_hint_y: None
                                    height: 50
                                    padding: (15,0,15, 0)
                                    Button:
                                        id: sv_but
                                        background_normal: "data/backgrounds/process_exec.png"
                                        text: "Open file(s)"
                                        bold: True
                                        font_size: 18

                                        on_release:
                                            idx = app.screen_names.index("fc")
                                            app.go_screen(idx)
                                            app.toggle_sidepanel()

                                TabbedPanel:
                                    id: main_tp
                                    do_default_tab: False
                                    background_color: (0,0,0,0)
                                    tab_pos: "top_mid"

                                    TabbedPanelItem:
                                        id: file_tp
                                        text: "Files"

                                        BoxLayout:
                                            orientation: "vertical"
                                            spacing: 20
                                            ScrollView:
                                                size_hint_y: .9
                                                height: root.height*.65
                                                id: sv_file
                                                GridLayout:
                                                    cols: 3
                                                    size_hint_y: None
                                                    id: file_sl
                                                    padding: 10
                                                    spacing: 5
                                                    height: 30
                                                    #minimum_height: root.height*.1

                                                    Button:
                                                        id: file_temp
                                                        height: 40
                                                        disabled: True
                                                        size_hint_y: None
                                                        #size_hint_x: None
                                                        text: "No files loaded"
                                            Label:
                                                id: file_lab
                                                size_hint_y: None
                                                height: 1
                                                color: (.6, .6, .6, 1)
                                            SelectionBox:
                                                id: sb_file

                                    TabbedPanelItem:
                                        id: taxa_tp
                                        text: "Taxa"
                                        BoxLayout:
                                            orientation: "vertical"
                                            spacing: 20
                                            ScrollView:
                                                size_hint_y: .9
                                                height: root.height*.65
                                                id: sv_sp
                                                GridLayout:
                                                    cols: 3
                                                    size_hint_y: None
                                                    id: taxa_sl
                                                    padding: 10
                                                    spacing: 5
                                                    Button:
                                                        id: species_temp
                                                        height: 40
                                                        disabled: True
                                                        size_hint_y: None
                                                        text: "No species loaded"
                                            Label:
                                                id: sp_lab
                                                size_hint_y: None
                                                height: 1
                                                color: (.6, .6, .6, 1)
                                            SelectionBox:
                                                id: sb_taxa
                            BoxLayout:
                                orientation: "vertical"
                                padding: 10
                                spacing: 5
                                Label:
                                    size_hint_y: .1
                                    text: "Taxa groups"
                                    font_size: 18
                                    halign: "center"
                                    valign: "middle"
                                    text_size: self.size
                                    bold: True
                                    canvas.before:
                                        Color:
                                            rgba: .35, .35, .35, 1
                                        Rectangle:
                                            pos: self.pos
                                            size: self.size
                                Hseparator
                                ScrollView:
                                    size_hint_y: .8
                                    GridLayout:
                                        id: group_grid
                                        size_hint_y: None
                                        height: 0
                                        padding: 5
                                        spacing: 5
                                        cols: 2
                                Button:
                                    size_hint_y: .1
                                    bold: True
                                    text: "Set new taxa group"
                                    id: tx_group_bt
                                    disabled: True
                                    on_release:
                                        app.dialog_taxagroup()

                            BoxLayout:
                                orientation: "vertical"
                                padding: 10
                                spacing: 5
                                Label:
                                    size_hint_y: .1
                                    text: "Operations queue"
                                    font_size: 18
                                    halign: "center"
                                    valign: "middle"
                                    text_size: self.size
                                    bold: True
                                    canvas.before:
                                        Color:
                                            rgba: .35, .35, .35, 1
                                        Rectangle:
                                            pos: self.pos
                                            size: self.size
                                Hseparator
                                ScrollView:
                                    size_hint_y: .8
                                    id: op_sv
                                Widget:
                                    size_hint_y: .1


            ScreenManager:
                id: sm

